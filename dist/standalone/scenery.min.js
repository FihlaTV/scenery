(function(){(function(t){function e(e){return"function"==typeof m[e]&&(m[e]=m[e](t,u,c)),m[e]}function n(e,i,n){m[e]=n?i(t,u,c):i}function s(t,e){var i=!1,n=t.charAt(0).toUpperCase()+t.slice(1),s=h.length,r=e.style;if("string"==typeof r[t])i=!0;else for(;s--;)if("string"==typeof r[h[s]+n]){i=!0;break}return i}function r(t){if(t)for(;t.lastChild;)t.removeChild(t.lastChild);return t}function o(t,e){var i=typeof t[e];return"object"==i?!!t[e]:!a[i]}var a={"boolean":1,number:1,string:1,undefined:1},h=["Webkit","Moz","O","ms","Khtml"],u=o(t,"document")&&t.document,c=u&&o(u,"createElement")&&u.createElement("DiV"),l="object"==typeof exports&&exports,d="object"==typeof module&&module,m={};e.add=n,e.clearElement=r,e.cssprop=s,e.isHostType=o,e._tests=m,e.add("dom",function(t,e,i){return e&&i&&o(t,"location")&&o(e,"documentElement")&&o(e,"getElementById")&&o(e,"getElementsByName")&&o(e,"getElementsByTagName")&&o(e,"createComment")&&o(e,"createElement")&&o(e,"createTextNode")&&o(i,"appendChild")&&o(i,"insertBefore")&&o(i,"removeChild")&&o(i,"getAttribute")&&o(i,"setAttribute")&&o(i,"removeAttribute")&&o(i,"style")&&"string"==typeof i.style.cssText});try{document.execCommand("BackgroundImageCache",!1,!0)}catch(f){}"function"==typeof i&&"object"==typeof i.amd&&i.amd?i("has",function(){return e}):l?d&&d.exports==l?(d.exports=e).has=e:l.has=e:t.has=e})(this);var t,e,i;(function(n){function s(t,e){return S.call(t,e)}function r(t,e){var i,n,s,r,o,a,h,u,c,l,d=e&&e.split("/"),m=v.map,f=m&&m["*"]||{};if(t&&"."===t.charAt(0))if(e){for(d=d.slice(0,d.length-1),t=d.concat(t.split("/")),u=0;t.length>u;u+=1)if(l=t[u],"."===l)t.splice(u,1),u-=1;else if(".."===l){if(1===u&&(".."===t[2]||".."===t[0]))break;u>0&&(t.splice(u-1,2),u-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((d||f)&&m){for(i=t.split("/"),u=i.length;u>0;u-=1){if(n=i.slice(0,u).join("/"),d)for(c=d.length;c>0;c-=1)if(s=m[d.slice(0,c).join("/")],s&&(s=s[n])){r=s,o=u;break}if(r)break;!a&&f&&f[n]&&(a=f[n],h=u)}!r&&a&&(r=a,o=h),r&&(i.splice(0,o,r),t=i.join("/"))}return t}function o(t,e){return function(){return m.apply(n,x.call(arguments,0).concat([t,e]))}}function a(t){return function(e){return r(e,t)}}function h(t){return function(e){g[t]=e}}function u(t){if(s(y,t)){var e=y[t];delete y[t],T[t]=!0,d.apply(n,e)}if(!s(g,t)&&!s(T,t))throw Error("No "+t);return g[t]}function c(t){var e,i=t?t.indexOf("!"):-1;return i>-1&&(e=t.substring(0,i),t=t.substring(i+1,t.length)),[e,t]}function l(t){return function(){return v&&v.config&&v.config[t]||{}}}var d,m,f,p,g={},y={},v={},T={},S=Object.prototype.hasOwnProperty,x=[].slice;f=function(t,e){var i,n=c(t),s=n[0];return t=n[1],s&&(s=r(s,e),i=u(s)),s?t=i&&i.normalize?i.normalize(t,a(e)):r(t,e):(t=r(t,e),n=c(t),s=n[0],t=n[1],s&&(i=u(s))),{f:s?s+"!"+t:t,n:t,pr:s,p:i}},p={require:function(t){return o(t)},exports:function(t){var e=g[t];return e!==void 0?e:g[t]={}},module:function(t){return{id:t,uri:"",exports:g[t],config:l(t)}}},d=function(t,e,i,r){var a,c,l,d,m,v,S=[];if(r=r||t,"function"==typeof i){for(e=!e.length&&i.length?["require","exports","module"]:e,m=0;e.length>m;m+=1)if(d=f(e[m],r),c=d.f,"require"===c)S[m]=p.require(t);else if("exports"===c)S[m]=p.exports(t),v=!0;else if("module"===c)a=S[m]=p.module(t);else if(s(g,c)||s(y,c)||s(T,c))S[m]=u(c);else{if(!d.p)throw Error(t+" missing "+c);d.p.load(d.n,o(r,!0),h(c),{}),S[m]=g[c]}l=i.apply(g[t],S),t&&(a&&a.exports!==n&&a.exports!==g[t]?g[t]=a.exports:l===n&&v||(g[t]=l))}else t&&(g[t]=i)},t=e=m=function(t,e,i,s,r){return"string"==typeof t?p[t]?p[t](e):u(f(t,e).f):(t.splice||(v=t,e.splice?(t=e,e=i,i=null):t=n),e=e||function(){},"function"==typeof i&&(i=s,s=r),s?d(n,t,e,i):setTimeout(function(){d(n,t,e,i)},4),m)},m.config=function(t){return v=t,v.deps&&m(v.deps,v.callback),m},i=function(t,e,i){e.splice||(i=e,e=[]),s(g,t)||s(y,t)||(y[t]=[t,e,i])},i.amd={jQuery:!0}})(),i("almond",function(){}),i("SCENERY/scenery",["require"],function(){return{}}),i("ASSERT/assert",["require"],function(){var t=function(t,e){var i="assert."+t,n=window.has&&void 0!==window.has(i),s=n?!window.has(i):e;return s?null:function(t,e){var i="function"==typeof t?t():t;if(!i)throw Error("Assertion failed: "+e)}};return t}),i("SCENERY/debug/DebugContext",["require","ASSERT/assert","SCENERY/scenery"],function(t){function e(t){return JSON.stringify(t)}function i(t){console.log("context."+t+";")}function n(t){i(t)}function s(t,n){i(t+" = "+e(n))}function r(t,n){void 0===n||0===n.length?i(t+"()"):i(t+"( "+_.reduce(n,function(t,i){return t.length>0?t+", "+e(i):e(i)},"")+" )")}t("ASSERT/assert")("scenery");var o=t("SCENERY/scenery");o.DebugContext=function(t){this._context=t,t&&!t.ellipse&&(this.ellipse=t.ellipse)};var a=o.DebugContext;return a.prototype={constructor:a,get canvas(){return n("canvas"),this._context.canvas},get width(){return n("width"),this._context.width},get height(){return n("height"),this._context.height},commit:function(){r("commit"),this._context.commit()},save:function(){r("save"),this._context.save()},restore:function(){r("restore"),this._context.restore()},get currentTransform(){return n("currentTransform"),this._context.currentTransform},set currentTransform(t){s("currentTransform",t),this._context.currentTransform=t},scale:function(t,e){r("scale",[t,e]),this._context.scale(t,e)},rotate:function(t){r("rotate",[t]),this._context.rotate(t)},translate:function(t,e){r("translate",[t,e]),this._context.translate(t,e)},transform:function(t,e,i,n,s,o){r("transform",[t,e,i,n,s,o]),this._context.transform(t,e,i,n,s,o)},setTransform:function(t,e,i,n,s,o){r("setTransform",[t,e,i,n,s,o]),this._context.setTransform(t,e,i,n,s,o)},resetTransform:function(){r("resetTransform"),this._context.resetTransform()},get globalAlpha(){return n("globalAlpha"),this._context.globalAlpha},set globalAlpha(t){s("globalAlpha",t),this._context.globalAlpha=t},get globalCompositeOperation(){return n("globalCompositeOperation"),this._context.globalCompositeOperation},set globalCompositeOperation(t){s("globalCompositeOperation",t),this._context.globalCompositeOperation=t},get imageSmoothingEnabled(){return n("imageSmoothingEnabled"),this._context.imageSmoothingEnabled},set imageSmoothingEnabled(t){s("imageSmoothingEnabled",t),this._context.imageSmoothingEnabled=t},get strokeStyle(){return n("strokeStyle"),this._context.strokeStyle},set strokeStyle(t){s("strokeStyle",t),this._context.strokeStyle=t},get fillStyle(){return n("fillStyle"),this._context.fillStyle},set fillStyle(t){s("fillStyle",t),this._context.fillStyle=t},createLinearGradient:function(t,e,i,n){return r("createLinearGradient",[t,e,i,n]),this._context.createLinearGradient(t,e,i,n)},createRadialGradient:function(t,e,i,n,s,o){return r("createRadialGradient",[t,e,i,n,s,o]),this._context.createRadialGradient(t,e,i,n,s,o)},createPattern:function(t,e){return r("createPattern",[t,e]),this._context.createPattern(t,e)},get shadowOffsetX(){return n("shadowOffsetX"),this._context.shadowOffsetX},set shadowOffsetX(t){s("shadowOffsetX",t),this._context.shadowOffsetX=t},get shadowOffsetY(){return n("shadowOffsetY"),this._context.shadowOffsetY},set shadowOffsetY(t){s("shadowOffsetY",t),this._context.shadowOffsetY=t},get shadowBlur(){return n("shadowBlur"),this._context.shadowBlur},set shadowBlur(t){s("shadowBlur",t),this._context.shadowBlur=t},get shadowColor(){return n("shadowColor"),this._context.shadowColor},set shadowColor(t){s("shadowColor",t),this._context.shadowColor=t},clearRect:function(t,e,i,n){r("clearRect",[t,e,i,n]),this._context.clearRect(t,e,i,n)},fillRect:function(t,e,i,n){r("fillRect",[t,e,i,n]),this._context.fillRect(t,e,i,n)},strokeRect:function(t,e,i,n){r("strokeRect",[t,e,i,n]),this._context.strokeRect(t,e,i,n)},get fillRule(){return n("fillRule"),this._context.fillRule},set fillRule(t){s("fillRule",t),this._context.fillRule=t},beginPath:function(){r("beginPath"),this._context.beginPath()},fill:function(t){r("fill",t?[t]:void 0),this._context.fill(t)},stroke:function(t){r("stroke",t?[t]:void 0),this._context.stroke(t)},drawSystemFocusRing:function(t,e){r("drawSystemFocusRing",e?[t,e]:[t]),this._context.drawSystemFocusRing(t,e)},drawCustomFocusRing:function(t,e){return r("drawCustomFocusRing",e?[t,e]:[t]),this._context.drawCustomFocusRing(t,e)},scrollPathIntoView:function(t){r("scrollPathIntoView",t?[t]:void 0),this._context.scrollPathIntoView(t)},clip:function(t){r("clip",t?[t]:void 0),this._context.clip(t)},resetClip:function(){r("resetClip"),this._context.resetClip()},isPointInPath:function(t,e,i){return r("isPointInPath",i?[t,e,i]:[t,e]),this._context.isPointInPath(t,e,i)},fillText:function(t,e,i,n){r("fillText",void 0!==n?[t,e,i,n]:[t,e,i]),this._context.fillText(t,e,i,n)},strokeText:function(t,e,i,n){r("strokeText",void 0!==n?[t,e,i,n]:[t,e,i]),this._context.strokeText(t,e,i,n)},measureText:function(t){return r("measureText",[t]),this._context.measureText(t)},drawImage:function(t,e,i,n,s,o,a,h,u){r("drawImage",void 0!==n?void 0!==o?[t,e,i,n,s,o,a,h,u]:[t,e,i,n,s]:[t,e,i]),this._context.drawImage(t,e,i,n,s,o,a,h,u)},addHitRegion:function(t){r("addHitRegion",[t]),this._context.addHitRegion(t)},removeHitRegion:function(t){r("removeHitRegion",[t]),this._context.removeHitRegion(t)},createImageData:function(t,e){return r("createImageData",void 0!==e?[t,e]:[t]),this._context.createImageData(t,e)},createImageDataHD:function(t,e){return r("createImageDataHD",[t,e]),this._context.createImageDataHD(t,e)},getImageData:function(t,e,i,n){return r("getImageData",[t,e,i,n]),this._context.getImageData(t,e,i,n)},getImageDataHD:function(t,e,i,n){return r("getImageDataHD",[t,e,i,n]),this._context.getImageDataHD(t,e,i,n)},putImageData:function(t,e,i,n,s,o,a){r("putImageData",void 0!==n?[t,e,i,n,s,o,a]:[t,e,i]),this._context.putImageData(t,e,i,n,s,o,a)},putImageDataHD:function(t,e,i,n,s,o,a){r("putImageDataHD",void 0!==n?[t,e,i,n,s,o,a]:[t,e,i]),this._context.putImageDataHD(t,e,i,n,s,o,a)},get lineWidth(){return n("lineWidth"),this._context.lineWidth},set lineWidth(t){s("lineWidth",t),this._context.lineWidth=t},get lineCap(){return n("lineCap"),this._context.lineCap},set lineCap(t){s("lineCap",t),this._context.lineCap=t},get lineJoin(){return n("lineJoin"),this._context.lineJoin},set lineJoin(t){s("lineJoin",t),this._context.lineJoin=t},get miterLimit(){return n("miterLimit"),this._context.miterLimit},set miterLimit(t){s("miterLimit",t),this._context.miterLimit=t},setLineDash:function(t){r("setLineDash",[t]),this._context.setLineDash(t)},getLineDash:function(){return r("getLineDash"),this._context.getLineDash()},get lineDashOffset(){return n("lineDashOffset"),this._context.lineDashOffset},set lineDashOffset(t){s("lineDashOffset",t),this._context.lineDashOffset=t},get font(){return n("font"),this._context.font},set font(t){s("font",t),this._context.font=t},get textAlign(){return n("textAlign"),this._context.textAlign},set textAlign(t){s("textAlign",t),this._context.textAlign=t},get textBaseline(){return n("textBaseline"),this._context.textBaseline},set textBaseline(t){s("textBaseline",t),this._context.textBaseline=t},get direction(){return n("direction"),this._context.direction},set direction(t){s("direction",t),this._context.direction=t},closePath:function(){r("closePath"),this._context.closePath()},moveTo:function(t,e){r("moveTo",[t,e]),this._context.moveTo(t,e)},lineTo:function(t,e){r("lineTo",[t,e]),this._context.lineTo(t,e)},quadraticCurveTo:function(t,e,i,n){r("quadraticCurveTo",[t,e,i,n]),this._context.quadraticCurveTo(t,e,i,n)},bezierCurveTo:function(t,e,i,n,s,o){r("bezierCurveTo",[t,e,i,n,s,o]),this._context.bezierCurveTo(t,e,i,n,s,o)},arcTo:function(t,e,i,n,s,o,a){r("arcTo",void 0!==o?[t,e,i,n,s,o,a]:[t,e,i,n,s]),this._context.arcTo(t,e,i,n,s,o,a)},rect:function(t,e,i,n){r("rect",[t,e,i,n]),this._context.rect(t,e,i,n)},arc:function(t,e,i,n,s,o){r("arc",[t,e,i,n,s,o]),this._context.arc(t,e,i,n,s,o)},ellipse:function(t,e,i,n,s,o,a,h){r("ellipse",[t,e,i,n,s,o,a,h]),this._context.ellipse(t,e,i,n,s,o,a,h)}},a}),i("SCENERY/input/Event",["require","ASSERT/assert","SCENERY/scenery"],function(t){var e=t("ASSERT/assert")("scenery"),i=t("SCENERY/scenery");i.Event=function(t){e&&e(t.trail&&t.type&&t.pointer&&t.domEvent&&t.target,"Missing required scenery.Event argument"),this.handled=!1,this.aborted=!1,this.trail=t.trail,this.type=t.type,this.pointer=t.pointer,this.domEvent=t.domEvent,this.currentTarget=t.currentTarget,this.target=t.trail};var n=i.Event;return n.prototype={constructor:n,handle:function(){this.handled=!0},abort:function(){this.handled=!0,this.aborted=!0}},n}),i("DOT/dot",["require"],function(){return{}}),i("DOT/Util",["require","ASSERT/assert","DOT/dot"],function(t){var e=t("ASSERT/assert")("dot"),i=t("DOT/dot");i.Util={testAssert:function(){return"assert.dot: "+(e?"true":"false")},clamp:function(t,e,i){return e>t?e:t>i?i:t},rangeInclusive:function(t,e){if(t>e)return[];for(var i=Array(e-t+1),n=t;e>=n;n++)i[n-t]=n;return i},rangeExclusive:function(t,e){return n.rangeInclusive(t+1,e-1)},toRadians:function(t){return Math.PI*t/180},toDegrees:function(t){return 180*t/Math.PI},lineLineIntersection:function(t,e,n,s){return new i.Vector2(((t.x*e.y-t.y*e.x)*(n.x-s.x)-(t.x-e.x)*(n.x*s.y-n.y*s.x))/((t.x-e.x)*(n.y-s.y)-(t.y-e.y)*(n.x-s.x)),((t.x*e.y-t.y*e.x)*(n.y-s.y)-(t.y-e.y)*(n.x*s.y-n.y*s.x))/((t.x-e.x)*(n.y-s.y)-(t.y-e.y)*(n.x-s.x)))},solveQuadraticRootsReal:function(t,e,i){var n=e*e-4*t*i;if(0>n)return[];var s=Math.sqrt(n);return[(-e-s)/(2*t),(-e+s)/(2*t)]},solveCubicRootsReal:function(t,e,i,s){if(0===t)return n.solveQuadraticRootsReal(e,i,s);if(0===s)return n.solveQuadraticRootsReal(t,e,i);e/=t,i/=t,s/=t;var r=(3*i-e*e)/9,o=(-(27*s)+e*(9*i-2*e*e))/54,a=r*r*r+o*o,h=e/3;if(a>0){var u=Math.sqrt(a);return[n.cubeRoot(o+u)+n.cubeRoot(o-u)-h]}if(0===a){var c=n.cubeRoot(o),l=h-c;return[-h+2*c,l,l]}var d=-r*r*r;d=Math.acos(o/Math.sqrt(d));var m=2*Math.sqrt(-r);return[-h+m*Math.cos(d/3),-h+m*Math.cos((d+2*Math.PI)/3),-h+m*Math.cos((d+4*Math.PI)/3)]},cubeRoot:function(t){return t>=0?Math.pow(t,1/3):-Math.pow(-t,1/3)}};var n=i.Util;return i.testAssert=n.testAssert,i.clamp=n.clamp,i.rangeInclusive=n.rangeInclusive,i.rangeExclusive=n.rangeExclusive,i.toRadians=n.toRadians,i.toDegrees=n.toDegrees,n}),i("DOT/Vector2",["require","ASSERT/assert","DOT/dot","DOT/Util"],function(t){var e=t("ASSERT/assert")("dot"),i=t("DOT/dot");t("DOT/Util"),i.Vector2=function(t,e){this.x=t||0,this.y=e||0};var n=i.Vector2;n.createPolar=function(t,e){return new n(Math.cos(e),Math.sin(e)).timesScalar(t)},n.prototype={constructor:n,isVector2:!0,dimension:2,magnitude:function(){return Math.sqrt(this.magnitudeSquared())},magnitudeSquared:function(){return this.dot(this)},distance:function(t){return this.minus(t).magnitude()},distanceSquared:function(t){return this.minus(t).magnitudeSquared()},dot:function(t){return this.x*t.x+this.y*t.y},equals:function(t){return this.x===t.x&&this.y===t.y},equalsEpsilon:function(t,e){return e||(e=0),e>=Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},isFinite:function(){return isFinite(this.x)&&isFinite(this.y)},copy:function(){return new n(this.x,this.y)},crossScalar:function(t){return this.x*t.y-this.y*t.x},normalized:function(){var t=this.magnitude();if(0===t)throw Error("Cannot normalize a zero-magnitude vector");return new n(this.x/t,this.y/t)},timesScalar:function(t){return new n(this.x*t,this.y*t)},times:function(t){return e&&e(void 0===t.dimension),this.timesScalar(t)},componentTimes:function(t){return new n(this.x*t.x,this.y*t.y)},plus:function(t){return new n(this.x+t.x,this.y+t.y)},plusScalar:function(t){return new n(this.x+t,this.y+t)},minus:function(t){return new n(this.x-t.x,this.y-t.y)},minusScalar:function(t){return new n(this.x-t,this.y-t)},dividedScalar:function(t){return new n(this.x/t,this.y/t)},negated:function(){return new n(-this.x,-this.y)},angle:function(){return Math.atan2(this.y,this.x)},perpendicular:function(){return new n(this.y,-this.x)},angleBetween:function(t){return Math.acos(i.clamp(this.normalized().dot(t.normalized()),-1,1))},rotated:function(t){return n.createPolar(this.magnitude(),this.angle()+t)},blend:function(t,e){return this.plus(t.minus(this).times(e))},toString:function(){return"Vector2("+this.x+", "+this.y+")"},toVector3:function(){return new i.Vector3(this.x,this.y)},set:function(t,e){return this.x=t,this.y=e,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},add:function(t){return this.x+=t.x,this.y+=t.y,this},addScalar:function(t){return this.x+=t,this.y+=t,this},subtract:function(t){return this.x-=t.x,this.y-=t.y,this},subtractScalar:function(t){return this.x-=t,this.y-=t,this},componentMultiply:function(t){return this.x*=t.x,this.y*=t.y,this},divideScalar:function(t){return this.x/=t,this.y/=t,this},negate:function(){return this.x=-this.x,this.y=-this.y,this}},n.Immutable=function(t,e){this.x=t||0,this.y=e||0};var s=n.Immutable;return s.prototype=new n,s.prototype.constructor=s,s.mutableOverrideHelper=function(t){s.prototype[t]=function(){throw Error("Cannot call mutable method '"+t+"' on immutable Vector2")}},s.mutableOverrideHelper("set"),s.mutableOverrideHelper("setX"),s.mutableOverrideHelper("setY"),s.mutableOverrideHelper("copy"),s.mutableOverrideHelper("add"),s.mutableOverrideHelper("addScalar"),s.mutableOverrideHelper("subtract"),s.mutableOverrideHelper("subtractScalar"),s.mutableOverrideHelper("componentMultiply"),s.mutableOverrideHelper("divideScalar"),s.mutableOverrideHelper("negate"),n.ZERO=new s(0,0),n.X_UNIT=new s(1,0),n.Y_UNIT=new s(0,1),n}),i("DOT/Vector4",["require","ASSERT/assert","DOT/dot","DOT/Util"],function(t){var e=t("ASSERT/assert")("dot"),i=t("DOT/dot");t("DOT/Util"),i.Vector4=function(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==n?n:1};var n=i.Vector4;n.prototype={constructor:n,magnitude:function(){return Math.sqrt(this.magnitudeSquared())},magnitudeSquared:function(){this.dot(this)},distance:function(t){return this.minus(t).magnitude()},distanceSquared:function(t){return this.minus(t).magnitudeSquared()},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},isFinite:function(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.z)&&isFinite(this.w)},normalized:function(){var t=this.magnitude();if(0===t)throw Error("Cannot normalize a zero-magnitude vector");return new n(this.x/t,this.y/t,this.z/t,this.w/t)},timesScalar:function(t){return new n(this.x*t,this.y*t,this.z*t,this.w*t)},times:function(t){return e&&e(void 0===t.dimension),this.timesScalar(t)},componentTimes:function(t){return new n(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)},plus:function(t){return new n(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},plusScalar:function(t){return new n(this.x+t,this.y+t,this.z+t,this.w+t)},minus:function(t){return new n(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},minusScalar:function(t){return new n(this.x-t,this.y-t,this.z-t,this.w-t)},dividedScalar:function(t){return new n(this.x/t,this.y/t,this.z/t,this.w/t)},negated:function(){return new n(-this.x,-this.y,-this.z,-this.w)},angleBetween:function(t){return Math.acos(i.clamp(this.normalized().dot(t.normalized()),-1,1))},blend:function(t,e){return this.plus(t.minus(this).times(e))},toString:function(){return"Vector4("+this.x+", "+this.y+", "+this.z+", "+this.w+")"},toVector3:function(){return new i.Vector3(this.x,this.y,this.z)},set:function(t,e,i,n){this.x=t,this.y=e,this.z=i,this.w=n},setX:function(t){this.x=t},setY:function(t){this.y=t},setZ:function(t){this.z=t},setW:function(t){this.w=t},copy:function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w},add:function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w},addScalar:function(t){this.x+=t,this.y+=t,this.z+=t,this.w+=t},subtract:function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w},subtractScalar:function(t){this.x-=t,this.y-=t,this.z-=t,this.w-=t},componentMultiply:function(t){this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w},divideScalar:function(t){this.x/=t,this.y/=t,this.z/=t,this.w/=t},negate:function(){this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w},equals:function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},equalsEpsilon:function(t,e){return e||(e=0),e>=Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)+Math.abs(this.w-t.w)},isVector4:!0,dimension:4},n.Immutable=function(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==n?n:1};var s=n.Immutable;return s.prototype=new n,s.prototype.constructor=s,s.mutableOverrideHelper=function(t){s.prototype[t]=function(){throw Error("Cannot call mutable method '"+t+"' on immutable Vector4")}},s.mutableOverrideHelper("set"),s.mutableOverrideHelper("setX"),s.mutableOverrideHelper("setY"),s.mutableOverrideHelper("setZ"),s.mutableOverrideHelper("setW"),s.mutableOverrideHelper("copy"),s.mutableOverrideHelper("add"),s.mutableOverrideHelper("addScalar"),s.mutableOverrideHelper("subtract"),s.mutableOverrideHelper("subtractScalar"),s.mutableOverrideHelper("componentMultiply"),s.mutableOverrideHelper("divideScalar"),s.mutableOverrideHelper("negate"),n.ZERO=new s(0,0,0,0),n.X_UNIT=new s(1,0,0,0),n.Y_UNIT=new s(0,1,0,0),n.Z_UNIT=new s(0,0,1,0),n.W_UNIT=new s(0,0,0,1),n}),i("DOT/Vector3",["require","ASSERT/assert","DOT/dot","DOT/Util","DOT/Vector2","DOT/Vector4"],function(t){var e=t("ASSERT/assert")("dot"),i=t("DOT/dot");t("DOT/Util"),t("DOT/Vector2"),t("DOT/Vector4"),i.Vector3=function(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0};var n=i.Vector3;n.prototype={constructor:n,magnitude:function(){return Math.sqrt(this.magnitudeSquared())},magnitudeSquared:function(){return this.dot(this)},distance:function(t){return this.minus(t).magnitude()},distanceSquared:function(t){return this.minus(t).magnitudeSquared()},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},isFinite:function(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.z)},cross:function(t){return new n(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},normalized:function(){var t=this.magnitude();if(0===t)throw Error("Cannot normalize a zero-magnitude vector");return new n(this.x/t,this.y/t,this.z/t)},timesScalar:function(t){return new n(this.x*t,this.y*t,this.z*t)},times:function(t){return e&&e(void 0===t.dimension),this.timesScalar(t)},componentTimes:function(t){return new n(this.x*t.x,this.y*t.y,this.z*t.z)},plus:function(t){return new n(this.x+t.x,this.y+t.y,this.z+t.z)},plusScalar:function(t){return new n(this.x+t,this.y+t,this.z+t)},minus:function(t){return new n(this.x-t.x,this.y-t.y,this.z-t.z)},minusScalar:function(t){return new n(this.x-t,this.y-t,this.z-t)},dividedScalar:function(t){return new n(this.x/t,this.y/t,this.z/t)},negated:function(){return new n(-this.x,-this.y,-this.z)},angleBetween:function(t){return Math.acos(i.clamp(this.normalized().dot(t.normalized()),-1,1))},blend:function(t,e){return this.plus(t.minus(this).times(e))},toString:function(){return"Vector3("+this.x+", "+this.y+", "+this.z+")"},toVector2:function(){return new i.Vector2(this.x,this.y)},toVector4:function(){return new i.Vector4(this.x,this.y,this.z)},set:function(t,e,i){this.x=t,this.y=e,this.z=i},setX:function(t){this.x=t},setY:function(t){this.y=t},setZ:function(t){this.z=t},copy:function(t){this.x=t.x,this.y=t.y,this.z=t.z},add:function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},addScalar:function(t){this.x+=t,this.y+=t,this.z+=t},subtract:function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z},subtractScalar:function(t){this.x-=t,this.y-=t,this.z-=t},componentMultiply:function(t){this.x*=t.x,this.y*=t.y,this.z*=t.z},divideScalar:function(t){this.x/=t,this.y/=t,this.z/=t},negate:function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},equals:function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z},equalsEpsilon:function(t,e){return e||(e=0),e>=Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},isVector3:!0,dimension:3},n.Immutable=function(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0};var s=n.Immutable;return s.prototype=new n,s.prototype.constructor=s,s.mutableOverrideHelper=function(t){s.prototype[t]=function(){throw Error("Cannot call mutable method '"+t+"' on immutable Vector3")}},s.mutableOverrideHelper("set"),s.mutableOverrideHelper("setX"),s.mutableOverrideHelper("setY"),s.mutableOverrideHelper("setZ"),s.mutableOverrideHelper("copy"),s.mutableOverrideHelper("add"),s.mutableOverrideHelper("addScalar"),s.mutableOverrideHelper("subtract"),s.mutableOverrideHelper("subtractScalar"),s.mutableOverrideHelper("componentMultiply"),s.mutableOverrideHelper("divideScalar"),s.mutableOverrideHelper("negate"),n.ZERO=new s(0,0,0),n.X_UNIT=new s(1,0,0),n.Y_UNIT=new s(0,1,0),n.Z_UNIT=new s(0,0,1),n}),i("DOT/Matrix4",["require","DOT/dot","DOT/Vector3","DOT/Vector4"],function(t){var e=t("DOT/dot");t("DOT/Vector3"),t("DOT/Vector4");var i=window.Float32Array||Array;e.Matrix4=function(t,e,n,s,r,o,a,h,u,c,l,d,m,f,p,g,y){this.entries=new i(16),this.rowMajor(void 0===t?1:t,e||0,n||0,s||0,r||0,void 0===o?1:o,a||0,h||0,u||0,c||0,void 0===l?1:l,d||0,m||0,f||0,p||0,void 0===g?1:g,y)};var n=e.Matrix4;n.Types={OTHER:0,IDENTITY:1,TRANSLATION_3D:2,SCALING:3};var s=n.Types;return n.identity=function(){return new n(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,s.IDENTITY)},n.translation=function(t,e,i){return new n(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1,s.TRANSLATION_3D)},n.translationFromVector=function(t){return n.translation(t.x,t.y,t.z)},n.scaling=function(t,e,i){return e=void 0===e?t:e,i=void 0===i?t:i,new n(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1,s.SCALING)},n.rotationAxisAngle=function(t,e){var i=Math.cos(e),r=Math.sin(e),o=1-i;return new n(t.x*t.x*o+i,t.x*t.y*o-t.z*r,t.x*t.z*o+t.y*r,0,t.y*t.x*o+t.z*r,t.y*t.y*o+i,t.y*t.z*o-t.x*r,0,t.z*t.x*o-t.y*r,t.z*t.y*o+t.x*r,t.z*t.z*o+i,0,0,0,0,1,s.OTHER)},n.rotationX=function(t){var e=Math.cos(t),i=Math.sin(t);return new n(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1,s.OTHER)},n.rotationY=function(t){var e=Math.cos(t),i=Math.sin(t);return new n(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1,s.OTHER)},n.rotationZ=function(t){var e=Math.cos(t),i=Math.sin(t);return new n(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1,s.OTHER)},n.gluPerspective=function(t,e,i,s){var r=Math.cos(t)/Math.sin(t);return new n(r/e,0,0,0,0,r,0,0,0,0,(s+i)/(i-s),2*s*i/(i-s),0,0,-1,0)},n.prototype={constructor:n,rowMajor:function(t,e,i,n,r,o,a,h,u,c,l,d,m,f,p,g,y){this.entries[0]=t,this.entries[1]=r,this.entries[2]=u,this.entries[3]=m,this.entries[4]=e,this.entries[5]=o,this.entries[6]=c,this.entries[7]=f,this.entries[8]=i,this.entries[9]=a,this.entries[10]=l,this.entries[11]=p,this.entries[12]=n,this.entries[13]=h,this.entries[14]=d,this.entries[15]=g,this.type=void 0===y?s.OTHER:y},columnMajor:function(t,e,i,n,s,r,o,a,h,u,c,l,d,m,f,p,g){this.rowMajor(t,s,h,d,e,r,u,m,i,o,c,f,n,a,l,p,g)},m00:function(){return this.entries[0]},m01:function(){return this.entries[4]},m02:function(){return this.entries[8]},m03:function(){return this.entries[12]},m10:function(){return this.entries[1]},m11:function(){return this.entries[5]},m12:function(){return this.entries[9]},m13:function(){return this.entries[13]},m20:function(){return this.entries[2]},m21:function(){return this.entries[6]},m22:function(){return this.entries[10]},m23:function(){return this.entries[14]},m30:function(){return this.entries[3]},m31:function(){return this.entries[7]},m32:function(){return this.entries[11]},m33:function(){return this.entries[15]},plus:function(t){return new n(this.m00()+t.m00(),this.m01()+t.m01(),this.m02()+t.m02(),this.m03()+t.m03(),this.m10()+t.m10(),this.m11()+t.m11(),this.m12()+t.m12(),this.m13()+t.m13(),this.m20()+t.m20(),this.m21()+t.m21(),this.m22()+t.m22(),this.m23()+t.m23(),this.m30()+t.m30(),this.m31()+t.m31(),this.m32()+t.m32(),this.m33()+t.m33())},minus:function(t){return new n(this.m00()-t.m00(),this.m01()-t.m01(),this.m02()-t.m02(),this.m03()-t.m03(),this.m10()-t.m10(),this.m11()-t.m11(),this.m12()-t.m12(),this.m13()-t.m13(),this.m20()-t.m20(),this.m21()-t.m21(),this.m22()-t.m22(),this.m23()-t.m23(),this.m30()-t.m30(),this.m31()-t.m31(),this.m32()-t.m32(),this.m33()-t.m33())},transposed:function(){return new n(this.m00(),this.m10(),this.m20(),this.m30(),this.m01(),this.m11(),this.m21(),this.m31(),this.m02(),this.m12(),this.m22(),this.m32(),this.m03(),this.m13(),this.m23(),this.m33())},negated:function(){return new n(-this.m00(),-this.m01(),-this.m02(),-this.m03(),-this.m10(),-this.m11(),-this.m12(),-this.m13(),-this.m20(),-this.m21(),-this.m22(),-this.m23(),-this.m30(),-this.m31(),-this.m32(),-this.m33())},inverted:function(){var t=this.determinant();if(0!==t)return new n((-this.m31()*this.m22()*this.m13()+this.m21()*this.m32()*this.m13()+this.m31()*this.m12()*this.m23()-this.m11()*this.m32()*this.m23()-this.m21()*this.m12()*this.m33()+this.m11()*this.m22()*this.m33())/t,(this.m31()*this.m22()*this.m03()-this.m21()*this.m32()*this.m03()-this.m31()*this.m02()*this.m23()+this.m01()*this.m32()*this.m23()+this.m21()*this.m02()*this.m33()-this.m01()*this.m22()*this.m33())/t,(-this.m31()*this.m12()*this.m03()+this.m11()*this.m32()*this.m03()+this.m31()*this.m02()*this.m13()-this.m01()*this.m32()*this.m13()-this.m11()*this.m02()*this.m33()+this.m01()*this.m12()*this.m33())/t,(this.m21()*this.m12()*this.m03()-this.m11()*this.m22()*this.m03()-this.m21()*this.m02()*this.m13()+this.m01()*this.m22()*this.m13()+this.m11()*this.m02()*this.m23()-this.m01()*this.m12()*this.m23())/t,(this.m30()*this.m22()*this.m13()-this.m20()*this.m32()*this.m13()-this.m30()*this.m12()*this.m23()+this.m10()*this.m32()*this.m23()+this.m20()*this.m12()*this.m33()-this.m10()*this.m22()*this.m33())/t,(-this.m30()*this.m22()*this.m03()+this.m20()*this.m32()*this.m03()+this.m30()*this.m02()*this.m23()-this.m00()*this.m32()*this.m23()-this.m20()*this.m02()*this.m33()+this.m00()*this.m22()*this.m33())/t,(this.m30()*this.m12()*this.m03()-this.m10()*this.m32()*this.m03()-this.m30()*this.m02()*this.m13()+this.m00()*this.m32()*this.m13()+this.m10()*this.m02()*this.m33()-this.m00()*this.m12()*this.m33())/t,(-this.m20()*this.m12()*this.m03()+this.m10()*this.m22()*this.m03()+this.m20()*this.m02()*this.m13()-this.m00()*this.m22()*this.m13()-this.m10()*this.m02()*this.m23()+this.m00()*this.m12()*this.m23())/t,(-this.m30()*this.m21()*this.m13()+this.m20()*this.m31()*this.m13()+this.m30()*this.m11()*this.m23()-this.m10()*this.m31()*this.m23()-this.m20()*this.m11()*this.m33()+this.m10()*this.m21()*this.m33())/t,(this.m30()*this.m21()*this.m03()-this.m20()*this.m31()*this.m03()-this.m30()*this.m01()*this.m23()+this.m00()*this.m31()*this.m23()+this.m20()*this.m01()*this.m33()-this.m00()*this.m21()*this.m33())/t,(-this.m30()*this.m11()*this.m03()+this.m10()*this.m31()*this.m03()+this.m30()*this.m01()*this.m13()-this.m00()*this.m31()*this.m13()-this.m10()*this.m01()*this.m33()+this.m00()*this.m11()*this.m33())/t,(this.m20()*this.m11()*this.m03()-this.m10()*this.m21()*this.m03()-this.m20()*this.m01()*this.m13()+this.m00()*this.m21()*this.m13()+this.m10()*this.m01()*this.m23()-this.m00()*this.m11()*this.m23())/t,(this.m30()*this.m21()*this.m12()-this.m20()*this.m31()*this.m12()-this.m30()*this.m11()*this.m22()+this.m10()*this.m31()*this.m22()+this.m20()*this.m11()*this.m32()-this.m10()*this.m21()*this.m32())/t,(-this.m30()*this.m21()*this.m02()+this.m20()*this.m31()*this.m02()+this.m30()*this.m01()*this.m22()-this.m00()*this.m31()*this.m22()-this.m20()*this.m01()*this.m32()+this.m00()*this.m21()*this.m32())/t,(this.m30()*this.m11()*this.m02()-this.m10()*this.m31()*this.m02()-this.m30()*this.m01()*this.m12()+this.m00()*this.m31()*this.m12()+this.m10()*this.m01()*this.m32()-this.m00()*this.m11()*this.m32())/t,(-this.m20()*this.m11()*this.m02()+this.m10()*this.m21()*this.m02()+this.m20()*this.m01()*this.m12()-this.m00()*this.m21()*this.m12()-this.m10()*this.m01()*this.m22()+this.m00()*this.m11()*this.m22())/t);throw Error("Matrix could not be inverted, determinant === 0")},timesMatrix:function(t){var e=s.OTHER;return this.type===s.TRANSLATION_3D&&t.type===s.TRANSLATION_3D&&(e=s.TRANSLATION_3D),this.type===s.SCALING&&t.type===s.SCALING&&(e=s.SCALING),this.type===s.IDENTITY&&(e=t.type),t.type===s.IDENTITY&&(e=this.type),new n(this.m00()*t.m00()+this.m01()*t.m10()+this.m02()*t.m20()+this.m03()*t.m30(),this.m00()*t.m01()+this.m01()*t.m11()+this.m02()*t.m21()+this.m03()*t.m31(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02()*t.m22()+this.m03()*t.m32(),this.m00()*t.m03()+this.m01()*t.m13()+this.m02()*t.m23()+this.m03()*t.m33(),this.m10()*t.m00()+this.m11()*t.m10()+this.m12()*t.m20()+this.m13()*t.m30(),this.m10()*t.m01()+this.m11()*t.m11()+this.m12()*t.m21()+this.m13()*t.m31(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12()*t.m22()+this.m13()*t.m32(),this.m10()*t.m03()+this.m11()*t.m13()+this.m12()*t.m23()+this.m13()*t.m33(),this.m20()*t.m00()+this.m21()*t.m10()+this.m22()*t.m20()+this.m23()*t.m30(),this.m20()*t.m01()+this.m21()*t.m11()+this.m22()*t.m21()+this.m23()*t.m31(),this.m20()*t.m02()+this.m21()*t.m12()+this.m22()*t.m22()+this.m23()*t.m32(),this.m20()*t.m03()+this.m21()*t.m13()+this.m22()*t.m23()+this.m23()*t.m33(),this.m30()*t.m00()+this.m31()*t.m10()+this.m32()*t.m20()+this.m33()*t.m30(),this.m30()*t.m01()+this.m31()*t.m11()+this.m32()*t.m21()+this.m33()*t.m31(),this.m30()*t.m02()+this.m31()*t.m12()+this.m32()*t.m22()+this.m33()*t.m32(),this.m30()*t.m03()+this.m31()*t.m13()+this.m32()*t.m23()+this.m33()*t.m33(),e)
},timesVector4:function(t){var i=this.m00()*t.x+this.m01()*t.y+this.m02()*t.z+this.m03()*t.w,n=this.m10()*t.x+this.m11()*t.y+this.m12()*t.z+this.m13()*t.w,s=this.m20()*t.x+this.m21()*t.y+this.m22()*t.z+this.m23()*t.w,r=this.m30()*t.x+this.m31()*t.y+this.m32()*t.z+this.m33()*t.w;return new e.Vector4(i,n,s,r)},timesVector3:function(t){return this.timesVector4(t.toVector4()).toVector3()},timesTransposeVector4:function(t){var i=this.m00()*t.x+this.m10()*t.y+this.m20()*t.z+this.m30()*t.w,n=this.m01()*t.x+this.m11()*t.y+this.m21()*t.z+this.m31()*t.w,s=this.m02()*t.x+this.m12()*t.y+this.m22()*t.z+this.m32()*t.w,r=this.m03()*t.x+this.m13()*t.y+this.m23()*t.z+this.m33()*t.w;return new e.Vector4(i,n,s,r)},timesTransposeVector3:function(t){return this.timesTransposeVector4(t.toVector4()).toVector3()},timesRelativeVector3:function(t){var i=this.m00()*t.x+this.m10()*t.y+this.m20()*t.z,n=this.m01()*t.y+this.m11()*t.y+this.m21()*t.z,s=this.m02()*t.z+this.m12()*t.y+this.m22()*t.z;return new e.Vector3(i,n,s)},determinant:function(){return this.m03()*this.m12()*this.m21()*this.m30()-this.m02()*this.m13()*this.m21()*this.m30()-this.m03()*this.m11()*this.m22()*this.m30()+this.m01()*this.m13()*this.m22()*this.m30()+this.m02()*this.m11()*this.m23()*this.m30()-this.m01()*this.m12()*this.m23()*this.m30()-this.m03()*this.m12()*this.m20()*this.m31()+this.m02()*this.m13()*this.m20()*this.m31()+this.m03()*this.m10()*this.m22()*this.m31()-this.m00()*this.m13()*this.m22()*this.m31()-this.m02()*this.m10()*this.m23()*this.m31()+this.m00()*this.m12()*this.m23()*this.m31()+this.m03()*this.m11()*this.m20()*this.m32()-this.m01()*this.m13()*this.m20()*this.m32()-this.m03()*this.m10()*this.m21()*this.m32()+this.m00()*this.m13()*this.m21()*this.m32()+this.m01()*this.m10()*this.m23()*this.m32()-this.m00()*this.m11()*this.m23()*this.m32()-this.m02()*this.m11()*this.m20()*this.m33()+this.m01()*this.m12()*this.m20()*this.m33()+this.m02()*this.m10()*this.m21()*this.m33()-this.m00()*this.m12()*this.m21()*this.m33()-this.m01()*this.m10()*this.m22()*this.m33()+this.m00()*this.m11()*this.m22()*this.m33()},toString:function(){return this.m00()+" "+this.m01()+" "+this.m02()+" "+this.m03()+"\n"+this.m10()+" "+this.m11()+" "+this.m12()+" "+this.m13()+"\n"+this.m20()+" "+this.m21()+" "+this.m22()+" "+this.m23()+"\n"+this.m30()+" "+this.m31()+" "+this.m32()+" "+this.m33()},translation:function(){return new e.Vector3(this.m03(),this.m13(),this.m23())},scaling:function(){return new e.Vector3(this.m00(),this.m11(),this.m22())},makeImmutable:function(){this.rowMajor=function(){throw Error("Cannot modify immutable matrix")}}},n.IDENTITY=new n,n.IDENTITY.makeImmutable(),n}),i("DOT/Matrix3",["require","DOT/dot","DOT/Vector2","DOT/Vector3","DOT/Matrix4"],function(t){var e=t("DOT/dot");t("DOT/Vector2"),t("DOT/Vector3"),t("DOT/Matrix4"),e.Matrix3=function(t,e,i,n,s,r,o,a,h,u){this.entries=Array(9),this.rowMajor(void 0===t?1:t,e||0,i||0,n||0,void 0===s?1:s,r||0,o||0,a||0,void 0===h?1:h,u)};var i=e.Matrix3;i.Types={OTHER:0,IDENTITY:1,TRANSLATION_2D:2,SCALING:3,AFFINE:4};var n=i.Types;return i.identity=function(){return new i(1,0,0,0,1,0,0,0,1,n.IDENTITY)},i.translation=function(t,e){return new i(1,0,t,0,1,e,0,0,1,n.TRANSLATION_2D)},i.translationFromVector=function(t){return i.translation(t.x,t.y)},i.scaling=function(t,e){return e=void 0===e?t:e,new i(t,0,0,0,e,0,0,0,1,n.SCALING)},i.scale=i.scaling,i.rotationAxisAngle=function(t,e){var s=Math.cos(e),r=Math.sin(e),o=1-s;return new i(t.x*t.x*o+s,t.x*t.y*o-t.z*r,t.x*t.z*o+t.y*r,t.y*t.x*o+t.z*r,t.y*t.y*o+s,t.y*t.z*o-t.x*r,t.z*t.x*o-t.y*r,t.z*t.y*o+t.x*r,t.z*t.z*o+s,n.OTHER)},i.rotationX=function(t){var e=Math.cos(t),s=Math.sin(t);return new i(1,0,0,0,e,-s,0,s,e,n.OTHER)},i.rotationY=function(t){var e=Math.cos(t),s=Math.sin(t);return new i(e,0,s,0,1,0,-s,0,e,n.OTHER)},i.rotationZ=function(t){var e=Math.cos(t),s=Math.sin(t);return new i(e,-s,0,s,e,0,0,0,1,n.AFFINE)},i.rotation2=i.rotationZ,i.fromSVGMatrix=function(t){return new i(t.a,t.c,t.e,t.b,t.d,t.f,0,0,1,n.AFFINE)},i.rotateAToB=function(t,n){var s,r,o,a=t,h=n,u=1e-4,c=a.cross(h);if(s=a.dot(h),o=0>s?-s:s,o>1-u){var l,d,m,f=new e.Vector3(a.x>0?a.x:-a.x,a.y>0?a.y:-a.y,a.z>0?a.z:-a.z);f=f.x<f.y?f.x<f.z?e.Vector3.X_UNIT:e.Vector3.Z_UNIT:f.y<f.z?e.Vector3.Y_UNIT:e.Vector3.Z_UNIT;var p=f.minus(a);return c=f.minus(h),l=2/p.dot(p),d=2/c.dot(c),m=l*d*p.dot(c),i.IDENTITY.plus(i.rowMajor(-l*p.x*p.x-d*c.x*c.x+m*c.x*p.x,-l*p.x*p.y-d*c.x*c.y+m*c.x*p.y,-l*p.x*p.z-d*c.x*c.z+m*c.x*p.z,-l*p.y*p.x-d*c.y*c.x+m*c.y*p.x,-l*p.y*p.y-d*c.y*c.y+m*c.y*p.y,-l*p.y*p.z-d*c.y*c.z+m*c.y*p.z,-l*p.z*p.x-d*c.z*c.x+m*c.z*p.x,-l*p.z*p.y-d*c.z*c.y+m*c.z*p.y,-l*p.z*p.z-d*c.z*c.z+m*c.z*p.z))}var g,y,v,T,S;return r=1/(1+s),g=r*c.x,y=r*c.z,v=g*c.y,T=g*c.z,S=y*c.y,i.rowMajor(s+g*c.x,v-c.z,T+c.y,v+c.z,s+r*c.y*c.y,S-c.x,T-c.y,S+c.x,s+y*c.z)},i.prototype={constructor:i,m00:function(){return this.entries[0]},m01:function(){return this.entries[3]},m02:function(){return this.entries[6]},m10:function(){return this.entries[1]},m11:function(){return this.entries[4]},m12:function(){return this.entries[7]},m20:function(){return this.entries[2]},m21:function(){return this.entries[5]},m22:function(){return this.entries[8]},isAffine:function(){return this.type===n.AFFINE||0===this.m20()&&0===this.m21()&&1===this.m22()},getDeterminant:function(){return this.m00()*this.m11()*this.m22()+this.m01()*this.m12()*this.m20()+this.m02()*this.m10()*this.m21()-this.m02()*this.m11()*this.m20()-this.m01()*this.m10()*this.m22()-this.m00()*this.m12()*this.m21()},get determinant(){return this.getDeterminant()},getTranslation:function(){return new e.Vector2(this.m02(),this.m12())},get translation(){return this.getTranslation()},getScaleVector:function(){return new e.Vector2(Math.sqrt(this.m00()*this.m00()+this.m10()*this.m10()),Math.sqrt(this.m01()*this.m01()+this.m11()*this.m11()))},get scaleVector(){return this.getScaleVector()},getRotation:function(){var t=this.timesVector2(e.Vector2.X_UNIT).minus(this.timesVector2(e.Vector2.ZERO));return Math.atan2(t.y,t.x)},get rotation(){return this.getRotation()},toMatrix4:function(){return new e.Matrix4(this.m00(),this.m01(),this.m02(),0,this.m10(),this.m11(),this.m12(),0,this.m20(),this.m21(),this.m22(),0,0,0,0,1)},toString:function(){return this.m00()+" "+this.m01()+" "+this.m02()+"\n"+this.m10()+" "+this.m11()+" "+this.m12()+"\n"+this.m20()+" "+this.m21()+" "+this.m22()},toSVGMatrix:function(){var t=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix();return t.a=this.m00(),t.b=this.m10(),t.c=this.m01(),t.d=this.m11(),t.e=this.m02(),t.f=this.m12(),t},getCSSTransform:function(){function t(t){return t.toFixed(20)}return"matrix("+t(this.entries[0])+","+t(this.entries[1])+","+t(this.entries[3])+","+t(this.entries[4])+","+t(this.entries[6])+","+t(this.entries[7])+")"},get cssTransform(){return this.getCSSTransform()},getSVGTransform:function(){function t(t){return t.toFixed(20)}switch(this.type){case n.IDENTITY:return"";case n.TRANSLATION_2D:return"translate("+t(this.entries[6])+","+this.entries[7]+")";case n.SCALING:return"scale("+t(this.entries[0])+(this.entries[0]===this.entries[4]?"":","+t(this.entries[4]))+")";default:return"matrix("+t(this.entries[0])+","+t(this.entries[1])+","+t(this.entries[3])+","+t(this.entries[4])+","+t(this.entries[6])+","+t(this.entries[7])+")"}},get svgTransform(){return this.getSVGTransform()},getCSSTransformStyles:function(){var t=this.getCSSTransform();return{"-webkit-perspective":1e3,"-webkit-backface-visibility":"hidden","-webkit-transform":t+" translateZ(0)","-moz-transform":t+" translateZ(0)","-ms-transform":t,"-o-transform":t,transform:t,"transform-origin":"top left","-ms-transform-origin":"top left"}},get cssTransformStyles(){return this.getCSSTransformStyles()},equals:function(t){return this.m00()===t.m00()&&this.m01()===t.m01()&&this.m02()===t.m02()&&this.m10()===t.m10()&&this.m11()===t.m11()&&this.m12()===t.m12()&&this.m20()===t.m20()&&this.m21()===t.m21()&&this.m22()===t.m22()},equalsEpsilon:function(t,e){return e>Math.abs(this.m00()-t.m00())&&e>Math.abs(this.m01()-t.m01())&&e>Math.abs(this.m02()-t.m02())&&e>Math.abs(this.m10()-t.m10())&&e>Math.abs(this.m11()-t.m11())&&e>Math.abs(this.m12()-t.m12())&&e>Math.abs(this.m20()-t.m20())&&e>Math.abs(this.m21()-t.m21())&&e>Math.abs(this.m22()-t.m22())},copy:function(){return new i(this.m00(),this.m01(),this.m02(),this.m10(),this.m11(),this.m12(),this.m20(),this.m21(),this.m22(),this.type)},plus:function(t){return new i(this.m00()+t.m00(),this.m01()+t.m01(),this.m02()+t.m02(),this.m10()+t.m10(),this.m11()+t.m11(),this.m12()+t.m12(),this.m20()+t.m20(),this.m21()+t.m21(),this.m22()+t.m22())},minus:function(t){return new i(this.m00()-t.m00(),this.m01()-t.m01(),this.m02()-t.m02(),this.m10()-t.m10(),this.m11()-t.m11(),this.m12()-t.m12(),this.m20()-t.m20(),this.m21()-t.m21(),this.m22()-t.m22())},transposed:function(){return new i(this.m00(),this.m10(),this.m20(),this.m01(),this.m11(),this.m21(),this.m02(),this.m12(),this.m22(),this.type===n.IDENTITY||this.type===n.SCALING?this.type:void 0)},negated:function(){return new i(-this.m00(),-this.m01(),-this.m02(),-this.m10(),-this.m11(),-this.m12(),-this.m20(),-this.m21(),-this.m22())},inverted:function(){var t;switch(this.type){case n.IDENTITY:return this;case n.TRANSLATION_2D:return new i(1,0,-this.m02(),0,1,-this.m12(),0,0,1,n.TRANSLATION_2D);case n.SCALING:return new i(1/this.m00(),0,0,0,1/this.m11(),0,0,0,1/this.m22(),n.SCALING);case n.AFFINE:if(t=this.getDeterminant(),0!==t)return new i((-this.m12()*this.m21()+this.m11()*this.m22())/t,(this.m02()*this.m21()-this.m01()*this.m22())/t,(-this.m02()*this.m11()+this.m01()*this.m12())/t,(this.m12()*this.m20()-this.m10()*this.m22())/t,(-this.m02()*this.m20()+this.m00()*this.m22())/t,(this.m02()*this.m10()-this.m00()*this.m12())/t,0,0,1,n.AFFINE);throw Error("Matrix could not be inverted, determinant === 0");case n.OTHER:if(t=this.getDeterminant(),0!==t)return new i((-this.m12()*this.m21()+this.m11()*this.m22())/t,(this.m02()*this.m21()-this.m01()*this.m22())/t,(-this.m02()*this.m11()+this.m01()*this.m12())/t,(this.m12()*this.m20()-this.m10()*this.m22())/t,(-this.m02()*this.m20()+this.m00()*this.m22())/t,(this.m02()*this.m10()-this.m00()*this.m12())/t,(-this.m11()*this.m20()+this.m10()*this.m21())/t,(this.m01()*this.m20()-this.m00()*this.m21())/t,(-this.m01()*this.m10()+this.m00()*this.m11())/t,n.OTHER);throw Error("Matrix could not be inverted, determinant === 0");default:throw Error("Matrix3.inverted with unknown type: "+this.type)}},timesMatrix:function(t){if(this.type===n.IDENTITY||t.type===n.IDENTITY)return this.type===n.IDENTITY?t:this;if(this.type===t.type){if(this.type===n.TRANSLATION_2D)return new i(1,0,this.m02()+t.m02(),0,1,this.m12()+t.m12(),0,0,1,n.TRANSLATION_2D);if(this.type===n.SCALING)return new i(this.m00()*t.m00(),0,0,0,this.m11()*t.m11(),0,0,0,1,n.SCALING)}return this.type!==n.OTHER&&t.type!==n.OTHER?new i(this.m00()*t.m00()+this.m01()*t.m10(),this.m00()*t.m01()+this.m01()*t.m11(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02(),this.m10()*t.m00()+this.m11()*t.m10(),this.m10()*t.m01()+this.m11()*t.m11(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12(),0,0,1,n.AFFINE):new i(this.m00()*t.m00()+this.m01()*t.m10()+this.m02()*t.m20(),this.m00()*t.m01()+this.m01()*t.m11()+this.m02()*t.m21(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02()*t.m22(),this.m10()*t.m00()+this.m11()*t.m10()+this.m12()*t.m20(),this.m10()*t.m01()+this.m11()*t.m11()+this.m12()*t.m21(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12()*t.m22(),this.m20()*t.m00()+this.m21()*t.m10()+this.m22()*t.m20(),this.m20()*t.m01()+this.m21()*t.m11()+this.m22()*t.m21(),this.m20()*t.m02()+this.m21()*t.m12()+this.m22()*t.m22())},timesVector2:function(t){var i=this.m00()*t.x+this.m01()*t.y+this.m02(),n=this.m10()*t.x+this.m11()*t.y+this.m12();return new e.Vector2(i,n)},timesVector3:function(t){var i=this.m00()*t.x+this.m01()*t.y+this.m02()*t.z,n=this.m10()*t.x+this.m11()*t.y+this.m12()*t.z,s=this.m20()*t.x+this.m21()*t.y+this.m22()*t.z;return new e.Vector3(i,n,s)},timesTransposeVector2:function(t){var i=this.m00()*t.x+this.m10()*t.y,n=this.m01()*t.x+this.m11()*t.y;return new e.Vector2(i,n)},timesRelativeVector2:function(t){var i=this.m00()*t.x+this.m01()*t.y,n=this.m10()*t.y+this.m11()*t.y;return new e.Vector2(i,n)},makeImmutable:function(){return this.rowMajor=function(){throw Error("Cannot modify immutable matrix")},this},rowMajor:function(t,e,i,s,r,o,a,h,u,c){return this.entries[0]=t,this.entries[1]=s,this.entries[2]=a,this.entries[3]=e,this.entries[4]=r,this.entries[5]=h,this.entries[6]=i,this.entries[7]=o,this.entries[8]=u,this.type=void 0===c?0===a&&0===h&&1===u?n.AFFINE:n.OTHER:c,this},columnMajor:function(t,e,i,n,s,r,o,a,h,u){return this.rowMajor(t,n,o,e,s,a,i,r,h,u)},add:function(t){return this.rowMajor(this.m00()+t.m00(),this.m01()+t.m01(),this.m02()+t.m02(),this.m10()+t.m10(),this.m11()+t.m11(),this.m12()+t.m12(),this.m20()+t.m20(),this.m21()+t.m21(),this.m22()+t.m22())},subtract:function(t){return this.rowMajor(this.m00()-t.m00(),this.m01()-t.m01(),this.m02()-t.m02(),this.m10()-t.m10(),this.m11()-t.m11(),this.m12()-t.m12(),this.m20()-t.m20(),this.m21()-t.m21(),this.m22()-t.m22())},transpose:function(){return this.rowMajor(this.m00(),this.m10(),this.m20(),this.m01(),this.m11(),this.m21(),this.m02(),this.m12(),this.m22(),this.type===n.IDENTITY||this.type===n.SCALING?this.type:void 0)},negate:function(){return this.rowMajor(-this.m00(),-this.m01(),-this.m02(),-this.m10(),-this.m11(),-this.m12(),-this.m20(),-this.m21(),-this.m22())},invert:function(){var t;switch(this.type){case n.IDENTITY:return this;case n.TRANSLATION_2D:return this.rowMajor(1,0,-this.m02(),0,1,-this.m12(),0,0,1,n.TRANSLATION_2D);case n.SCALING:return this.rowMajor(1/this.m00(),0,0,0,1/this.m11(),0,0,0,1/this.m22(),n.SCALING);case n.AFFINE:if(t=this.getDeterminant(),0!==t)return this.rowMajor((-this.m12()*this.m21()+this.m11()*this.m22())/t,(this.m02()*this.m21()-this.m01()*this.m22())/t,(-this.m02()*this.m11()+this.m01()*this.m12())/t,(this.m12()*this.m20()-this.m10()*this.m22())/t,(-this.m02()*this.m20()+this.m00()*this.m22())/t,(this.m02()*this.m10()-this.m00()*this.m12())/t,0,0,1,n.AFFINE);throw Error("Matrix could not be inverted, determinant === 0");case n.OTHER:if(t=this.getDeterminant(),0!==t)return this.rowMajor((-this.m12()*this.m21()+this.m11()*this.m22())/t,(this.m02()*this.m21()-this.m01()*this.m22())/t,(-this.m02()*this.m11()+this.m01()*this.m12())/t,(this.m12()*this.m20()-this.m10()*this.m22())/t,(-this.m02()*this.m20()+this.m00()*this.m22())/t,(this.m02()*this.m10()-this.m00()*this.m12())/t,(-this.m11()*this.m20()+this.m10()*this.m21())/t,(this.m01()*this.m20()-this.m00()*this.m21())/t,(-this.m01()*this.m10()+this.m00()*this.m11())/t,n.OTHER);throw Error("Matrix could not be inverted, determinant === 0");default:throw Error("Matrix3.inverted with unknown type: "+this.type)}},multiplyMatrix:function(t){if(this.type===n.IDENTITY||t.type===n.IDENTITY)return this.type===n.IDENTITY?t:this;if(this.type===t.type){if(this.type===n.TRANSLATION_2D)return this.rowMajor(1,0,this.m02()+t.m02(),0,1,this.m12()+t.m12(),0,0,1,n.TRANSLATION_2D);if(this.type===n.SCALING)return this.rowMajor(this.m00()*t.m00(),0,0,0,this.m11()*t.m11(),0,0,0,1,n.SCALING)}return this.type!==n.OTHER&&t.type!==n.OTHER?this.rowMajor(this.m00()*t.m00()+this.m01()*t.m10(),this.m00()*t.m01()+this.m01()*t.m11(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02(),this.m10()*t.m00()+this.m11()*t.m10(),this.m10()*t.m01()+this.m11()*t.m11(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12(),0,0,1,n.AFFINE):this.rowMajor(this.m00()*t.m00()+this.m01()*t.m10()+this.m02()*t.m20(),this.m00()*t.m01()+this.m01()*t.m11()+this.m02()*t.m21(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02()*t.m22(),this.m10()*t.m00()+this.m11()*t.m10()+this.m12()*t.m20(),this.m10()*t.m01()+this.m11()*t.m11()+this.m12()*t.m21(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12()*t.m22(),this.m20()*t.m00()+this.m21()*t.m10()+this.m22()*t.m20(),this.m20()*t.m01()+this.m21()*t.m11()+this.m22()*t.m21(),this.m20()*t.m02()+this.m21()*t.m12()+this.m22()*t.m22())},multiplyVector2:function(t){var e=this.m00()*t.x+this.m01()*t.y+this.m02(),i=this.m10()*t.x+this.m11()*t.y+this.m12();return t.setX(e),t.setY(i),t},multiplyVector3:function(t){var e=this.m00()*t.x+this.m01()*t.y+this.m02()*t.z,i=this.m10()*t.x+this.m11()*t.y+this.m12()*t.z,n=this.m20()*t.x+this.m21()*t.y+this.m22()*t.z;return t.setX(e),t.setY(i),t.setZ(n),t},multiplyTransposeVector2:function(t){var e=this.m00()*t.x+this.m10()*t.y,i=this.m01()*t.x+this.m11()*t.y;return t.setX(e),t.setY(i),t},multiplyRelativeVector2:function(t){var e=this.m00()*t.x+this.m01()*t.y,i=this.m10()*t.y+this.m11()*t.y;return t.setX(e),t.setY(i),t},canvasSetTransform:function(t){t.setTransform(this.entries[0],this.entries[1],this.entries[3],this.entries[4],this.entries[6],this.entries[7])},canvasAppendTransform:function(t){t.transform(this.entries[0],this.entries[1],this.entries[3],this.entries[4],this.entries[6],this.entries[7])}},i.IDENTITY=new i(1,0,0,0,1,0,0,0,1,n.IDENTITY),i.IDENTITY.makeImmutable(),i.X_REFLECTION=new i(-1,0,0,0,1,0,0,0,1,n.AFFINE),i.X_REFLECTION.makeImmutable(),i.Y_REFLECTION=new i(1,0,0,0,-1,0,0,0,1,n.AFFINE),i.Y_REFLECTION.makeImmutable(),i.printer={print:function(t){console.log(""+t)}},i}),i("DOT/Ray2",["require","ASSERT/assert","DOT/dot"],function(t){var e=t("ASSERT/assert")("dot"),i=t("DOT/dot");i.Ray2=function(t,i){this.pos=t,this.dir=i,e&&e(.01>Math.abs(i.magnitude()-1))};var n=i.Ray2;return n.prototype={constructor:n,shifted:function(t){return new n(this.pointAtDistance(t),this.dir)},pointAtDistance:function(t){return this.pos.plus(this.dir.timesScalar(t))},toString:function(){return""+this.pos+" => "+(""+this.dir)}},n}),i("DOT/Transform3",["require","ASSERT/assert","DOT/dot","DOT/Matrix3","DOT/Vector2","DOT/Ray2"],function(t){var e=t("ASSERT/assert")("dot"),i=t("DOT/dot");t("DOT/Matrix3"),t("DOT/Vector2"),t("DOT/Ray2"),i.Transform3=function(t){this.listeners=[],this.set(void 0===t?i.Matrix3.IDENTITY:t)};var n=i.Transform3;return n.prototype={constructor:n,set:function(t){e&&e(t instanceof i.Matrix3);var n,s=this.matrix,r=this.listeners.length;for(n=0;r>n;n++)this.listeners[n].before(t,s);for(this.matrix=t,this.inverse=null,this.matrixTransposed=null,this.inverseTransposed=null,n=0;r>n;n++)this.listeners[n].after(t,s)},prepend:function(t){this.set(t.timesMatrix(this.matrix))},append:function(t){this.set(this.matrix.timesMatrix(t))},prependTransform:function(t){this.prepend(t.matrix)},appendTransform:function(t){this.append(t.matrix)},applyToCanvasContext:function(t){t.setTransform(this.matrix.m00(),this.matrix.m10(),this.matrix.m01(),this.matrix.m11(),this.matrix.m02(),this.matrix.m12())},copy:function(){var t=new n(this.matrix);t.inverse=this.inverse,t.matrixTransposed=this.matrixTransposed,t.inverseTransposed=this.inverseTransposed},deepCopy:function(){var t=new n(this.matrix.copy());t.inverse=this.inverse?this.inverse.copy():null,t.matrixTransposed=this.matrixTransposed?this.matrixTransposed.copy():null,t.inverseTransposed=this.inverseTransposed?this.inverseTransposed.copy():null},getMatrix:function(){return this.matrix},getInverse:function(){return null===this.inverse&&(this.inverse=this.matrix.inverted()),this.inverse},getMatrixTransposed:function(){return null===this.matrixTransposed&&(this.matrixTransposed=this.matrix.transposed()),this.matrixTransposed},getInverseTransposed:function(){return null===this.inverseTransposed&&(this.inverseTransposed=this.getInverse().transposed()),this.inverseTransposed},isIdentity:function(){return this.matrix.type===i.Matrix3.Types.IDENTITY},transformPosition2:function(t){return this.matrix.timesVector2(t)},transformDelta2:function(t){return this.matrix.timesRelativeVector2(t)},transformNormal2:function(t){return this.getInverse().timesTransposeVector2(t)},transformDeltaX:function(t){return this.transformDelta2(new i.Vector2(t,0)).x},transformDeltaY:function(t){return this.transformDelta2(new i.Vector2(0,t)).y},transformBounds2:function(t){return t.transformed(this.matrix)},transformShape:function(t){return t.transformed(this.matrix)},transformRay2:function(t){return new i.Ray2(this.transformPosition2(t.pos),this.transformDelta2(t.dir).normalized())},inversePosition2:function(t){return this.getInverse().timesVector2(t)},inverseDelta2:function(t){return this.inversePosition2(t).minus(this.inversePosition2(i.Vector2.ZERO))},inverseNormal2:function(t){return this.matrix.timesTransposeVector2(t)},inverseDeltaX:function(t){return this.inverseDelta2(new i.Vector2(t,0)).x},inverseDeltaY:function(t){return this.inverseDelta2(new i.Vector2(0,t)).y},inverseBounds2:function(t){return t.transformed(this.getInverse())},inverseShape:function(t){return t.transformed(this.getInverse())},inverseRay2:function(t){return new i.Ray2(this.inversePosition2(t.pos),this.inverseDelta2(t.dir).normalized())},addTransformListener:function(t){e&&e(!_.contains(this.listeners,t)),this.listeners.push(t)},removeTransformListener:function(t){e&&e(_.contains(this.listeners,t)),this.listeners.splice(_.indexOf(this.listeners,t),1)}},n}),i("DOT/Bounds2",["require","ASSERT/assert","DOT/dot","DOT/Vector2"],function(t){var e=t("ASSERT/assert")("dot"),i=t("DOT/dot");t("DOT/Vector2"),i.Bounds2=function(t,i,n,s){e&&e(void 0!==s,"Bounds2 requires 4 parameters"),this.minX=t,this.minY=i,this.maxX=n,this.maxY=s};var n=i.Bounds2;return n.prototype={constructor:n,getWidth:function(){return this.maxX-this.minX},get width(){return this.getWidth()},getHeight:function(){return this.maxY-this.minY},get height(){return this.getHeight()},getX:function(){return this.minX},get x(){return this.getX()},getY:function(){return this.minY},get y(){return this.getY()},getCenterX:function(){return(this.maxX+this.minX)/2},get centerX(){return this.getCenterX()},getCenterY:function(){return(this.maxY+this.minY)/2},get centerY(){return this.getCenterY()},getMinX:function(){return this.minX},getMinY:function(){return this.minY},getMaxX:function(){return this.maxX},getMaxY:function(){return this.maxY},isEmpty:function(){return 0>this.getWidth()||0>this.getHeight()},isFinite:function(){return isFinite(this.minX)&&isFinite(this.minY)&&isFinite(this.maxX)&&isFinite(this.maxY)},isValid:function(){return!this.isEmpty()&&this.isFinite()},containsCoordinates:function(t,e){return t>=this.minX&&this.maxX>=t&&e>=this.minY&&this.maxY>=e},containsPoint:function(t){return this.containsCoordinates(t.x,t.y)},containsBounds:function(t){return this.minX<=t.minX&&this.maxX>=t.maxX&&this.minY<=t.minY&&this.maxY>=t.maxY},intersectsBounds:function(t){return!this.intersection(t).isEmpty()},toString:function(){return"[x:("+this.minX+","+this.maxX+"),y:("+this.minY+","+this.maxY+")]"},equals:function(t){return this.minX===t.minX&&this.minY===t.minY&&this.maxX===t.maxX&&this.maxY===t.maxY},copy:function(){return new n(this.minX,this.minY,this.maxX,this.maxY)},union:function(t){return new n(Math.min(this.minX,t.minX),Math.min(this.minY,t.minY),Math.max(this.maxX,t.maxX),Math.max(this.maxY,t.maxY))},intersection:function(t){return new n(Math.max(this.minX,t.minX),Math.max(this.minY,t.minY),Math.min(this.maxX,t.maxX),Math.min(this.maxY,t.maxY))},withCoordinates:function(t,e){return new n(Math.min(this.minX,t),Math.min(this.minY,e),Math.max(this.maxX,t),Math.max(this.maxY,e))},withPoint:function(t){return this.withCoordinates(t.x,t.y)},withMinX:function(t){return new n(t,this.minY,this.maxX,this.maxY)},withMinY:function(t){return new n(this.minX,t,this.maxX,this.maxY)},withMaxX:function(t){return new n(this.minX,this.minY,t,this.maxY)},withMaxY:function(t){return new n(this.minX,this.minY,this.maxX,t)},roundedOut:function(){return new n(Math.floor(this.minX),Math.floor(this.minY),Math.ceil(this.maxX),Math.ceil(this.maxY))},roundedIn:function(){return new n(Math.ceil(this.minX),Math.ceil(this.minY),Math.floor(this.maxX),Math.floor(this.maxY))},transformed:function(t){return this.copy().transform(t)},dilated:function(t){return new n(this.minX-t,this.minY-t,this.maxX+t,this.maxY+t)},eroded:function(t){return this.dilated(-t)},shiftedX:function(t){return new n(this.minX+t,this.minY,this.maxX+t,this.maxY)},shiftedY:function(t){return new n(this.minX,this.minY+t,this.maxX,this.maxY+t)},shifted:function(t,e){return new n(this.minX+t,this.minY+e,this.maxX+t,this.maxY+e)},set:function(t,e,i,n){return this.minX=t,this.minY=e,this.maxX=i,this.maxY=n,this},setBounds:function(t){return this.set(t.minX,t.minY,t.maxX,t.maxY)},includeBounds:function(t){return this.minX=Math.min(this.minX,t.minX),this.minY=Math.min(this.minY,t.minY),this.maxX=Math.max(this.maxX,t.maxX),this.maxY=Math.max(this.maxY,t.maxY),this},constrainBounds:function(t){return this.minX=Math.max(this.minX,t.minX),this.minY=Math.max(this.minY,t.minY),this.maxX=Math.min(this.maxX,t.maxX),this.maxY=Math.min(this.maxY,t.maxY),this},addCoordinates:function(t,e){return this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,e),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,e),this},addPoint:function(t){return this.addCoordinates(t.x,t.y)},setMinX:function(t){return this.minX=t,this},setMinY:function(t){return this.minY=t,this},setMaxX:function(t){return this.maxX=t,this},setMaxY:function(t){return this.maxY=t,this},roundOut:function(){return this.minX=Math.floor(this.minX),this.minY=Math.floor(this.minY),this.maxX=Math.ceil(this.maxX),this.maxY=Math.ceil(this.maxY),this},roundIn:function(){return this.minX=Math.ceil(this.minX),this.minY=Math.ceil(this.minY),this.maxX=Math.floor(this.maxX),this.maxY=Math.floor(this.maxY),this},transform:function(t){if(this.isEmpty())return this;var e=this.minX,s=this.minY,r=this.maxX,o=this.maxY,a=new i.Vector2;return this.setBounds(n.NOTHING),this.addPoint(t.multiplyVector2(a.set(e,s))),this.addPoint(t.multiplyVector2(a.set(e,o))),this.addPoint(t.multiplyVector2(a.set(r,s))),this.addPoint(t.multiplyVector2(a.set(r,o))),this},dilate:function(t){return this.set(this.minX-t,this.minY-t,this.maxX+t,this.maxY+t)},erode:function(t){return this.dilate(-t)},shiftX:function(t){return this.setMinX(this.minX+t).setMaxX(this.maxX+t)},shiftY:function(t){return this.setMinY(this.minY+t).setMaxY(this.maxY+t)},shift:function(t,e){return this.shiftX(t).shiftY(e)}},n.EVERYTHING=new n(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),n.NOTHING=new n(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),n}),i("SCENERY/layers/LayerStrategy",["require","ASSERT/assert","SCENERY/scenery"],function(t){var e=t("ASSERT/assert")("scenery"),i=t("SCENERY/scenery");i.LayerStrategy={hasPreferredLayerType:function(t){return t.trail.lastNode().hasRenderer()},getPreferredLayerType:function(t,i){e&&e(this.hasPreferredLayerType(t,i));var n,s=t.trail.lastNode();return s.hasRendererLayerType()?n=s.getRendererLayerType():(n=i.bestPreferredLayerTypeFor([s.getRenderer()]),n||(n=s.getRenderer().defaultLayerType)),n},enter:function(t,e){var i,n=t.trail,s=n.lastNode();if(s.hasRenderer())i=this.getPreferredLayerType(t,e),e.pushPreferredLayerType(i),e.getCurrentLayerType()!==i&&e.switchToType(t,i);else if(s.hasSelf()){var r=s._supportedRenderers,o=e.getCurrentLayerType();i=e.bestPreferredLayerTypeFor(r),i?o!==i&&e.switchToType(t,i):o&&o.supportsNode(s)||e.switchToType(t,r[0].defaultLayerType)}(s.isLayerSplitBefore()||this.hasSplitFlags(s))&&e.switchToType(t,e.getCurrentLayerType()),s.hasSelf()&&e.markSelf(t)},exit:function(t,e){var i=t.trail,n=i.lastNode();n.hasRenderer()&&e.popPreferredLayerType(),(n.isLayerSplitAfter()||this.hasSplitFlags(n))&&e.switchToType(t,e.getCurrentLayerType())},hasSplitFlags:function(t){var e=t.getRendererOptions();return t.hasRenderer()&&e&&(e.cssTranslation||e.cssRotation||e.cssScale||e.cssTransform)}};var n=i.LayerStrategy;return n}),i("SCENERY/nodes/Node",["require","ASSERT/assert","DOT/Bounds2","DOT/Transform3","DOT/Matrix3","SCENERY/scenery","SCENERY/layers/LayerStrategy"],function(t){var e=t("ASSERT/assert")("scenery"),i=t("DOT/Bounds2"),n=t("DOT/Transform3"),s=t("DOT/Matrix3"),r=t("SCENERY/scenery"),o=t("SCENERY/layers/LayerStrategy"),a=1;r.Node=function h(t){var e=this;this._id=a++,this._visible=!0,this._pickable=!0,this._clipShape=null,this._cursor=null,this._children=[],this._parents=[],this._transform=new n,this._transformListener={before:function(){e.beforeTransformChange()},after:function(){e.afterTransformChange()}},this._transform.addTransformListener(this._transformListener),this._inputListeners=[],this._eventListeners=[],this._includeStrokeInHitRegion=!1,this._bounds=i.NOTHING,this._selfBounds=i.NOTHING,this._childBounds=i.NOTHING,this._boundsDirty=!0,this._selfBoundsDirty=this.hasSelf(),this._childBoundsDirty=!0,this._paintDirty=!1,this._childPaintDirty=!1,this._oldPaintMarked=!1,this._renderer=null,this._rendererOptions=null,this._rendererLayerType=null,this._layerSplitBefore=!1,this._layerSplitAfter=!1,t&&this.mutate(t)};var h=r.Node;return h.prototype={constructor:h,enterState:function(t,e){this._transform.isIdentity()||t.applyTransformationMatrix(this._transform.getMatrix()),this._clipShape&&t.pushClipShape(e.getTransform().transformShape(this._clipShape))},exitState:function(t){this._clipShape&&t.popClipShape(),this._transform.isIdentity()||t.applyTransformationMatrix(this._transform.getInverse())},insertChild:function(t,i){e&&e(null!==i&&void 0!==i,"insertChild cannot insert a null/undefined child"),e&&e(!_.contains(this._children,i),"Parent already contains child"),e&&e(i!==this,"Cannot add self as a child"),i._parents.push(this),this._children.splice(t,0,i),i.invalidateBounds(),i.invalidatePaint(),this.dispatchEvent("markForInsertion",{parent:this,child:i,index:t}),this.dispatchEvent("stitch",{match:!1})},addChild:function(t){this.insertChild(this._children.length,t)},removeChild:function(t){e&&e(this.isChild(t)),t.markOldPaint();var i=_.indexOf(t._parents,this),n=_.indexOf(this._children,t);this.dispatchEvent("markForRemoval",{parent:this,child:t,index:n}),t._parents.splice(i,1),this._children.splice(n,1),this.invalidateBounds(),this.dispatchEvent("stitch",{match:!1})},setChildren:function(t){var e=this;this._children!==t&&(_.each(this._children.slice(0),function(t){e.removeChild(t)}),_.each(t,function(t){e.addChild(t)}))},getChildren:function(){return this._children.slice(0)},getParents:function(){return this._parents.slice(0)},indexOfParent:function(t){return _.indexOf(this._parents,t)},indexOfChild:function(t){return _.indexOf(this._children,t)},moveToFront:function(){var t=this;_.each(this._parents.slice(0),function(e){e.moveChildToFront(t)})},moveChildToFront:function(t){this.indexOfChild(t)!==this._children.length-1&&(this.removeChild(t),this.addChild(t))},moveToBack:function(){var t=this;_.each(this._parents.slice(0),function(e){e.moveChildToBack(t)})},moveChildToBack:function(t){0!==this.indexOfChild(t)&&(this.removeChild(t),this.insertChild(0,t))},detach:function(){var t=this;_.each(this._parents.slice(0),function(e){e.removeChild(t)})},validateBounds:function(){var t=this;if(this._selfBoundsDirty&&(this._selfBoundsDirty=!1,this.markDirtyRegion(this._selfBounds),this.fireEvent("selfBounds",this._selfBounds)),this._childBoundsDirty){_.each(this._children,function(t){t.validateBounds()});var e=this._childBounds;this._childBounds=i.NOTHING,_.each(this._children,function(e){t._childBounds=t._childBounds.union(e._bounds)}),this._childBoundsDirty=!1,this._childBounds.equals(e)||this.fireEvent("childBounds",this._childBounds)}if(this._boundsDirty){var n=this._bounds,s=this.localToParentBounds(this._selfBounds).union(t.localToParentBounds(this._childBounds)),r=!s.equals(n);r&&(this._bounds=s,_.each(this._parents,function(t){t.invalidateBounds()}),this.fireEvent("bounds",this._bounds)),this._boundsDirty=!1}},validatePaint:function(){this._paintDirty&&(this.markDirtyRegion(this.parentToLocalBounds(this._bounds)),this._paintDirty=!1),(this._childPaintDirty||this._oldPaintMarked)&&(this._childPaintDirty=!1,this._oldPaintMarked=!1,_.each(this._children,function(t){t.validatePaint()
}))},invalidateBounds:function(){this._boundsDirty=!0,_.each(this._parents,function(t){t.invalidateChildBounds()})},invalidateChildBounds:function(){this._childBoundsDirty||(this._childBoundsDirty=!0,_.each(this._parents,function(t){t.invalidateChildBounds()}))},invalidatePaint:function(){this._paintDirty=!0,_.each(this._parents,function(t){t.invalidateChildPaint()})},invalidateChildPaint:function(){this._childPaintDirty||(this._childPaintDirty=!0,_.each(this._parents,function(t){t.invalidateChildPaint()}))},invalidateSelf:function(t){e&&e(t.isEmpty()||t.isFinite(),"Bounds must be empty or finite in invalidateSelf"),this.markOldSelfPaint(),this._selfBounds.equals(t)||(this._selfBoundsDirty=!0,this.invalidateBounds(),this._selfBounds=t),this.invalidatePaint()},markDirtyRegion:function(t){this.dispatchEventWithTransform("dirtyBounds",{node:this,bounds:t})},markOldSelfPaint:function(){this.markOldPaint(!0)},markLayerRefreshNeeded:function(){this.dispatchEvent("markForLayerRefresh",{}),this.dispatchEvent("stitch",{match:!0})},markOldPaint:function(t){function e(t){return t._oldPaintMarked?!0:_.some(t._parents,function(t){return e(t)})}var i=e(this);i||(t?this.markDirtyRegion(this._selfBounds):(this.markDirtyRegion(this.parentToLocalBounds(this._bounds)),this._oldPaintMarked=!0))},isChild:function(t){var i=_.contains(this._children,t),n=_.contains(t._parents,this);return e&&e(i===n),i},getSelfBounds:function(){return this._selfBounds},getChildBounds:function(){return this.validateBounds(),this._childBounds},getBounds:function(){return this.validateBounds(),this._bounds},trailUnderPoint:function(t,i){e&&e(t,"trailUnderPointer requires a point");var n=i&&void 0!==i.pruneInvisible?i.pruneInvisible:!0,s=i&&void 0!==i.pruneUnpickable?i.pruneUnpickable:!0;if(n&&!this.isVisible())return null;if(s&&!this.isPickable())return null;if(this.validateBounds(),!this._bounds.containsPoint(t))return null;var o=this._transform.inversePosition2(t);if(this._children.length>0&&this._childBounds.containsPoint(o))for(var a=this._children.length-1;a>=0;a--){var h=this._children[a],u=h.trailUnderPoint(o,i);if(u)return u.addAncestor(this,a),u}return this._selfBounds.containsPoint(o)&&this.containsPointSelf(o)?new r.Trail(this):null},containsPoint:function(t){return null!==this.trailUnderPoint(t)},containsPointSelf:function(t){return this._selfBounds.containsPoint(t)},intersectsBoundsSelf:function(t){return this._selfBounds.intersectsBounds(t)},hasSelf:function(){return!1},hasParent:function(){return 0!==this._parents.length},hasChildren:function(){return this._children.length>0},walkDepthFirst:function(t){t(this),_.each(this._children,function(e){e.walkDepthFirst(t)})},getChildrenWithinBounds:function(t){return _.filter(this._children,function(e){return!e._bounds.intersection(t).isEmpty()})},addInputListener:function(t){-1===_.indexOf(this._inputListeners,t)&&this._inputListeners.push(t)},removeInputListener:function(t){e&&e(-1!==_.indexOf(this._inputListeners,t)),this._inputListeners.splice(_.indexOf(this._inputListeners,t),1)},getInputListeners:function(){return this._inputListeners.slice(0)},addEventListener:function(t){-1===_.indexOf(this._eventListeners,t)&&this._eventListeners.push(t)},removeEventListener:function(t){e&&e(-1!==_.indexOf(this._eventListeners,t)),this._eventListeners.splice(_.indexOf(this._eventListeners,t),1)},getEventListeners:function(){return this._eventListeners.slice(0)},fireEvent:function(t,e){_.each(this.getEventListeners(),function(i){i[t]&&i[t](e)})},dispatchEvent:function(t,e){function i(s){n.addAncestor(s),e.trail=n,s.fireEvent(t,e),_.each(s._parents,function(t){i(t)}),n.removeAncestor()}var n=new r.Trail;i(this)},dispatchEventWithTransform:function(t,e){function i(r){s.addAncestor(r),o.push(new n(r.getMatrix().timesMatrix(o[o.length-1].getMatrix()))),e.transform=o[o.length-1],e.trail=s,r.fireEvent(t,e),_.each(r._parents,function(t){i(t)}),o.pop(),s.removeAncestor()}var s=new r.Trail,o=[new n];i(this)},translate:function(t,e,i){if("number"==typeof t)i?this.prependMatrix(s.translation(t,e)):this.appendMatrix(s.translation(t,e));else{var n=t;this.translate(n.x,n.y,e)}},scale:function(t,e,i){if("number"==typeof t)void 0===e?this.appendMatrix(s.scaling(t,t)):i?this.prependMatrix(s.scaling(t,e)):this.appendMatrix(s.scaling(t,e));else{var n=t;this.scale(n.x,n.y,e)}},rotate:function(t,e){e?this.prependMatrix(s.rotation2(t)):this.appendMatrix(s.rotation2(t))},rotateAround:function(t,e){var i=s.translation(-t.x,-t.y);i=s.rotation2(e).timesMatrix(i),i=s.translation(t.x,t.y).timesMatrix(i),this.prependMatrix(i)},getX:function(){return this.getTranslation().x},setX:function(t){return this.setTranslation(t,this.getY()),this},getY:function(){return this.getTranslation().y},setY:function(t){return this.setTranslation(this.getX(),t),this},getScaleVector:function(){return this._transform.getMatrix().getScaleVector()},setScaleMagnitude:function(t,e){var i=this.getScaleVector();return"number"==typeof t?(void 0===e&&(e=t),this.appendMatrix(s.scaling(t/i.x,e/i.y))):this.appendMatrix(s.scaling(t.x/i.x,t.y/i.y)),this},getRotation:function(){return this._transform.getMatrix().getRotation()},setRotation:function(t){return this.appendMatrix(s.rotation2(t-this.getRotation())),this},setTranslation:function(t,e){var i=this.getTranslation();return"number"==typeof t?this.translate(t-i.x,e-i.y,!0):this.translate(t.x-i.x,t.y-i.y,!0),this},getTranslation:function(){return this._transform.getMatrix().getTranslation()},appendMatrix:function(t){this._transform.append(t)},prependMatrix:function(t){this._transform.prepend(t)},setMatrix:function(t){this._transform.set(t)},getMatrix:function(){return this._transform.getMatrix()},setTransform:function(t){this._transform!==t&&(this.beforeTransformChange(),this._transform.removeTransformListener(this._transformListener),this._transform=t,this._transform.addTransformListener(this._transformListener),this.afterTransformChange())},getTransform:function(){return this._transform},resetTransform:function(){this.setMatrix(s.IDENTITY)},beforeTransformChange:function(){this.markOldPaint()},afterTransformChange:function(){this.dispatchEventWithTransform("transform",{node:this,type:"transform",matrix:this._transform.getMatrix()}),this.invalidateBounds(),this.invalidatePaint()},getLeft:function(){return this.getBounds().minX},setLeft:function(t){return this.translate(t-this.getLeft(),0,!0),this},getRight:function(){return this.getBounds().maxX},setRight:function(t){return this.translate(t-this.getRight(),0,!0),this},getCenterX:function(){return this.getBounds().getCenterX()},setCenterX:function(t){return this.translate(t-this.getCenterX(),0,!0),this},getCenterY:function(){return this.getBounds().getCenterY()},setCenterY:function(t){return this.translate(0,t-this.getCenterY(),!0),this},getTop:function(){return this.getBounds().minY},setTop:function(t){return this.translate(0,t-this.getTop(),!0),this},getBottom:function(){return this.getBounds().maxY},setBottom:function(t){return this.translate(0,t-this.getBottom(),!0),this},getWidth:function(){return this.getBounds().getWidth()},getHeight:function(){return this.getBounds().getHeight()},getId:function(){return this._id},isVisible:function(){return this._visible},setVisible:function(t){return t!==this._visible&&(this._visible&&this.markOldSelfPaint(),this._visible=t,this.invalidatePaint()),this},isPickable:function(){return this._pickable},setPickable:function(t){this._pickable!==t&&(this._pickable=t)},setCursor:function(t){this._cursor="auto"===t?null:t},getCursor:function(){return this._cursor},updateLayerType:function(){this._renderer&&this._rendererOptions?(this._rendererOptions.cssTransform||this._rendererOptions.cssTranslation||this._rendererOptions.cssRotation||this._rendererOptions.cssScale?this._rendererOptions.baseNode=this:this._rendererOptions.hasOwnProperty("baseNode")&&delete this._rendererOptions.baseNode,this._rendererLayerType=this._renderer.createLayerType(this._rendererOptions)):this._rendererLayerType=null},getRendererLayerType:function(){return this._rendererLayerType},hasRendererLayerType:function(){return!!this._rendererLayerType},setRenderer:function(t){var i;if("string"==typeof t)e&&e(r.Renderer[t],"unknown renderer in setRenderer: "+t),i=r.Renderer[t];else{if(!(t instanceof r.Renderer))throw Error("unrecognized type of renderer: "+t);i=t}i!==this._renderer&&(e&&e(!this.hasSelf()||_.contains(this._supportedRenderers,i),"renderer "+i+" not supported by "+this),this._renderer=i,this.updateLayerType(),this.markLayerRefreshNeeded())},getRenderer:function(){return this._renderer},hasRenderer:function(){return!!this._renderer},setRendererOptions:function(t){this._rendererOptions=t,this.updateLayerType(),this.markLayerRefreshNeeded()},getRendererOptions:function(){return this._rendererOptions},hasRendererOptions:function(){return!!this._rendererOptions},setLayerSplitBefore:function(t){this._layerSplitBefore!==t&&(this._layerSplitBefore=t,this.markLayerRefreshNeeded())},isLayerSplitBefore:function(){return this._layerSplitBefore},setLayerSplitAfter:function(t){this._layerSplitAfter!==t&&(this._layerSplitAfter=t,this.markLayerRefreshNeeded())},isLayerSplitAfter:function(){return this._layerSplitAfter},setLayerSplit:function(t){(t!==this._layerSplitBefore||t!==this._layerSplitAfter)&&(this._layerSplitBefore=t,this._layerSplitAfter=t,this.markLayerRefreshNeeded())},getUniqueTrail:function(){for(var t=new r.Trail,i=this;i;)t.addAncestor(i),e&&e(1>=i._parents.length),i=i._parents[0];return t},debugText:function(){var t=new r.TrailPointer(new r.Trail(this),!0),e=new r.TrailPointer(new r.Trail(this),!1),i=0;t.depthFirstUntil(e,function(t){if(t.isBefore){var e=Array(2*i).join(" ");console.log(e+t.trail.lastNode().getId()+" "+(""+t.trail))}i+=t.isBefore?1:-1},!1)},toCanvas:function(t,e,i,n,s){var o=this,a=2,h=this.getBounds();e=void 0!==e?e:Math.ceil(a-h.minX),i=void 0!==i?i:Math.ceil(a-h.minY),n=void 0!==n?n:Math.ceil(e+h.getWidth()+a),s=void 0!==s?s:Math.ceil(i+h.getHeight()+a);var u=document.createElement("canvas");u.width=n,u.height=s;var c=u.getContext("2d"),l=$(document.createElement("div"));l.width(n).height(s);var d=new r.Scene(l);d.addChild(o),d.x=e,d.y=i,d.updateScene(),d.renderToCanvas(u,c,function(){t(u,e,i),d.removeChild(o)})},toDataURL:function(t,e,i,n,s){this.toCanvas(function(e,i,n){t(e.toDataURL(),i,n)},e,i,n,s)},toImage:function(t,e,i,n,s){this.toDataURL(function(e,i,n){var s=document.createElement("img");s.onload=function(){t(s,i,n),delete s.onload},s.src=e},e,i,n,s)},localToParentPoint:function(t){return this._transform.transformPosition2(t)},localToParentBounds:function(t){return this._transform.transformBounds2(t)},parentToLocalPoint:function(t){return this._transform.inversePosition2(t)},parentToLocalBounds:function(t){return this._transform.inverseBounds2(t)},localToGlobalPoint:function(t){for(var i=this;null!==i;)t=i._transform.transformPosition2(t),e&&e(void 0===i._parents[1],"localToGlobalPoint unable to work for DAG"),i=i._parents[0];return t},localToGlobalBounds:function(t){for(var i=this;null!==i;)t=i._transform.transformBounds2(t),e&&e(void 0===i._parents[1],"localToGlobalBounds unable to work for DAG"),i=i._parents[0];return t},globalToLocalPoint:function(t){for(var i=this,n=[];null!==i;)n.push(i._transform),e&&e(void 0===i._parents[1],"globalToLocalPoint unable to work for DAG"),i=i._parents[0];for(var s=n.length-1;s>=0;s--)t=n[s].inversePosition2(t);return t},globalToLocalBounds:function(t){for(var i=this,n=[];null!==i;)n.push(i._transform),e&&e(void 0===i._parents[1],"globalToLocalBounds unable to work for DAG"),i=i._parents[0];for(var s=n.length-1;s>=0;s--)t=n[s].inverseBounds2(t);return t},set layerSplit(t){this.setLayerSplit(t)},get layerSplit(){throw Error("You can't get a layerSplit property, since it modifies two separate properties")},set layerSplitBefore(t){this.setLayerSplitBefore(t)},get layerSplitBefore(){return this.isLayerSplitBefore()},set layerSplitAfter(t){this.setLayerSplitAfter(t)},get layerSplitAfter(){return this.isLayerSplitAfter()},set renderer(t){this.setRenderer(t)},get renderer(){return this.getRenderer()},set rendererOptions(t){this.setRendererOptions(t)},get rendererOptions(){return this.getRendererOptions()},set cursor(t){this.setCursor(t)},get cursor(){return this.isCursor()},set visible(t){this.setVisible(t)},get visible(){return this.isVisible()},set pickable(t){this.setPickable(t)},get pickable(){return this.isPickable()},set transform(t){this.setTransform(t)},get transform(){return this.getTransform()},set matrix(t){this.setMatrix(t)},get matrix(){return this.getMatrix()},set translation(t){this.setTranslation(t)},get translation(){return this.getTranslation()},set rotation(t){this.setRotation(t)},get rotation(){return this.getRotation()},set x(t){this.setX(t)},get x(){return this.getX()},set y(t){this.setY(t)},get y(){return this.getY()},set left(t){this.setLeft(t)},get left(){return this.getLeft()},set right(t){this.setRight(t)},get right(){return this.getRight()},set top(t){this.setTop(t)},get top(){return this.getTop()},set bottom(t){this.setBottom(t)},get bottom(){return this.getBottom()},set centerX(t){this.setCenterX(t)},get centerX(){return this.getCenterX()},set centerY(t){this.setCenterY(t)},get centerY(){return this.getCenterY()},set children(t){this.setChildren(t)},get children(){return this.getChildren()},get parents(){return this.getParents()},get width(){return this.getWidth()},get height(){return this.getHeight()},get bounds(){return this.getBounds()},get selfBounds(){return this.getSelfBounds()},get childBounds(){return this.getChildBounds()},get id(){return this.getId()},mutate:function(t){var e=this;return _.each(this._mutatorKeys,function(i){if(void 0!==t[i]){var n=Object.getOwnPropertyDescriptor(h.prototype,i);n&&"function"==typeof n.value?e[i](t[i]):e[i]=t[i]}}),this}},h.prototype._mutatorKeys=["children","cursor","visible","pickable","translation","x","y","rotation","scale","left","right","top","bottom","centerX","centerY","renderer","rendererOptions","layerSplit","layerSplitBefore","layerSplitAfter"],h.prototype._supportedRenderers=[],h.prototype.layerStrategy=o,h}),i("SCENERY/util/Trail",["require","ASSERT/assert","ASSERT/assert","DOT/Transform3","SCENERY/scenery","SCENERY/nodes/Node"],function(t){var e=t("ASSERT/assert")("scenery"),i=t("ASSERT/assert")("scenery.extra",!1),n=t("DOT/Transform3"),s=t("SCENERY/scenery");t("SCENERY/nodes/Node"),s.Trail=function(t){if(t instanceof r){var e=t;return this.nodes=e.nodes.slice(0),this.length=e.length,this.indices=e.indices.slice(0),void 0}this.nodes=[],this.length=0,this.indices=[];var i=this;if(t)if(t instanceof s.Node){var n=t;i.addDescendant(n)}else _.each(t,function(t){i.addDescendant(t)})};var r=s.Trail;return r.prototype={constructor:r,copy:function(){return new r(this)},get:function(t){return t>=0?this.nodes[t]:this.nodes[this.nodes.length+t]},slice:function(t,e){return new r(this.nodes.slice(t,e))},subtrailTo:function(t,e){return this.slice(0,_.indexOf(this.nodes,t)+(e?0:1))},isEmpty:function(){return 0===this.nodes.length},getTransform:function(){var t=new n;return _.each(this.nodes,function(e){t.appendTransform(e._transform)}),t},addAncestor:function(t,e){var i=this.nodes[0];this.nodes.unshift(t),i&&this.indices.unshift(void 0===e?_.indexOf(t._children,i):e),this.length++;for(var n=0;this.length>n;n++)this[n]=this.nodes[n];return this},removeAncestor:function(){this.nodes.shift(),this.indices.length&&this.indices.shift(),this.length--,delete this[this.length];for(var t=0;this.length>t;t++)this[t]=this.nodes[t];return this},addDescendant:function(t,e){var i=this.lastNode();return this.nodes.push(t),i&&this.indices.push(void 0===e?_.indexOf(i._children,t):e),this.length++,this[this.length-1]=t,this},removeDescendant:function(){return this.nodes.pop(),this.indices.length&&this.indices.pop(),this.length--,delete this[this.length],this},reindex:function(){for(var t=1;this.length>t;t++){var e=this.indices[t-1];this.nodes[t-1]._children[e]!==this.nodes[t]&&(this.indices[t-1]=_.indexOf(this.nodes[t-1]._children,this.nodes[t]))}},areIndicesValid:function(){for(var t=1;this.length>t;t++){var e=this.indices[t-1];if(this.nodes[t-1]._children[e]!==this.nodes[t])return!1}return!0},equals:function(t){if(this.length!==t.length)return!1;for(var e=0;this.nodes.length>e;e++)if(this.nodes[e]!==t.nodes[e])return!1;return!0},isExtensionOf:function(t,e){if(i&&i(this.areIndicesValid(),"Trail.compare this.areIndicesValid() failed"),i&&i(t.areIndicesValid(),"Trail.compare other.areIndicesValid() failed"),this.length<=t.length-(e?1:0))return!1;for(var n=0;t.nodes.length>n;n++)if(this.nodes[n]!==t.nodes[n])return!1;return!0},nodeFromTop:function(t){return this.nodes[this.length-1-t]},lastNode:function(){return this.nodeFromTop(0)},rootNode:function(){return this.nodes[0]},previous:function(){if(1>=this.nodes.length)return null;var t=this.nodeFromTop(0),i=this.nodeFromTop(1),n=_.indexOf(i._children,t);e&&e(-1!==n);var s=this.nodes.slice(0,this.nodes.length-1);if(0===n)return new r(s);for(s.push(i._children[n-1]);0!==s[s.length-1]._children.length;){var o=s[s.length-1];s.push(o._children[o._children.length-1])}return new r(s)},previousSelf:function(){for(var t=this.previous();t&&!t.lastNode().hasSelf();)t=t.previous();return t},next:function(){var t=this.nodes.slice(0),e=this.nodeFromTop(0);if(e._children.length>0)return t.push(e._children[0]),new r(t);for(var i=this.nodes.length-1;i>0;){var n=this.nodes[i],s=this.nodes[i-1];t.pop();var o=_.indexOf(s._children,n);if(o!==s._children.length-1)return t.push(s._children[o+1]),new r(t);i--}return null},nextSelf:function(){for(var t=this.next();t&&!t.lastNode().hasSelf();)t=t.next();return t},eachTrailUnder:function(t){new s.TrailPointer(this,!0).eachTrailBetween(new s.TrailPointer(this,!1),t)},compare:function(t){e&&e(!this.isEmpty(),"cannot compare with an empty trail"),e&&e(!t.isEmpty(),"cannot compare with an empty trail"),e&&e(this.nodes[0]===t.nodes[0],"for Trail comparison, trails must have the same root node"),i&&i(this.areIndicesValid(),"Trail.compare this.areIndicesValid() failed"),i&&i(t.areIndicesValid(),"Trail.compare other.areIndicesValid() failed");for(var n=Math.min(this.indices.length,t.indices.length),s=0;n>s;s++)if(this.indices[s]!==t.indices[s])return this.indices[s]<t.indices[s]?-1:1;return this.nodes.length<t.nodes.length?-1:this.nodes.length>t.nodes.length?1:0},localToGlobalPoint:function(t){return this.getTransform().transformPosition2(t)},localToGlobalBounds:function(t){return this.getTransform().transformBounds2(t)},globalToLocalPoint:function(t){return this.getTransform().inversePosition2(t)},globalToLocalBounds:function(t){return this.getTransform().inverseBounds2(t)},getUniqueId:function(){return _.map(this.nodes,function(t){return t.getId()}).join("-")},toString:function(){return this.reindex(),this.length?"[Trail "+this.indices.join(".")+" "+this.getUniqueId()+"]":"Empty Trail"}},r.eachSelfTrailbetween=function(t,e,i,n,s){r.eachTrailBetween(t,e,function(t){t&&t.lastNode().hasSelf()&&i(t)},n,s)},r.eachTrailBetween=function(t,e,i,n,r){var o=t?new s.TrailPointer(t.copy(),!0):new s.TrailPointer(new s.Trail(r),!0),a=e?new s.TrailPointer(e.copy(),!0):new s.TrailPointer(new s.Trail(r),!1);n&&(o.nestedForwards(),a.nestedBackwards(),1===o.compareNested(a))||o.depthFirstUntil(a,function(t){t.isBefore&&i(t.trail)},!1)},r}),i("SCENERY/input/Pointer",["require","ASSERT/assert","SCENERY/scenery"],function(t){var e=t("ASSERT/assert")("scenery"),i=t("SCENERY/scenery");i.Pointer=function(){this.listeners=[]};var n=i.Pointer;return n.prototype={constructor:n,addInputListener:function(t){e&&e(!_.contains(this.listeners,t)),this.listeners.push(t)},removeInputListener:function(t){var i=_.indexOf(this.listeners,t);e&&e(-1!==i),this.listeners.splice(i,1)}},n}),i("SCENERY/input/Mouse",["require","SCENERY/scenery","SCENERY/input/Pointer"],function(t){var e=t("SCENERY/scenery"),i=t("SCENERY/input/Pointer");e.Mouse=function(){i.call(this),this.point=null,this.leftDown=!1,this.middleDown=!1,this.rightDown=!1,this.isMouse=!0,this.trail=null,this.type="mouse"};var n=e.Mouse;return n.prototype=_.extend({},i.prototype,{constructor:n,down:function(t,e){switch(this.point=t,e.button){case 0:this.leftDown=!0;break;case 1:this.middleDown=!0;break;case 2:this.rightDown=!0}},up:function(t,e){switch(this.point=t,e.button){case 0:this.leftDown=!1;break;case 1:this.middleDown=!1;break;case 2:this.rightDown=!1}},move:function(t){this.point=t},over:function(t){this.point=t},out:function(){this.point=null}}),n}),i("SCENERY/input/Touch",["require","SCENERY/scenery","SCENERY/input/Pointer"],function(t){var e=t("SCENERY/scenery"),i=t("SCENERY/input/Pointer");e.Touch=function(t,e){i.call(this),this.id=t,this.point=e,this.isTouch=!0,this.trail=null,this.type="touch"};var n=e.Touch;return n.prototype=_.extend({},i.prototype,{constructor:n,move:function(t){this.point=t},end:function(t){this.point=t},cancel:function(t){this.point=t}}),n}),i("SCENERY/input/Pen",["require","SCENERY/scenery","SCENERY/input/Pointer"],function(t){var e=t("SCENERY/scenery"),i=t("SCENERY/input/Pointer");e.Pen=function(t,e){i.call(this),this.id=t,this.point=e,this.isPen=!0,this.trail=null,this.type="pen"};var n=e.Pen;return n.prototype=_.extend({},i.prototype,{constructor:n,move:function(t){this.point=t},end:function(t){this.point=t},cancel:function(t){this.point=t}}),n}),i("SCENERY/input/Input",["require","ASSERT/assert","SCENERY/scenery","SCENERY/util/Trail","SCENERY/input/Mouse","SCENERY/input/Touch","SCENERY/input/Pen","SCENERY/input/Event"],function(t){t("ASSERT/assert")("scenery");var e=t("SCENERY/scenery");t("SCENERY/util/Trail"),t("SCENERY/input/Mouse"),t("SCENERY/input/Touch"),t("SCENERY/input/Pen"),t("SCENERY/input/Event"),e.Input=function(t,i){this.scene=t,this.listenerTarget=i,this.mouse=new e.Mouse,this.pointers=[this.mouse],this.listenerReferences=[]};var i=e.Input;return i.prototype={constructor:i,addPointer:function(t){this.pointers.push(t)},removePointer:function(t){for(var e=this.pointers.length-1;e>=0;e--)this.pointers[e]===t&&this.pointers.splice(e,1)},findTouchById:function(t){return _.find(this.pointers,function(e){return e.id===t})},mouseDown:function(t,e){this.mouse.down(t,e),this.downEvent(this.mouse,e)},mouseUp:function(t,e){this.mouse.up(t,e),this.upEvent(this.mouse,e)},mouseMove:function(t,e){this.mouse.move(t,e),this.moveEvent(this.mouse,e)},mouseOver:function(t,e){this.mouse.over(t,e)},mouseOut:function(t,e){this.mouse.out(t,e)},touchStart:function(t,i,n){var s=new e.Touch(t,i,n);this.addPointer(s),this.downEvent(s,n)},touchEnd:function(t,e,i){var n=this.findTouchById(t);n.end(e,i),this.removePointer(n),this.upEvent(n,i)},touchMove:function(t,e,i){var n=this.findTouchById(t);n.move(e,i),this.moveEvent(n,i)},touchCancel:function(t,e,i){var n=this.findTouchById(t);n.cancel(e,i),this.removePointer(n),this.cancelEvent(n,i)},penStart:function(t,i,n){var s=new e.Pen(t,i,n);this.addPointer(s),this.downEvent(s,n)},penEnd:function(t,e,i){var n=this.findTouchById(t);n.end(e,i),this.removePointer(n),this.upEvent(n,i)},penMove:function(t,e,i){var n=this.findTouchById(t);n.move(e,i),this.moveEvent(n,i)},penCancel:function(t,e,i){var n=this.findTouchById(t);n.cancel(e,i),this.removePointer(n),this.cancelEvent(n,i)},pointerDown:function(t,e,i,n){switch(e){case"mouse":this.mouseDown(i,n);break;case"touch":this.touchStart(t,i,n);break;case"pen":this.penStart(t,i,n);break;default:console.log&&console.log("Unknown pointer type: "+e)}},pointerUp:function(t,e,i,n){switch(e){case"mouse":this.mouseUp(i,n);break;case"touch":this.touchEnd(t,i,n);break;case"pen":this.penEnd(t,i,n);break;default:console.log&&console.log("Unknown pointer type: "+e)}},pointerCancel:function(t,e,i,n){switch(e){case"mouse":console&&console.log&&console.log("WARNING: Pointer mouse cancel was received");break;case"touch":this.touchCancel(t,i,n);break;case"pen":this.penCancel(t,i,n);break;default:console.log&&console.log("Unknown pointer type: "+e)}},pointerMove:function(t,e,i,n){switch(e){case"mouse":this.mouseMove(i,n);break;case"touch":this.touchMove(t,i,n);break;case"pen":this.penMove(t,i,n);break;default:console.log&&console.log("Unknown pointer type: "+e)}},pointerOver:function(){},pointerOut:function(){},pointerEnter:function(){},pointerLeave:function(){},upEvent:function(t,i){var n=this.scene.trailUnderPoint(t.point)||new e.Trail(this.scene);this.dispatchEvent(n,"up",t,i,!0),t.trail=n},downEvent:function(t,i){var n=this.scene.trailUnderPoint(t.point)||new e.Trail(this.scene);this.dispatchEvent(n,"down",t,i,!0),t.trail=n},moveEvent:function(t,i){var n,s=this.scene.trailUnderPoint(t.point)||new e.Trail(this.scene),r=t.trail||new e.Trail(this.scene),o=r.lastNode()!==s.lastNode();for(n=0;Math.min(s.length,r.length)>n&&s.nodes[n]===r.nodes[n];n++);if(o&&this.dispatchEvent(r,"out",t,i,!0),r.length>n)for(var a=n;r.length>a;a++)this.dispatchEvent(r.slice(0,a+1),"exit",t,i,!1);if(s.length>n)for(var h=n;s.length>h;h++)this.dispatchEvent(s.slice(0,h+1),"enter",t,i,!1);o&&this.dispatchEvent(s,"over",t,i,!0),this.dispatchEvent(s,"move",t,i,!0),t.trail=s},cancelEvent:function(t,e){var i=this.scene.trailUnderPoint(t.point);this.dispatchEvent(i,"cancel",t,e,!0),t.trail=i},dispatchEvent:function(t,i,n,s,r){if(!t)try{throw Error("falsy trail for dispatchEvent")}catch(o){throw console.log(o.stack),o}var a=new e.Event({trail:t,type:i,pointer:n,domEvent:s,currentTarget:null,target:t.lastNode()});this.dispatchToPointer(i,n,a),this.dispatchToTargets(t,n,i,a,r),t.lastNode().interactive||s.preventDefault()},dispatchToPointer:function(t,e,i){if(!i.aborted&&!i.handled)for(var n=e.type+t,s=e.listeners.slice(0),r=0;s.length>r;r++){var o=s[r],a=!1;if(!a&&o[n]&&(o[n](i),a=i.aborted),!a&&o[t]&&(o[t](i),a=i.aborted),a)return}},dispatchToTargets:function(t,e,i,n,s){if(!n.aborted&&!n.handled)for(var r=e.type+i,o=t.length-1;o>=0;s?o--:o=-1){var a=t.nodes[o];n.currentTarget=a;for(var h=a.getInputListeners(),u=0;h.length>u;u++){var c=h[u],l=!1;if(!l&&c[r]&&(c[r](n),l=n.aborted),!l&&c[i]&&(c[i](n),l=n.aborted),l)return}if(n.handled)return}},addListener:function(t,e,i){this.listenerTarget.addEventListener(t,e,i),this.listenerReferences.push({type:t,callback:e,useCapture:i})},diposeListeners:function(){var t=this;_.each(this.listenerReferences,function(e){t.listenerTarget.removeEventListener(e.type,e.callback,e.useCapture)})}},i}),i("SCENERY/input/Key",["require","SCENERY/scenery","SCENERY/input/Pointer"],function(t){var e=t("SCENERY/scenery"),i=t("SCENERY/input/Pointer");e.Key=function(t){i.call(this),this.key=t,this.isKey=!0,this.trail=null,this.type="key"};var n=e.Key;return n.prototype=_.extend({},i.prototype,{constructor:n}),n}),i("SCENERY/input/SimpleDragHandler",["require","ASSERT/assert","DOT/Matrix3","SCENERY/scenery"],function(t){var e=t("ASSERT/assert")("scenery");t("DOT/Matrix3");var i=t("SCENERY/scenery");i.SimpleDragHandler=function(t){var i=this;this.options=_.extend({allowTouchSnag:!1},t),this.dragging=!1,this.pointer=null,this.trail=null,this.transform=null,this.node=null,this.lastDragPoint=null,this.startTransformMatrix=null,this.mouseButton=void 0,this.transformListener={transform:function(t){if(i.trail.isExtensionOf(t.trail,!0)){var e=t.trail.getTransform().getMatrix(),n=i.transform.getMatrix();i.node.prependMatrix(e.inverted().timesMatrix(n)),i.transform.set(e)}}},this.dragListener={up:function(t){e&&e(t.pointer===i.pointer),t.pointer.isMouse&&t.domEvent.button!==i.mouseButton||i.endDrag(t)},cancel:function(t){e&&e(t.pointer===i.pointer),i.endDrag(t),i.node.setMatrix(i.startTransformMatrix)},move:function(t){e&&e(t.pointer===i.pointer);var n=i.transform.inverseDelta2(i.pointer.point.minus(i.lastDragPoint));if(i.options.translate){var s=i.node.getTransform().getMatrix().getTranslation();i.options.translate({delta:n,oldPosition:s,position:s.plus(n)})}else i.node.translate(n,!0);i.lastDragPoint=i.pointer.point,i.options.drag&&i.options.drag(t,i.trail)}}};var n=i.SimpleDragHandler;return n.prototype={constructor:n,startDrag:function(t){t.pointer.dragging=!0,t.pointer.addInputListener(this.dragListener),t.trail.rootNode().addEventListener(this.transformListener),this.dragging=!0,this.pointer=t.pointer,this.trail=t.trail.subtrailTo(t.currentTarget,!0),this.transform=this.trail.getTransform(),this.node=t.currentTarget,this.lastDragPoint=t.pointer.point,this.startTransformMatrix=t.currentTarget.getMatrix(),this.mouseButton=t.domEvent.button,this.options.start&&this.options.start(t,this.trail)},endDrag:function(t){this.pointer.dragging=!1,this.pointer.removeInputListener(this.dragListener),this.trail.rootNode().removeEventListener(this.transformListener),this.dragging=!1,this.options.end&&this.options.end(t,this.trail)},tryToSnag:function(t){this.dragging||t.pointer.dragging||this.startDrag(t)},down:function(t){this.tryToSnag(t)},touchenter:function(t){this.options.allowTouchSnag&&this.tryToSnag(t)}},n}),i("KITE/kite",["require"],function(){return{}}),i("KITE/segments/Segment",["require","ASSERT/assert","KITE/kite"],function(t){t("ASSERT/assert")("kite");var e=t("KITE/kite");e.Segment={};var i=e.Segment;return i}),i("KITE/pieces/Piece",["require","ASSERT/assert","KITE/kite"],function(t){t("ASSERT/assert")("kite");var e=t("KITE/kite");e.Piece={};var i=e.Piece;return i}),i("KITE/segments/Line",["require","ASSERT/assert","KITE/kite","DOT/Bounds2","DOT/Util","KITE/segments/Segment","KITE/pieces/Piece"],function(t){t("ASSERT/assert")("kite"),t("KITE/kite");var e=t("DOT/Bounds2"),i=t("DOT/Util").lineLineIntersection,n=t("KITE/segments/Segment"),s=t("KITE/pieces/Piece");return n.Line=function(t,i){return this.start=t,this.end=i,t.equals(i,0)?(this.invalid=!0,void 0):(this.startTangent=i.minus(t).normalized(),this.endTangent=this.startTangent,this.bounds=e.NOTHING.withPoint(t).withPoint(i),void 0)},n.Line.prototype={constructor:n.Line,positionAt:function(t){return this.start.plus(this.end.minus(this.start).times(t))},tangentAt:function(){return this.startTangent},curvatureAt:function(){return 0},toPieces:function(){return[new s.LineTo(this.end)]},getSVGPathFragment:function(){return"L "+this.end.x+" "+this.end.y},strokeLeft:function(t){return[new s.LineTo(this.end.plus(this.endTangent.perpendicular().negated().times(t/2)))]},strokeRight:function(t){return[new s.LineTo(this.start.plus(this.startTangent.perpendicular().times(t/2)))]},intersectsBounds:function(){throw Error("Segment.Line.intersectsBounds unimplemented")},intersection:function(t){var e=[],n=this.start,s=this.end,r=i(n,s,t.pos,t.pos.plus(t.dir));if(!isFinite(r.x)||!isFinite(r.y))return e;if(n.x!==s.x&&(n.x>s.x?r.x>=n.x||r.x<s.x:r.x<=n.x||r.x>s.x))return e;if(n.y!==s.y&&(n.y>s.y?r.y>=n.y||r.y<s.y:r.y<=n.y||r.y>s.y))return e;var o=r.minus(t.pos).dot(t.dir);if(0>o)return e;var a=s.minus(n),h=a.perpendicular();return e.push({distance:o,point:t.pointAtDistance(o),normal:h.dot(t.dir)>0?h.negated():h,wind:0>t.dir.perpendicular().dot(a)?1:-1}),e},windingIntersection:function(t){var e=this.intersection(t);return e.length?e[0].wind:0}},n.Line}),i("KITE/util/Subpath",["require","ASSERT/assert","KITE/kite","KITE/segments/Line"],function(t){var e=t("ASSERT/assert")("kite"),i=t("KITE/kite");t("KITE/segments/Line"),i.Subpath=function(){this.points=[],this.segments=[],this.closed=!1};var n=i.Subpath;return n.prototype={addPoint:function(t){this.points.push(t)},addSegment:function(t){t.invalid||(e&&e(t.start.isFinite(),"Segment start is infinite"),e&&e(t.end.isFinite(),"Segment end is infinite"),e&&e(t.startTangent.isFinite(),"Segment startTangent is infinite"),e&&e(t.endTangent.isFinite(),"Segment endTangent is infinite"),e&&e(t.bounds.isEmpty()||t.bounds.isFinite(),"Segment bounds is infinite and non-empty"),this.segments.push(t))},close:function(){this.closed=!0},getLength:function(){return this.points.length},getFirstPoint:function(){return _.first(this.points)},getLastPoint:function(){return _.last(this.points)},getFirstSegment:function(){return _.first(this.segments)
},getLastSegment:function(){return _.last(this.segments)},isDrawable:function(){return this.segments.length>0},isClosed:function(){return this.closed},hasClosingSegment:function(){return!this.getFirstPoint().equalsEpsilon(this.getLastPoint(),1e-9)},getClosingSegment:function(){return e&&e(this.hasClosingSegment(),"Implicit closing segment unnecessary on a fully closed path"),new i.Segment.Line(this.getLastPoint(),this.getFirstPoint())}},i.Subpath}),i("KITE/util/LineStyles",["require","ASSERT/assert","KITE/kite"],function(t){t("ASSERT/assert")("kite");var e=t("KITE/kite");e.LineStyles=function(t){void 0===t&&(t={}),this.lineWidth=void 0!==t.lineWidth?t.lineWidth:1,this.lineCap=void 0!==t.lineCap?t.lineCap:"butt",this.lineJoin=void 0!==t.lineJoin?t.lineJoin:"miter",this.lineDash=void 0!==t.lineDash?t.lineDash:null,this.miterLimit=void 0!==t.miterLimit?t.miterLimit:10};var i=e.LineStyles;return i.prototype={constructor:i,equals:function(t){var e=this.lineWidth===t.lineWidth&&this.lineCap===t.lineCap&&this.lineJoin===t.lineJoin&&this.miterLimit===t.miterLimit;if(!e)return!1;if(!this.lineDash!=!t.lineDash)return!1;if(this.lineDash){if(this.lineDash.length!==t.lineDash.length)return!1;for(var i=0;this.lineDash.length>i;i++)if(this.lineDash[i]!==t.lineDash[i])return!1;return!0}return!0}},e.LineStyles}),i("KITE/segments/EllipticalArc",["require","ASSERT/assert","KITE/kite","DOT/Vector2","DOT/Bounds2","DOT/Matrix3","DOT/Transform3","DOT/Util","KITE/segments/Segment","KITE/pieces/Piece","KITE/util/Subpath"],function(t){var e=t("ASSERT/assert")("kite");t("KITE/kite");var i=t("DOT/Vector2"),n=t("DOT/Bounds2"),s=t("DOT/Matrix3"),r=t("DOT/Transform3"),o=t("DOT/Util").toDegrees,a=t("KITE/segments/Segment"),h=t("KITE/pieces/Piece");return t("KITE/util/Subpath"),a.EllipticalArc=function(t,i,s,r,o,h,u){function c(t){l.containsAngle(t)&&(l.bounds=l.bounds.withPoint(l.positionAtAngle(t)))}if(this.center=t,this.radiusX=i,this.radiusY=s,this.rotation=r,this.startAngle=o,this.endAngle=h,this.anticlockwise=u,this.unitTransform=a.EllipticalArc.computeUnitTransform(t,i,s,r),this.start=this.positionAtAngle(o),this.end=this.positionAtAngle(h),this.startTangent=this.tangentAtAngle(o).normalized(),this.endTangent=this.tangentAtAngle(h).normalized(),0===i||0===s||o===h)return this.invalid=!0,void 0;if(s>i)throw Error("Not verified to work if radiusX < radiusY");e&&e(!(!u&&2*-Math.PI>=h-o||u&&2*-Math.PI>=o-h),"Not handling elliptical arcs with start/end angles that show differences in-between browser handling"),e&&e(!(!u&&h-o>2*Math.PI||u&&o-h>2*Math.PI),"Not handling elliptical arcs with start/end angles that show differences in-between browser handling"),!u&&h-o>=2*Math.PI||u&&o-h>=2*Math.PI,this.angleDifference=this.anticlockwise?this.startAngle-this.endAngle:this.endAngle-this.startAngle,0>this.angleDifference&&(this.angleDifference+=2*Math.PI),e&&e(this.angleDifference>=0),this.unitArcSegment=new a.Arc(t,1,o,h,u),this.bounds=n.NOTHING,this.bounds=this.bounds.withPoint(this.start),this.bounds=this.bounds.withPoint(this.end);var l=this;if(o!==h){var d=Math.atan(-(s/i)*Math.tan(r)),m=Math.atan(s/i/Math.tan(r));c(d),c(d+Math.PI),c(m),c(m+Math.PI)}},a.EllipticalArc.prototype={constructor:a.EllipticalArc,angleAt:function(t){return this.anticlockwise?this.startAngle>this.endAngle?this.startAngle+(this.endAngle-this.startAngle)*t:this.startAngle<this.endAngle?this.startAngle+(2*-Math.PI+this.endAngle-this.startAngle)*t:this.startAngle:this.startAngle<this.endAngle?this.startAngle+(this.endAngle-this.startAngle)*t:this.startAngle>this.endAngle?this.startAngle+(2*Math.PI+this.endAngle-this.startAngle)*t:this.startAngle},positionAt:function(t){return this.positionAtAngle(this.angleAt(t))},tangentAt:function(t){return this.tangentAtAngle(this.angleAt(t))},curvatureAt:function(t){var e=this.angleAt(t),i=this.radiusX*Math.sin(e),n=this.radiusY*Math.cos(e),s=Math.pow(n*n+i*i,1.5);return(this.anticlockwise?-1:1)*this.radiusX*this.radiusY/s},positionAtAngle:function(t){return this.unitTransform.transformPosition2(i.createPolar(1,t))},tangentAtAngle:function(t){var e=this.unitTransform.transformNormal2(i.createPolar(1,t));return this.anticlockwise?e.perpendicular():e.perpendicular().negated()},containsAngle:function(t){var e=this.anticlockwise?t-this.endAngle:t-this.startAngle,i=e%(2*Math.PI);return 0>i&&(i+=2*Math.PI),this.angleDifference>=i},toPieces:function(){return[new h.EllipticalArc(this.center,this.radiusX,this.radiusY,this.rotation,this.startAngle,this.endAngle,this.anticlockwise)]},offsetTo:function(t,e){for(var i=32,n=[],s=1;i>s;s++){var r=s/(i-1);e&&(r=1-r);var o=this.angleAt(r),a=this.positionAtAngle(o).plus(this.tangentAtAngle(o).perpendicular().normalized().times(t));n.push(new h.LineTo(a))}return n},getSVGPathFragment:function(){var t,e=.01,i=this.anticlockwise?"0":"1",n=o(this.rotation);if(this.angleDifference<2*Math.PI-e)return t=this.angleDifference<Math.PI?"0":"1","A "+this.radiusX+" "+this.radiusY+" "+n+" "+t+" "+i+" "+this.end.x+" "+this.end.y;var s=(this.startAngle+this.endAngle)/2,r=this.positionAtAngle(s);t="0";var a="A "+this.radiusX+" "+this.radiusY+" "+n+" "+t+" "+i+" "+r.x+" "+r.y,h="A "+this.radiusX+" "+this.radiusY+" "+n+" "+t+" "+i+" "+this.end.x+" "+this.end.y;return a+" "+h},strokeLeft:function(t){return this.offsetTo(-t/2,!1)},strokeRight:function(t){return this.offsetTo(t/2,!0)},intersectsBounds:function(){throw Error("Segment.EllipticalArc.intersectsBounds unimplemented")},intersection:function(t){var e=this.unitTransform,i=e.inverseRay2(t),n=this.unitArcSegment.intersection(i);return _.map(n,function(i){var n=e.transformPosition2(i.point);return{distance:t.pos.distance(n),point:n,normal:e.inverseNormal2(i.normal),wind:i.wind}})},windingIntersection:function(t){var e=this.unitTransform.inverseRay2(t);return this.unitArcSegment.windingIntersection(e)}},a.EllipticalArc.computeUnitTransform=function(t,e,i,n){return new r(s.translation(t.x,t.y).timesMatrix(s.rotation2(n)).timesMatrix(s.scaling(e,i)))},a.EllipticalArc}),i("KITE/pieces/EllipticalArc",["require","ASSERT/assert","ASSERT/assert","KITE/kite","DOT/Vector2","DOT/Bounds2","DOT/Ray2","DOT/Matrix3","DOT/Transform3","KITE/pieces/Piece","KITE/segments/EllipticalArc","KITE/segments/Line","KITE/util/Subpath"],function(t){t("ASSERT/assert")("kite"),t("ASSERT/assert")("kite.extra",!0);var e=t("KITE/kite"),i=t("DOT/Vector2");t("DOT/Bounds2"),t("DOT/Ray2"),t("DOT/Matrix3"),t("DOT/Transform3");var n=t("KITE/pieces/Piece");return t("KITE/segments/EllipticalArc"),t("KITE/segments/Line"),t("KITE/util/Subpath"),n.EllipticalArc=function(t,i,n,s,r,o,a){if(0>i&&(i=-i,r=Math.PI-r,o=Math.PI-o,a=!a),0>n&&(n=-n,r=-r,o=-o,a=!a),n>i){s+=Math.PI/2,r-=Math.PI/2,o-=Math.PI/2;var h=i;i=n,n=h}this.center=t,this.radiusX=i,this.radiusY=n,this.rotation=s,this.startAngle=r,this.endAngle=o,this.anticlockwise=a,this.unitTransform=e.Segment.EllipticalArc.computeUnitTransform(t,i,n,s)},n.EllipticalArc.prototype={constructor:n.EllipticalArc,writeToContext:function(t){t.ellipse?t.ellipse(this.center.x,this.center.y,this.radiusX,this.radiusY,this.rotation,this.startAngle,this.endAngle,this.anticlockwise):(this.unitTransform.getMatrix().canvasAppendTransform(t),t.arc(0,0,1,this.startAngle,this.endAngle,this.anticlockwise),this.unitTransform.getInverse().canvasAppendTransform(t))},transformed:function(t){var e=t.timesVector2(i.createPolar(this.radiusX,this.rotation)).minus(t.timesVector2(i.ZERO)),s=t.timesVector2(i.createPolar(this.radiusY,this.rotation+Math.PI/2)).minus(t.timesVector2(i.ZERO)),r=e.angle(),o=e.magnitude(),a=s.magnitude(),h=0>t.getDeterminant(),u=h?!this.anticlockwise:this.anticlockwise,c=h?-this.startAngle:this.startAngle,l=h?-this.endAngle:this.endAngle;return[new n.EllipticalArc(t.timesVector2(this.center),o,a,r,c,l,u)]},applyPiece:function(t){var i=new e.Segment.EllipticalArc(this.center,this.radiusX,this.radiusY,this.rotation,this.startAngle,this.endAngle,this.anticlockwise),n=i.start,s=i.end;t.hasSubpaths()&&t.getLastSubpath().getLength()>0&&!n.equals(t.getLastSubpath().getLastPoint(),0)&&t.getLastSubpath().addSegment(new e.Segment.Line(t.getLastSubpath().getLastPoint(),n)),t.hasSubpaths()||t.addSubpath(new e.Subpath),t.getLastSubpath().addSegment(i),t.getLastSubpath().addPoint(n),t.getLastSubpath().addPoint(s),i.invalid||(t.bounds=t.bounds.union(i.bounds))}},n.EllipticalArc}),i("KITE/segments/Arc",["require","ASSERT/assert","KITE/kite","DOT/Vector2","DOT/Bounds2","KITE/segments/Segment","KITE/pieces/Piece"],function(t){var e=t("ASSERT/assert")("kite");t("KITE/kite");var i=t("DOT/Vector2"),n=t("DOT/Bounds2"),s=t("KITE/segments/Segment"),r=t("KITE/pieces/Piece");return s.Arc=function(t,s,r,o,a){function h(e){u.containsAngle(e)&&(u.bounds=u.bounds.withPoint(t.plus(i.createPolar(s,e))))}if(this.center=t,this.radius=s,this.startAngle=r,this.endAngle=o,this.anticlockwise=a,this.start=this.positionAtAngle(r),this.end=this.positionAtAngle(o),this.startTangent=this.tangentAtAngle(r),this.endTangent=this.tangentAtAngle(o),0>=s||r===o)return this.invalid=!0,void 0;e&&e(!(!a&&2*-Math.PI>=o-r||a&&2*-Math.PI>=r-o),"Not handling arcs with start/end angles that show differences in-between browser handling"),e&&e(!(!a&&o-r>2*Math.PI||a&&r-o>2*Math.PI),"Not handling arcs with start/end angles that show differences in-between browser handling"),!a&&o-r>=2*Math.PI||a&&r-o>=2*Math.PI,this.angleDifference=this.anticlockwise?this.startAngle-this.endAngle:this.endAngle-this.startAngle,0>this.angleDifference&&(this.angleDifference+=2*Math.PI),e&&e(this.angleDifference>=0),this.bounds=n.NOTHING,this.bounds=this.bounds.withPoint(this.start),this.bounds=this.bounds.withPoint(this.end);var u=this;r!==o&&(h(0),h(Math.PI/2),h(Math.PI),h(3*Math.PI/2))},s.Arc.prototype={constructor:s.Arc,angleAt:function(t){return this.anticlockwise?this.startAngle>this.endAngle?this.startAngle+(this.endAngle-this.startAngle)*t:this.startAngle<this.endAngle?this.startAngle+(2*-Math.PI+this.endAngle-this.startAngle)*t:this.startAngle:this.startAngle<this.endAngle?this.startAngle+(this.endAngle-this.startAngle)*t:this.startAngle>this.endAngle?this.startAngle+(2*Math.PI+this.endAngle-this.startAngle)*t:this.startAngle},positionAt:function(t){return this.positionAtAngle(this.angleAt(t))},tangentAt:function(t){return this.tangentAtAngle(this.angleAt(t))},curvatureAt:function(){return(this.anticlockwise?-1:1)/this.radius},positionAtAngle:function(t){return this.center.plus(i.createPolar(this.radius,t))},tangentAtAngle:function(t){var e=i.createPolar(1,t);return this.anticlockwise?e.perpendicular():e.perpendicular().negated()},containsAngle:function(t){var e=this.anticlockwise?t-this.endAngle:t-this.startAngle,i=e%(2*Math.PI);return 0>i&&(i+=2*Math.PI),this.angleDifference>=i},toPieces:function(){return[new r.Arc(this.center,this.radius,this.startAngle,this.endAngle,this.anticlockwise)]},getSVGPathFragment:function(){var t,e=.01,n=this.anticlockwise?"0":"1";if(this.angleDifference<2*Math.PI-e)return t=this.angleDifference<Math.PI?"0":"1","A "+this.radius+" "+this.radius+" 0 "+t+" "+n+" "+this.end.x+" "+this.end.y;var s=(this.startAngle+this.endAngle)/2,r=this.center.plus(i.createPolar(this.radius,s));t="0";var o="A "+this.radius+" "+this.radius+" 0 "+t+" "+n+" "+r.x+" "+r.y,a="A "+this.radius+" "+this.radius+" 0 "+t+" "+n+" "+this.end.x+" "+this.end.y;return o+" "+a},strokeLeft:function(t){return[new r.Arc(this.center,this.radius+(this.anticlockwise?1:-1)*t/2,this.startAngle,this.endAngle,this.anticlockwise)]},strokeRight:function(t){return[new r.Arc(this.center,this.radius+(this.anticlockwise?-1:1)*t/2,this.endAngle,this.startAngle,!this.anticlockwise)]},intersectsBounds:function(){throw Error("Segment.intersectsBounds unimplemented!")},intersection:function(t){var e=[],i=0,n=t.pos.minus(this.center),s=t.dir.dot(n),r=n.magnitudeSquared(),o=4*s*s-4*(r-this.radius*this.radius);if(i>o)return e;var a=t.dir.dot(this.center)-t.dir.dot(t.pos),h=Math.sqrt(o)/2,u=a-h,c=a+h;if(i>c)return e;var l=t.pointAtDistance(c),d=l.minus(this.center).normalized();if(i>u)this.containsAngle(d.angle())&&e.push({distance:c,point:l,normal:d.negated(),wind:this.anticlockwise?-1:1});else{var m=t.pointAtDistance(u),f=m.minus(this.center).normalized();this.containsAngle(f.angle())&&e.push({distance:u,point:m,normal:f,wind:this.anticlockwise?1:-1}),this.containsAngle(d.angle())&&e.push({distance:c,point:l,normal:d.negated(),wind:this.anticlockwise?-1:1})}return e},windingIntersection:function(t){var e=0,i=this.intersection(t);return _.each(i,function(t){e+=t.wind}),e}},s.Arc}),i("KITE/pieces/Arc",["require","ASSERT/assert","KITE/kite","DOT/Vector2","KITE/pieces/Piece","KITE/pieces/EllipticalArc","KITE/segments/Line","KITE/segments/Arc","KITE/util/Subpath"],function(t){t("ASSERT/assert")("kite");var e=t("KITE/kite"),i=t("DOT/Vector2"),n=t("KITE/pieces/Piece");return t("KITE/pieces/EllipticalArc"),t("KITE/segments/Line"),t("KITE/segments/Arc"),t("KITE/util/Subpath"),n.Arc=function(t,e,i,n,s){0>e&&(e=-e,i+=Math.PI,n+=Math.PI),this.center=t,this.radius=e,this.startAngle=i,this.endAngle=n,this.anticlockwise=s},n.Arc.prototype={constructor:n.Arc,writeToContext:function(t){t.arc(this.center.x,this.center.y,this.radius,this.startAngle,this.endAngle,this.anticlockwise)},transformed:function(t){var e=t.timesVector2(i.createPolar(1,this.startAngle)).minus(t.timesVector2(i.ZERO)).angle(),s=t.timesVector2(i.createPolar(1,this.endAngle)).minus(t.timesVector2(i.ZERO)).angle(),r=t.getDeterminant()>=0?this.anticlockwise:!this.anticlockwise,o=t.getScaleVector();if(o.x!==o.y){var a=o.x*this.radius,h=o.y*this.radius;return[new n.EllipticalArc(t.timesVector2(this.center),a,h,0,e,s,r)]}var u=o.x*this.radius;return[new n.Arc(t.timesVector2(this.center),u,e,s,r)]},applyPiece:function(t){var i=new e.Segment.Arc(this.center,this.radius,this.startAngle,this.endAngle,this.anticlockwise),n=i.start,s=i.end;t.hasSubpaths()&&t.getLastSubpath().getLength()>0&&!n.equals(t.getLastSubpath().getLastPoint(),0)&&t.getLastSubpath().addSegment(new e.Segment.Line(t.getLastSubpath().getLastPoint(),n)),t.hasSubpaths()||t.addSubpath(new e.Subpath),t.getLastSubpath().addSegment(i),t.getLastSubpath().addPoint(n),t.getLastSubpath().addPoint(s),i.invalid||(t.bounds=t.bounds.union(i.bounds))}},n.Arc}),i("KITE/pieces/Close",["require","ASSERT/assert","KITE/kite","KITE/pieces/Piece","KITE/util/Subpath"],function(t){t("ASSERT/assert")("kite");var e=t("KITE/kite"),i=t("KITE/pieces/Piece");return t("KITE/util/Subpath"),i.Close=function(){},i.Close.prototype={constructor:i.Close,writeToContext:function(t){t.closePath()},transformed:function(){return[this]},applyPiece:function(t){if(t.hasSubpaths()){var i=t.getLastSubpath(),n=new e.Subpath;i.close(),t.addSubpath(n),n.addPoint(i.getFirstPoint())}}},i.Close}),i("KITE/segments/Quadratic",["require","ASSERT/assert","KITE/kite","DOT/Bounds2","DOT/Matrix3","DOT/Util","KITE/segments/Segment","KITE/pieces/Piece"],function(t){var e=t("ASSERT/assert")("kite");t("KITE/kite");var i=t("DOT/Bounds2"),n=t("DOT/Matrix3"),s=t("DOT/Util").solveQuadraticRootsReal,r=t("KITE/segments/Segment"),o=t("KITE/pieces/Piece");return r.Quadratic=function(t,n,s,r){if(this.start=t,this.control=n,this.end=s,t.equals(s,0)&&t.equals(n,0))return this.invalid=!0,void 0;var o;if(!r){var a=t.equals(n),h=s.equals(n);e&&e(!a||!h),this.startTangent=a?s.minus(t).normalized():n.minus(t).normalized(),this.endTangent=h?s.minus(t).normalized():s.minus(n).normalized(),this.bounds=new i(Math.min(t.x,s.x),Math.min(t.y,s.y),Math.max(t.x,s.x),Math.max(t.y,s.y));var u=2*(s.x-2*n.x+t.x);0!==u&&(o=-2*(n.x-t.x)/u,o>0&&1>o&&(this.bounds=this.bounds.withPoint(this.positionAt(o))));var c=2*(s.y-2*n.y+t.y);0!==c&&(o=-2*(n.y-t.y)/c,o>0&&1>o&&(this.bounds=this.bounds.withPoint(this.positionAt(o))))}},r.Quadratic.prototype={constructor:r.Quadratic,degree:2,positionAt:function(t){var e=1-t;return this.start.times(e*e).plus(this.control.times(2*e*t)).plus(this.end.times(t*t))},tangentAt:function(t){return this.control.minus(this.start).times(2*(1-t)).plus(this.end.minus(this.control).times(2*t))},curvatureAt:function(t){var e=1e-7;if(Math.abs(t-.5)>.5-e){var i=.5>t,n=i?this.start:this.end,s=this.control,r=i?this.end:this.start,o=s.minus(n),a=o.magnitude(),h=(i?-1:1)*o.perpendicular().normalized().dot(r.minus(s));return h*(this.degree-1)/(this.degree*a*a)}return this.subdivided(t,!0)[0].curvatureAt(1)},offsetTo:function(t,e){for(var i=[this],n=5,s=0;n>s;s++)i=_.flatten(_.map(i,function(t){return t.subdivided(.5,!0)}));var r=_.map(i,function(e){return e.approximateOffset(t)});e&&(r.reverse(),r=_.map(r,function(t){return t.reversed(!0)}));var a=_.map(r,function(t){return new o.QuadraticCurveTo(t.control,t.end)});return a},subdivided:function(t,e){var i=this.start.blend(this.control,t),n=this.control.blend(this.end,t),s=i.blend(n,t);return[new r.Quadratic(this.start,i,s,e),new r.Quadratic(s,n,this.end,e)]},reversed:function(){return new r.Quadratic(this.end,this.control,this.start)},approximateOffset:function(t){return new r.Quadratic(this.start.plus((this.start.equals(this.control)?this.end.minus(this.start):this.control.minus(this.start)).perpendicular().normalized().times(t)),this.control.plus(this.end.minus(this.start).perpendicular().normalized().times(t)),this.end.plus((this.end.equals(this.control)?this.end.minus(this.start):this.end.minus(this.control)).perpendicular().normalized().times(t)))},toPieces:function(){return[new o.QuadraticCurveTo(this.control,this.end)]},getSVGPathFragment:function(){return"Q "+this.control.x+" "+this.control.y+" "+this.end.x+" "+this.end.y},strokeLeft:function(t){return this.offsetTo(-t/2,!1)},strokeRight:function(t){return this.offsetTo(t/2,!0)},intersectsBounds:function(){throw Error("Segment.Quadratic.intersectsBounds unimplemented")},intersection:function(t){var e=this,i=[],r=n.rotation2(-t.dir.angle()).timesMatrix(n.translation(-t.pos.x,-t.pos.y)),o=r.timesVector2(this.start),a=r.timesVector2(this.control),h=r.timesVector2(this.end),u=o.y-2*a.y+h.y,c=-2*o.y+2*a.y,l=o.y,d=s(u,c,l);return _.each(d,function(n){if(n>=0&&1>=n){var s=e.positionAt(n),r=e.tangentAt(n).normalized(),o=r.perpendicular(),a=s.minus(t.pos);a.dot(t.dir)>0&&i.push({distance:a.magnitude(),point:s,normal:o.dot(t.dir)>0?o.negated():o,wind:0>t.dir.perpendicular().dot(r)?1:-1})}}),i},windingIntersection:function(t){var e=0,i=this.intersection(t);return _.each(i,function(t){e+=t.wind}),e}},r.Quadratic}),i("KITE/segments/Cubic",["require","ASSERT/assert","KITE/kite","DOT/Bounds2","DOT/Vector2","DOT/Matrix3","DOT/Util","DOT/Util","KITE/segments/Segment","KITE/pieces/Piece","KITE/segments/Quadratic"],function(t){t("ASSERT/assert")("kite"),t("KITE/kite");var e=t("DOT/Bounds2"),i=t("DOT/Vector2"),n=t("DOT/Matrix3"),s=t("DOT/Util").solveQuadraticRootsReal,r=t("DOT/Util").solveCubicRootsReal,o=t("KITE/segments/Segment"),a=t("KITE/pieces/Piece");return t("KITE/segments/Quadratic"),o.Cubic=function(t,i,n,r,a){function h(t,e,i,n){var r=-3*t+9*e-9*i+3*n,o=6*t-12*e+6*i,a=-3*t+3*e;return s(r,o,a)}if(this.start=t,this.control1=i,this.control2=n,this.end=r,!a){if(this.startTangent=this.tangentAt(0).normalized(),this.endTangent=this.tangentAt(1).normalized(),t.equals(r,0)&&t.equals(i,0)&&t.equals(n,0))return this.invalid=!0,void 0;this.r=i.minus(t).normalized(),this.s=this.r.perpendicular();var u=t.times(-1).plus(i.times(3)).plus(n.times(-3)).plus(r),c=t.times(3).plus(i.times(-6)).plus(n.times(3)),l=t.times(-3).plus(i.times(3)),d=u.perpendicular(),m=c.perpendicular(),f=d.dot(c);if(this.tCusp=-.5*(d.dot(l)/f),this.tDeterminant=this.tCusp*this.tCusp-1/3*(m.dot(l)/f),this.tDeterminant>=0){var p=Math.sqrt(this.tDeterminant);this.tInflection1=this.tCusp-p,this.tInflection2=this.tCusp+p}if(this.hasCusp()){var g=this.subdivided(this.tCusp,!0);this.startQuadratic=new o.Quadratic(g[0].start,g[0].control1,g[0].end,!1),this.endQuadratic=new o.Quadratic(g[1].start,g[1].control2,g[1].end,!1)}this.bounds=e.NOTHING,this.bounds=this.bounds.withPoint(this.start),this.bounds=this.bounds.withPoint(this.end);var y=this;_.each(h(this.start.x,this.control1.x,this.control2.x,this.end.x),function(t){t>=0&&1>=t&&(y.bounds=y.bounds.withPoint(y.positionAt(t)))}),_.each(h(this.start.y,this.control1.y,this.control2.y,this.end.y),function(t){t>=0&&1>=t&&(y.bounds=y.bounds.withPoint(y.positionAt(t)))}),this.hasCusp()&&(this.bounds=this.bounds.withPoint(this.positionAt(this.tCusp)))}},o.Cubic.prototype={constructor:o.Cubic,degree:3,hasCusp:function(){var t=1e-6;return t>this.tangentAt(this.tCusp).magnitude()&&this.tCusp>=0&&1>=this.tCusp},positionAt:function(t){var e=1-t;return this.start.times(e*e*e).plus(this.control1.times(3*e*e*t)).plus(this.control2.times(3*e*t*t)).plus(this.end.times(t*t*t))},tangentAt:function(t){var e=1-t;return this.start.times(-3*e*e).plus(this.control1.times(3*e*e-6*e*t)).plus(this.control2.times(6*e*t-3*t*t)).plus(this.end.times(3*t*t))},curvatureAt:function(t){var e=1e-7;if(Math.abs(t-.5)>.5-e){var i=.5>t,n=i?this.start:this.end,s=i?this.control1:this.control2,r=i?this.control2:this.control1,o=s.minus(n),a=o.magnitude(),h=(i?-1:1)*o.perpendicular().normalized().dot(r.minus(s));return h*(this.degree-1)/(this.degree*a*a)}return this.subdivided(t,!0)[0].curvatureAt(1)},toRS:function(t){var e=t.minus(this.start);return new i(e.dot(this.r),e.dot(this.s))},subdivided:function(t,e){var i=this.start.blend(this.control1,t),n=this.control2.blend(this.end,t),s=this.control1.blend(this.control2,t),r=i.blend(s,t),a=s.blend(n,t),h=r.blend(a,t);return[new o.Cubic(this.start,i,r,h,e),new o.Cubic(h,a,n,this.end,e)]},offsetTo:function(t,e){for(var i=32,n=[],s=1;i>s;s++){var r=s/(i-1);e&&(r=1-r);var o=this.positionAt(r).plus(this.tangentAt(r).perpendicular().normalized().times(t));n.push(new a.LineTo(o))}return n},toPieces:function(){return[new a.CubicCurveTo(this.control1,this.control2,this.end)]},getSVGPathFragment:function(){return"C "+this.control1.x+" "+this.control1.y+" "+this.control2.x+" "+this.control2.y+" "+this.end.x+" "+this.end.y},strokeLeft:function(t){return this.offsetTo(-t/2,!1)},strokeRight:function(t){return this.offsetTo(t/2,!0)},intersectsBounds:function(){throw Error("Segment.Cubic.intersectsBounds unimplemented")},intersection:function(t){var e=this,i=[],s=n.rotation2(-t.dir.angle()).timesMatrix(n.translation(-t.pos.x,-t.pos.y)),o=s.timesVector2(this.start),a=s.timesVector2(this.control1),h=s.timesVector2(this.control2),u=s.timesVector2(this.end),c=-o.y+3*a.y-3*h.y+u.y,l=3*o.y-6*a.y+3*h.y,d=-3*o.y+3*a.y,m=o.y,f=r(c,l,d,m);return _.each(f,function(n){if(n>=0&&1>=n){var s=e.positionAt(n),r=e.tangentAt(n).normalized(),o=r.perpendicular(),a=s.minus(t.pos);a.dot(t.dir)>0&&i.push({distance:a.magnitude(),point:s,normal:o.dot(t.dir)>0?o.negated():o,wind:0>t.dir.perpendicular().dot(r)?1:-1})}}),i},windingIntersection:function(t){var e=0,i=this.intersection(t);return _.each(i,function(t){e+=t.wind}),e}},o.Cubic}),i("KITE/pieces/CubicCurveTo",["require","ASSERT/assert","KITE/kite","KITE/pieces/Piece","KITE/segments/Cubic"],function(t){t("ASSERT/assert")("kite");var e=t("KITE/kite"),i=t("KITE/pieces/Piece");return t("KITE/segments/Cubic"),i.CubicCurveTo=function(t,e,i){this.control1=t,this.control2=e,this.point=i},i.CubicCurveTo.prototype={constructor:i.CubicCurveTo,writeToContext:function(t){t.bezierCurveTo(this.control1.x,this.control1.y,this.control2.x,this.control2.y,this.point.x,this.point.y)},transformed:function(t){return[new i.CubicCurveTo(t.timesVector2(this.control1),t.timesVector2(this.control2),t.timesVector2(this.point))]},applyPiece:function(t){t.ensure(this.controlPoint);var i=t.getLastSubpath().getLastPoint(),n=new e.Segment.Cubic(i,this.control1,this.control2,this.point);n.hasCusp()?(t.getLastSubpath().addSegment(n.startQuadratic),t.getLastSubpath().addSegment(n.endQuadratic)):t.getLastSubpath().addSegment(n),t.getLastSubpath().addPoint(this.point),n.invalid||(t.bounds=t.bounds.union(n.bounds))}},i.CubicCurveTo}),i("KITE/pieces/LineTo",["require","ASSERT/assert","KITE/kite","KITE/pieces/Piece","KITE/segments/Line"],function(t){var e=t("ASSERT/assert")("kite"),i=t("KITE/kite"),n=t("KITE/pieces/Piece");return t("KITE/segments/Line"),n.LineTo=function(t){this.point=t},n.LineTo.prototype={constructor:n.LineTo,writeToContext:function(t){t.lineTo(this.point.x,this.point.y)},transformed:function(t){return[new n.LineTo(t.timesVector2(this.point))]},applyPiece:function(t){if(t.hasSubpaths()){var n=t.getLastSubpath().getLastPoint(),s=this.point,r=new i.Segment.Line(n,s);t.getLastSubpath().addSegment(r),t.getLastSubpath().addPoint(s),t.bounds=t.bounds.withPoint(n).withPoint(s),e&&e(!isNaN(t.bounds.getX()))}else t.ensure(this.point)}},n.LineTo}),i("KITE/pieces/MoveTo",["require","ASSERT/assert","KITE/kite","KITE/pieces/Piece","KITE/util/Subpath"],function(t){t("ASSERT/assert")("kite");var e=t("KITE/kite"),i=t("KITE/pieces/Piece");return t("KITE/util/Subpath"),i.MoveTo=function(t){this.point=t},i.MoveTo.prototype={constructor:i.MoveTo,writeToContext:function(t){t.moveTo(this.point.x,this.point.y)},transformed:function(t){return[new i.MoveTo(t.timesVector2(this.point))]},applyPiece:function(t){var i=new e.Subpath;i.addPoint(this.point),t.addSubpath(i)}},i.MoveTo}),i("KITE/pieces/QuadraticCurveTo",["require","ASSERT/assert","KITE/kite","KITE/pieces/Piece","KITE/segments/Quadratic"],function(t){t("ASSERT/assert")("kite");var e=t("KITE/kite"),i=t("KITE/pieces/Piece");return t("KITE/segments/Quadratic"),i.QuadraticCurveTo=function(t,e){this.controlPoint=t,this.point=e},i.QuadraticCurveTo.prototype={constructor:i.QuadraticCurveTo,writeToContext:function(t){t.quadraticCurveTo(this.controlPoint.x,this.controlPoint.y,this.point.x,this.point.y)},transformed:function(t){return[new i.QuadraticCurveTo(t.timesVector2(this.controlPoint),t.timesVector2(this.point))]},applyPiece:function(t){t.ensure(this.controlPoint);var i=t.getLastSubpath().getLastPoint(),n=new e.Segment.Quadratic(i,this.controlPoint,this.point);t.getLastSubpath().addSegment(n),t.getLastSubpath().addPoint(this.point),n.invalid||(t.bounds=t.bounds.union(n.bounds))}},i.QuadraticCurveTo}),i("KITE/pieces/Rect",["require","ASSERT/assert","KITE/kite","DOT/Vector2","KITE/pieces/Piece","KITE/pieces/MoveTo","KITE/pieces/Close","KITE/util/Subpath","KITE/segments/Line"],function(t){function e(t,e){return new s(t,e)}var i=t("ASSERT/assert")("kite"),n=t("KITE/kite"),s=t("DOT/Vector2"),r=t("KITE/pieces/Piece");return t("KITE/pieces/MoveTo"),t("KITE/pieces/Close"),t("KITE/util/Subpath"),t("KITE/segments/Line"),r.Rect=function(t,e,n,s){i&&i(void 0!==t&&void 0!==e&&void 0!==n&&void 0!==s,"Undefined argument for Piece.Rect"),this.x=t,this.y=e,this.width=n,this.height=s},r.Rect.prototype={constructor:r.Rect,writeToContext:function(t){t.rect(this.x,this.y,this.width,this.height)},transformed:function(t){var i=t.timesVector2(e(this.x,this.y)),n=t.timesVector2(e(this.x+this.width,this.y)),s=t.timesVector2(e(this.x+this.width,this.y+this.height)),o=t.timesVector2(e(this.x,this.y+this.height));return[new r.MoveTo(i),new r.LineTo(n),new r.LineTo(s),new r.LineTo(o),new r.Close,new r.MoveTo(i)]},applyPiece:function(t){var s=new n.Subpath;t.addSubpath(s),s.addPoint(e(this.x,this.y)),s.addPoint(e(this.x+this.width,this.y)),s.addPoint(e(this.x+this.width,this.y+this.height)),s.addPoint(e(this.x,this.y+this.height)),s.addSegment(new n.Segment.Line(s.points[0],s.points[1])),s.addSegment(new n.Segment.Line(s.points[1],s.points[2])),s.addSegment(new n.Segment.Line(s.points[2],s.points[3])),s.close(),t.addSubpath(new n.Subpath),t.getLastSubpath().addPoint(e(this.x,this.y)),t.bounds=t.bounds.withCoordinates(this.x,this.y).withCoordinates(this.x+this.width,this.y+this.height),i&&i(!isNaN(t.bounds.getX()))}},r.Rect}),i("KITE/Shape",["require","ASSERT/assert","ASSERT/assert","KITE/kite","DOT/Vector2","DOT/Bounds2","DOT/Ray2","DOT/Matrix3","DOT/Transform3","DOT/Util","DOT/Util","KITE/util/Subpath","KITE/pieces/Piece","KITE/util/LineStyles","KITE/pieces/Arc","KITE/pieces/Close","KITE/pieces/CubicCurveTo","KITE/pieces/EllipticalArc","KITE/pieces/LineTo","KITE/pieces/MoveTo","KITE/pieces/QuadraticCurveTo","KITE/pieces/Rect","KITE/segments/Line"],function(t){function e(t,e){return new o(t,e)}function i(t,e){return s&&s(void 0!==e),t.start.plus(t.startTangent.perpendicular().negated().times(e/2))}function n(t,e){return s&&s(void 0!==e),t.start.plus(t.startTangent.perpendicular().times(e/2))}var s=t("ASSERT/assert")("kite");t("ASSERT/assert")("kite.extra",!0);var r=t("KITE/kite"),o=t("DOT/Vector2"),a=t("DOT/Bounds2"),h=t("DOT/Ray2");t("DOT/Matrix3"),t("DOT/Transform3"),t("DOT/Util").toDegrees;var u=t("DOT/Util").lineLineIntersection,c=t("KITE/util/Subpath"),l=t("KITE/pieces/Piece");t("KITE/util/LineStyles"),t("KITE/pieces/Arc"),t("KITE/pieces/Close"),t("KITE/pieces/CubicCurveTo"),t("KITE/pieces/EllipticalArc"),t("KITE/pieces/LineTo"),t("KITE/pieces/MoveTo"),t("KITE/pieces/QuadraticCurveTo"),t("KITE/pieces/Rect"),t("KITE/segments/Line"),r.Shape=function(t,e){this.pieces=[],this.subpaths=[],this.bounds=a.NOTHING,this._strokedShape=null,this._strokedShapeComputed=!1,this._strokedShapeStyles=null;var i=this;void 0!==t&&_.each(t,function(t){i.addPiece(t)}),e&&this.addPiece(new l.Close)};var d=r.Shape;return d.prototype={constructor:d,moveTo:function(t,i){if(void 0===i&&"object"==typeof t){var n=t instanceof o?t:new o(t.x,t.y);this.addPiece(new l.MoveTo(n))}else this.addPiece(new l.MoveTo(e(t,i)));return this},lineTo:function(t,i){if(void 0===i&&"object"==typeof t){var n=t instanceof o?t:new o(t.x,t.y);this.addPiece(new l.LineTo(n))}else this.addPiece(new l.LineTo(e(t,i)));return this},quadraticCurveTo:function(t,i,n,s){if(void 0===n&&"object"==typeof t){var r=t instanceof o?t:new o(t.x,t.y),a=i instanceof o?i:new o(i.x,i.y);this.addPiece(new l.QuadraticCurveTo(r,a))}else this.addPiece(new l.QuadraticCurveTo(e(t,i),e(n,s)));return this},cubicCurveTo:function(t,i,n,s,r,a){if(void 0===s&&"object"==typeof t){var h=t instanceof o?t:new o(t.x,t.y),u=i instanceof o?i:new o(i.x,i.y),c=n instanceof o?n:new o(n.x,n.y);this.addPiece(new l.CubicCurveTo(h,u,c))}else this.addPiece(new l.CubicCurveTo(e(t,i),e(n,s),e(r,a)));return this},circle:function(t,i,n){if("object"==typeof t){var s=t;return n=i,this.arc(s,n,0,2*Math.PI,!1)}return this.arc(e(t,i),n,0,2*Math.PI,!1)},ellipse:function(t,i,n,s,r){if("object"==typeof t){var o=t;return r=s,s=n,n=i,this.ellipticalArc(o,n,s,r||0,0,2*Math.PI,!1)}return this.ellipticalArc(e(t,i),n,s,r||0,0,2*Math.PI,!1)},arc:function(t,i,n,s,r,o){if("object"==typeof t){o=r,r=s,s=n,n=i;var a=t;this.addPiece(new l.Arc(a,n,s,r,o))}else this.addPiece(new l.Arc(e(t,i),n,s,r,o));return this},ellipticalArc:function(t,i,n,s,r,o,a,h){if("object"==typeof t){h=a,a=o,o=r,r=s,s=n,n=i;var u=t;this.addPiece(new l.EllipticalArc(u,n,s,r,o,a,h))}else this.addPiece(new l.EllipticalArc(e(t,i),n,s,r,o,a,h));return this},rect:function(t,e,i,n){return this.addPiece(new l.Rect(t,e,i,n)),this},roundRect:function(t,e,i,n,s,r){return this.moveTo(t+s,e).lineTo(t+i-s,e).quadraticCurveTo(t+i,e,t+i,e+r).lineTo(t+i,e+n-r).quadraticCurveTo(t+i,e+n,t+i-s,e+n).lineTo(t+s,e+n).quadraticCurveTo(t,e+n,t,e+n-r).lineTo(t,e+r).quadraticCurveTo(t,e,t+s,e),this},close:function(){return this.addPiece(new l.Close),this},copy:function(){return new d(this.pieces)},addPiece:function(t){return this.pieces.push(t),t.applyPiece(this),this.invalidate(),s&&s(this.bounds.isEmpty()||this.bounds.isFinite(),"shape bounds infinite after adding piece: "+t),this},writeToContext:function(t){_.each(this.pieces,function(e){e.writeToContext(t)})},getSVGPath:function(){var t=[];return _.each(this.subpaths,function(e){if(e.isDrawable()){var i=e.getFirstSegment().start;s&&s(i.equals(e.getFirstPoint(),1e-5));var n="M "+i.x+" "+i.y+" ";n+=_.map(e.segments,function(t){return t.getSVGPathFragment()}).join(" "),e.isClosed()&&(n+=" Z"),t.push(n)}}),t.join(" ")},transformed:function(t){return new d(_.flatten(_.map(this.pieces,function(e){return e.transformed(t)}),!0))},computeBounds:function(t){return t?this.bounds.union(this.getStrokedShape(t).bounds):this.bounds
},containsPoint:function(t){var i=new h(t,e(1,0));return 0!==this.windingIntersection(i)},intersection:function(t){var e=[];return _.each(this.subpaths,function(i){i.isDrawable()&&(_.each(i.segments,function(i){_.each(i.intersection(t),function(t){e.push(t)})}),i.hasClosingSegment()&&_.each(i.getClosingSegment().intersection(t),function(t){e.push(t)}))}),_.sortBy(e,function(t){return t.distance})},windingIntersection:function(t){var e=0;return _.each(this.subpaths,function(i){i.isDrawable()&&(_.each(i.segments,function(i){e+=i.windingIntersection(t)}),i.hasClosingSegment()&&(e+=i.getClosingSegment().windingIntersection(t)))}),e},intersectsBounds:function(t){var e=!1;return _.each(this.subpaths,function(i){i.isDrawable()&&(_.each(i.segments,function(i){e=e&&i.intersectsBounds(t)}),i.hasClosingSegment()&&(e=e&&i.getClosingSegment().intersectsBounds(t)))}),e},invalidate:function(){this._strokedShapeComputed=!1},getStrokedShape:function(t){function e(e,i,n){var s=e.plus(i.perpendicular().negated().times(h/2)),r=e.plus(n.perpendicular().negated().times(h/2));if(i.perpendicular().dot(n)>0)switch(t.lineJoin){case"round":var o=i.angle()+Math.PI/2,c=n.angle()+Math.PI/2;a.addPiece(new l.Arc(e,h/2,o,c,!0));break;case"miter":var d=i.angleBetween(n.negated());if(Math.PI-1e-5>d,1/Math.sin(d/2)<=t.miterLimit&&Math.PI-1e-5>d){var m=u(s,s.plus(i),r,r.plus(n));a.addPiece(new l.LineTo(m)),a.addPiece(new l.LineTo(r))}else a.addPiece(new l.LineTo(r));break;case"bevel":a.addPiece(new l.LineTo(r))}else s.equals(r)||a.addPiece(new l.LineTo(r))}function s(e,i){switch(t.lineCap){case"butt":a.addPiece(new l.LineTo(e.plus(i.perpendicular().times(h/2))));break;case"round":var n=i.angle();a.addPiece(new l.Arc(e,h/2,n+Math.PI/2,n-Math.PI/2,!0));break;case"square":var s=i.perpendicular().negated().times(h/2),r=i.perpendicular().times(h/2),o=i.times(h/2);a.addPiece(new l.LineTo(e.plus(s).plus(o))),a.addPiece(new l.LineTo(e.plus(r).plus(o))),a.addPiece(new l.LineTo(e.plus(r)))}}if(void 0===t&&(t=new r.LineStyles),this._strokedShapeComputed&&this._strokedShapeStyles.equals(t))return this._strokedShape;var o=_.filter(this.subpaths,function(t){return t.isDrawable()}),a=new d,h=t.lineWidth;return _.each(o,function(t){var o,u=t.segments,c=_.last(u).end.equals(_.first(u).start),d=c?null:new r.Segment.Line(u[u.length-1].end,u[0].start);for(a.addPiece(new l.MoveTo(i(_.first(u),h))),o=0;u.length>o;o++)o>0&&e(u[o].start,u[o-1].endTangent,u[o].startTangent,!0),_.each(u[o].strokeLeft(h),function(t){a.addPiece(t)});for(t.closed?c?(e(_.last(u).end,_.last(u).endTangent,_.first(u).startTangent),a.addPiece(new l.Close),a.addPiece(new l.MoveTo(n(_.first(u),h))),e(_.last(u).end,_.first(u).startTangent.negated(),_.last(u).endTangent.negated())):(e(d.start,_.last(u).endTangent,d.startTangent),_.each(d.strokeLeft(h),function(t){a.addPiece(t)}),e(d.end,d.endTangent,_.first(u).startTangent),a.addPiece(new l.Close),a.addPiece(new l.MoveTo(n(_.first(u),h))),e(d.end,_.first(u).startTangent.negated(),d.endTangent.negated()),_.each(d.strokeRight(h),function(t){a.addPiece(t)}),e(d.start,d.startTangent.negated(),_.last(u).endTangent.negated())):s(_.last(u).end,_.last(u).endTangent),o=u.length-1;o>=0;o--)u.length-1>o&&e(u[o].end,u[o+1].startTangent.negated(),u[o].endTangent.negated(),!1),_.each(u[o].strokeRight(h),function(t){a.addPiece(t)});t.closed?a.addPiece(new l.Close):(s(_.first(u).start,_.first(u).startTangent.negated()),a.addPiece(new l.Close))}),this._strokedShape=a,this._strokedShapeComputed=!0,this._strokedShapeStyles=new r.LineStyles(t),a},ensure:function(t){this.hasSubpaths()||(this.addSubpath(new c),this.getLastSubpath().addPoint(t))},addSubpath:function(t){this.subpaths.push(t)},hasSubpaths:function(){return this.subpaths.length>0},getLastSubpath:function(){return _.last(this.subpaths)}},d.rectangle=function(t,e,i,n){return(new d).rect(t,e,i,n)},d.rect=d.rectangle,d.roundRect=function(t,e,i,n,s,r){return(new d).roundRect(t,e,i,n,s,r)},d.roundRectangle=d.roundRect,d.bounds=function(t){return(new d).rect(t.minX,t.minY,t.maxX-t.minX,t.maxY-t.minY)},d.lineSegment=function(t,e,i,n){return"number"==typeof t?(new d).moveTo(t,e).lineTo(i,n):(new d).moveTo(t).lineTo(e)},d.regularPolygon=function(t,i){var n=!0;return new d(_.map(_.range(t),function(s){var r=2*Math.PI*s/t;return n?(n=!1,new l.MoveTo(e(i*Math.cos(r),i*Math.sin(r)))):new l.LineTo(e(i*Math.cos(r),i*Math.sin(r)))}),!0)},d.circle=function(t,e,i){return void 0===e?(new d).circle(0,0,t):(new d).circle(t,e,i).close()},d.ellipse=function(t,e,i,n){return void 0===i?(new d).ellipse(0,0,t,e):(new d).ellipse(t,e,i,n).close()},d.arc=function(t,e,i,n,s,r){return(new d).arc(t,e,i,n,s,r)},d}),i("SCENERY/layers/Layer",["require","ASSERT/assert","ASSERT/assert","DOT/Bounds2","DOT/Transform3","SCENERY/scenery","SCENERY/util/Trail"],function(t){var e=t("ASSERT/assert")("scenery");t("ASSERT/assert")("scenery.extra",!0);var i=t("DOT/Bounds2"),n=t("DOT/Transform3"),s=t("SCENERY/scenery");t("SCENERY/util/Trail");var r=1;s.Layer=function(t){this._id=r++,this.$main=t.$main,this.scene=t.scene,this.baseNode=t.baseNode,this.batchDOMChanges=t.batchDOMChanges||!1,this.pendingDOMChanges=[],this.applyingDOMChanges=!1,this.usesPartialCSSTransforms=t.cssTranslation||t.cssRotation||t.cssScale,this.cssTranslation=t.cssTranslation,this.cssRotation=t.cssRotation,this.cssScale=t.cssScale,this.cssTransform=t.cssTransform,e&&e(!(this.usesPartialCSSTransforms&&this.cssTransform),"Do not specify both partial and complete CSS transform arguments."),this.dirtyBounds=i.EVERYTHING,this.setStartBoundary(t.startBoundary),this.setEndBoundary(t.endBoundary),this.baseNode===this.scene?this.baseTrail=new s.Trail(this.scene):(this.baseTrail=this.startPointer.trail.copy(),e&&e(this.baseTrail.lastNode()===this.baseNode)),this._layerTrails=[];var o=this;this.baseNodeListener={selfBounds:function(){o.baseNodeInternalBoundsChange()},childBounds:function(){o.baseNodeInternalBoundsChange()}},this.baseNode.addEventListener(this.baseNodeListener),this.fitToBounds=this.usesPartialCSSTransforms||this.cssTransform,e&&e(this.fitToBounds||this.baseNode===this.scene,"If the baseNode is not the scene, we need to fit the bounds"),this.baseNodeTransform=new n};var o=s.Layer;return o.prototype={constructor:o,setStartBoundary:function(t){this.startBoundary=t,this.startPointer=this.startBoundary.nextStartPointer,this.startSelfTrail=this.startBoundary.nextSelfTrail},setEndBoundary:function(t){this.endBoundary=t,this.endPointer=this.endBoundary.previousEndPointer,this.endSelfTrail=this.endBoundary.previousSelfTrail},getStartPointer:function(){return this.startPointer},getEndPointer:function(){return this.endPointer},flushDOMChanges:function(){this.applyingDOMChanges=!0,_.each(this.pendingDOMChanges,function(t){t()}),this.pendingDOMChanges.splice(0,this.pendingDOMChanges.length),this.applyingDOMChanges=!1},domChange:function(t){this.batchDOMChanges&&!this.applyingDOMChanges?this.pendingDOMChanges.push(t):t()},toString:function(){return this.getName()+" "+(this.startPointer?""+this.startPointer:"!")+" ("+(this.startSelfTrail?""+this.startSelfTrail:"!")+") => "+(this.endPointer?""+this.endPointer:"!")+" ("+(this.endSelfTrail?""+this.endSelfTrail:"!")+")"},getId:function(){return this._id},getLayerTrails:function(){return this._layerTrails.slice(0)},render:function(){throw Error("Layer.render unimplemented")},applyTransformationMatrix:function(){throw Error("Layer.applyTransformationMatrix unimplemented")},addNodeFromTrail:function(t){this._layerTrails.push(t)},removeNodeFromTrail:function(t){var i;for(i=0;this._layerTrails.length>i&&(this._layerTrails[i].reindex(),0!==this._layerTrails[i].compare(t));i++);e&&e(this._layerTrails.length>i),this._layerTrails.splice(i,1)},reindex:function(){throw Error("unimplemented layer reindex")},pushClipShape:function(){throw Error("Layer.pushClipShape unimplemented")},popClipShape:function(){throw Error("Layer.popClipShape unimplemented")},renderToCanvas:function(){throw Error("Layer.renderToCanvas unimplemented")},dispose:function(){this.baseNode.removeEventListener(this.baseNodeListener)},markDirtyRegion:function(){throw Error("Layer.markDirtyRegion unimplemented")},transformChange:function(){throw Error("Layer.transformChange unimplemented")},getName:function(){throw Error("Layer.getName unimplemented")},baseNodeInternalBoundsChange:function(){}},o.cssTransformPadding=3,o}),i("SCENERY/util/RenderState",["require","ASSERT/assert","SCENERY/scenery"],function(t){t("ASSERT/assert")("scenery");var e=t("SCENERY/scenery");e.RenderState=function(t){this.layer=null,this.scene=t,this.clipShapes=[],this.childRestrictedBounds=null};var i=e.RenderState;return i.prototype={constructor:i,pushClipShape:function(t){this.clipShapes.push(t),this.layer&&this.layer.pushClipShape(t)},popClipShape:function(){this.clipShapes.pop(),this.layer&&this.layer.popClipShape()},isCanvasState:function(){return this.layer.isCanvasLayer},isDOMState:function(){return this.layer.isDOMLayer},applyTransformationMatrix:function(t){this.layer.applyTransformationMatrix(t)}},i}),i("SCENERY/util/TrailPointer",["require","ASSERT/assert","SCENERY/scenery","SCENERY/util/Trail"],function(t){var e=t("ASSERT/assert")("scenery"),i=t("SCENERY/scenery");t("SCENERY/util/Trail"),i.TrailPointer=function(t,n){e&&e(t instanceof i.Trail,"trail is not a trail"),this.trail=t,this.setBefore(n)};var n=i.TrailPointer;return n.prototype={constructor:n,copy:function(){return new n(this.trail.copy(),this.isBefore)},setBefore:function(t){this.isBefore=t,this.isAfter=!t},getRenderSwappedPointer:function(){var t=this.isBefore?this.trail.previous():this.trail.next();return null===t?null:new n(t,!this.isBefore)},getRenderBeforePointer:function(){return this.isBefore?this:this.getRenderSwappedPointer()},getRenderAfterPointer:function(){return this.isAfter?this:this.getRenderSwappedPointer()},compareRender:function(t){e&&e(null!==t);var i=this.getRenderBeforePointer(),n=t.getRenderBeforePointer();return null!==i&&null!==n?i.trail.compare(n.trail):i===n?0:null===i?1:-1},compareNested:function(t){e&&e(t);var i=this.trail.compare(t.trail);return 0===i?this.isBefore===t.isBefore?0:this.isBefore?-1:1:this.trail.isExtensionOf(t.trail)?t.isBefore?1:-1:t.trail.isExtensionOf(this.trail)?this.isBefore?-1:1:i},equalsRender:function(t){return 0===this.compareRender(t)},equalsNested:function(t){return 0===this.compareNested(t)},hasTrail:function(){return!!this.trail},nestedForwards:function(){if(this.isBefore)this.trail.lastNode()._children.length>0?this.trail.addDescendant(this.trail.lastNode()._children[0],0):this.setBefore(!1);else{if(0===this.trail.indices.length)return this.trail=null,null;var t=this.trail.indices[this.trail.indices.length-1];this.trail.removeDescendant(),this.trail.lastNode()._children.length>t+1&&(this.trail.addDescendant(this.trail.lastNode()._children[t+1],t+1),this.setBefore(!0))}return this},nestedBackwards:function(){if(this.isBefore){if(0===this.trail.indices.length)return this.trail=null,null;var t=this.trail.indices[this.trail.indices.length-1];this.trail.removeDescendant(),t-1>=0&&(this.trail.addDescendant(this.trail.lastNode()._children[t-1],t-1),this.setBefore(!1))}else if(this.trail.lastNode()._children.length>0){var e=this.trail.lastNode()._children;this.trail.addDescendant(e[e.length-1],e.length-1)}else this.setBefore(!0);return this},eachNodeBetween:function(t,e){this.eachTrailBetween(t,function(t){e(t.lastNode())})},eachTrailBetween:function(t,e){this.isBefore&&e(this.trail),this.depthFirstUntil(t,function(t){t.isBefore&&e(t.trail)},!0)},depthFirstUntil:function(t,i,n){e&&e((n?-1:0)>=this.compareNested(t),"TrailPointer.depthFirstUntil pointers out of order, possibly in both meanings of the phrase!"),e&&e(this.trail.rootNode()===t.trail.rootNode(),"TrailPointer.depthFirstUntil takes pointers with the same root"),this.trail.reindex(),t.trail.reindex();for(var s=this.copy(),r=!0;!s.equalsNested(t);){e&&e(1!==s.compareNested(t),"skipped in depthFirstUntil");var o=!1;if(r?(n||(o=i(s)),r=!1):o=i(s),o&&s.isBefore){if(s.setBefore(!1),1===s.compareNested(t))break}else s.nestedForwards()}n||i(s)},toString:function(){return"["+(this.isBefore?"before":"after")+" "+(""+this.trail).slice(1)}},n}),i("SCENERY/util/Util",["require","ASSERT/assert","ASSERT/assert","SCENERY/scenery","DOT/Matrix3","DOT/Transform3","DOT/Bounds2","DOT/Vector2"],function(t){function e(t,e){return new h(t,e)}var i=t("ASSERT/assert")("scenery"),n=t("ASSERT/assert")("scenery.extra",!0),s=t("SCENERY/scenery"),r=t("DOT/Matrix3"),o=t("DOT/Transform3"),a=t("DOT/Bounds2"),h=t("DOT/Vector2"),u=!1;s.Util={extend:function(t){return _.each(Array.prototype.slice.call(arguments,1),function(e){if(e)for(var i in e)Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))}),t},objectCreate:Object.create||function(t){function e(){}if(arguments.length>1)throw Error("Object.create implementation only accepts the first parameter.");return e.prototype=t,new e},testAssert:function(){return"assert.scenery: "+(i?"true":"false")},testAssertExtra:function(){return"assert.scenery.extra: "+(n?"true":"false")},polyfillRequestAnimationFrame:function(){for(var t=0,e=["ms","moz","webkit","o"],i=0;e.length>i&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]||window[e[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var i=(new Date).getTime(),n=Math.max(0,16-(i-t)),s=window.setTimeout(function(){e(i+n)},n);return t=i+n,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})},backingStorePixelRatio:function(t){return t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1},backingScale:function(t){if("devicePixelRatio"in window){var e=c.backingStorePixelRatio(t);return window.devicePixelRatio/e}return 1},scanBounds:function(t,i,n){for(var s=_.map(_.range(i),function(){return!1}),r=_.map(_.range(i),function(){return!1}),o=0;i>o;o++)for(var h=0;i>h;h++){var u=4*(h*i+o);(0!==t.data[u]||0!==t.data[u+1]||0!==t.data[u+2]||0!==t.data[u+3])&&(s[o]=!0,r[h]=!0)}var c=_.indexOf(s,!0),l=_.lastIndexOf(s,!0),d=_.indexOf(r,!0),m=_.lastIndexOf(r,!0),f=i/16;return{minBounds:new a(1>c||c>=i-1?Number.POSITIVE_INFINITY:n.inversePosition2(e(c+1+f,0)).x,1>d||d>=i-1?Number.POSITIVE_INFINITY:n.inversePosition2(e(0,d+1+f)).y,1>l||l>=i-1?Number.NEGATIVE_INFINITY:n.inversePosition2(e(l-f,0)).x,1>m||m>=i-1?Number.NEGATIVE_INFINITY:n.inversePosition2(e(0,m-f)).y),maxBounds:new a(1>c||c>=i-1?Number.NEGATIVE_INFINITY:n.inversePosition2(e(c-1-f,0)).x,1>d||d>=i-1?Number.NEGATIVE_INFINITY:n.inversePosition2(e(0,d-1-f)).y,1>l||l>=i-1?Number.POSITIVE_INFINITY:n.inversePosition2(e(l+2+f,0)).x,1>m||m>=i-1?Number.POSITIVE_INFINITY:n.inversePosition2(e(0,m+2+f)).y)}},canvasAccurateBounds:function(t,i){function n(e){function i(t){var e=document.createElement("canvas");e.width=l,e.height=l;var i=e.getContext("2d");i.putImageData(t,0,0),$(e).css("border","1px solid black"),$(window).ready(function(){$("#display").append(e)})}g.save(),e.matrix.canvasSetTransform(g),t(g),g.restore();var n=g.getImageData(0,0,l,l),s=c.scanBounds(n,l,e);return u&&i(n),g.clearRect(0,0,l,l),s}function s(t){var e=2,i=(l-2*e)/(t.maxX-t.minX),n=(l-2*e)/(t.maxY-t.minY),s=-i*t.minX+e,a=-n*t.minY+e;return new o(r.translation(s,a).timesMatrix(r.scaling(i,n)))}var h=i&&i.precision?i.precision:.001,l=i&&i.resolution?i.resolution:128,d=i&&i.initialScale?i.initialScale:1/16,m=a.NOTHING,f=a.EVERYTHING,p=document.createElement("canvas");p.width=l,p.height=l;var g=p.getContext("2d");u&&$(window).ready(function(){var t=document.createElement("h2");$(t).text("Bounds Scan"),$("#display").append(t)});var y=new o;y.append(r.translation(l/2,l/2)),y.append(r.scaling(d));var v=n(y);m=m.union(v.minBounds),f=f.intersection(v.maxBounds);var T,S,x;for(T=f.minY,S=f.maxY;isFinite(m.minX)&&isFinite(f.minX)&&Math.abs(m.minX-f.minX)>h;){if(x=n(s(new a(f.minX,T,m.minX,S))),m.minX<=x.minBounds.minX&&f.minX>=x.maxBounds.minX){u&&(console.log("warning, exiting infinite loop!"),console.log('transformed "min" minX: '+s(new a(f.minX,f.minY,m.minX,f.maxY)).transformPosition2(e(m.minX,0))),console.log('transformed "max" minX: '+s(new a(f.minX,f.minY,m.minX,f.maxY)).transformPosition2(e(f.minX,0))));break}m=m.withMinX(Math.min(m.minX,x.minBounds.minX)),f=f.withMinX(Math.max(f.minX,x.maxBounds.minX)),T=Math.max(T,x.maxBounds.minY),S=Math.min(S,x.maxBounds.maxY)}for(T=f.minY,S=f.maxY;isFinite(m.maxX)&&isFinite(f.maxX)&&Math.abs(m.maxX-f.maxX)>h;){if(x=n(s(new a(m.maxX,T,f.maxX,S))),m.maxX>=x.minBounds.maxX&&f.maxX<=x.maxBounds.maxX){u&&console.log("warning, exiting infinite loop!");break}m=m.withMaxX(Math.max(m.maxX,x.minBounds.maxX)),f=f.withMaxX(Math.min(f.maxX,x.maxBounds.maxX)),T=Math.max(T,x.maxBounds.minY),S=Math.min(S,x.maxBounds.maxY)}for(T=f.minX,S=f.maxX;isFinite(m.minY)&&isFinite(f.minY)&&Math.abs(m.minY-f.minY)>h;){if(x=n(s(new a(T,f.minY,S,m.minY))),m.minY<=x.minBounds.minY&&f.minY>=x.maxBounds.minY){u&&console.log("warning, exiting infinite loop!");break}m=m.withMinY(Math.min(m.minY,x.minBounds.minY)),f=f.withMinY(Math.max(f.minY,x.maxBounds.minY)),T=Math.max(T,x.maxBounds.minX),S=Math.min(S,x.maxBounds.maxX)}for(T=f.minX,S=f.maxX;isFinite(m.maxY)&&isFinite(f.maxY)&&Math.abs(m.maxY-f.maxY)>h;){if(x=n(s(new a(T,m.maxY,S,f.maxY))),m.maxY>=x.minBounds.maxY&&f.maxY<=x.maxBounds.maxY){u&&console.log("warning, exiting infinite loop!");break}m=m.withMaxY(Math.max(m.maxY,x.minBounds.maxY)),f=f.withMaxY(Math.min(f.maxY,x.maxBounds.maxY)),T=Math.max(T,x.maxBounds.minX),S=Math.min(S,x.maxBounds.maxX)}u&&(console.log("minBounds: "+m),console.log("maxBounds: "+f));var E=new a((m.minX+f.minX)/2,(m.minY+f.minY)/2,(m.maxX+f.maxX)/2,(m.maxY+f.maxY)/2);return E.minBounds=m,E.maxBounds=f,E.isConsistent=f.containsBounds(m),E.precision=Math.max(Math.abs(m.minX-f.minX),Math.abs(m.minY-f.minY),Math.abs(m.maxX-f.maxX),Math.abs(m.maxY-f.maxY)),E}};var c=s.Util;return c}),i("SCENERY/layers/CanvasLayer",["require","ASSERT/assert","DOT/Bounds2","SCENERY/scenery","KITE/Shape","SCENERY/layers/Layer","SCENERY/util/RenderState","SCENERY/util/Trail","SCENERY/util/TrailPointer","SCENERY/util/Util"],function(t){var e=t("ASSERT/assert")("scenery"),i=t("DOT/Bounds2"),n=t("SCENERY/scenery"),s=t("KITE/Shape"),r=t("SCENERY/layers/Layer");t("SCENERY/util/RenderState"),t("SCENERY/util/Trail"),t("SCENERY/util/TrailPointer"),t("SCENERY/util/Util"),n.CanvasLayer=function(t){r.call(this,t),this.backingScale=t.scene.backingScale,void 0!==t.fullResolution&&(this.backingScale=t.fullResolution?n.Util.backingScale(document.createElement("canvas").getContext("2d")):1);var e=this.$main.width(),i=this.$main.height(),s=document.createElement("canvas");s.width=e*this.backingScale,s.height=i*this.backingScale,$(s).css("width",e),$(s).css("height",i),$(s).css("position","absolute"),this.$main.append(s),this.canvas=s,this.context=s.getContext("2d"),this.scene=t.scene,this.context.miterLimit=20,this.context.miterLimit=10,this.isCanvasLayer=!0,this.resetStyles()};var o=n.CanvasLayer;return o.prototype=_.extend({},r.prototype,{constructor:o,render:function(t,e){if(e=e||{},e.fullRender||!this.dirtyBounds.isEmpty()){var r=new n.RenderState(t);r.layer=this,this.context.setTransform(this.backingScale,0,0,this.backingScale,0,0),this.resetStyles();var o=e.fullRender?t.sceneBounds:this.dirtyBounds.intersection(t.sceneBounds);o.isEmpty()||(this.clearGlobalBounds(o),e.fullRender||r.pushClipShape(s.bounds(o)),this.recursiveRender(r,e),e.fullRender||r.popClipShape()),this.dirtyBounds=i.NOTHING}},recursiveRender:function(t){var e,i,s=new n.TrailPointer(this.startSelfTrail,!0),r=new n.TrailPointer(this.endSelfTrail,!0),o=0;s.trail.reindex(),r.trail.reindex();var a=s.trail.length-(s.isBefore?1:0);for(i=new n.Trail,e=0;a>e;e++){var h=s.trail.nodes[e];i.addDescendant(h),o+=h.isVisible()?0:1,0===o&&h.enterState(t,i)}s.depthFirstUntil(r,function(e){var i=e.trail.lastNode();if(e.isBefore){if(o+=i.isVisible()?0:1,0!==o)return!0;i.enterState(t,e.trail),i.hasSelf()&&i.paintCanvas(t)}else 0===o&&i.exitState(t,e.trail),o-=i.isVisible()?0:1},!1),i=r.trail.copy();var u=r.trail.length-(r.isAfter?1:0);for(e=u-1;e>=0;e--){var c=r.trail.nodes[e];i.removeDescendant(),o-=c.isVisible()?0:1,0===o&&c.exitState(t,i)}},dispose:function(){r.prototype.dispose.call(this),$(this.canvas).detach()},applyTransformationMatrix:function(t){t.canvasAppendTransform(this.context)},resetStyles:function(){this.fillStyle=null,this.strokeStyle=null,this.lineWidth=1,this.lineCap="butt",this.lineJoin="miter",this.lineDash=null,this.miterLimit=10,this.font="10px sans-serif",this.textAlign="start",this.textBaseline="alphabetic",this.direction="inherit"},reindex:function(t){return $(this.canvas).css("z-index",t),this.zIndex=t,t+1},pushClipShape:function(t){this.context.save(),this.writeClipShape(t)},popClipShape:function(){this.context.restore()},writeClipShape:function(t){this.context.beginPath(),t.writeToContext(this.context),this.context.clip()},clearGlobalBounds:function(t){t.isEmpty()||(this.context.save(),this.context.setTransform(this.backingScale,0,0,this.backingScale,0,0),this.context.clearRect(t.getX(),t.getY(),t.getWidth(),t.getHeight()),this.context.restore())},setFillStyle:function(t){this.fillStyle!==t&&(this.fillStyle=t,this.context.fillStyle=t.getCanvasStyle?t.getCanvasStyle():t)},setStrokeStyle:function(t){this.strokeStyle!==t&&(this.strokeStyle=t,this.context.strokeStyle=t.getCanvasStyle?t.getCanvasStyle():t)},setLineWidth:function(t){this.lineWidth!==t&&(this.lineWidth=t,this.context.lineWidth=t)},setLineCap:function(t){this.lineCap!==t&&(this.lineCap=t,this.context.lineCap=t)},setLineJoin:function(t){this.lineJoin!==t&&(this.lineJoin=t,this.context.lineJoin=t)},setLineDash:function(t){e&&e(void 0!==t,"undefined line dash would cause hard-to-trace errors"),this.lineDash!==t&&(this.lineDash=t,this.context.setLineDash?this.context.setLineDash(t):void 0!==this.context.mozDash&&(this.context.mozDash=t))},setFont:function(t){this.font!==t&&(this.font=t,this.context.font=t)},setTextAlign:function(t){this.textAlign!==t&&(this.textAlign=t,this.context.textAlign=t)},setTextBaseline:function(t){this.textBaseline!==t&&(this.textBaseline=t,this.context.textBaseline=t)},setDirection:function(t){this.direction!==t&&(this.direction=t,this.context.direction=t)},getSVGString:function(){return'<image xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+this.canvas.toDataURL()+'" x="0" y="0" height="'+this.canvas.height+'px" width="'+this.canvas.width+'px"/>'},renderToCanvas:function(t,e){e.drawImage(this.canvas,0,0)},markDirtyRegion:function(t){e&&e(t.bounds.isEmpty()||t.bounds.isFinite(),"Infinite (non-empty) dirty bounds passed to CanvasLayer");var i=t.transform.transformBounds2(t.bounds);this.dirtyBounds=this.dirtyBounds.union(i.dilated(1).roundedOut())},transformChange:function(){},getName:function(){return"canvas"}}),o}),i("SCENERY/layers/DOMLayer",["require","ASSERT/assert","DOT/Bounds2","SCENERY/scenery","SCENERY/layers/Layer"],function(t){var e=t("ASSERT/assert")("scenery");t("DOT/Bounds2");var i=t("SCENERY/scenery"),n=t("SCENERY/layers/Layer");i.DOMLayer=function(t){n.call(this,t);var e=this.$main.width(),i=this.$main.height();this.div=document.createElement("div"),this.$div=$(this.div),this.$div.width(0),this.$div.height(0),this.$div.css("position","absolute"),this.div.style.clip="rect(0px,"+e+"px,"+i+"px,0px)",this.$main.append(this.div),this.scene=t.scene,this.isDOMLayer=!0,this.idElementMap={},this.idTrailMap={},this.trails=[]};var s=i.DOMLayer;return s.prototype=_.extend({},n.prototype,{constructor:s,addNodeFromTrail:function(t){n.prototype.addNodeFromTrail.call(this,t),t=t.copy(),this.reindexTrails();var i=t.lastNode(),s=i.getDOMElement();this.idElementMap[t.getUniqueId()]=s,this.idTrailMap[t.getUniqueId()]=t;var r;for(r=0;this.trails.length>r;r++){var o=this.trails[r];o.reindex();var a=o.compare(t);if(e&&e(0!==a,"Trail has already been inserted into the DOMLayer"),1===a)break}r===this.div.childNodes.length?(this.div.appendChild(s),this.trails.push(t)):(this.div.insertBefore(this.getElementFromTrail(this.trails[r])),this.trails.splice(r,0,t)),i.updateCSSTransform(t.getTransform())},removeNodeFromTrail:function(t){n.prototype.removeNodeFromTrail.call(this,t),this.reindexTrails();var i=this.getElementFromTrail(t);e&&e(i,"Trail does not exist in the DOMLayer"),delete this.idElementMap[t.getUniqueId],delete this.idTrailMap[t.getUniqueId],this.div.removeChild(i);var s=this.getIndexOfTrail(t);this.trails.splice(s,1)},getElementFromTrail:function(t){return this.idElementMap[t.getUniqueId()]},reindexTrails:function(){_.each(this.trails,function(t){t.reindex()})},getIndexOfTrail:function(t){var e;for(e=0;this.trails.length>e;e++)if(0===this.trails[e].compare(t))return e;throw Error("DOMLayer.getIndexOfTrail unable to find trail: "+(""+t))},render:function(){},dispose:function(){n.prototype.dispose.call(this),this.$div.detach()},markDirtyRegion:function(t){t.node;var e=t.trail;for(var i in this.idTrailMap){var n=this.idTrailMap[i];if(n.reindex(),n.isExtensionOf(e,!0)){var s=this.idElementMap[i],r=_.every(n.nodes,function(t){return t.isVisible()});s.style.visibility=r?"visible":"hidden"}}},transformChange:function(t){var e=t.trail;this.startPointer.eachTrailBetween(this.endPointer,function(t){if(t.isExtensionOf(e,!0)){var i=t.lastNode();i.hasSelf()&&i.updateCSSTransform(t.getTransform())}})},applyTransformationMatrix:function(){},getContainer:function(){return this.div},reindex:function(t){return this.$div.css("z-index",t),this.zIndex=t,t+1},pushClipShape:function(){},popClipShape:function(){},getSVGString:function(){"<svg xmlns='http://www.w3.org/2000/svg' width='"+this.$main.width()+"' height='"+this.$main.height()+"'>"+"<foreignObject width='100%' height='100%'>"+$(this.div).html()+"</foreignObject></svg>"},renderToCanvas:function(){},getName:function(){return"dom"}}),s}),i("SCENERY/layers/LayerBoundary",["require","ASSERT/assert","SCENERY/scenery"],function(t){t("ASSERT/assert")("scenery");var e=t("SCENERY/scenery");e.LayerBoundary=function(){this.previousLayerType=null,this.nextLayerType=null,this.previousSelfTrail=null,this.nextSelfTrail=null,this.previousEndPointer=null,this.nextStartPointer=null};var i=e.LayerBoundary;return i.prototype={constructor:i,hasPrevious:function(){return!!this.previousSelfTrail},hasNext:function(){return!!this.nextSelfTrail},equivalentPreviousTrail:function(t){return this.previousSelfTrail&&t?this.previousSelfTrail.equals(t):this.previousSelfTrail===t},equivalentNextTrail:function(t){return this.nextSelfTrail&&t?this.nextSelfTrail.equals(t):this.nextSelfTrail===t},toString:function(){return"boundary:\n    types:    "+(this.previousLayerType?this.previousLayerType.name:"")+" => "+(this.nextLayerType?this.nextLayerType.name:"")+"\n    trails:   "+(this.previousSelfTrail?this.previousSelfTrail.getUniqueId():"")+" => "+(this.nextSelfTrail?this.nextSelfTrail.getUniqueId():"")+"\n    pointers: "+(this.previousEndPointer?""+this.previousEndPointer:"")+" => "+(this.nextStartPointer?""+this.nextStartPointer:"")}},i}),i("SCENERY/layers/LayerBuilder",["require","ASSERT/assert","SCENERY/scenery","SCENERY/layers/LayerBoundary","SCENERY/util/Trail","SCENERY/util/TrailPointer"],function(t){t("ASSERT/assert")("scenery");var e=t("SCENERY/scenery");t("SCENERY/layers/LayerBoundary"),t("SCENERY/util/Trail"),t("SCENERY/util/TrailPointer"),e.LayerBuilder=function(t,i,n,s){this.layerTypeStack=[],this.boundaries=[],this.pendingBoundary=new e.LayerBoundary,this.pendingBoundary.previousLayerType=i,this.pendingBoundary.previousSelfTrail=n,this.currentLayerType=i,this.layerChangePending=null===n,n?(this.startPointer=new e.TrailPointer(n.copy(),!0),this.startPointer.nestedForwards()):this.startPointer=new e.TrailPointer(new e.Trail(t),!0),this.endPointer=s?new e.TrailPointer(s.copy(),!0):new e.TrailPointer(new e.Trail(t),!1),this.includesEndTrail=null!==s};var i=e.LayerBuilder;return i.prototype={constructor:i,prepareLayerStack:function(){for(var t=new e.TrailPointer(new e.Trail(this.startPointer.trail.rootNode()),!0),i=this.startPointer.trail.length-(this.startPointer.isBefore?1:0);i>=t.trail.length;){var n=t.trail.lastNode();n.layerStrategy.hasPreferredLayerType(t,this)&&this.pushPreferredLayerType(n.layerStrategy.getPreferredLayerType(t,this)),t.trail.addDescendant(this.startPointer.trail.nodes[t.trail.length])}},run:function(){var t=this;this.prepareLayerStack(),t.startPointer.depthFirstUntil(t.endPointer,function(e){var i=e.trail.lastNode();e.isBefore?i.layerStrategy.enter(e,t):i.layerStrategy.exit(e,t)},!1),this.includesEndTrail||(this.pendingBoundary.previousEndPointer=t.endPointer,this.layerChange(null))},layerChange:function(t){this.layerChangePending=!1;var i=this.pendingBoundary;i.nextSelfTrail=t?t.trail.copy():null,this.boundaries.push(i),this.pendingBoundary=new e.LayerBoundary,this.pendingBoundary.previousLayerType=i.nextLayerType,this.pendingBoundary.previousSelfTrail=i.nextSelfTrail},switchToType:function(t,e){this.currentLayerType=e,this.pendingBoundary.nextLayerType=e,this.pendingBoundary.nextStartPointer=t.copy(),this.layerChangePending||(this.pendingBoundary.previousEndPointer=t.copy()),this.layerChangePending=!0},markSelf:function(t){this.layerChangePending?this.layerChange(t):this.pendingBoundary.previousSelfTrail=t.trail.copy()},getCurrentLayerType:function(){return this.currentLayerType},pushPreferredLayerType:function(t){this.layerTypeStack.push(t)},popPreferredLayerType:function(){this.layerTypeStack.pop()},getPreferredLayerType:function(){return 0!==this.layerTypeStack.length?this.layerTypeStack[this.layerTypeStack.length-1]:null},bestPreferredLayerTypeFor:function(t){for(var e=this.layerTypeStack.length-1;e>=0;e--){var i=this.layerTypeStack[e];if(_.some(t,function(t){return i.supportsRenderer(t)}))return i}return null}},i}),i("SCENERY/layers/LayerType",["require","ASSERT/assert","SCENERY/scenery"],function(t){t("ASSERT/assert")("scenery");var e=t("SCENERY/scenery");e.LayerType=function(t,e,i,n){this.Constructor=t,this.name=e,this.renderer=i,this.args=n};var i=e.LayerType;return i.prototype={constructor:i,supportsRenderer:function(t){return this.renderer===t},supportsNode:function(t){var e=this;return _.some(t._supportedRenderers,function(t){return e.supportsRenderer(t)})},createLayer:function(t){var e=this.Constructor;return new e(_.extend({},t,this.args))}},i}),i("SCENERY/layers/SVGLayer",["require","ASSERT/assert","DOT/Bounds2","DOT/Transform3","DOT/Matrix3","SCENERY/scenery","SCENERY/layers/Layer","SCENERY/util/Trail"],function(t){var e=t("ASSERT/assert")("scenery");t("DOT/Bounds2");var i=t("DOT/Transform3"),n=t("DOT/Matrix3"),s=t("SCENERY/scenery"),r=t("SCENERY/layers/Layer");t("SCENERY/util/Trail");var o="http://www.w3.org/2000/svg";s.SVGLayer=function(t){var e=t.$main;this.svg=document.createElementNS(o,"svg"),this.g=document.createElementNS(o,"g"),this.defs=document.createElementNS(o,"defs");var i=e.width(),n=e.height();this.svg.appendChild(this.defs),this.svg.appendChild(this.g),this.$svg=$(this.svg),this.svg.setAttribute("width",i),this.svg.setAttribute("height",n),this.svg.setAttribute("stroke-miterlimit",10),this.$svg.css("position","absolute"),this.svg.style.clip="rect(0px,"+i+"px,"+n+"px,0px)",this.svg.style["pointer-events"]="none",e.append(this.svg),this.scene=t.scene,this.isSVGLayer=!0,this.idFragmentMap={},this.idGroupMap={},r.call(this,t),this.baseTransformDirty=!0,this.baseTransformChange=!0};var a=s.SVGLayer;return a.prototype=_.extend({},r.prototype,{constructor:a,addNodeFromTrail:function(t){e&&e(!(t.getUniqueId()in this.idFragmentMap),"Already contained that trail!"),e&&e(t.lastNode().hasSelf(),"Don't add nodes without hasSelf() to SVGLayer"),r.prototype.addNodeFromTrail.call(this,t);for(var i=this.baseTrail.copy(),n=null;i.length<=t.length;){var s=i.getUniqueId();
if(!(s in this.idGroupMap)){var a;n?(a=document.createElementNS(o,"g"),this.applyTransform(i.lastNode().getTransform(),a),this.insertGroupIntoParent(a,this.idGroupMap[n],i)):(e&&e(i.lastNode()===this.baseNode),a=this.g,this.initializeBase()),a.referenceCount=0,a.trail=i.copy(),this.idGroupMap[s]=a}this.idGroupMap[s].referenceCount++,i.addDescendant(t.nodes[i.length]),n=s}var h=t.lastNode(),u=t.getUniqueId(),c=this.idGroupMap[u],l=h.createSVGFragment(this.svg,this.defs,c);this.updateNode(h,l),this.updateNodeGroup(h,c),this.idFragmentMap[u]=l,c.appendChild(l)},removeNodeFromTrail:function(t){e&&e(t.getUniqueId()in this.idFragmentMap,"Did not contain that trail!"),r.prototype.removeNodeFromTrail.call(this,t);var i=t.getUniqueId(),n=t.lastNode(),s=this.idFragmentMap[i];this.idGroupMap[i].removeChild(s),delete this.idFragmentMap[i],n.removeSVGDefs&&n.removeSVGDefs(this.svg,this.defs);for(var o=t.copy();o.length>this.baseTrail.length;){var a=o.getUniqueId(),h=this.idGroupMap[a];h.referenceCount--,0===h.referenceCount&&(h.parentNode.removeChild(h),delete h.trail,delete this.idGroupMap[a]),o.removeDescendant()}this.g.referenceCount--},insertGroupIntoParent:function(t,e,i){if(e.childNodes.length){var n,s=i.length-2,r=i.indices[s];for(n=0;e.childNodes.length>n;n++){var o=e.childNodes[n];if(o.trail){o.trail.reindex();var a=o.trail.indices[s];if(a>r)break}}n===e.childNodes.length?e.appendChild(t):e.insertBefore(t,e.childNodes[n])}else e.appendChild(t)},updateNode:function(t,e){t.updateSVGFragment&&t.updateSVGFragment(e),t.updateSVGDefs&&t.updateSVGDefs(this.svg,this.defs)},updateNodeGroup:function(t,e){e.style.display=t.isVisible()?"inherit":"none"},applyTransform:function(t,e){t.isIdentity()?e.hasAttribute("transform")&&e.removeAttribute("transform"):e.setAttribute("transform",t.getMatrix().getSVGTransform())},render:function(){var t=this;if(this.baseTransformDirty){var e=this.baseTransformChange;this.domChange(function(){t.updateBaseTransform(e)}),this.baseTransformDirty=!1,this.baseTransformChange=!1}this.flushDOMChanges()},dispose:function(){r.prototype.dispose.call(this),this.$svg.detach()},markDirtyRegion:function(t){var e=t.node,i=t.trail.getUniqueId(),n=this.idFragmentMap[i];n&&this.updateNode(e,n);var s=this.idGroupMap[i];s&&this.updateNodeGroup(e,s)},markBaseTransformDirty:function(t){var e=this.baseTransformChange||!!t;this.batchDOMChanges?(this.baseTransformDirty=!0,this.baseTransformChange=e):this.updateBaseTransform(e)},initializeBase:function(){this.cssTransform?this.baseNodeInternalBoundsChange():this.markBaseTransformDirty(!0)},baseNodeInternalBoundsChange:function(){if(this.cssTransform){var t=this.baseNode.parentToLocalBounds(this.baseNode.getBounds()),i=s.Layer.cssTransformPadding;if(!t.isEmpty()){this.baseNodeTransform.set(n.translation(Math.ceil(-t.minX+i),Math.ceil(-t.minY+i)));var r=this.baseNodeTransform.transformBounds2(t);e&&e(r.minX>=0&&r.minY>=0),this.updateContainerDimensions(Math.ceil(r.maxX+i),Math.ceil(r.maxY+i))}this.markBaseTransformDirty(!0)}else this.usesPartialCSSTransforms&&this.markBaseTransformDirty(!0)},updateContainerDimensions:function(t,e){var i=this;this.domChange(function(){i.svg.setAttribute("width",t),i.svg.setAttribute("height",e)})},updateBaseTransform:function(t){var e=this.baseTrail.getTransform();if(this.cssTransform)this.$svg.css(e.getMatrix().timesMatrix(this.baseNodeTransform.getInverse()).getCSSTransformStyles()),t&&this.applyTransform(this.baseNodeTransform,this.g);else if(this.usesPartialCSSTransforms){var r=new i,o=e.getMatrix();if(this.cssTranslation&&r.append(n.translation(o.m02(),o.m12())),this.cssRotation&&r.append(n.rotation2(o.getRotation())),this.cssScale){var a=o.getScaleVector();r.append(n.scaling(a.x,a.y))}e.prepend(r.getInverse());var h=s.Layer.cssTransformPadding,u=this.baseNode.parentToLocalBounds(this.baseNode.getBounds()),c=e.transformBounds2(u),l=n.translation(Math.ceil(-c.minX+h),Math.ceil(-c.minY+h)),d=l.inverted();this.updateContainerDimensions(Math.ceil(c.getWidth()+2*h),Math.ceil(c.getHeight()+2*h)),r.append(d),e.prepend(l),this.$svg.css(r.getMatrix().getCSSTransformStyles()),this.applyTransform(e,this.g)}else this.applyTransform(e,this.g)},transformChange:function(t){var e=this,i=t.node,n=t.trail;if(n.lastNode()===this.baseNode)this.markBaseTransformDirty();else if(_.contains(n.nodes,this.baseNode)){var s=this.idGroupMap[n.getUniqueId()];this.domChange(function(){e.applyTransform(i.getTransform(),s)})}else this.markBaseTransformDirty()},applyTransformationMatrix:function(){},getContainer:function(){return this.svg},reindex:function(t){return this.$svg.css("z-index",t),this.zIndex=t,t+1},pushClipShape:function(){},popClipShape:function(){},getSVGString:function(){return $("<div>").append(this.$svg.clone()).html()},renderToCanvas:function(t,e,i){if(this.applyTransform(this.baseTrail.getTransform(),this.g),!window.canvg){var n=window.URL||window.webkitURL||window,s=new Image,r=this.getSVGString();console.log(r);var o=new Blob([r],{type:"image/svg+xml;charset=utf-8"}),a=n.createObjectURL(o);throw i.increment(),s.onload=function(){e.drawImage(s,0,0),n.revokeObjectURL(a),i.decrement()},s.src=a,Error("this implementation hits Chrome bugs, won't work on IE9/10, etc. deprecated")}i.increment(),canvg(t,this.getSVGString(),{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,renderCallback:function(){i.decrement()}}),this.updateBaseTransform()},getName:function(){return"svg"}}),a}),i("SCENERY/layers/Renderer",["require","ASSERT/assert","SCENERY/scenery","SCENERY/layers/LayerType","SCENERY/layers/CanvasLayer","SCENERY/layers/DOMLayer","SCENERY/layers/SVGLayer"],function(t){t("ASSERT/assert")("scenery");var e=t("SCENERY/scenery");t("SCENERY/layers/LayerType"),t("SCENERY/layers/CanvasLayer"),t("SCENERY/layers/DOMLayer"),t("SCENERY/layers/SVGLayer"),e.Renderer=function(t,e,i){this.layerConstructor=t,this.name=e,this.defaultOptions=i,this.defaultLayerType=this.createLayerType({})};var i=e.Renderer;return i.prototype={constructor:i,createLayerType:function(t){return new e.LayerType(this.layerConstructor,this.name,this,_.extend({},this.defaultOptions,t))}},i.Canvas=new i(e.CanvasLayer,"canvas",{}),i.DOM=new i(e.DOMLayer,"dom",{}),i.SVG=new i(e.SVGLayer,"svg",{}),e.CanvasDefaultLayerType=i.Canvas.defaultLayerType,e.DOMDefaultLayerType=i.DOM.defaultLayerType,e.SVGDefaultLayerType=i.SVG.defaultLayerType,i.canvas=i.Canvas,i.dom=i.DOM,i.svg=i.SVG,i.webgl=i.WebGL,i}),i("PHET_CORE/extend",["require"],function(){return function(t){return _.each(Array.prototype.slice.call(arguments,1),function(e){if(e)for(var i in e)Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))}),t}}),i("PHET_CORE/inherit",["require","PHET_CORE/extend"],function(t){function e(t,e,n){function s(){}s.prototype=e.prototype,t.prototype=i(new s,{constructor:t},n)}var i=t("PHET_CORE/extend");return e}),i("SCENERY/nodes/DOM",["require","ASSERT/assert","PHET_CORE/inherit","DOT/Bounds2","SCENERY/scenery","SCENERY/nodes/Node","SCENERY/layers/Renderer","SCENERY/util/Util"],function(t){t("ASSERT/assert")("scenery");var e=t("PHET_CORE/inherit"),i=t("DOT/Bounds2"),n=t("SCENERY/scenery"),s=t("SCENERY/nodes/Node"),r=t("SCENERY/layers/Renderer");t("SCENERY/util/Util").objectCreate,n.DOM=function o(t,e){e=e||{},this._interactive=!1,t&&t.jquery&&(t=t[0]),this._container=document.createElement("div"),this._$container=$(this._container),this._$container.css("position","absolute"),this._$container.css("left",0),this._$container.css("top",0),this.invalidateDOMLock=!1,e.element=t,s.call(this,e)};var o=n.DOM;return e(o,s,{calculateDOMBounds:function(){var t=this._element.getBoundingClientRect();return new i(0,0,t.width,t.height)},createTemporaryContainer:function(){var t=document.createElement("div");return $(t).css({display:"hidden",padding:"0 !important",margin:"0 !important",position:"absolute",left:0,top:0,width:65535,height:65535}),t},invalidateDOM:function(){if(!this.invalidateDOMLock){this.invalidateDOMLock=!0;var t=this.createTemporaryContainer();this._container.removeChild(this._element),t.appendChild(this._element),document.body.appendChild(t);var e=this.calculateDOMBounds();this.invalidateSelf(e),this._$container.width(e.getWidth()),this._$container.height(e.getHeight()),document.body.removeChild(t),t.removeChild(this._element),this._container.appendChild(this._element),this.invalidateDOMLock=!1}},getDOMElement:function(){return this._container},updateCSSTransform:function(t){this._$container.css(t.getMatrix().getCSSTransformStyles())},hasSelf:function(){return!0},setElement:function(t){return this._element!==t&&(this._element&&this._container.removeChild(this._element),this._element=t,this._$element=$(t),this._container.appendChild(this._element),this.invalidateDOM()),this},getElement:function(){return this._element},setInteractive:function(t){this._interactive!==t&&(this._interactive=t)},isInteractive:function(){return this._interactive},set element(t){this.setElement(t)},get element(){return this.getElement()},set interactive(t){this.setInteractive(t)},get interactive(){return this.isInteractive()}}),o.prototype._mutatorKeys=["element","interactive"].concat(s.prototype._mutatorKeys),o.prototype._supportedRenderers=[r.DOM],o}),i("SCENERY/nodes/Fillable",["require","ASSERT/assert","SCENERY/scenery"],function(t){t("ASSERT/assert")("scenery");var e=t("SCENERY/scenery");e.Fillable=function(t){var e=t.prototype;e.initializeFillable=function(){this._fill=null},e.hasFill=function(){return null!==this._fill},e.getFill=function(){return this._fill},e.setFill=function(t){return this.getFill()!==t&&(this._fill=t,this.invalidatePaint(),this.invalidateFill()),this},e._mutatorKeys=["fill"].concat(e._mutatorKeys),Object.defineProperty(e,"fill",{set:e.setFill,get:e.getFill}),e.invalidateFill||(e.invalidateFill=function(){})};var i=e.Fillable;return i}),i("SCENERY/nodes/HBox",["require","SCENERY/scenery","SCENERY/nodes/Node","SCENERY/util/Util"],function(t){var e=t("SCENERY/scenery"),i=t("SCENERY/nodes/Node"),n=t("SCENERY/util/Util").objectCreate;e.HBox=function s(t){if(this.options=t=_.extend({spacing:function(){return 0},align:"center"},t),"number"==typeof t.spacing){var e=t.spacing;t.spacing=function(){return e}}i.call(this,t),this.updateLayout()};var s=e.HBox;return s.prototype=n(i.prototype),s.prototype.updateLayout=function(){for(var t=_.min(_.map(this.children,function(t){return t.y})),e=_.max(_.map(this.children,function(t){return t.y+t.height})),i=(e+t)/2,n=0,s=0;this.children.length>s;s++){var r=this.children[s];r.x=n,"top"===this.options.align?r.top=t:"bottom"===this.options.align?r.bottom=e:r.centerY=i,n+=r.width+this.options.spacing(r,this.children[s+1])}},s.prototype.constructor=s,s}),i("SCENERY/nodes/Image",["require","ASSERT/assert","PHET_CORE/inherit","DOT/Bounds2","SCENERY/scenery","SCENERY/nodes/Node","SCENERY/layers/Renderer","SCENERY/util/Util"],function(t){t("ASSERT/assert")("scenery");var e=t("PHET_CORE/inherit"),i=t("DOT/Bounds2"),n=t("SCENERY/scenery"),s=t("SCENERY/nodes/Node"),r=t("SCENERY/layers/Renderer");t("SCENERY/util/Util").objectCreate,n.Image=function o(t,e){e=e||{},t&&(e.image=t);var i=this;this.loadListener=function(){i.invalidateImage(),i._image.removeEventListener("load",i.loadListener)},s.call(this,e)};var o=n.Image;return e(o,s,{invalidateImage:function(){this.invalidateSelf(new i(0,0,this.getImageWidth(),this.getImageHeight()))},getImage:function(){return this._image},setImage:function(t){if(this._image!==t&&("string"!=typeof t||!this._image||t!==this._image.src)){if(this._image&&this._image.removeEventListener("load",this.loadListener),"string"==typeof t){var e=t;t=document.createElement("img"),t.addEventListener("load",this.loadListener),t.src=e}else t instanceof HTMLImageElement&&(t.width&&t.height||t.addEventListener("load",this.loadListener));t instanceof HTMLCanvasElement?this.hasOwnProperty("_supportedRenderers")||(this._supportedRenderers=[r.Canvas],this.markLayerRefreshNeeded()):this.hasOwnProperty("_supportedRenderers")&&(delete this._supportedRenderers,this.markLayerRefreshNeeded()),this._image=t,this.invalidateImage()}return this},invalidateOnImageLoad:function(t){var e=this,i=function(){e.invalidateImage(),t.removeEventListener(i)};t.addEventListener(i)},getImageWidth:function(){return this._image.width},getImageHeight:function(){return this._image.height},getImageURL:function(){return this._image.src},hasSelf:function(){return!0},paintCanvas:function(t){var e=t.layer,i=e.context;i.drawImage(this._image,0,0)},paintWebGL:function(){throw Error("paintWebGL:nimplemented")},createSVGFragment:function(){var t=document.createElementNS("http://www.w3.org/2000/svg","image");return t.setAttribute("x",0),t.setAttribute("y",0),t},updateSVGFragment:function(t){var e="http://www.w3.org/1999/xlink";t.setAttribute("width",this.getImageWidth()+"px"),t.setAttribute("height",this.getImageHeight()+"px"),t.setAttributeNS(e,"xlink:href",this.getImageURL())},getDOMElement:function(){return this._image.style.display="block",this._image.style.position="absolute",this._image},updateCSSTransform:function(t){$(this._image).css(t.getMatrix().getCSSTransformStyles())},set image(t){this.setImage(t)},get image(){return this.getImage()}}),o.prototype._mutatorKeys=["image"].concat(s.prototype._mutatorKeys),o.prototype._supportedRenderers=[r.Canvas,r.SVG,r.DOM],o.createSVGImage=function(t,e,i){var n="http://www.w3.org/1999/xlink",s="http://www.w3.org/2000/svg",r=document.createElementNS(s,"image");return r.setAttribute("x",0),r.setAttribute("y",0),r.setAttribute("width",e+"px"),r.setAttribute("height",i+"px"),r.setAttributeNS(n,"xlink:href",t),r},o}),i("SCENERY/nodes/Strokable",["require","ASSERT/assert","SCENERY/scenery","KITE/util/LineStyles"],function(t){t("ASSERT/assert")("scenery");var e=t("SCENERY/scenery"),i=t("KITE/util/LineStyles");e.Strokable=function(t){var e=t.prototype;e.initializeStrokable=function(){this._stroke=null,this._lineDrawingStyles=new i},e.hasStroke=function(){return null!==this._stroke},e.getLineWidth=function(){return this._lineDrawingStyles.lineWidth},e.setLineWidth=function(t){return this.getLineWidth()!==t&&(this.markOldSelfPaint(),this._lineDrawingStyles.lineWidth=t,this.invalidateStroke()),this},e.getLineCap=function(){return this._lineDrawingStyles.lineCap},e.setLineCap=function(t){return this._lineDrawingStyles.lineCap!==t&&(this.markOldSelfPaint(),this._lineDrawingStyles.lineCap=t,this.invalidateStroke()),this},e.getLineJoin=function(){return this._lineDrawingStyles.lineJoin},e.setLineJoin=function(t){return this._lineDrawingStyles.lineJoin!==t&&(this.markOldSelfPaint(),this._lineDrawingStyles.lineJoin=t,this.invalidateStroke()),this},e.getLineDash=function(){return this._lineDrawingStyles.lineDash},e.setLineDash=function(t){return this._lineDrawingStyles.lineDash!==t&&(this.markOldSelfPaint(),this._lineDrawingStyles.lineDash=t,this.invalidateStroke()),this},e.setLineStyles=function(t){return this.markOldSelfPaint(),this._lineDrawingStyles=t,this.invalidateStroke(),this},e.getLineStyles=function(){return this._lineDrawingStyles},e.getStroke=function(){return this._stroke},e.setStroke=function(t){return this.getStroke()!==t&&(this.markOldSelfPaint(),this._stroke=t,this.invalidateStroke()),this},e._mutatorKeys=["stroke","lineWidth","lineCap","lineJoin","lineDash"].concat(e._mutatorKeys),Object.defineProperty(e,"stroke",{set:e.setStroke,get:e.getStroke}),Object.defineProperty(e,"lineWidth",{set:e.setLineWidth,get:e.getLineWidth}),Object.defineProperty(e,"lineCap",{set:e.setLineCap,get:e.getLineCap}),Object.defineProperty(e,"lineJoin",{set:e.setLineJoin,get:e.getLineJoin}),Object.defineProperty(e,"lineDash",{set:e.setLineDash,get:e.getLineDash}),e.invalidateStroke||(e.invalidateStroke=function(){})};var n=e.Strokable;return n}),i("SCENERY/nodes/Path",["require","ASSERT/assert","PHET_CORE/inherit","SCENERY/scenery","SCENERY/nodes/Node","SCENERY/layers/Renderer","SCENERY/nodes/Fillable","SCENERY/nodes/Strokable","SCENERY/util/Util"],function(t){t("ASSERT/assert")("scenery");var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/nodes/Node"),s=t("SCENERY/layers/Renderer"),r=t("SCENERY/nodes/Fillable"),o=t("SCENERY/nodes/Strokable");t("SCENERY/util/Util").objectCreate,i.Path=function a(t){this._shape=null,t=t||{},this.initializeStrokable(),n.call(this,t)};var a=i.Path;return e(a,n,{setShape:function(t){return this._shape!==t&&(this._shape=t,this.invalidateShape()),this},getShape:function(){return this._shape},invalidateShape:function(){this.markOldSelfPaint(),this.hasShape()&&(this.invalidateSelf(this._shape.computeBounds(this._stroke?this._lineDrawingStyles:null)),this.invalidatePaint())},invalidateStroke:function(){this.invalidateShape()},hasShape:function(){return null!==this._shape},paintCanvas:function(t){if(this.hasShape()){var e=t.layer,i=e.context;i.beginPath(),this._shape.writeToContext(i),this._fill&&(e.setFillStyle(this._fill),this._fill.transformMatrix&&(i.save(),this._fill.transformMatrix.canvasAppendTransform(i)),i.fill(),this._fill.transformMatrix&&i.restore()),this._stroke&&(e.setStrokeStyle(this._stroke),e.setLineWidth(this.getLineWidth()),e.setLineCap(this.getLineCap()),e.setLineJoin(this.getLineJoin()),e.setLineDash(this.getLineDash()),i.stroke())}},paintWebGL:function(){throw Error("Path.prototype.paintWebGL unimplemented")},createSVGFragment:function(){return document.createElementNS("http://www.w3.org/2000/svg","path")},updateSVGFragment:function(t){this.hasShape()?t.setAttribute("d",this._shape.getSVGPath()):t.hasAttribute("d")&&t.removeAttribute("d");var e="";e+="fill: "+(this._fill?this._fill.getSVGDefinition?"url(#fill"+this.getId()+")":this._fill:"none")+";",e+="stroke: "+(this._stroke?this._stroke.getSVGDefinition?"url(#stroke"+this.getId()+")":this._stroke:"none")+";",this._stroke&&(e+="stroke-width: "+this.getLineWidth()+";",e+="stroke-linecap: "+this.getLineCap()+";",e+="stroke-linejoin: "+this.getLineJoin()+";",this.getLineDash()&&(e+="stroke-dasharray: "+this.getLineDash().join(",")+";")),t.setAttribute("style",e)},updateSVGDefs:function(t,e){var i=this.getStroke(),n=this.getFill(),s="stroke"+this.getId(),r="fill"+this.getId();this.removeSVGDefs(t,e),i&&i.getSVGDefinition&&e.appendChild(i.getSVGDefinition(s)),n&&n.getSVGDefinition&&e.appendChild(n.getSVGDefinition(r))},removeSVGDefs:function(t,e){var i="stroke"+this.getId(),n="fill"+this.getId(),s=t.getElementById(i),r=t.getElementById(n);s&&e.removeChild(s),r&&e.removeChild(r)},hasSelf:function(){return!0},containsPointSelf:function(t){if(!this.hasShape())return!1;var e=this._shape.containsPoint(t);return!e&&this._includeStrokeInHitRegion&&this.hasStroke()&&(e=this._shape.getStrokedShape(this._lineDrawingStyles).containsPoint(t)),e},intersectsBoundsSelf:function(t){return this.hasShape()?this._shape.intersectsBounds(t):!1},set shape(t){this.setShape(t)},get shape(){return this.getShape()}}),a.prototype._mutatorKeys=["shape"].concat(n.prototype._mutatorKeys),a.prototype._supportedRenderers=[s.Canvas,s.SVG],r(a),o(a),a}),i("SCENERY/util/Font",["require","ASSERT/assert","SCENERY/scenery"],function(t){t("ASSERT/assert")("scenery");var e=t("SCENERY/scenery");e.Font=function(t){this._font="10px sans-serif",this.$span=$(document.createElement("span"));var e=typeof t;"string"===e?this._font=t:"object"===e&&this.mutate(t)};var i=e.Font;return i.prototype={constructor:i,getProperty:function(t){return this.$span.css("font",this._font),this.$span.css(t)},setProperty:function(t,e){return this.$span.css("font",this._font),this.$span.css(t,e),this._font=this.$span.css("font"),this},getFont:function(){return this._font},setFont:function(t){return this._font=t,this},getFamily:function(){return this.getProperty("font-family")},setFamily:function(t){return this.setProperty("font-family",t)},getWeight:function(){return this.getProperty("font-weight")},setWeight:function(t){return this.setProperty("font-weight",t)},getStretch:function(){return this.getProperty("font-stretch")},setStretch:function(t){return this.setProperty("font-stretch",t)},getStyle:function(){return this.getProperty("font-style")},setStyle:function(t){return this.setProperty("font-style",t)},getSize:function(){return this.getProperty("font-size")},setSize:function(t){return this.setProperty("font-size",t)},getLineHeight:function(){return this.getProperty("line-height")},setLineHeight:function(t){return this.setProperty("line-height",t)},set font(t){this.setFont(t)},get font(){return this.getFont()},set weight(t){this.setWeight(t)},get weight(){return this.getWeight()},set family(t){this.setFamily(t)},get family(){return this.getFamily()},set stretch(t){this.setStretch(t)},get stretch(){return this.getStretch()},set style(t){this.setStyle(t)},get style(){return this.getStyle()},set size(t){this.setSize(t)},get size(){return this.getSize()},set lineHeight(t){this.setLineHeight(t)},get lineHeight(){return this.getLineHeight()},mutate:function(t){var e=this;_.each(this._mutatorKeys,function(i){void 0!==t[i]&&(e[i]=t[i])})}},i.prototype._mutatorKeys=["font","weight","family","stretch","style","size","lineHeight"],i}),i("SCENERY/nodes/Text",["require","ASSERT/assert","PHET_CORE/inherit","DOT/Bounds2","SCENERY/scenery","SCENERY/nodes/Node","SCENERY/layers/Renderer","SCENERY/nodes/Fillable","SCENERY/util/Util","SCENERY/util/Font","SCENERY/util/Util"],function(t){function e(t,e,i){var n="get"+e,s="set"+e;u.prototype[n]=function(){return this._font[i]},u.prototype[s]=function(t){return this._font[i]=t,this.invalidateText(),this},Object.defineProperty(u.prototype,t,{set:u.prototype[s],get:u.prototype[n]})}var i=t("ASSERT/assert")("scenery"),n=t("PHET_CORE/inherit"),s=t("DOT/Bounds2"),r=t("SCENERY/scenery"),o=t("SCENERY/nodes/Node"),a=t("SCENERY/layers/Renderer"),h=t("SCENERY/nodes/Fillable");t("SCENERY/util/Util").objectCreate,t("SCENERY/util/Font"),t("SCENERY/util/Util"),r.Text=function u(t,e){this._text="",this._font=new r.Font,this._textAlign="start",this._textBaseline="alphabetic",this._direction="ltr",e=e||{},void 0===e.fill&&(e.fill="#000000"),void 0!==t&&(e.text=t),o.call(this,e)};var u=r.Text;return n(u,o,{setText:function(t){return t!==this._text&&(this._text=t,this.invalidateText()),this},getText:function(){return this._text},invalidateText:function(){this.invalidateSelf(this.accurateCanvasBounds())},paintCanvas:function(t){var e=t.layer,i=e.context;this.hasFill()&&(e.setFillStyle(this.getFill()),e.setFont(this._font.getFont()),e.setTextAlign(this._textAlign),e.setTextBaseline(this._textBaseline),e.setDirection(this._direction),i.fillText(this._text,0,0))},paintWebGL:function(){throw Error("Text.prototype.paintWebGL unimplemented")},createSVGFragment:function(){return document.createElementNS("http://www.w3.org/2000/svg","text")},updateSVGFragment:function(t){for(var e="rtl"===this._direction;t.hasChildNodes();)t.removeChild(t.lastChild);switch(t.appendChild(document.createTextNode(this._text)),t.setAttribute("fill",this._fill),this._textAlign){case"start":case"end":t.setAttribute("text-anchor",this._textAlign);break;case"left":t.setAttribute("text-anchor",e?"end":"start");break;case"right":t.setAttribute("text-anchor",e?"start":"end");break;case"center":t.setAttribute("text-anchor","middle")}switch(this._textBaseline){case"alphabetic":case"ideographic":case"hanging":case"middle":t.setAttribute("dominant-baseline",this._textBaseline);break;default:throw Error("impossible to get the SVG approximate bounds for textBaseline: "+this._textBaseline)}t.setAttribute("direction",this._direction),t.setAttribute("font-family",this._font.getFamily()),t.setAttribute("font-size",this._font.getSize()),t.setAttribute("font-style",this._font.getStyle()),t.setAttribute("font-weight",this._font.getWeight()),this._font.getStretch()&&t.setAttribute("font-stretch",this._font.getStretch())},accurateCanvasBounds:function(){var t=this,e=this.approximateSVGBounds();return r.Util.canvasAccurateBounds(function(e){e.font=t.font,e.textAlign=t.textAlign,e.textBaseline=t.textBaseline,e.direction=t.direction,e.fillText(t.text,0,0)},{precision:.5,resolution:128,initialScale:32/Math.max(Math.abs(e.minX),Math.abs(e.minY),Math.abs(e.maxX),Math.abs(e.maxY))})},approximateCanvasWidth:function(){var t=document.createElement("canvas").getContext("2d");return t.font=this.font,t.textAlign=this.textAlign,t.textBaseline=this.textBaseline,t.direction=this.direction,t.measureText(this.text).width},approximateSVGBounds:function(){"rtl"===this._direction;var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("width","1024"),t.setAttribute("height","1024"),t.setAttribute("style","display: hidden;");var e=document.createElementNS("http://www.w3.org/2000/svg","text");this.updateSVGFragment(e),t.appendChild(e),document.body.appendChild(t);var i=e.getBBox(),n=new s(i.x,i.y,i.x+i.width,i.y+i.height);return document.body.removeChild(t),n},approximateDOMBounds:function(){i&&i("alphabetic"===this._textBaseline);var t=1024,e="rtl"===this.direction,n=document.createElement("div");$(n).css({position:"absolute",left:0,top:0,padding:"0 !important",margin:"0 !important",display:"hidden"});var r=document.createElement("span");$(r).css("font",this.getFont()),r.appendChild(document.createTextNode(this.text)),r.setAttribute("direction",this._direction);var o=document.createElement("div");$(o).css({"vertical-align":"baseline",display:"inline-block",width:0,height:t+"px",margin:"0 !important",padding:"0 !important"}),n.appendChild(r),n.appendChild(o),document.body.appendChild(n);var a=r.getBoundingClientRect(),h=n.getBoundingClientRect(),u=new s(a.left,a.top-t,a.right,a.bottom-t).shifted(-h.left,-h.top);document.body.removeChild(n);var c=a.right-a.left;switch(this._textAlign){case"start":u=u.shiftedX(e?-c:0);break;case"end":u=u.shiftedX(e?0:-c);break;case"left":break;case"right":u=u.shiftedX(-c);break;case"center":u=u.shiftedX(-c/2)}return u},setFont:function(t){return this._font=t instanceof r.Font?t:new r.Font(t),this.invalidateText(),this},getFont:function(){return this._font.getFont()},setTextAlign:function(t){return this._textAlign=t,this.invalidateText(),this},getTextAlign:function(){return this._textAlign},setTextBaseline:function(t){return this._textBaseline=t,this.invalidateText(),this},getTextBaseline:function(){return this._textBaseline},setDirection:function(t){return this._direction=t,this.invalidateText(),this},getDirection:function(){return this._direction},hasSelf:function(){return!0}}),e("fontWeight","FontWeight","weight"),e("fontFamily","FontFamily","family"),e("fontStretch","FontStretch","stretch"),e("fontStyle","FontStyle","style"),e("fontSize","FontSize","size"),e("lineHeight","LineHeight","lineHeight"),u.prototype._mutatorKeys=["text","font","fontWeight","fontFamily","fontStretch","fontStyle","fontSize","lineHeight","textAlign","textBaseline","direction"].concat(o.prototype._mutatorKeys),u.prototype._supportedRenderers=[a.Canvas,a.SVG],Object.defineProperty(u.prototype,"font",{set:u.prototype.setFont,get:u.prototype.getFont}),Object.defineProperty(u.prototype,"text",{set:u.prototype.setText,get:u.prototype.getText}),Object.defineProperty(u.prototype,"textAlign",{set:u.prototype.setTextAlign,get:u.prototype.getTextAlign}),Object.defineProperty(u.prototype,"textBaseline",{set:u.prototype.setTextBaseline,get:u.prototype.getTextBaseline}),Object.defineProperty(u.prototype,"direction",{set:u.prototype.setDirection,get:u.prototype.getDirection}),h(u),u}),i("SCENERY/nodes/VBox",["require","SCENERY/scenery","SCENERY/nodes/Node","SCENERY/util/Util"],function(t){var e=t("SCENERY/scenery"),i=t("SCENERY/nodes/Node"),n=t("SCENERY/util/Util").objectCreate;e.VBox=function s(t){if(this.options=t=_.extend({spacing:function(){return 0},align:"center"},t),"number"==typeof t.spacing){var e=t.spacing;t.spacing=function(){return e}}i.call(this,t),this.updateLayout()};var s=e.VBox;return s.prototype=n(i.prototype),s.prototype.updateLayout=function(){for(var t=_.min(_.map(this.children,function(t){return t.x})),e=_.max(_.map(this.children,function(t){return t.x+t.width})),i=(e+t)/2,n=0,s=0;this.children.length>s;s++){var r=this.children[s];r.y=n,"left"===this.options.align?r.left=t:"right"===this.options.align?r.right=e:r.centerX=i,n+=r.height+this.options.spacing(r,this.children[s+1])}},s.prototype.constructor=s,s}),i("SCENERY/util/Color",["require","ASSERT/assert","SCENERY/scenery","DOT/Util"],function(t){function e(t){var e=1;return"%"===t.charAt(t.length-1)&&(e=2.55,t=t.slice(0,t.length-1)),Math.round(parseInt(t,10)*e)}t("ASSERT/assert")("scenery");var i=t("SCENERY/scenery"),n=t("DOT/Util").clamp;i.Color=function(t,e,i,n){if("string"==typeof t){var r=t.replace(/ /g,"").toLowerCase(),o=!1,a=s.colorKeywords[r];a&&(r="#"+a);for(var h=0;s.formatParsers.length>h;h++){var u=s.formatParsers[h],c=u.regexp.exec(r);if(c){u.apply(this,c),o=!0;break}}if(!o)throw Error("scenery.Color unable to parse color string: "+t)}else this.a=void 0===n?255:n,void 0===e||void 0===i?(this.r=t>>16&&255,this.g=t>>8&&255,this.b=t>>0&&255):(this.r=t,this.g=e,this.b=i)};var s=i.Color,r="(-?\\d{1,3}%?)",o="(\\d+|\\d*\\.\\d+)",a="(\\d{1,3})";return s.formatParsers=[{regexp:/^transparent$/,apply:function(t){t.setRGBA(0,0,0,0)}},{regexp:/^#(\w{1})(\w{1})(\w{1})$/,apply:function(t,e){t.setRGBA(parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),1)}},{regexp:/^#(\w{2})(\w{2})(\w{2})$/,apply:function(t,e){t.setRGBA(parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),1)}},{regexp:RegExp("^rgb\\("+r+","+r+","+r+"\\)$"),apply:function(t,i){t.setRGBA(e(i[1]),e(i[2]),e(i[3]),1)}},{regexp:RegExp("^rgba\\("+r+","+r+","+r+","+o+"\\)$"),apply:function(t,i){t.setRGBA(e(i[1]),e(i[2]),e(i[3]),parseFloat(i[4]))}},{regexp:RegExp("^hsl\\("+a+","+a+"%,"+a+"%\\)$"),apply:function(t,e){t.setHSLA(parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3],10),1)}},{regexp:RegExp("^hsla\\("+a+","+a+"%,"+a+"%,"+o+"\\)$"),apply:function(t,e){t.setHSLA(parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3],10),parseFloat(e[4]))}}],s.hueToRGB=function(t,e,i){return 0>i&&(i+=1),i>1&&(i-=1),1>6*i?t+6*(e-t)*i:1>2*i?e:2>3*i?t+6*(e-t)*(2/3-i):t},s.prototype={constructor:s,setRGBA:function(t,e,i,s){this.r=Math.round(n(t,0,255)),this.g=Math.round(n(e,0,255)),this.b=Math.round(n(i,0,255)),this.a=n(s,0,1)},getCSS:function(){if(1===this.a)return"rgb("+this.r+","+this.g+","+this.b+")";var t=0===this.a||1===this.a?this.a:this.a.toFixed(20);return"rgba("+this.r+","+this.g+","+this.b+","+t+")"},setHSLA:function(t,e,i,r){t=t%360/360,e=n(e/100,0,1),i=n(i/100,0,1);var o,a;a=.5>i?i*(e+1):i+e-i*e,o=2*i-a,this.r=Math.round(255*s.hueToRGB(o,a,t+1/3)),this.g=Math.round(255*s.hueToRGB(o,a,t)),this.b=Math.round(255*s.hueToRGB(o,a,t-1/3)),this.a=n(r,0,1)},equals:function(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a},withAlpha:function(t){return new s(this.r,this.g,this.b,t)},brighterColor:function(t){if(0>t||t>1)throw Error("factor must be between 0 and 1: "+t);var e=Math.min(255,this.r+Math.floor(t*(255-this.r))),i=Math.min(255,this.g+Math.floor(t*(255-this.g))),n=Math.min(255,this.b+Math.floor(t*(255-this.b)));return new s(e,i,n,this.a)},darkerColor:function(t){if(0>t||t>1)throw Error("factor must be between 0 and 1: "+t);var e=Math.max(0,this.r-Math.floor(t*this.r)),i=Math.max(0,this.g-Math.floor(t*this.g)),n=Math.max(0,this.b-Math.floor(t*this.b));return new s(e,i,n,this.a)}},s.basicColorKeywords={aqua:"00ffff",black:"000000",blue:"0000ff",fuchsia:"ff00ff",gray:"808080",green:"008000",lime:"00ff00",maroon:"800000",navy:"000080",olive:"808000",purple:"800080",red:"ff0000",silver:"c0c0c0",teal:"008080",white:"ffffff",yellow:"ffff00"},s.colorKeywords={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"},s.BLACK=new s(0,0,0),s.BLUE=new s(0,0,255),s.CYAN=new s(0,255,255),s.DARK_GRAY=new s(64,64,64),s.GRAY=new s(128,128,128),s.GREEN=new s(0,255,0),s.LIGHT_GRAY=new s(192,192,192),s.MAGENTA=new s(255,0,255),s.ORANGE=new s(255,200,0),s.PINK=new s(255,175,175),s.RED=new s(255,0,0),s.WHITE=new s(255,255,255),s.YELLOW=new s(255,255,0),s
}),i("SCENERY/util/LinearGradient",["require","ASSERT/assert","SCENERY/scenery","DOT/Vector2"],function(t){var e=t("ASSERT/assert")("scenery"),i=t("SCENERY/scenery"),n=t("DOT/Vector2");i.LinearGradient=function(t,i,s,r){e&&e(isFinite(t)&&isFinite(i)&&isFinite(s)&&isFinite(r));var o=void 0===r;o&&e&&e(t instanceof n&&i instanceof n,"If less than 4 parameters are given, the first two parameters must be Vector2"),this.start=o?t:new n(t,i),this.end=o?i:new n(s,r),this.stops=[],this.lastStopRatio=0,this.canvasGradient=document.createElement("canvas").getContext("2d").createLinearGradient(t,i,s,r),this.transformMatrix=null};var s=i.LinearGradient;return s.prototype={constructor:s,addColorStop:function(t,e){if(this.lastStopRatio>t)throw Error("Color stops not specified in the order of increasing ratios");return this.lastStopRatio=t,this.stops.push({ratio:t,color:e}),this.canvasGradient.addColorStop(t,e),this},setTransformMatrix:function(t){return this.transformMatrix=t,this},getCanvasStyle:function(){return this.canvasGradient},getSVGDefinition:function(t){var e="http://www.w3.org/2000/svg",n=document.createElementNS(e,"linearGradient");return n.setAttribute("id",t),n.setAttribute("gradientUnits","userSpaceOnUse"),n.setAttribute("x1",this.start.x),n.setAttribute("y1",this.start.y),n.setAttribute("x2",this.end.x),n.setAttribute("y2",this.end.y),this.transformMatrix&&n.setAttribute("gradientTransform",this.transformMatrix.getSVGTransform()),_.each(this.stops,function(t){var s=new i.Color(t.color),r=document.createElementNS(e,"stop");r.setAttribute("offset",t.ratio),r.setAttribute("style","stop-color: "+s.withAlpha(1).getCSS()+"; stop-opacity: "+s.a.toFixed(20)+";"),n.appendChild(r)}),n}},s}),i("SCENERY/util/Pattern",["require","ASSERT/assert","SCENERY/scenery","DOT/Vector2"],function(t){t("ASSERT/assert")("scenery");var e=t("SCENERY/scenery");t("DOT/Vector2"),e.Pattern=function(t){this.image=t,this.canvasPattern=document.createElement("canvas").getContext("2d").createPattern(t,"repeat"),this.transformMatrix=null};var i=e.Pattern;return i.prototype={constructor:i,setTransformMatrix:function(t){return this.transformMatrix=t,this},getCanvasStyle:function(){return this.canvasPattern},getSVGDefinition:function(t){var i="http://www.w3.org/2000/svg",n=document.createElementNS(i,"pattern");return n.setAttribute("id",t),n.setAttribute("patternUnits","userSpaceOnUse"),n.setAttribute("patternContentUnits","userSpaceOnUse"),n.setAttribute("x",0),n.setAttribute("y",0),n.setAttribute("width",this.image.width),n.setAttribute("height",this.image.height),this.transformMatrix&&n.setAttribute("patternTransform",this.transformMatrix.getSVGTransform()),n.appendChild(e.Image.createSVGImage(this.image.src,this.image.width,this.image.height)),n}},i}),i("SCENERY/util/RadialGradient",["require","ASSERT/assert","SCENERY/scenery","DOT/Vector2"],function(t){var e=t("ASSERT/assert")("scenery"),i=t("SCENERY/scenery"),n=t("DOT/Vector2");i.RadialGradient=function(t,i,s,r,o,a){this.start=new n(t,i),this.end=new n(r,o),this.startRadius=s,this.endRadius=a,this.focalPoint=this.start.plus(this.end.minus(this.start).times(this.startRadius/(this.startRadius-this.endRadius))),this.startRadius>=this.endRadius?e&&e(this.focalPoint.minus(this.start).magnitude()<=this.startRadius):e&&e(this.focalPoint.minus(this.end).magnitude()<=this.endRadius),this.stops=[],this.lastStopRatio=0,this.canvasGradient=document.createElement("canvas").getContext("2d").createRadialGradient(t,i,s,r,o,a),this.transformMatrix=null};var s=i.RadialGradient;return s.prototype={constructor:s,addColorStop:function(t,e){if(this.lastStopRatio>t)throw Error("Color stops not specified in the order of increasing ratios");return this.lastStopRatio=t,this.stops.push({ratio:t,color:e}),this.canvasGradient.addColorStop(t,e),this},setTransformMatrix:function(t){return this.transformMatrix=t,this},getCanvasStyle:function(){return this.canvasGradient},getSVGDefinition:function(t){function e(t,e,i,n,s){return i+(s-t)*(n-i)/(e-t)}function n(t){var n=s?1-t.ratio:t.ratio;a>0&&(n=e(0,1,a/o,1,n));var r=new i.Color(t.color),c=document.createElementNS(h,"stop");c.setAttribute("offset",n),c.setAttribute("style","stop-color: "+r.withAlpha(1).getCSS()+"; stop-opacity: "+r.a.toFixed(20)+";"),u.appendChild(c)}var s=this.startRadius>this.endRadius,r=s?this.start:this.end;s?this.end:this.start;var o=Math.max(this.startRadius,this.endRadius),a=Math.min(this.startRadius,this.endRadius),h="http://www.w3.org/2000/svg",u=document.createElementNS(h,"radialGradient");u.setAttribute("id",t),u.setAttribute("gradientUnits","userSpaceOnUse"),u.setAttribute("cx",r.x),u.setAttribute("cy",r.y),u.setAttribute("r",o),u.setAttribute("fx",this.focalPoint.x),u.setAttribute("fy",this.focalPoint.y),this.transformMatrix&&u.setAttribute("gradientTransform",this.transformMatrix.getSVGTransform());var c;if(s)for(c=this.stops.length-1;c>=0;c--)n(this.stops[c]);else for(c=0;this.stops.length>c;c++)n(this.stops[c]);return u}},s}),i("SCENERY/util/SceneImage",["require","ASSERT/assert","SCENERY/scenery"],function(t){t("ASSERT/assert")("scenery");var e=t("SCENERY/scenery");e.SceneImage=function(t){this.scene=t,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.img=document.createElement("img"),this.update()};var i=e.SceneImage;return i.prototype={constructor:i,update:function(t){var e=this;this.scene.updateScene(),this.canvas.width=this.scene.getSceneWidth(),this.canvas.height=this.scene.getSceneHeight(),this.scene.renderToCanvas(this.canvas,this.context,function(){var i=e.toDataURL();e.img.onload=function(){t(),delete e.img.onload},e.img.src=i})}},i}),i("SCENERY/util/TrailInterval",["require","ASSERT/assert","SCENERY/scenery","SCENERY/util/Trail"],function(t){var e=t("ASSERT/assert")("scenery"),i=t("SCENERY/scenery");t("SCENERY/util/Trail"),i.TrailInterval=function(t,i,n,s){e&&e(!t||!i||0>=t.compare(i),"TrailInterval parameters must not be out of order"),this.a=t,this.b=i,this.dataA=n,this.dataB=s};var n=i.TrailInterval;return n.prototype={constructor:n,reindex:function(){this.a&&this.a.reindex(),this.b&&this.b.reindex()},isValidExclusive:function(){return!this.a||!this.b||0>this.a.compare(this.b)},exclusiveUnionable:function(t){return e&&e(this.isValidExclusive(),"exclusiveUnionable requires exclusive intervals"),e&&e(t.isValidExclusive(),"exclusiveUnionable requires exclusive intervals"),!(this.a&&t.b&&-1!==this.a.compare(t.b)||this.b&&t.a&&1!==this.b.compare(t.a))},exclusiveContains:function(t){return e&&e(t),(!this.a||0>this.a.compare(t))&&(!this.b||this.b.compare(t)>0)},union:function(t){var e=!this.a||t.a&&-1===this.a.compare(t.a),i=!this.b||t.b&&1===this.b.compare(t.b);return new n(e?this.a:t.a,i?this.b:t.b,e?this.dataA:t.dataA,i?this.dataB:t.dataB)},toString:function(){return"["+(this.a?""+this.a:this.a)+","+(this.b?""+this.b:this.b)+"]"}},n}),i("SCENERY/Scene",["require","ASSERT/assert","DOT/Bounds2","DOT/Vector2","SCENERY/scenery","SCENERY/nodes/Node","SCENERY/util/Trail","SCENERY/util/TrailInterval","SCENERY/util/TrailPointer","SCENERY/input/Input","SCENERY/layers/LayerBuilder","SCENERY/layers/Renderer","SCENERY/util/Util"],function(t){function e(t,e){e.allowSceneOverflow||t.css("overflow","hidden"),t.css("-ms-touch-action","none"),e.allowCSSHacks&&function(){var e=["-webkit-","-moz-","-ms-","-o-",""],i={userSelect:"none",touchCallout:"none",touchAction:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"};_.each(e,function(e){_.each(i,function(i,n){t.css(e+n,i)})})}()}var i=t("ASSERT/assert")("scenery"),n=t("DOT/Bounds2"),s=t("DOT/Vector2"),r=t("SCENERY/scenery"),o=t("SCENERY/nodes/Node");t("SCENERY/util/Trail"),t("SCENERY/util/TrailInterval"),t("SCENERY/util/TrailPointer"),t("SCENERY/input/Input"),t("SCENERY/layers/LayerBuilder"),t("SCENERY/layers/Renderer");var a=t("SCENERY/util/Util"),h=a.objectCreate;r.Scene=function u(t,s){i&&i(t[0],"A main container is required for a scene"),s=_.extend({allowSceneOverflow:!1,allowCSSHacks:!0,allowDevicePixelRatioScaling:!1,enablePointerEvents:!0,preferredSceneLayerType:r.CanvasDefaultLayerType,width:t.width(),height:t.height()},s||{}),this.backingScale=s.allowDevicePixelRatioScaling?a.backingScale(document.createElement("canvas").getContext("2d")):1,this.enablePointerEvents=s.enablePointerEvents,o.call(this,s);var h=this;window.debugScene=h,this.layers=[],this.layerChangeIntervals=[],this.lastCursor=null,this.defaultCursor=t.css("cursor"),this.$main=t,this.setSize(s.width,s.height),this.sceneBounds=new n(0,0,t.width(),t.height()),this.preferredSceneLayerType=s.preferredSceneLayerType,e(t,s),this.sceneEventListener={markForLayerRefresh:function(t){h.markInterval(t.trail)},markForInsertion:function(t){var e=t.trail.copy().addDescendant(t.child);h.markInterval(e)},markForRemoval:function(t){var e=t.trail.copy().addDescendant(t.child);h.markInterval(e),e.eachTrailUnder(function(t){t.lastNode().hasSelf()&&h.layerLookup(t).removeNodeFromTrail(t)})},stitch:function(t){h.stitch(t.match)},dirtyBounds:function(t){var e=t.trail;h.layers.length&&_.each(h.affectedLayers(e),function(e){e.markDirtyRegion(t)})},transform:function(t){var e=t.trail;h.layers.length&&_.each(h.affectedLayers(e),function(e){e.transformChange(t)})}},this.addEventListener(this.sceneEventListener)};var u=r.Scene;return u.prototype=h(o.prototype),u.prototype.constructor=u,u.prototype.updateScene=function(t){if(this.validateBounds(),this.validatePaint(),this.layers.length){var e=this;_.each(this.layers,function(i){i.render(e,t)}),this.updateCursor()}},u.prototype.renderScene=function(){this.updateScene()},u.prototype.markInterval=function(t){for(var e=t.previousSelf(),i=new r.TrailPointer(t.copy(),!1);i.hasTrail()&&(!i.isBefore||!i.trail.lastNode().hasSelf());)i.nestedForwards();var n=i.trail;this.addLayerChangeInterval(new r.TrailInterval(e,n,e?this.layerLookup(e):null,n?this.layerLookup(n):null))},u.prototype.addLayerChangeInterval=function(t){for(var e=0;this.layerChangeIntervals.length>e;e++){var i=this.layerChangeIntervals[e];i.reindex(),t.exclusiveUnionable(i)&&(t=t.union(i),this.layerChangeIntervals.splice(e,1))}this.layerChangeIntervals.push(t)},u.prototype.createAndAddLayer=function(t,e,i,n){var s=t.createLayer(_.extend({startBoundary:i,endBoundary:n},e));return s.type=t,this.insertLayer(s),s},u.prototype.insertLayer=function(t){for(var e=0;this.layers.length>e&&!this.layers[e].endBoundary.equivalentNextTrail(t.startBoundary.nextSelfTrail);e++);this.layers.length>e?this.layers.splice(e+1,0,t):this.layers.push(t)},u.prototype.calculateBoundaries=function(t,e,i){var n=new r.LayerBuilder(this,t,e,i);return this.preferredSceneLayerType&&n.pushPreferredLayerType(this.preferredSceneLayerType),n.run(),n.boundaries},u.prototype.stitch=function(t){var e=this,i={},n={$main:this.$main,scene:this,baseNode:this};this.layerChangeIntervals.sort(function(t,e){return t.a.compare(e.a)}),_.each(this.layerChangeIntervals,function(s){s.reindex();for(var r=s.a,o=s.b,a=s.dataA,h=s.dataB;a&&i[a.getId()];)a=i[a.getId()];for(;h&&i[h.getId()];)h=i[h.getId()];var u=e.calculateBoundaries(a?a.type:null,r,o);t?e.rebuildLayers():e.stitchInterval(i,n,r,o,a,h,u,t)}),this.layerChangeIntervals=[],this.reindexLayers()},u.prototype.stitchInterval=function(t,e,n,s,o,a,h){function u(){_.each(w,function(t){C.addNodeFromTrail(t)}),w=[]}function c(t){_.contains(D,t)||D.push(a)}function l(t,n){E&&E.equivalentPreviousTrail(b)&&(i&&i(E.equivalentNextTrail(t)),C||I?(C?C.setEndBoundary(E):(i&&i(I),C=p.createAndAddLayer(R,e,I,E)),i&&i(C.startSelfTrail),i&&i(C.endSelfTrail),u()):i&&i(0===w.length),C=null,R=E.nextLayerType,I=E,x++,E=h[x]),t&&!n&&w.push(t),b=t}function d(){}function m(t){l(t,!1)}function f(n){l(n,!0),o!==a&&0===h.length?(o.setEndBoundary(a.endBoundary),c(a),C=o,u(),_.each(a._layerTrails.slice(0),function(t){t.reindex(),a.removeNodeFromTrail(t),o.addNodeFromTrail(t)}),t[a.getId()]=o):o&&o===a&&h.length>0?(i&&i(I),C=p.createAndAddLayer(R,e,I,g),t[a.getId()]=C,u(),r.Trail.eachSelfTrailbetween(s,C.endSelfTrail,function(t){t.reindex(),a.removeNodeFromTrail(t),C.addNodeFromTrail(t)},!1,p)):(o||a||1!==h.length||h[0].hasNext()||h[0].hasPrevious())&&(C=a,C&&I&&C.setStartBoundary(I),u()),_.each(D,function(t){p.disposeLayer(t)})}for(var p=this,g=a?a.endBoundary:null,y=o?_.indexOf(this.layers,o):-1,v=a?_.indexOf(this.layers,a):this.layers.length,T=n?new r.TrailPointer(n,!0):new r.TrailPointer(new r.Trail(this),!0),S=s?new r.TrailPointer(s,!0):new r.TrailPointer(new r.Trail(this),!1),x=0,E=h[x],w=[],b=n,C=o,R=o?o.type:null,I=null,D=[],A=y+1;v>A;A++)D.push(this.layers[A]);d(n),T.eachTrailBetween(S,function(t){!t.lastNode().hasSelf()||n&&t.equals(n)||m(t.copy())}),f(s)},u.prototype.rebuildLayers=function(){this.disposeLayers(),this.boundaries=this.calculateBoundaries(null,null,null);var t={$main:this.$main,scene:this,baseNode:this};this.layers=[];for(var e=1;this.boundaries.length>e;e++){var n=this.boundaries[e-1],s=this.boundaries[e];i&&i(n.nextLayerType===s.previousLayerType);var r=n.nextLayerType,o=r.createLayer(_.extend({startBoundary:n,endBoundary:s},t));o.type=r,o.startPointer.eachTrailBetween(o.endPointer,function(t){t.lastNode().hasSelf()&&o.addNodeFromTrail(t)}),this.layers.push(o)}},u.prototype.reindexLayers=function(){var t=1;_.each(this.layers,function(e){t=e.reindex(t)})},u.prototype.dispose=function(){this.disposeLayers()},u.prototype.disposeLayer=function(t){t.dispose(),this.layers.splice(_.indexOf(this.layers,t),1)},u.prototype.disposeLayers=function(){var t=this;_.each(this.layers.slice(0),function(e){t.disposeLayer(e)})},u.prototype.layerLookup=function(t){if(i&&i(!(t.isEmpty()||t.nodes[0]!==this),"layerLookup root matches"),i&&i(t.lastNode().hasSelf(),"layerLookup only supports nodes with hasSelf(), as this guarantees an unambiguous answer"),0===this.layers.length)return null;for(var e=0;this.layers.length>e;e++){var n=this.layers[e];if(n.startSelfTrail&&n.startSelfTrail.reindex(),n.endSelfTrail&&n.endSelfTrail.reindex(),!n.endSelfTrail||0>=t.compare(n.endSelfTrail))return!n.startSelfTrail||t.compare(n.startSelfTrail)>=0?n:null}return null},u.prototype.affectedLayers=function(t){var e=[];if(i&&i(!(t.isEmpty()||t.nodes[0]!==this),"layerLookup root matches"),0===this.layers.length)throw Error("no layers in the scene");for(var n=new r.TrailPointer(t,!0),s=new r.TrailPointer(t,!1),o=0;this.layers.length>o;o++){var a=this.layers[o],h=-1!==s.compareNested(new r.TrailPointer(a.startSelfTrail,!0)),u=1!==n.compareNested(new r.TrailPointer(a.endSelfTrail,!0));h&&u&&e.push(a)}return e},u.prototype.renderToCanvas=function(t,e,i){var n=0,s=!1,r={increment:function(){n++},decrement:function(){n--,0===n&&i&&s&&i()}};e.clearRect(0,0,t.width,t.height),_.each(this.layers,function(i){i.renderToCanvas(t,e,r)}),0===n?i&&i():s=!0},u.prototype.canvasDataURL=function(t){this.canvasSnapshot(function(e){t(e.toDataURL())})},u.prototype.canvasSnapshot=function(t){var e=document.createElement("canvas");e.width=this.sceneBounds.getWidth(),e.height=this.sceneBounds.getHeight();var i=e.getContext("2d");this.renderToCanvas(e,i,function(){t(e,i.getImageData(0,0,e.width,e.height))})},u.prototype.setSize=function(t,e){this.$main.width(t),this.$main.height(e),this.$main.css("clip","rect(0px,"+t+"px,"+e+"px,0px)"),this.sceneBounds=new n(0,0,t,e)},u.prototype.resize=function(t,e){this.setSize(t,e),this.rebuildLayers()},u.prototype.getSceneWidth=function(){return this.sceneBounds.getWidth()},u.prototype.getSceneHeight=function(){return this.sceneBounds.getHeight()},u.prototype.updateCursor=function(){if(this.input&&this.input.mouse.point){var t=this.trailUnderPoint(this.input.mouse.point);if(t)for(var e=t.length-1;e>=0;e--){var i=t.nodes[e].getCursor();if(i)return this.setSceneCursor(i),void 0}}this.setSceneCursor(this.defaultCursor)},u.prototype.setSceneCursor=function(t){t!==this.lastCursor&&(this.lastCursor=t,this.$main.css("cursor",t))},u.prototype.updateOnRequestAnimationFrame=function(t){var e=this;(function i(){window.requestAnimationFrame(i,t),e.updateScene()})()},u.prototype.initializeStandaloneEvents=function(t){var e=this.$main[0];this.initializeEvents(_.extend({},{listenerTarget:e,pointFromEvent:function(t){var i=e.getBoundingClientRect();return new s(t.clientX-i.left,t.clientY-i.top)}},t))},u.prototype.initializeFullscreenEvents=function(t){var e=this.$main[0];this.initializeEvents(_.extend({},{listenerTarget:document,pointFromEvent:function(t){var i=e.getBoundingClientRect();return new s(t.clientX-i.left,t.clientY-i.top)}},t))},u.prototype.initializeEvents=function(t){function e(t){return t.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_TOUCH?"touch":t.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_PEN?"pen":t.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_MOUSE?"mouse":t.pointerType}function i(t,e){for(var i=0;t.changedTouches.length>i;i++){var n=t.changedTouches.item(i);e(n.identifier,s(n))}}var n=this;if(n.input)throw Error("Attempt to attach events twice to the scene");var s=t.pointFromEvent,o=t.listenerTarget,a=new r.Input(n,o);n.input=a;var h=window.navigator&&window.navigator.pointerEnabled,u=window.navigator&&window.navigator.msPointerEnabled;this.enablePointerEvents&&h?(a.addListener("pointerdown",function(t){a.pointerDown(t.pointerId,t.pointerType,s(t),t)}),a.addListener("pointerup",function(t){a.pointerUp(t.pointerId,t.pointerType,s(t),t)}),a.addListener("pointermove",function(t){a.pointerMove(t.pointerId,t.pointerType,s(t),t)}),a.addListener("pointerover",function(t){a.pointerOver(t.pointerId,t.pointerType,s(t),t)}),a.addListener("pointerout",function(t){a.pointerOut(t.pointerId,t.pointerType,s(t),t)}),a.addListener("pointercancel",function(t){a.pointerCancel(t.pointerId,t.pointerType,s(t),t)})):this.enablePointerEvents&&u?(a.addListener("MSPointerDown",function(t){a.pointerDown(t.pointerId,e(t),s(t),t)}),a.addListener("MSPointerUp",function(t){a.pointerUp(t.pointerId,e(t),s(t),t)}),a.addListener("MSPointerMove",function(t){a.pointerMove(t.pointerId,e(t),s(t),t)}),a.addListener("MSPointerOver",function(t){a.pointerOver(t.pointerId,e(t),s(t),t)}),a.addListener("MSPointerOut",function(t){a.pointerOut(t.pointerId,e(t),s(t),t)}),a.addListener("MSPointerCancel",function(t){a.pointerCancel(t.pointerId,e(t),s(t),t)})):(a.addListener("mousedown",function(t){a.mouseDown(s(t),t)}),a.addListener("mouseup",function(t){a.mouseUp(s(t),t)}),a.addListener("mousemove",function(t){a.mouseMove(s(t),t)}),a.addListener("mouseover",function(t){a.mouseOver(s(t),t)}),a.addListener("mouseout",function(t){a.mouseOut(s(t),t)}),a.addListener("touchstart",function(t){i(t,function(e,i){a.touchStart(e,i,t)})}),a.addListener("touchend",function(t){i(t,function(e,i){a.touchEnd(e,i,t)})}),a.addListener("touchmove",function(t){i(t,function(e,i){a.touchMove(e,i,t)})}),a.addListener("touchcancel",function(t){i(t,function(e,i){a.touchCancel(e,i,t)})}))},u.prototype.resizeOnWindowResize=function(){var t=this,e=function(){t.resize(window.innerWidth,window.innerHeight)};$(window).resize(e),e()},u.prototype.layerAudit=function(){var t=this,e=this.calculateBoundaries(null,null,null);i&&i(e.length===this.layers.length+1);var n=0;new r.Trail(this).eachTrailUnder(function(t){t.lastNode().hasSelf()&&n++});var s=0;_.each(this.layers,function(t){s+=t.getLayerTrails().length});var o=0;return _.each(this.layers,function(e){var n=0;r.Trail.eachSelfTrailbetween(e.startSelfTrail,e.endSelfTrail,function(){n++},!1,t),i&&i(n>0,"every layer must have at least one self trail"),o+=n}),i&&i(n===s,"cross-referencing self trail counts: layerSelfCount, "+n+" vs "+s),i&&i(n===o,"cross-referencing self trail counts: layerIterationSelfCount, "+n+" vs "+o),_.each(this.layers,function(t){var e=t.startSelfTrail,n=t.endSelfTrail;i&&i(0>=e.compare(n),"proper ordering on layer trails")}),!0},u.prototype.getDebugHTML=function(){function t(t){return t?""+t:t}var e=new r.TrailPointer(new r.Trail(this),!0),i=new r.TrailPointer(new r.Trail(this),!1),n=0,s="",o=[];return _.each(this.layers,function(e){e.startPointer&&e.startPointer.trail&&e.startPointer.trail.reindex(),e.endPointer&&e.endPointer.trail&&e.endPointer.trail.reindex();var i=t(e.startPointer),n=t(e.endPointer);o[i]||(o[i]=""),o[n]||(o[n]=""),e.startSelfTrail.reindex(),e.endSelfTrail.reindex();var s=e.getId()+" <strong>"+e.type.name+"</strong>"+" trails: "+(e.startSelfTrail?t(e.startSelfTrail):e.startSelfTrail)+","+(e.endSelfTrail?t(e.endSelfTrail):e.endSelfTrail)+" pointers: "+t(e.startPointer)+","+t(e.endPointer);o[i]+='<div style="color: #080">+Layer '+s+"</div>",o[n]+='<div style="color: #800">-Layer '+s+"</div>"}),e.depthFirstUntil(i,function(e){function i(t){r+=' <span style="color: #008">'+t+"</span>"}var r,a=t(e),h=e.trail.lastNode();o[a]&&(s+=o[a]),e.isBefore&&(r='<div style="margin-left: '+20*n+'px">',h.constructor.name&&(r+=" "+h.constructor.name),r+=' <span style="font-weight: '+(h.hasSelf()?"bold":"normal")+'">'+e.trail.lastNode().getId()+"</span>",r+=' <span style="color: #888">'+t(e.trail)+"</span>",h._visible||i("invisible"),h._pickable||i("unpickable"),h._clipShape&&i("clipShape"),h._renderer&&i("renderer:"+h._renderer.name),h._rendererOptions&&i("rendererOptions:"+_.each(h._rendererOptions,function(e,i){return i+":"+t(e)}).join(",")),h._layerSplitBefore&&i("layerSplitBefore"),h._layerSplitAfter&&i("layerSplitAfter"),r+="</div>",s+=r),n+=e.isBefore?1:-1},!1),s},u.prototype.popupDebug=function(){var t='<!DOCTYPE html><html lang="en"><head><title>Scenery Debug Snapshot</title></head><body>'+this.getDebugHTML()+"</body>"+"</html>";window.open("data:text/html;charset=utf-8,"+encodeURIComponent(t))},u}),i("main",["SCENERY/scenery","SCENERY/debug/DebugContext","SCENERY/input/Event","SCENERY/input/Input","SCENERY/input/Key","SCENERY/input/Mouse","SCENERY/input/Pen","SCENERY/input/Pointer","SCENERY/input/SimpleDragHandler","SCENERY/input/Touch","SCENERY/layers/CanvasLayer","SCENERY/layers/DOMLayer","SCENERY/layers/Layer","SCENERY/layers/LayerBoundary","SCENERY/layers/LayerBuilder","SCENERY/layers/LayerStrategy","SCENERY/layers/LayerType","SCENERY/layers/Renderer","SCENERY/layers/SVGLayer","SCENERY/nodes/DOM","SCENERY/nodes/Fillable","SCENERY/nodes/HBox","SCENERY/nodes/Image","SCENERY/nodes/Node","SCENERY/nodes/Path","SCENERY/nodes/Strokable","SCENERY/nodes/Text","SCENERY/nodes/VBox","SCENERY/util/Color","SCENERY/util/Font","SCENERY/util/LinearGradient","SCENERY/util/Pattern","SCENERY/util/RadialGradient","SCENERY/util/RenderState","SCENERY/util/SceneImage","SCENERY/util/Trail","SCENERY/util/TrailInterval","SCENERY/util/TrailPointer","SCENERY/util/Util","SCENERY/Scene"],function(t){return t}),i("KITE/main",["KITE/kite","KITE/Shape","KITE/pieces/Arc","KITE/pieces/Close","KITE/pieces/CubicCurveTo","KITE/pieces/EllipticalArc","KITE/pieces/LineTo","KITE/pieces/MoveTo","KITE/pieces/Piece","KITE/pieces/QuadraticCurveTo","KITE/pieces/Rect","KITE/segments/Arc","KITE/segments/Cubic","KITE/segments/EllipticalArc","KITE/segments/Line","KITE/segments/Quadratic","KITE/segments/Segment","KITE/util/LineStyles","KITE/util/Subpath"],function(t){return t}),i("DOT/ConvexHull2",["require","ASSERT/assert","DOT/dot"],function(t){function e(t,e,i){return e.minus(t).crossScalar(i.minus(t))}t("ASSERT/assert")("dot");var i=t("DOT/dot");return i.ConvexHull2={grahamScan:function(t,i){if(2>=t.length)return t;var n=Number.POSITIVE_INFINITY,s=null;_.each(t,function(t){n>=t.y&&(t.y===n&&s?t.x<s.x&&(s=t):(n=t.y,s=t))}),t=_.sortBy(t,function(t){return t.minus(s).angle()}),t.splice(_.indexOf(t,s),1);var r=[s];return _.each(t,function(t){function n(){if(2>r.length)return!1;var n=e(r[r.length-2],r[r.length-1],t);return i?0>n:0>=n}if(s.x!==t.x||s.y!==t.y){for(;n();)r.pop();r.push(t)}}),r}},i.ConvexHull2}),i("DOT/Dimension2",["require","DOT/dot"],function(t){var e=t("DOT/dot");e.Dimension2=function(t,e){this.width=t,this.height=e};var i=e.Dimension2;return i.prototype={constructor:i,toString:function(){return"["+this.width+"w, "+this.height+"h]"},equals:function(t){return this.width===t.width&&this.height===t.height}},i}),i("DOT/LUDecomposition",["require","DOT/dot"],function(t){var e=t("DOT/dot"),i=window.Float32Array||Array;e.LUDecomposition=function(t){var e,n,s;this.matrix=t,this.LU=t.getArrayCopy();var r=this.LU;this.m=t.getRowDimension();var o=this.m;this.n=t.getColumnDimension();var a=this.n;for(this.piv=new Uint32Array(o),e=0;o>e;e++)this.piv[e]=e;this.pivsign=1;var h=new i(o);for(n=0;a>n;n++){for(e=0;o>e;e++)h[e]=r[t.index(e,n)];for(e=0;o>e;e++){var u=Math.min(e,n),c=0;for(s=0;u>s;s++){var l=t.index(e,s);c+=r[l]*h[s]}h[e]-=c,r[t.index(e,n)]=h[e]}var d=n;for(e=n+1;o>e;e++)Math.abs(h[e])>Math.abs(h[d])&&(d=e);if(d!==n){for(s=0;a>s;s++){var m=t.index(d,s),f=t.index(n,s),p=r[m];r[m]=r[f],r[f]=p}s=this.piv[d],this.piv[d]=this.piv[n],this.piv[n]=s,this.pivsign=-this.pivsign}if(o>n&&0!==r[this.matrix.index(n,n)])for(e=n+1;o>e;e++)r[t.index(e,n)]/=r[t.index(n,n)]}};var n=e.LUDecomposition;return n.prototype={constructor:n,isNonsingular:function(){for(var t=0;this.n>t;t++){var e=this.matrix.index(t,t);if(0===this.LU[e])return!1}return!0},getL:function(){for(var t=new e.Matrix(this.m,this.n),i=0;this.m>i;i++)for(var n=0;this.n>n;n++)t.entries[t.index(i,n)]=i>n?this.LU[this.matrix.index(i,n)]:i===n?1:0;return t},getU:function(){for(var t=new e.Matrix(this.n,this.n),i=0;this.n>i;i++)for(var n=0;this.n>n;n++)t.entries[t.index(i,n)]=n>=i?this.LU[this.matrix.index(i,n)]:0;return t},getPivot:function(){for(var t=new Uint32Array(this.m),e=0;this.m>e;e++)t[e]=this.piv[e];return t},getDoublePivot:function(){for(var t=new i(this.m),e=0;this.m>e;e++)t[e]=this.piv[e];return t},det:function(){if(this.m!==this.n)throw Error("Matrix must be square.");for(var t=this.pivsign,e=0;this.n>e;e++)t*=this.LU[this.matrix.index(e,e)];return t},solve:function(t){var e,i,n;if(t.getRowDimension()!==this.m)throw Error("Matrix row dimensions must agree.");if(!this.isNonsingular())throw Error("Matrix is singular.");var s=t.getColumnDimension(),r=t.getArrayRowMatrix(this.piv,0,s-1);for(n=0;this.n>n;n++)for(e=n+1;this.n>e;e++)for(i=0;s>i;i++)r.entries[r.index(e,i)]-=r.entries[r.index(n,i)]*this.LU[this.matrix.index(e,n)];for(n=this.n-1;n>=0;n--){for(i=0;s>i;i++)r.entries[r.index(n,i)]/=this.LU[this.matrix.index(n,n)];for(e=0;n>e;e++)for(i=0;s>i;i++)r.entries[r.index(e,i)]-=r.entries[r.index(n,i)]*this.LU[this.matrix.index(e,n)]}return r}},n}),i("PHET_CORE/isArray",["require"],function(){return function(t){return"[object Array]"===Object.prototype.toString.call(t)}}),i("DOT/SingularValueDecomposition",["require","DOT/dot"],function(t){var e=t("DOT/dot"),i=window.Float32Array||Array;e.SingularValueDecomposition=function(t){this.matrix=t;var n=t,s=n.getArrayCopy();this.m=n.getRowDimension(),this.n=n.getColumnDimension();var r=this.m,o=this.n,a=Math.min,h=Math.max,u=Math.pow,c=Math.abs,l=a(r,o);this.s=new i(a(r+1,o));var d=this.s;this.U=new i(r*l);var m=this.U;this.V=new i(o*o);var f,p,g,y,v,T,S,x=this.V,E=new i(o),w=new i(r),b=!0,C=!0,R=e.Matrix.hypot,_=a(r-1,o),I=h(0,a(o-2,r));for(g=0;h(_,I)>g;g++){if(_>g){for(d[g]=0,f=g;r>f;f++)d[g]=R(d[g],s[f*o+g]);if(0!==d[g]){for(0>s[g*o+g]&&(d[g]=-d[g]),f=g;r>f;f++)s[f*o+g]/=d[g];s[g*o+g]+=1}d[g]=-d[g]}for(p=g+1;o>p;p++){if(_>g&&0!==d[g]){for(y=0,f=g;r>f;f++)y+=s[f*o+g]*s[f*o+p];for(y=-y/s[g*o+g],f=g;r>f;f++)s[f*o+p]+=y*s[f*o+g]}E[p]=s[g*o+p]}if(b&&_>g)for(f=g;r>f;f++)m[f*l+g]=s[f*o+g];if(I>g){for(E[g]=0,f=g+1;o>f;f++)E[g]=R(E[g],E[f]);if(0!==E[g]){for(0>E[g+1]&&(E[g]=-E[g]),f=g+1;o>f;f++)E[f]/=E[g];E[g+1]+=1}if(E[g]=-E[g],r>g+1&&0!==E[g]){for(f=g+1;r>f;f++)w[f]=0;for(p=g+1;o>p;p++)for(f=g+1;r>f;f++)w[f]+=E[p]*s[f*o+p];for(p=g+1;o>p;p++)for(y=-E[p]/E[g+1],f=g+1;r>f;f++)s[f*o+p]+=y*w[f]}if(C)for(f=g+1;o>f;f++)x[f*o+g]=E[f]}}var D=a(o,r+1);if(o>_&&(d[_]=s[_*o+_]),D>r&&(d[D-1]=0),D>I+1&&(E[I]=s[I*o+D-1]),E[D-1]=0,b){for(p=_;l>p;p++){for(f=0;r>f;f++)m[f*l+p]=0;m[p*l+p]=1}for(g=_-1;g>=0;g--)if(0!==d[g]){for(p=g+1;l>p;p++){for(y=0,f=g;r>f;f++)y+=m[f*l+g]*m[f*l+p];for(y=-y/m[g*l+g],f=g;r>f;f++)m[f*l+p]+=y*m[f*l+g]}for(f=g;r>f;f++)m[f*l+g]=-m[f*l+g];for(m[g*l+g]=1+m[g*l+g],f=0;g-1>f;f++)m[f*l+g]=0}else{for(f=0;r>f;f++)m[f*l+g]=0;m[g*l+g]=1}}if(C)for(g=o-1;g>=0;g--){if(I>g&&0!==E[g])for(p=g+1;l>p;p++){for(y=0,f=g+1;o>f;f++)y+=x[f*o+g]*x[f*o+p];for(y=-y/x[g+1*o+g],f=g+1;o>f;f++)x[f*o+p]+=y*x[f*o+g]}for(f=0;o>f;f++)x[f*o+g]=0;x[g*o+g]=1}for(var A=D-1,N=0,P=u(2,-52),M=u(2,-966);D>0;){var O;for(g=D-2;g>=-1&&-1!==g;g--)if(c(E[g])<=M+P*(c(d[g])+c(d[g+1]))){E[g]=0;break}if(g===D-2)O=4;else{var L;for(L=D-1;L>=g&&L!==g;L--)if(y=(L!==D?c(E[L]):0)+(L!==g+1?c(E[L-1]):0),M+P*y>=c(d[L])){d[L]=0;break}L===g?O=3:L===D-1?O=1:(O=2,g=L)}switch(g++,O){case 1:for(v=E[D-2],E[D-2]=0,p=D-2;p>=g;p--)if(y=R(d[p],v),T=d[p]/y,S=v/y,d[p]=y,p!==g&&(v=-S*E[p-1],E[p-1]=T*E[p-1]),C)for(f=0;o>f;f++)y=T*x[f*o+p]+S*x[f*o+D-1],x[f*o+D-1]=-S*x[f*o+p]+T*x[f*o+D-1],x[f*o+p]=y;break;case 2:for(v=E[g-1],E[g-1]=0,p=g;D>p;p++)if(y=R(d[p],v),T=d[p]/y,S=v/y,d[p]=y,v=-S*E[p],E[p]=T*E[p],b)for(f=0;r>f;f++)y=T*m[f*l+p]+S*m[f*l+g-1],m[f*l+g-1]=-S*m[f*l+p]+T*m[f*l+g-1],m[f*l+p]=y;break;case 3:var Y=h(h(h(h(c(d[D-1]),c(d[D-2])),c(E[D-2])),c(d[g])),c(E[g])),B=d[D-1]/Y,k=d[D-2]/Y,V=E[D-2]/Y,F=d[g]/Y,z=E[g]/Y,X=((k+B)*(k-B)+V*V)/2,q=B*V*B*V,K=0;(0!==X||0!==q)&&(K=Math.sqrt(X*X+q),0>X&&(K=-K),K=q/(X+K)),v=(F+B)*(F-B)+K;var G=F*z;for(p=g;D-1>p;p++){if(y=R(v,G),T=v/y,S=G/y,p!==g&&(E[p-1]=y),v=T*d[p]+S*E[p],E[p]=T*E[p]-S*d[p],G=S*d[p+1],d[p+1]=T*d[p+1],C)for(f=0;o>f;f++)y=T*x[f*o+p]+S*x[f*o+p+1],x[f*o+p+1]=-S*x[f*o+p]+T*x[f*o+p+1],x[f*o+p]=y;if(y=R(v,G),T=v/y,S=G/y,d[p]=y,v=T*E[p]+S*d[p+1],d[p+1]=-S*E[p]+T*d[p+1],G=S*E[p+1],E[p+1]=T*E[p+1],b&&r-1>p)for(f=0;r>f;f++)y=T*m[f*l+p]+S*m[f*l+p+1],m[f*l+p+1]=-S*m[f*l+p]+T*m[f*l+p+1],m[f*l+p]=y}E[D-2]=v,N+=1;break;case 4:if(0>=d[g]&&(d[g]=0>d[g]?-d[g]:0,C))for(f=0;A>=f;f++)x[f*o+g]=-x[f*o+g];for(;A>g&&!(d[g]>=d[g+1]);){if(y=d[g],d[g]=d[g+1],d[g+1]=y,C&&o-1>g)for(f=0;o>f;f++)y=x[f*o+g+1],x[f*o+g+1]=x[f*o+g],x[f*o+g]=y;if(b&&r-1>g)for(f=0;r>f;f++)y=m[f*l+g+1],m[f*l+g+1]=m[f*l+g],m[f*l+g]=y;g++}N=0,D--}}};var n=e.SingularValueDecomposition;n.prototype={constructor:n,getU:function(){return new e.Matrix(this.m,Math.min(this.m+1,this.n),this.U,!0)},getV:function(){return new e.Matrix(this.n,this.n,this.V,!0)},getSingularValues:function(){return this.s},getS:function(){for(var t=new e.Matrix(this.n,this.n),i=0;this.n>i;i++){for(var n=0;this.n>n;n++)t.entries[t.index(i,n)]=0;t.entries[t.index(i,i)]=this.s[i]}return t},norm2:function(){return this.s[0]},cond:function(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]},rank:function(){for(var t=Math.pow(2,-23),e=Math.max(this.m,this.n)*this.s[0]*t,i=0,n=0;this.s.length>n;n++)this.s[n]>e&&i++;return i}}}),i("DOT/QRDecomposition",["require","DOT/dot"],function(t){var e=t("DOT/dot"),i=window.Float32Array||Array;e.QRDecomposition=function(t){this.matrix=t,this.QR=t.getArrayCopy();var n=this.QR;this.m=t.getRowDimension();var s=this.m;this.n=t.getColumnDimension();var r=this.n;this.Rdiag=new i(r);var o,a,h;for(h=0;r>h;h++){var u=0;for(o=h;s>o;o++)u=e.Matrix.hypot(u,n[this.matrix.index(o,h)]);if(0!==u){for(0>n[this.matrix.index(h,h)]&&(u=-u),o=h;s>o;o++)n[this.matrix.index(o,h)]/=u;for(n[this.matrix.index(h,h)]+=1,a=h+1;r>a;a++){var c=0;for(o=h;s>o;o++)c+=n[this.matrix.index(o,h)]*n[this.matrix.index(o,a)];for(c=-c/n[this.matrix.index(h,h)],o=h;s>o;o++)n[this.matrix.index(o,a)]+=c*n[this.matrix.index(o,h)]}}this.Rdiag[h]=-u}};var n=e.QRDecomposition;return n.prototype={constructor:n,isFullRank:function(){for(var t=0;this.n>t;t++)if(0===this.Rdiag[t])return!1;return!0},getH:function(){for(var t=new e.Matrix(this.m,this.n),i=0;this.m>i;i++)for(var n=0;this.n>n;n++)t.entries[t.index(i,n)]=i>=n?this.QR[this.matrix.index(i,n)]:0;return t},getR:function(){for(var t=new e.Matrix(this.n,this.n),i=0;this.n>i;i++)for(var n=0;this.n>n;n++)t.entries[t.index(i,n)]=n>i?this.QR[this.matrix.index(i,n)]:i===n?this.Rdiag[i]:0;return t},getQ:function(){var t,i,n,s=new e.Matrix(this.m,this.n);for(n=this.n-1;n>=0;n--){for(t=0;this.m>t;t++)s.entries[s.index(t,n)]=0;
for(s.entries[s.index(n,n)]=1,i=n;this.n>i;i++)if(0!==this.QR[this.matrix.index(n,n)]){var r=0;for(t=n;this.m>t;t++)r+=this.QR[this.matrix.index(t,n)]*s.entries[s.index(t,i)];for(r=-r/this.QR[this.matrix.index(n,n)],t=n;this.m>t;t++)s.entries[s.index(t,i)]+=r*this.QR[this.matrix.index(t,n)]}}return s},solve:function(t){if(t.getRowDimension()!==this.m)throw Error("Matrix row dimensions must agree.");if(!this.isFullRank())throw Error("Matrix is rank deficient.");var i,n,s,r=t.getColumnDimension(),o=t.getArrayCopy();for(s=0;this.n>s;s++)for(n=0;r>n;n++){var a=0;for(i=s;this.m>i;i++)a+=this.QR[this.matrix.index(i,s)]*o[t.index(i,n)];for(a=-a/this.QR[this.matrix.index(s,s)],i=s;this.m>i;i++)o[t.index(i,n)]+=a*this.QR[this.matrix.index(i,s)]}for(s=this.n-1;s>=0;s--){for(n=0;r>n;n++)o[t.index(s,n)]/=this.Rdiag[s];for(i=0;s>i;i++)for(n=0;r>n;n++)o[t.index(i,n)]-=o[t.index(s,n)]*this.QR[this.matrix.index(i,s)]}return new e.Matrix(o,this.n,r).getMatrix(0,this.n-1,0,r-1)}},n}),i("DOT/Matrix",["require","ASSERT/assert","DOT/dot","PHET_CORE/isArray","DOT/SingularValueDecomposition","DOT/LUDecomposition","DOT/QRDecomposition","DOT/Vector2","DOT/Vector3","DOT/Vector4"],function(t){var e=t("ASSERT/assert")("dot"),i=t("DOT/dot"),n=window.Float32Array||Array,s=t("PHET_CORE/isArray");t("DOT/SingularValueDecomposition"),t("DOT/LUDecomposition"),t("DOT/QRDecomposition"),t("DOT/Vector2"),t("DOT/Vector3"),t("DOT/Vector4"),i.Matrix=function(t,i,r,o){this.m=t,this.n=i;var a=t*i;this.size=a;var h;if(o)this.entries=r;else if(r||(r=0),this.entries=new n(a),s(r))for(e&&e(r.length===a),h=0;a>h;h++)this.entries[h]=r[h];else for(h=0;a>h;h++)this.entries[h]=r};var r=i.Matrix;return r.hypot=function(t,e){var i;return Math.abs(t)>Math.abs(e)?(i=e/t,i=Math.abs(t)*Math.sqrt(1+i*i)):0!==e?(i=t/e,i=Math.abs(e)*Math.sqrt(1+i*i)):i=0,i},r.prototype={constructor:r,copy:function(){for(var t=new r(this.m,this.n),e=0;this.size>e;e++)t.entries[e]=this.entries[e];return t},getArray:function(){return this.entries},getArrayCopy:function(){return new n(this.entries)},getRowDimension:function(){return this.m},getColumnDimension:function(){return this.n},index:function(t,e){return t*this.n+e},get:function(t,e){return this.entries[this.index(t,e)]},set:function(t,e,i){this.entries[this.index(t,e)]=i},getMatrix:function(t,e,i,n){for(var s=new r(e-t+1,n-i+1),o=t;e>=o;o++)for(var a=i;n>=a;a++)s.entries[s.index(o-t,a-i)]=this.entries[this.index(o,a)];return s},getArrayRowMatrix:function(t,e,i){for(var n=new r(t.length,i-e+1),s=0;t.length>s;s++)for(var o=e;i>=o;o++)n.entries[n.index(s,o-e)]=this.entries[this.index(t[s],o)];return n},transpose:function(){for(var t=new r(this.n,this.m),e=0;this.m>e;e++)for(var i=0;this.n>i;i++)t.entries[t.index(i,e)]=this.entries[this.index(e,i)];return t},norm1:function(){for(var t=0,e=0;this.n>e;e++){for(var i=0,n=0;this.m>n;n++)i+=Math.abs(this.entries[this.index(n,e)]);t=Math.max(t,i)}return t},norm2:function(){return new i.SingularValueDecomposition(this).norm2()},normInf:function(){for(var t=0,e=0;this.m>e;e++){for(var i=0,n=0;this.n>n;n++)i+=Math.abs(this.entries[this.index(e,n)]);t=Math.max(t,i)}return t},normF:function(){for(var t=0,e=0;this.m>e;e++)for(var i=0;this.n>i;i++)t=r.hypot(t,this.entries[this.index(e,i)]);return t},uminus:function(){for(var t=new r(this.m,this.n),e=0;this.m>e;e++)for(var i=0;this.n>i;i++)t.entries[t.index(e,i)]=-this.entries[this.index(e,i)];return t},plus:function(t){this.checkMatrixDimensions(t);for(var e=new r(this.m,this.n),i=0;this.m>i;i++)for(var n=0;this.n>n;n++){var s=e.index(i,n);e.entries[s]=this.entries[s]+t.entries[s]}return e},plusEquals:function(t){this.checkMatrixDimensions(t);for(var e=new r(this.m,this.n),i=0;this.m>i;i++)for(var n=0;this.n>n;n++){var s=e.index(i,n);this.entries[s]=this.entries[s]+t.entries[s]}return this},minus:function(t){this.checkMatrixDimensions(t);for(var e=new r(this.m,this.n),i=0;this.m>i;i++)for(var n=0;this.n>n;n++){var s=this.index(i,n);e.entries[s]=this.entries[s]-t.entries[s]}return e},minusEquals:function(t){this.checkMatrixDimensions(t);for(var e=0;this.m>e;e++)for(var i=0;this.n>i;i++){var n=this.index(e,i);this.entries[n]=this.entries[n]-t.entries[n]}return this},arrayTimes:function(t){this.checkMatrixDimensions(t);for(var e=new r(this.m,this.n),i=0;this.m>i;i++)for(var n=0;this.n>n;n++){var s=e.index(i,n);e.entries[s]=this.entries[s]*t.entries[s]}return e},arrayTimesEquals:function(t){this.checkMatrixDimensions(t);for(var e=0;this.m>e;e++)for(var i=0;this.n>i;i++){var n=this.index(e,i);this.entries[n]=this.entries[n]*t.entries[n]}return this},arrayRightDivide:function(t){this.checkMatrixDimensions(t);for(var e=new r(this.m,this.n),i=0;this.m>i;i++)for(var n=0;this.n>n;n++){var s=this.index(i,n);e.entries[s]=this.entries[s]/t.entries[s]}return e},arrayRightDivideEquals:function(t){this.checkMatrixDimensions(t);for(var e=0;this.m>e;e++)for(var i=0;this.n>i;i++){var n=this.index(e,i);this.entries[n]=this.entries[n]/t.entries[n]}return this},arrayLeftDivide:function(t){this.checkMatrixDimensions(t);for(var e=new r(this.m,this.n),i=0;this.m>i;i++)for(var n=0;this.n>n;n++){var s=this.index(i,n);e.entries[s]=t.entries[s]/this.entries[s]}return e},arrayLeftDivideEquals:function(t){this.checkMatrixDimensions(t);for(var e=0;this.m>e;e++)for(var i=0;this.n>i;i++){var n=this.index(e,i);this.entries[n]=t.entries[n]/this.entries[n]}return this},times:function(t){var e,i,s,o,a,h;if(t.isMatrix){if(h=t,h.m!==this.n)throw Error("Matrix inner dimensions must agree.");e=new r(this.m,h.n);var u=new n(this.n);for(s=0;h.n>s;s++){for(o=0;this.n>o;o++)u[o]=h.entries[h.index(o,s)];for(i=0;this.m>i;i++){for(a=0,o=0;this.n>o;o++)a+=this.entries[this.index(i,o)]*u[o];e.entries[e.index(i,s)]=a}}return e}for(a=t,e=new r(this.m,this.n),i=0;this.m>i;i++)for(s=0;this.n>s;s++)e.entries[e.index(i,s)]=a*this.entries[this.index(i,s)];return e},timesEquals:function(t){for(var e=0;this.m>e;e++)for(var i=0;this.n>i;i++){var n=this.index(e,i);this.entries[n]=t*this.entries[n]}return this},solve:function(t){return this.m===this.n?new i.LUDecomposition(this).solve(t):new i.QRDecomposition(this).solve(t)},solveTranspose:function(t){return this.transpose().solve(t.transpose())},inverse:function(){return this.solve(r.identity(this.m,this.m))},det:function(){return new i.LUDecomposition(this).det()},rank:function(){return new i.SingularValueDecomposition(this).rank()},cond:function(){return new i.SingularValueDecomposition(this).cond()},trace:function(){for(var t=0,e=0;Math.min(this.m,this.n)>e;e++)t+=this.entries[this.index(e,e)];return t},checkMatrixDimensions:function(t){if(t.m!==this.m||t.n!==this.n)throw Error("Matrix dimensions must agree.")},toString:function(){var t="";t+="dim: "+this.getRowDimension()+"x"+this.getColumnDimension()+"\n";for(var e=0;this.getRowDimension()>e;e++){for(var i=0;this.getColumnDimension()>i;i++)t+=this.get(e,i)+" ";t+="\n"}return t},extractVector2:function(t){return e&&e(2===this.m),new i.Vector2(this.get(0,t),this.get(1,t))},extractVector3:function(t){return e&&e(3===this.m),new i.Vector3(this.get(0,t),this.get(1,t),this.get(2,t))},extractVector4:function(t){return e&&e(4===this.m),new i.Vector4(this.get(0,t),this.get(1,t),this.get(2,t),this.get(3,t))},isMatrix:!0},r.identity=function(t,e){for(var i=new r(t,e),n=0;t>n;n++)for(var s=0;e>s;s++)i.entries[i.index(n,s)]=n===s?1:0;return i},r.rowVector2=function(t){return new r(1,2,[t.x,t.y])},r.rowVector3=function(t){return new r(1,3,[t.x,t.y,t.z])},r.rowVector4=function(t){return new r(1,4,[t.x,t.y,t.z,t.w])},r.rowVector=function(t){if(t.isVector2)return r.rowVector2(t);if(t.isVector3)return r.rowVector3(t);if(t.isVector4)return r.rowVector4(t);throw Error("undetected type of vector: "+(""+t))},r.columnVector2=function(t){return new r(2,1,[t.x,t.y])},r.columnVector3=function(t){return new r(3,1,[t.x,t.y,t.z])},r.columnVector4=function(t){return new r(4,1,[t.x,t.y,t.z,t.w])},r.columnVector=function(t){if(t.isVector2)return r.columnVector2(t);if(t.isVector3)return r.columnVector3(t);if(t.isVector4)return r.columnVector4(t);throw Error("undetected type of vector: "+(""+t))},r.fromVectors2=function(t){for(var e=2,i=t.length,s=new n(e*i),o=0;i>o;o++){var a=t[o];s[o]=a.x,s[o+i]=a.y}return new r(e,i,s,!0)},r.fromVectors3=function(t){for(var e=3,i=t.length,s=new n(e*i),o=0;i>o;o++){var a=t[o];s[o]=a.x,s[o+i]=a.y,s[o+2*i]=a.z}return new r(e,i,s,!0)},r.fromVectors4=function(t){for(var e=4,i=t.length,s=new n(e*i),o=0;i>o;o++){var a=t[o];s[o]=a.x,s[o+i]=a.y,s[o+2*i]=a.z,s[o+3*i]=a.w}return new r(e,i,s,!0)},r}),i("DOT/Permutation",["require","ASSERT/assert","DOT/dot","PHET_CORE/isArray","DOT/Util"],function(t){function e(t,i,n){if(0===t.length)n.call(void 0,i);else for(var s=0;t.length>s;s++){var r=t[s],o=t.slice(0);o.splice(s,1);var a=i.slice(0);a.push(r),e(o,a,n)}}var i=t("ASSERT/assert")("dot"),n=t("DOT/dot"),s=t("PHET_CORE/isArray");t("DOT/Util");var r=function(t){this.indices=t};return r.identity=function(t){i&&i(t>=0);for(var e=Array(t),n=0;t>n;n++)e[n]=n;return new r(e)},r.permutations=function(t){var e=[];return r.forEachPermutation(n.rangeInclusive(0,t-1),function(t){e.push(new r(t))}),e},r.forEachPermutation=function(t,i){e(t,[],i)},r.prototype={constructor:r,size:function(){return this.indices.length},apply:function(t){if(s(t)){if(t.length!==this.size())throw Error("Permutation length "+this.size()+" not equal to list length "+t.length);for(var e=Array(t.length),i=0;t.length>i;i++)e[i]=t[this.indices[i]];return e}return this.indices[t]},inverted:function(){for(var t=Array(this.size()),e=0;this.size()>e;e++)t[this.indices[e]]=e;return new r(t)},withIndicesPermuted:function(t){var e=[],i=this;return r.forEachPermutation(t,function(n){for(var s=i.indices,o=s.slice(0),a=0;t.length>a;a++)o[t[a]]=s[n[a]];e.push(new r(o))}),e},toString:function(){return"P["+this.indices.join(", ")+"]"}},r.testMe=function(t){var e=new r([1,4,3,2,0]);t.log(""+e);var i=e.inverted();t.log(""+i),t.log(""+i.withIndicesPermuted([0,3,4])),t.log(""+r.permutations(4))},r}),i("DOT/Ray3",["require","DOT/dot"],function(t){var e=t("DOT/dot");e.Ray3=function(t,e){this.pos=t,this.dir=e};var i=e.Ray3;return i.prototype={constructor:i,shifted:function(t){return new i(this.pointAtDistance(t),this.dir)},pointAtDistance:function(t){return this.pos.plus(this.dir.timesScalar(t))},toString:function(){return""+this.pos+" => "+(""+this.dir)}},i}),i("DOT/Transform4",["require","DOT/dot","DOT/Matrix4","DOT/Vector3","DOT/Ray3"],function(t){var e=t("DOT/dot");t("DOT/Matrix4"),t("DOT/Vector3"),t("DOT/Ray3"),e.Transform4=function(t){this.set(void 0===t?e.Matrix4.IDENTITY:t)};var i=e.Transform4;return i.prototype={constructor:i,set:function(t){this.matrix=t,this.inverse=null,this.matrixTransposed=null,this.inverseTransposed=null},getMatrix:function(){return this.matrix},getInverse:function(){return null===this.inverse&&(this.inverse=this.matrix.inverted()),this.inverse},getMatrixTransposed:function(){return null===this.matrixTransposed&&(this.matrixTransposed=this.matrix.transposed()),this.matrixTransposed},getInverseTransposed:function(){return null===this.inverseTransposed&&(this.inverseTransposed=this.getInverse().transposed()),this.inverseTransposed},prepend:function(t){this.set(t.timesMatrix(this.matrix))},append:function(t){this.set(this.matrix.timesMatrix(t))},prependTransform:function(t){this.prepend(t.matrix)},appendTransform:function(t){this.append(t.matrix)},isIdentity:function(){return this.matrix.type===e.Matrix4.Types.IDENTITY},applyToCanvasContext:function(t){t.setTransform(this.matrix.m00(),this.matrix.m10(),this.matrix.m01(),this.matrix.m11(),this.matrix.m03(),this.matrix.m13())},transformPosition3:function(t){return this.matrix.timesVector3(t)},transformDelta3:function(t){return this.matrix.timesRelativeVector3(t)},transformNormal3:function(t){return this.getInverse().timesTransposeVector3(t)},transformDeltaX:function(t){return this.transformDelta3(new e.Vector3(t,0,0)).x},transformDeltaY:function(t){return this.transformDelta3(new e.Vector3(0,t,0)).y},transformDeltaZ:function(t){return this.transformDelta3(new e.Vector3(0,0,t)).z},transformRay:function(t){return new e.Ray3(this.transformPosition3(t.pos),this.transformPosition3(t.pos.plus(t.dir)).minus(this.transformPosition3(t.pos)))},inversePosition3:function(t){return this.getInverse().timesVector3(t)},inverseDelta3:function(t){return this.inversePosition3(t).minus(this.inversePosition3(e.Vector3.ZERO))},inverseNormal3:function(t){return this.matrix.timesTransposeVector3(t)},inverseDeltaX:function(t){return this.inverseDelta3(new e.Vector3(t,0,0)).x},inverseDeltaY:function(t){return this.inverseDelta3(new e.Vector3(0,t,0)).y},inverseDeltaZ:function(t){return this.inverseDelta3(new e.Vector3(0,0,t)).z},inverseRay:function(t){return new e.Ray3(this.inversePosition3(t.pos),this.inversePosition3(t.pos.plus(t.dir)).minus(this.inversePosition3(t.pos)))}},i}),i("DOT/main",["DOT/dot","DOT/Bounds2","DOT/ConvexHull2","DOT/Dimension2","DOT/LUDecomposition","DOT/Matrix","DOT/Matrix3","DOT/Matrix4","DOT/Permutation","DOT/QRDecomposition","DOT/Ray2","DOT/Ray3","DOT/SingularValueDecomposition","DOT/Transform3","DOT/Transform4","DOT/Util","DOT/Vector2","DOT/Vector3","DOT/Vector4"],function(t){return t}),i("PHET_CORE/callSuper",["require"],function(){function t(t,e,i){(function(){var i=t.prototype[e];Function.call.apply(i,arguments)})(i)}return t}),i("PHET_CORE/inheritPrototype",["require"],function(){function t(t,e){var i=Object(e.prototype);i.constructor=t,t.prototype=i}return t}),i("PHET_CORE/loadScript",["require"],function(){return function(t){"string"==typeof t&&(t={src:t});var e=t.src,i=t.callback,n=void 0===t.async?!0:t.async,s=void 0===t.cacheBuster?!1:t.cacheBuster,r=!1,o=document.createElement("script");o.type="text/javascript",o.async=n,o.onload=o.onreadystatechange=function(){var t=this.readyState;t&&"complete"!==t&&"loaded"!==t||r||(r=!0,i&&i())},o.src=e+(s?"?random="+Math.random().toFixed(10):"");var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(o,a)}}),i("PHET_CORE/main",["require","PHET_CORE/callSuper","PHET_CORE/inherit","PHET_CORE/inheritPrototype","PHET_CORE/isArray","PHET_CORE/extend","PHET_CORE/loadScript"],function(t){return{callSuper:t("PHET_CORE/callSuper"),inherit:t("PHET_CORE/inherit"),inheritPrototype:t("PHET_CORE/inheritPrototype"),isArray:t("PHET_CORE/isArray"),extend:t("PHET_CORE/extend"),loadScript:t("PHET_CORE/loadScript")}}),window.has&&(window.has.add("assert.dot",function(){return!1}),window.has.add("assert.kite",function(){return!1}),window.has.add("assert.kite.extra",function(){return!1}),window.has.add("assert.scenery",function(){return!1}),window.has.add("assert.scenery.extra",function(){return!1})),e.config({deps:["main","KITE/main","DOT/main","PHET_CORE/main"],paths:{underscore:"../contrib/lodash.min-1.0.0-rc.3",jquery:"../contrib/jquery-1.8.3.min",SCENERY:".",KITE:"../common/kite/js",DOT:"../common/dot/js",PHET_CORE:"../common/phet-core/js",ASSERT:"../common/assert/js"},shim:{underscore:{exports:"_"},jquery:{exports:"$"}},urlArgs:(new Date).getTime()}),i("production-config",function(){}),window.scenery=e("main"),window.kite=e("KITE/main"),window.dot=e("DOT/main"),window.core=e("PHET_CORE/main"),scenery.Util.polyfillRequestAnimationFrame()})();
//@ sourceMappingURL=scenery.min.js.map