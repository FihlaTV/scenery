!function(){if(!window.hasOwnProperty("_"))throw new Error("Underscore/Lodash not found: _");if(!window.hasOwnProperty("$"))throw new Error("jQuery not found: $");!function(){window.assertions=window.assertions||{},window.assertions.assertFunction=window.assertions.assertFunction||function(t,e){var i="function"==typeof t?t():t;if(!i){if(window.navigator&&"Microsoft Internet Explorer"===window.navigator.appName)try{throw new Error}catch(n){e=e+", stack=\n"+n.stack}throw new Error("Assertion failed: "+e)}},window.assert=window.assert||null,window.assertSlow=window.assertSlow||null,window.assertions.enableAssert=function(){window.assert=window.assertions.assertFunction,window.console&&window.console.log&&window.console.log("enabling assert")},window.assertions.disableAssert=function(){window.assert=null,window.console&&window.console.log&&window.console.log("disabling assert")},window.assertions.enableAssertSlow=function(){window.assertSlow=window.assertions.assertFunction,window.console&&window.console.log&&window.console.log("enabling assertSlow")},window.assertions.disableAssertSlow=function(){window.assertSlow=null,window.console&&window.console.log&&window.console.log("disabling assertSlow")}}();var t,e,i;!function(n){function s(t,e){return _.call(t,e)}function r(t,e){var i,n,s,r,o,a,h,u,l,c,d=e&&e.split("/"),m=y.map,f=m&&m["*"]||{};if(t&&"."===t.charAt(0))if(e){for(d=d.slice(0,d.length-1),t=d.concat(t.split("/")),u=0;u<t.length;u+=1)if(c=t[u],"."===c)t.splice(u,1),u-=1;else if(".."===c){if(1===u&&(".."===t[2]||".."===t[0]))break;u>0&&(t.splice(u-1,2),u-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((d||f)&&m){for(i=t.split("/"),u=i.length;u>0;u-=1){if(n=i.slice(0,u).join("/"),d)for(l=d.length;l>0;l-=1)if(s=m[d.slice(0,l).join("/")],s&&(s=s[n])){r=s,o=u;break}if(r)break;!a&&f&&f[n]&&(a=f[n],h=u)}!r&&a&&(r=a,o=h),r&&(i.splice(0,o,r),t=i.join("/"))}return t}function o(t,e){return function(){return m.apply(n,E.call(arguments,0).concat([t,e]))}}function a(t){return function(e){return r(e,t)}}function h(t){return function(e){p[t]=e}}function u(t){if(s(v,t)){var e=v[t];delete v[t],x[t]=!0,d.apply(n,e)}if(!s(p,t)&&!s(x,t))throw new Error("No "+t);return p[t]}function l(t){var e,i=t?t.indexOf("!"):-1;return i>-1&&(e=t.substring(0,i),t=t.substring(i+1,t.length)),[e,t]}function c(t){return function(){return y&&y.config&&y.config[t]||{}}}var d,m,f,g,p={},v={},y={},x={},_=Object.prototype.hasOwnProperty,E=[].slice;f=function(t,e){var i,n=l(t),s=n[0];return t=n[1],s&&(s=r(s,e),i=u(s)),s?t=i&&i.normalize?i.normalize(t,a(e)):r(t,e):(t=r(t,e),n=l(t),s=n[0],t=n[1],s&&(i=u(s))),{f:s?s+"!"+t:t,n:t,pr:s,p:i}},g={require:function(t){return o(t)},exports:function(t){var e=p[t];return"undefined"!=typeof e?e:p[t]={}},module:function(t){return{id:t,uri:"",exports:p[t],config:c(t)}}},d=function(t,e,i,r){var a,l,c,d,m,y,_=[];if(r=r||t,"function"==typeof i){for(e=!e.length&&i.length?["require","exports","module"]:e,m=0;m<e.length;m+=1)if(d=f(e[m],r),l=d.f,"require"===l)_[m]=g.require(t);else if("exports"===l)_[m]=g.exports(t),y=!0;else if("module"===l)a=_[m]=g.module(t);else if(s(p,l)||s(v,l)||s(x,l))_[m]=u(l);else{if(!d.p)throw new Error(t+" missing "+l);d.p.load(d.n,o(r,!0),h(l),{}),_[m]=p[l]}c=i.apply(p[t],_),t&&(a&&a.exports!==n&&a.exports!==p[t]?p[t]=a.exports:c===n&&y||(p[t]=c))}else t&&(p[t]=i)},t=e=m=function(t,e,i,s,r){return"string"==typeof t?g[t]?g[t](e):u(f(t,e).f):(t.splice||(y=t,e.splice?(t=e,e=i,i=null):t=n),e=e||function(){},"function"==typeof i&&(i=s,s=r),s?d(n,t,e,i):setTimeout(function(){d(n,t,e,i)},4),m)},m.config=function(t){return y=t,y.deps&&m(y.deps,y.callback),m},t._defined=p,i=function(t,e,i){e.splice||(i=e,e=[]),s(p,t)||s(v,t)||(v[t]=[t,e,i])},i.amd={jQuery:!0}}(),i("almond",function(){}),i("PHET_CORE/core",["require"],function(){return{}}),i("PHET_CORE/phetAllocation",["require","PHET_CORE/core"],function(t){var e=t("PHET_CORE/core");return e.phetAllocation=function(t){if(window.alloc){var e;try{throw new Error}catch(i){e=i.stack}window.alloc[t]||(window.alloc[t]={count:0,stacks:{}});var n=window.alloc[t];n.count++,n.stacks[e]?n.stacks[e]+=1:n.stacks[e]=1,n.report=function(){var t=Object.keys(n.stacks);t=_.sortBy(t,function(t){return n.stacks[t]}),_.each(t,function(t){console.log(n.stacks[t]+": "+t)})}}},e.phetAllocation}),i("SCENERY/scenery",["require","PHET_CORE/phetAllocation"],function(t){window.sceneryLayerLog=null,window.sceneryEventLog=null,window.sceneryAccessibilityLog=null,window.phetAllocation=t("PHET_CORE/phetAllocation");var e=document.createElement("canvas"),i=e.getContext("2d");return{assert:null,scratchCanvas:e,scratchContext:i,svgns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",enableLayerLogging:function(){window.sceneryLayerLog=function(t){console.log(t)}},disableLayerLogging:function(){window.sceneryLayerLog=null},enableEventLogging:function(){window.sceneryEventLog=function(t){console.log(t)}},disableEventLogging:function(){window.sceneryEventLog=null},enableAccessibilityLogging:function(){window.sceneryAccessibilityLog=function(t){console.log(t)}},disableAccessibilityLogging:function(){window.sceneryAccessibilityLog=null},bitmaskAll:268435455,bitmaskNodeDefault:511,bitmaskPaintedDefault:0,bitmaskSupportsCanvas:1,bitmaskSupportsSVG:2,bitmaskSupportsDOM:4,bitmaskSupportsWebGL:8,bitmaskNotPainted:256}}),i("SCENERY/debug/DebugContext",["require","SCENERY/scenery"],function(t){function e(t){return JSON.stringify(t)}function i(t){console.log("context."+t+";")}function n(t){i(t)}function s(t,n){i(t+" = "+e(n))}function r(t,n){void 0===n||0===n.length?i(t+"()"):i(t+"( "+_.reduce(n,function(t,i){return t.length>0?t+", "+e(i):e(i)},"")+" )")}var o=t("SCENERY/scenery");o.DebugContext=function(t){this._context=t,t&&!t.ellipse&&(this.ellipse=t.ellipse)};var a=o.DebugContext;return a.prototype={constructor:a,get canvas(){return n("canvas"),this._context.canvas},get width(){return n("width"),this._context.width},get height(){return n("height"),this._context.height},commit:function(){r("commit"),this._context.commit()},save:function(){r("save"),this._context.save()},restore:function(){r("restore"),this._context.restore()},get currentTransform(){return n("currentTransform"),this._context.currentTransform},set currentTransform(t){s("currentTransform",t),this._context.currentTransform=t},scale:function(t,e){r("scale",[t,e]),this._context.scale(t,e)},rotate:function(t){r("rotate",[t]),this._context.rotate(t)},translate:function(t,e){r("translate",[t,e]),this._context.translate(t,e)},transform:function(t,e,i,n,s,o){r("transform",[t,e,i,n,s,o]),this._context.transform(t,e,i,n,s,o)},setTransform:function(t,e,i,n,s,o){r("setTransform",[t,e,i,n,s,o]),this._context.setTransform(t,e,i,n,s,o)},resetTransform:function(){r("resetTransform"),this._context.resetTransform()},get globalAlpha(){return n("globalAlpha"),this._context.globalAlpha},set globalAlpha(t){s("globalAlpha",t),this._context.globalAlpha=t},get globalCompositeOperation(){return n("globalCompositeOperation"),this._context.globalCompositeOperation},set globalCompositeOperation(t){s("globalCompositeOperation",t),this._context.globalCompositeOperation=t},get imageSmoothingEnabled(){return n("imageSmoothingEnabled"),this._context.imageSmoothingEnabled},set imageSmoothingEnabled(t){s("imageSmoothingEnabled",t),this._context.imageSmoothingEnabled=t},get strokeStyle(){return n("strokeStyle"),this._context.strokeStyle},set strokeStyle(t){s("strokeStyle",t),this._context.strokeStyle=t},get fillStyle(){return n("fillStyle"),this._context.fillStyle},set fillStyle(t){s("fillStyle",t),this._context.fillStyle=t},createLinearGradient:function(t,e,i,n){return r("createLinearGradient",[t,e,i,n]),this._context.createLinearGradient(t,e,i,n)},createRadialGradient:function(t,e,i,n,s,o){return r("createRadialGradient",[t,e,i,n,s,o]),this._context.createRadialGradient(t,e,i,n,s,o)},createPattern:function(t,e){return r("createPattern",[t,e]),this._context.createPattern(t,e)},get shadowOffsetX(){return n("shadowOffsetX"),this._context.shadowOffsetX},set shadowOffsetX(t){s("shadowOffsetX",t),this._context.shadowOffsetX=t},get shadowOffsetY(){return n("shadowOffsetY"),this._context.shadowOffsetY},set shadowOffsetY(t){s("shadowOffsetY",t),this._context.shadowOffsetY=t},get shadowBlur(){return n("shadowBlur"),this._context.shadowBlur},set shadowBlur(t){s("shadowBlur",t),this._context.shadowBlur=t},get shadowColor(){return n("shadowColor"),this._context.shadowColor},set shadowColor(t){s("shadowColor",t),this._context.shadowColor=t},clearRect:function(t,e,i,n){r("clearRect",[t,e,i,n]),this._context.clearRect(t,e,i,n)},fillRect:function(t,e,i,n){r("fillRect",[t,e,i,n]),this._context.fillRect(t,e,i,n)},strokeRect:function(t,e,i,n){r("strokeRect",[t,e,i,n]),this._context.strokeRect(t,e,i,n)},get fillRule(){return n("fillRule"),this._context.fillRule},set fillRule(t){s("fillRule",t),this._context.fillRule=t},beginPath:function(){r("beginPath"),this._context.beginPath()},fill:function(t){r("fill",t?[t]:void 0),this._context.fill(t)},stroke:function(t){r("stroke",t?[t]:void 0),this._context.stroke(t)},drawSystemFocusRing:function(t,e){r("drawSystemFocusRing",e?[t,e]:[t]),this._context.drawSystemFocusRing(t,e)},drawCustomFocusRing:function(t,e){return r("drawCustomFocusRing",e?[t,e]:[t]),this._context.drawCustomFocusRing(t,e)},scrollPathIntoView:function(t){r("scrollPathIntoView",t?[t]:void 0),this._context.scrollPathIntoView(t)},clip:function(t){r("clip",t?[t]:void 0),this._context.clip(t)},resetClip:function(){r("resetClip"),this._context.resetClip()},isPointInPath:function(t,e,i){return r("isPointInPath",i?[t,e,i]:[t,e]),this._context.isPointInPath(t,e,i)},fillText:function(t,e,i,n){r("fillText",void 0!==n?[t,e,i,n]:[t,e,i]),this._context.fillText(t,e,i,n)},strokeText:function(t,e,i,n){r("strokeText",void 0!==n?[t,e,i,n]:[t,e,i]),this._context.strokeText(t,e,i,n)},measureText:function(t){return r("measureText",[t]),this._context.measureText(t)},drawImage:function(t,e,i,n,s,o,a,h,u){r("drawImage",void 0!==n?void 0!==o?[t,e,i,n,s,o,a,h,u]:[t,e,i,n,s]:[t,e,i]),this._context.drawImage(t,e,i,n,s,o,a,h,u)},addHitRegion:function(t){r("addHitRegion",[t]),this._context.addHitRegion(t)},removeHitRegion:function(t){r("removeHitRegion",[t]),this._context.removeHitRegion(t)},createImageData:function(t,e){return r("createImageData",void 0!==e?[t,e]:[t]),this._context.createImageData(t,e)},createImageDataHD:function(t,e){return r("createImageDataHD",[t,e]),this._context.createImageDataHD(t,e)},getImageData:function(t,e,i,n){return r("getImageData",[t,e,i,n]),this._context.getImageData(t,e,i,n)},getImageDataHD:function(t,e,i,n){return r("getImageDataHD",[t,e,i,n]),this._context.getImageDataHD(t,e,i,n)},putImageData:function(t,e,i,n,s,o,a){r("putImageData",void 0!==n?[t,e,i,n,s,o,a]:[t,e,i]),this._context.putImageData(t,e,i,n,s,o,a)},putImageDataHD:function(t,e,i,n,s,o,a){r("putImageDataHD",void 0!==n?[t,e,i,n,s,o,a]:[t,e,i]),this._context.putImageDataHD(t,e,i,n,s,o,a)},get lineWidth(){return n("lineWidth"),this._context.lineWidth},set lineWidth(t){s("lineWidth",t),this._context.lineWidth=t},get lineCap(){return n("lineCap"),this._context.lineCap},set lineCap(t){s("lineCap",t),this._context.lineCap=t},get lineJoin(){return n("lineJoin"),this._context.lineJoin},set lineJoin(t){s("lineJoin",t),this._context.lineJoin=t},get miterLimit(){return n("miterLimit"),this._context.miterLimit},set miterLimit(t){s("miterLimit",t),this._context.miterLimit=t},setLineDash:function(t){r("setLineDash",[t]),this._context.setLineDash(t)},getLineDash:function(){return r("getLineDash"),this._context.getLineDash()},get lineDashOffset(){return n("lineDashOffset"),this._context.lineDashOffset},set lineDashOffset(t){s("lineDashOffset",t),this._context.lineDashOffset=t},get font(){return n("font"),this._context.font},set font(t){s("font",t),this._context.font=t},get textAlign(){return n("textAlign"),this._context.textAlign},set textAlign(t){s("textAlign",t),this._context.textAlign=t},get textBaseline(){return n("textBaseline"),this._context.textBaseline},set textBaseline(t){s("textBaseline",t),this._context.textBaseline=t},get direction(){return n("direction"),this._context.direction},set direction(t){s("direction",t),this._context.direction=t},closePath:function(){r("closePath"),this._context.closePath()},moveTo:function(t,e){r("moveTo",[t,e]),this._context.moveTo(t,e)},lineTo:function(t,e){r("lineTo",[t,e]),this._context.lineTo(t,e)},quadraticCurveTo:function(t,e,i,n){r("quadraticCurveTo",[t,e,i,n]),this._context.quadraticCurveTo(t,e,i,n)},bezierCurveTo:function(t,e,i,n,s,o){r("bezierCurveTo",[t,e,i,n,s,o]),this._context.bezierCurveTo(t,e,i,n,s,o)},arcTo:function(t,e,i,n,s,o,a){r("arcTo",void 0!==o?[t,e,i,n,s,o,a]:[t,e,i,n,s]),this._context.arcTo(t,e,i,n,s,o,a)},rect:function(t,e,i,n){r("rect",[t,e,i,n]),this._context.rect(t,e,i,n)},arc:function(t,e,i,n,s,o){r("arc",[t,e,i,n,s,o]),this._context.arc(t,e,i,n,s,o)},ellipse:function(t,e,i,n,s,o,a,h){r("ellipse",[t,e,i,n,s,o,a,h]),this._context.ellipse(t,e,i,n,s,o,a,h)}},a}),i("PHET_CORE/extend",["require","PHET_CORE/core"],function(t){var e=t("PHET_CORE/core");return e.extend=function(t){return _.each(Array.prototype.slice.call(arguments,1),function(e){if(e)for(var i in e)Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))}),t},e.extend}),i("PHET_CORE/inherit",["require","PHET_CORE/core","PHET_CORE/extend"],function(t){var e=t("PHET_CORE/core"),i=t("PHET_CORE/extend");return e.inherit=function(t,e,n,s){function r(){}return r.prototype=t.prototype,e.prototype=i(new r,{constructor:e},n),i(e,s),e},e.inherit}),i("SCENERY/display/Block",["require","PHET_CORE/inherit","SCENERY/scenery"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery");i.Block=function(){};var n=i.Block;return e(Object,n,{}),n}),i("SCENERY/display/BackboneBlock",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/display/Block"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/display/Block");i.BackboneBlock=function(){this._domElement=document.createElement("div")};var s=i.BackboneBlock;return e(n,s,{getDomElement:function(){return this._domElement}}),s}),i("DOT/dot",["require","PHET_CORE/phetAllocation"],function(t){window.phetAllocation=t("PHET_CORE/phetAllocation");var e=function i(){switch(arguments.length){case 2:return new i.Vector2(arguments[0],arguments[1]);case 3:return new i.Vector3(arguments[0],arguments[1],arguments[2]);case 4:return new i.Vector4(arguments[0],arguments[1],arguments[2],arguments[3]);default:throw new Error("dot takes 2-4 arguments")}};return e.FastArray=window.Float64Array?window.Float64Array:window.Array,e}),i("PHET_CORE/Poolable",["require","PHET_CORE/core","PHET_CORE/extend"],function(t){var e=t("PHET_CORE/core"),i=t("PHET_CORE/extend");return e.Poolable=function(t,e){var n=t.prototype;e=i({maxPoolSize:50,initialSize:0},e);var s=t.pool=[];e.defaultFactory&&(t.dirtyFromPool=function(){return s.length?s.pop():e.defaultFactory()},t.fillPool=function(t){for(;s.length<t;)s.push(e.defaultFactory())},t.fillPool(e.initialSize)),e.constructorDuplicateFactory&&(t.createFromPool=e.constructorDuplicateFactory(s)),n.freeToPool=function(){s.length<e.maxPoolSize&&s.push(this)}},e.Poolable}),i("DOT/Util",["require","DOT/dot"],function(t){var e=t("DOT/dot");e.Util={testAssert:function(){return"assert.dot: false"},clamp:function(t,e,i){return e>t?e:t>i?i:t},moduloBetweenDown:function(t,e,i){var n=i-e,s=(t-e)%n;return 0>s&&(s+=n),s+e},moduloBetweenUp:function(t,e,n){return-i.moduloBetweenDown(-t,-n,-e)},rangeInclusive:function(t,e){if(t>e)return[];for(var i=new Array(e-t+1),n=t;e>=n;n++)i[n-t]=n;return i},rangeExclusive:function(t,e){return i.rangeInclusive(t+1,e-1)},toRadians:function(t){return Math.PI*t/180},toDegrees:function(t){return 180*t/Math.PI},gcd:function(t,e){return 0===e?t:this.gcd(e,t%e)},lineLineIntersection:function(t,i,n,s){var r=t.x-i.x,o=n.x-s.x,a=t.y-i.y,h=n.y-s.y,u=r*h-a*o,l=t.x*i.y-t.y*i.x,c=n.x*s.y-n.y*s.x;return new e.Vector2((l*o-r*c)/u,(l*h-a*c)/u)},sphereRayIntersection:function(t,i,n){n=void 0===n?1e-5:n;var s=new e.Vector3,r=i.dir,o=i.pos,a=o.minus(s),h=r.dot(a),u=a.magnitudeSquared(),l=4*h*h-4*(u-t*t);if(n>l)return null;var c=r.dot(s)-r.dot(o),d=Math.sqrt(l)/2,m=c-d,f=c+d;if(n>f)return null;var g=i.pointAtDistance(f),p=g.minus(s).normalized();if(n>m)return{distance:f,hitPoint:g,normal:p.negated(),fromOutside:!1};var v=i.pointAtDistance(m),y=v.minus(s).normalized();return{distance:m,hitPoint:v,normal:y,fromOutside:!0}},solveQuadraticRootsReal:function(t,e,i){var n=1e7;if(0===t||Math.abs(e/t)>n||Math.abs(i/t)>n)return[-i/e];var s=e*e-4*t*i;if(0>s)return[];var r=Math.sqrt(s);return[(-e-r)/(2*t),(-e+r)/(2*t)]},solveCubicRootsReal:function(t,e,n,s){var r=1e7;if(0===t||Math.abs(e/t)>r||Math.abs(n/t)>r||Math.abs(s/t)>r)return i.solveQuadraticRootsReal(e,n,s);if(0===s||Math.abs(t/s)>r||Math.abs(e/s)>r||Math.abs(n/s)>r)return i.solveQuadraticRootsReal(t,e,n);e/=t,n/=t,s/=t;var o=(3*n-e*e)/9,a=(-(27*s)+e*(9*n-2*e*e))/54,h=o*o*o+a*a,u=e/3;if(h>0){var l=Math.sqrt(h);return[i.cubeRoot(a+l)+i.cubeRoot(a-l)-u]}if(0===h){var c=i.cubeRoot(a),d=u-c;return[-u+2*c,d,d]}var m=-o*o*o;m=Math.acos(a/Math.sqrt(m));var f=2*Math.sqrt(-o);return[-u+f*Math.cos(m/3),-u+f*Math.cos((m+2*Math.PI)/3),-u+f*Math.cos((m+4*Math.PI)/3)]},cubeRoot:function(t){return t>=0?Math.pow(t,1/3):-Math.pow(-t,1/3)},linear:function(t,e,i,n,s){return(n-i)/(e-t)*(s-t)+i},toFixed:function(t,e){var i=Math.pow(10,e),n=Math.round(t*i)/i;return n.toFixed(e)},toFixedNumber:function(t,e){return parseFloat(i.toFixed(t,e))},isInteger:function(t){return"number"==typeof t&&0===t%1},lineSegmentIntersection:function(t,i,n,s,r,o,a,h){var u=(a-r)*(i-o)-(h-o)*(t-r),l=(n-t)*(i-o)-(s-i)*(t-r),c=(h-o)*(n-t)-(a-r)*(s-i);if(0===c)return null;var d=u/c,m=l/c;if(d>=0&&1>=d&&m>=0&&1>=m){var f=t+d*(n-t),g=i+d*(s-i);return new e.Vector2(f,g)}return null},distToSegmentSquared:function(t,i,n){var s=i.distanceSquared(n);if(0===s)return t.distanceSquared(i);var r=((t.x-i.x)*(n.x-i.x)+(t.y-i.y)*(n.y-i.y))/s;return 0>r?t.distanceSquared(i):r>1?t.distanceSquared(n):t.distanceSquared(new e.Vector2(i.x+r*(n.x-i.x),i.y+r*(n.y-i.y)))},distToSegment:function(t,e,i){return Math.sqrt(this.distToSegmentSquared(t,e,i))},arePointsCollinear:function(t,e,n,s){return void 0===s&&(s=0),i.triangleArea(t,e,n)<=s},triangleArea:function(t,e,n){return Math.abs(i.triangleAreaSigned(t,e,n))},triangleAreaSigned:function(t,e,i){return t.x*(e.y-i.y)+e.x*(i.y-t.y)+i.x*(t.y-e.y)},log10:function(t){return Math.log(t)/Math.LN10}};var i=e.Util;return e.testAssert=i.testAssert,e.clamp=i.clamp,e.moduloBetweenDown=i.moduloBetweenDown,e.moduloBetweenUp=i.moduloBetweenUp,e.rangeInclusive=i.rangeInclusive,e.rangeExclusive=i.rangeExclusive,e.toRadians=i.toRadians,e.toDegrees=i.toDegrees,e.lineLineIntersection=i.lineLineIntersection,e.sphereRayIntersection=i.sphereRayIntersection,e.solveQuadraticRootsReal=i.solveQuadraticRootsReal,e.solveCubicRootsReal=i.solveCubicRootsReal,e.cubeRoot=i.cubeRoot,e.linear=i.linear,i}),i("DOT/Vector2",["require","DOT/dot","PHET_CORE/inherit","PHET_CORE/Poolable","DOT/Util"],function(t){var e=t("DOT/dot"),i=t("PHET_CORE/inherit"),n=t("PHET_CORE/Poolable");t("DOT/Util"),e.Vector2=function(t,e){this.x=t||0,this.y=e||0};var s=e.Vector2;s.createPolar=function(t,e){return(new s).setPolar(t,e)},s.prototype={constructor:s,isVector2:!0,dimension:2,magnitude:function(){return Math.sqrt(this.magnitudeSquared())},magnitudeSquared:function(){return this.x*this.x+this.y*this.y},distance:function(t){return Math.sqrt(this.distanceSquared(t))},distanceXY:function(t,e){var i=this.x-t,n=this.y-e;return Math.sqrt(i*i+n*n)},distanceSquared:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i},distanceSquaredXY:function(t,e){var i=this.x-t,n=this.y-e;return i*i+n*n},dot:function(t){return this.x*t.x+this.y*t.y},dotXY:function(t,e){return this.x*t+this.y*e},equals:function(t){return this.x===t.x&&this.y===t.y},equalsEpsilon:function(t,e){return e||(e=0),Math.max(Math.abs(this.x-t.x),Math.abs(this.y-t.y))<=e},isFinite:function(){return isFinite(this.x)&&isFinite(this.y)},copy:function(t){return t?t.set(this):new s(this.x,this.y)},crossScalar:function(t){return this.x*t.y-this.y*t.x},normalized:function(){var t=this.magnitude();if(0===t)throw new Error("Cannot normalize a zero-magnitude vector");return new s(this.x/t,this.y/t)},withMagnitude:function(t){return this.copy().setMagnitude(t)},timesScalar:function(t){return new s(this.x*t,this.y*t)},times:function(t){return this.timesScalar(t)},componentTimes:function(t){return new s(this.x*t.x,this.y*t.y)},plus:function(t){return new s(this.x+t.x,this.y+t.y)},plusXY:function(t,e){return new s(this.x+t,this.y+e)},plusScalar:function(t){return new s(this.x+t,this.y+t)},minus:function(t){return new s(this.x-t.x,this.y-t.y)},minusXY:function(t,e){return new s(this.x-t,this.y-e)},minusScalar:function(t){return new s(this.x-t,this.y-t)},dividedScalar:function(t){return new s(this.x/t,this.y/t)},negated:function(){return new s(-this.x,-this.y)},angle:function(){return Math.atan2(this.y,this.x)},perpendicular:function(){return new s(this.y,-this.x)},angleBetween:function(t){var i=this.magnitude(),n=t.magnitude();return Math.acos(e.clamp((this.x*t.x+this.y*t.y)/(i*n),-1,1))},rotated:function(t){var e=this.angle()+t,i=this.magnitude();return new s(i*Math.cos(e),i*Math.sin(e))},blend:function(t,e){return new s(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)},average:function(t){return this.blend(t,.5)},toString:function(){return"Vector2("+this.x+", "+this.y+")"},toVector3:function(){return new e.Vector3(this.x,this.y)},setXY:function(t,e){return this.x=t,this.y=e,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},set:function(t){return this.setXY(t.x,t.y)},setMagnitude:function(t){var e=t/this.magnitude();return this.multiplyScalar(e)},add:function(t){return this.setXY(this.x+t.x,this.y+t.y)},addXY:function(t,e){return this.setXY(this.x+t,this.y+e)},addScalar:function(t){return this.setXY(this.x+t,this.y+t)},subtract:function(t){return this.setXY(this.x-t.x,this.y-t.y)},subtractScalar:function(t){return this.setXY(this.x-t,this.y-t)},multiplyScalar:function(t){return this.setXY(this.x*t,this.y*t)},multiply:function(t){return this.multiplyScalar(t)},componentMultiply:function(t){return this.setXY(this.x*t.x,this.y*t.y)},divideScalar:function(t){return this.setXY(this.x/t,this.y/t)},negate:function(){return this.setXY(-this.x,-this.y)},normalize:function(){var t=this.magnitude();if(0===t)throw new Error("Cannot normalize a zero-magnitude vector");return this.divideScalar(t)},rotate:function(t){var e=this.angle()+t,i=this.magnitude();return this.setXY(i*Math.cos(e),i*Math.sin(e))},setPolar:function(t,e){return this.setXY(t*Math.cos(e),t*Math.sin(e))}},n(s,{defaultFactory:function(){return new s},constructorDuplicateFactory:function(t){return function(e,i){return t.length?t.pop().setXY(e,i):new s(e,i)}}}),s.Immutable=function(t,e){s.call(this,t,e)};var r=s.Immutable;return i(s,r),r.mutableOverrideHelper=function(t){r.prototype[t]=function(){throw new Error("Cannot call mutable method '"+t+"' on immutable Vector2")}},r.mutableOverrideHelper("setXY"),r.mutableOverrideHelper("setX"),r.mutableOverrideHelper("setY"),s.ZERO=new r(0,0),s.X_UNIT=new r(1,0),s.Y_UNIT=new r(0,1),s}),i("DOT/Vector4",["require","DOT/dot","DOT/Util"],function(t){var e=t("DOT/dot");t("DOT/Util"),e.Vector4=function(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==n?n:1};var i=e.Vector4;i.prototype={constructor:i,isVector4:!0,dimension:4,magnitude:function(){return Math.sqrt(this.magnitudeSquared())},magnitudeSquared:function(){this.dot(this)},distance:function(t){return this.minus(t).magnitude()},distanceSquared:function(t){return this.minus(t).magnitudeSquared()},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},isFinite:function(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.z)&&isFinite(this.w)},equals:function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},equalsEpsilon:function(t,e){return e||(e=0),Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)+Math.abs(this.w-t.w)<=e},copy:function(t){return t?t.set(this):new i(this.x,this.y,this.z,this.w)},normalized:function(){var t=this.magnitude();if(0===t)throw new Error("Cannot normalize a zero-magnitude vector");return new i(this.x/t,this.y/t,this.z/t,this.w/t)},timesScalar:function(t){return new i(this.x*t,this.y*t,this.z*t,this.w*t)},times:function(t){return this.timesScalar(t)},componentTimes:function(t){return new i(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)},plus:function(t){return new i(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},plusScalar:function(t){return new i(this.x+t,this.y+t,this.z+t,this.w+t)},minus:function(t){return new i(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},minusScalar:function(t){return new i(this.x-t,this.y-t,this.z-t,this.w-t)},dividedScalar:function(t){return new i(this.x/t,this.y/t,this.z/t,this.w/t)},negated:function(){return new i(-this.x,-this.y,-this.z,-this.w)},angleBetween:function(t){return Math.acos(e.clamp(this.normalized().dot(t.normalized()),-1,1))},blend:function(t,e){return this.plus(t.minus(this).times(e))},average:function(t){return this.blend(t,.5)},toString:function(){return"Vector4("+this.x+", "+this.y+", "+this.z+", "+this.w+")"},toVector3:function(){return new e.Vector3(this.x,this.y,this.z)},setXYZW:function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},set:function(t){return this.setXYZW(t.x,t.y,t.z,t.w)},add:function(t){return this.setXYZW(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},addScalar:function(t){return this.setXYZW(this.x+t,this.y+t,this.z+t,this.w+t)},subtract:function(t){return this.setXYZW(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},subtractScalar:function(t){return this.setXYZW(this.x-t,this.y-t,this.z-t,this.w-t)},multiplyScalar:function(t){return this.setXYZW(this.x*t,this.y*t,this.z*t,this.w*t)},multiply:function(t){return this.multiplyScalar(t)},componentMultiply:function(t){return this.setXYZW(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)},divideScalar:function(t){return this.setXYZW(this.x/t,this.y/t,this.z/t,this.w/t)},negate:function(){return this.setXYZW(-this.x,-this.y,-this.z,-this.w)},normalize:function(){var t=this.magnitude();if(0===t)throw new Error("Cannot normalize a zero-magnitude vector");return this.divideScalar(t)}},i.Immutable=function(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==n?n:1};var n=i.Immutable;return n.prototype=new i,n.prototype.constructor=n,n.mutableOverrideHelper=function(t){n.prototype[t]=function(){throw new Error("Cannot call mutable method '"+t+"' on immutable Vector4")}},n.mutableOverrideHelper("setXYZW"),n.mutableOverrideHelper("setX"),n.mutableOverrideHelper("setY"),n.mutableOverrideHelper("setZ"),n.mutableOverrideHelper("setW"),i.ZERO=new n(0,0,0,0),i.X_UNIT=new n(1,0,0,0),i.Y_UNIT=new n(0,1,0,0),i.Z_UNIT=new n(0,0,1,0),i.W_UNIT=new n(0,0,0,1),i}),i("DOT/Vector3",["require","DOT/dot","DOT/Util","DOT/Vector2","DOT/Vector4"],function(t){var e=t("DOT/dot");t("DOT/Util"),t("DOT/Vector2"),t("DOT/Vector4"),e.Vector3=function(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0};var i=e.Vector3;i.prototype={constructor:i,isVector3:!0,dimension:3,magnitude:function(){return Math.sqrt(this.magnitudeSquared())},magnitudeSquared:function(){return this.dot(this)},distance:function(t){return Math.sqrt(this.distanceSquared(t))},distanceSquared:function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},isFinite:function(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.z)},equals:function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z},equalsEpsilon:function(t,e){return e||(e=0),Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)<=e},copy:function(t){return t?t.set(this):new i(this.x,this.y,this.z)},cross:function(t){return new i(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},normalized:function(){var t=this.magnitude();if(0===t)throw new Error("Cannot normalize a zero-magnitude vector");return new i(this.x/t,this.y/t,this.z/t)},withMagnitude:function(t){return this.copy().setMagnitude(t)},timesScalar:function(t){return new i(this.x*t,this.y*t,this.z*t)},times:function(t){return this.timesScalar(t)},componentTimes:function(t){return new i(this.x*t.x,this.y*t.y,this.z*t.z)},plus:function(t){return new i(this.x+t.x,this.y+t.y,this.z+t.z)},plusScalar:function(t){return new i(this.x+t,this.y+t,this.z+t)},minus:function(t){return new i(this.x-t.x,this.y-t.y,this.z-t.z)},minusScalar:function(t){return new i(this.x-t,this.y-t,this.z-t)},dividedScalar:function(t){return new i(this.x/t,this.y/t,this.z/t)},negated:function(){return new i(-this.x,-this.y,-this.z)},angleBetween:function(t){return Math.acos(e.clamp(this.normalized().dot(t.normalized()),-1,1))},blend:function(t,e){return this.plus(t.minus(this).times(e))},average:function(t){return this.blend(t,.5)},toString:function(){return"Vector3("+this.x+", "+this.y+", "+this.z+")"},toVector2:function(){return new e.Vector2(this.x,this.y)},toVector4:function(){return new e.Vector4(this.x,this.y,this.z)},setXYZ:function(t,e,i){return this.x=t,this.y=e,this.z=i,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},set:function(t){return this.setXYZ(t.x,t.y,t.z)},setMagnitude:function(t){var e=t/this.magnitude();return this.multiplyScalar(e)},add:function(t){return this.setXYZ(this.x+t.x,this.y+t.y,this.z+t.z)},addScalar:function(t){return this.setXYZ(this.x+t,this.y+t,this.z+t)},subtract:function(t){return this.setXYZ(this.x-t.x,this.y-t.y,this.z-t.z)},subtractScalar:function(t){return this.setXYZ(this.x-t,this.y-t,this.z-t)},multiplyScalar:function(t){return this.setXYZ(this.x*t,this.y*t,this.z*t)},multiply:function(t){return this.multiplyScalar(t)},componentMultiply:function(t){return this.setXYZ(this.x*t.x,this.y*t.y,this.z*t.z)},divideScalar:function(t){return this.setXYZ(this.x/t,this.y/t,this.z/t)},negate:function(){return this.setXYZ(-this.x,-this.y,-this.z)},normalize:function(){var t=this.magnitude();if(0===t)throw new Error("Cannot normalize a zero-magnitude vector");return this.divideScalar(t)}},i.slerp=function(t,i,n){return e.Quaternion.slerp(new e.Quaternion,e.Quaternion.getRotationQuaternion(t,i),n).timesVector3(t)},i.Immutable=function(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0};var n=i.Immutable;return n.prototype=new i,n.prototype.constructor=n,n.mutableOverrideHelper=function(t){n.prototype[t]=function(){throw new Error("Cannot call mutable method '"+t+"' on immutable Vector3")}},n.mutableOverrideHelper("setXYZ"),n.mutableOverrideHelper("setX"),n.mutableOverrideHelper("setY"),n.mutableOverrideHelper("setZ"),i.ZERO=new n(0,0,0),i.X_UNIT=new n(1,0,0),i.Y_UNIT=new n(0,1,0),i.Z_UNIT=new n(0,0,1),i}),i("DOT/Matrix4",["require","DOT/dot","DOT/Vector3","DOT/Vector4"],function(t){var e=t("DOT/dot");t("DOT/Vector3"),t("DOT/Vector4");var i=window.Float32Array||Array;e.Matrix4=function(t,e,n,s,r,o,a,h,u,l,c,d,m,f,g,p,v){this.entries=new i(16),this.rowMajor(void 0===t?1:t,e||0,n||0,s||0,r||0,void 0===o?1:o,a||0,h||0,u||0,l||0,void 0===c?1:c,d||0,m||0,f||0,g||0,void 0===p?1:p,v)};var n=e.Matrix4;n.Types={OTHER:0,IDENTITY:1,TRANSLATION_3D:2,SCALING:3,AFFINE:4};var s=n.Types;return n.identity=function(){return new n(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,s.IDENTITY)},n.translation=function(t,e,i){return new n(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1,s.TRANSLATION_3D)},n.translationFromVector=function(t){return n.translation(t.x,t.y,t.z)},n.scaling=function(t,e,i){return e=void 0===e?t:e,i=void 0===i?t:i,new n(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1,s.SCALING)
},n.rotationAxisAngle=function(t,e){var i=Math.cos(e),r=Math.sin(e),o=1-i;return new n(t.x*t.x*o+i,t.x*t.y*o-t.z*r,t.x*t.z*o+t.y*r,0,t.y*t.x*o+t.z*r,t.y*t.y*o+i,t.y*t.z*o-t.x*r,0,t.z*t.x*o-t.y*r,t.z*t.y*o+t.x*r,t.z*t.z*o+i,0,0,0,0,1,s.AFFINE)},n.rotationX=function(t){var e=Math.cos(t),i=Math.sin(t);return new n(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1,s.AFFINE)},n.rotationY=function(t){var e=Math.cos(t),i=Math.sin(t);return new n(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1,s.AFFINE)},n.rotationZ=function(t){var e=Math.cos(t),i=Math.sin(t);return new n(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1,s.AFFINE)},n.gluPerspective=function(t,e,i,s){var r=Math.cos(t)/Math.sin(t);return new n(r/e,0,0,0,0,r,0,0,0,0,(s+i)/(i-s),2*s*i/(i-s),0,0,-1,0)},n.prototype={constructor:n,rowMajor:function(t,e,i,n,r,o,a,h,u,l,c,d,m,f,g,p,v){return this.entries[0]=t,this.entries[1]=r,this.entries[2]=u,this.entries[3]=m,this.entries[4]=e,this.entries[5]=o,this.entries[6]=l,this.entries[7]=f,this.entries[8]=i,this.entries[9]=a,this.entries[10]=c,this.entries[11]=g,this.entries[12]=n,this.entries[13]=h,this.entries[14]=d,this.entries[15]=p,this.type=void 0===v?0===m&&0===f&&0===g&&1===p?s.AFFINE:s.OTHER:v,this},columnMajor:function(t,e,i,n,s,r,o,a,h,u,l,c,d,m,f,g,p){return this.rowMajor(t,s,h,d,e,r,u,m,i,o,l,f,n,a,c,g,p)},m00:function(){return this.entries[0]},m01:function(){return this.entries[4]},m02:function(){return this.entries[8]},m03:function(){return this.entries[12]},m10:function(){return this.entries[1]},m11:function(){return this.entries[5]},m12:function(){return this.entries[9]},m13:function(){return this.entries[13]},m20:function(){return this.entries[2]},m21:function(){return this.entries[6]},m22:function(){return this.entries[10]},m23:function(){return this.entries[14]},m30:function(){return this.entries[3]},m31:function(){return this.entries[7]},m32:function(){return this.entries[11]},m33:function(){return this.entries[15]},isFinite:function(){return isFinite(this.m00())&&isFinite(this.m01())&&isFinite(this.m02())&&isFinite(this.m03())&&isFinite(this.m10())&&isFinite(this.m11())&&isFinite(this.m12())&&isFinite(this.m13())&&isFinite(this.m20())&&isFinite(this.m21())&&isFinite(this.m22())&&isFinite(this.m23())&&isFinite(this.m30())&&isFinite(this.m31())&&isFinite(this.m32())&&isFinite(this.m33())},getTranslation:function(){return new e.Vector3(this.m03(),this.m13(),this.m23())},get translation(){return this.getTranslation()},getScaleVector:function(){var t=this.m00()+this.m03(),i=this.m10()+this.m13(),n=this.m20()+this.m23(),s=this.m30()+this.m33(),r=this.m01()+this.m03(),o=this.m11()+this.m13(),a=this.m21()+this.m23(),h=this.m31()+this.m33(),u=this.m02()+this.m03(),l=this.m12()+this.m13(),c=this.m22()+this.m23(),d=this.m32()+this.m33();return new e.Vector3(Math.sqrt(t*t+i*i+n*n+s*s),Math.sqrt(r*r+o*o+a*a+h*h),Math.sqrt(u*u+l*l+c*c+d*d))},get scaleVector(){return this.getScaleVector()},getCSSTransform:function(){return"matrix3d("+this.entries[0].toFixed(20)+","+this.entries[1].toFixed(20)+","+this.entries[2].toFixed(20)+","+this.entries[3].toFixed(20)+","+this.entries[4].toFixed(20)+","+this.entries[5].toFixed(20)+","+this.entries[6].toFixed(20)+","+this.entries[7].toFixed(20)+","+this.entries[8].toFixed(20)+","+this.entries[9].toFixed(20)+","+this.entries[10].toFixed(20)+","+this.entries[11].toFixed(20)+","+this.entries[12].toFixed(20)+","+this.entries[13].toFixed(20)+","+this.entries[14].toFixed(20)+","+this.entries[15].toFixed(20)+")"},get cssTransform(){return this.getCSSTransform()},equals:function(t){return this.m00()===t.m00()&&this.m01()===t.m01()&&this.m02()===t.m02()&&this.m03()===t.m03()&&this.m10()===t.m10()&&this.m11()===t.m11()&&this.m12()===t.m12()&&this.m13()===t.m13()&&this.m20()===t.m20()&&this.m21()===t.m21()&&this.m22()===t.m22()&&this.m23()===t.m23()&&this.m30()===t.m30()&&this.m31()===t.m31()&&this.m32()===t.m32()&&this.m33()===t.m33()},equalsEpsilon:function(t,e){return Math.abs(this.m00()-t.m00())<e&&Math.abs(this.m01()-t.m01())<e&&Math.abs(this.m02()-t.m02())<e&&Math.abs(this.m03()-t.m03())<e&&Math.abs(this.m10()-t.m10())<e&&Math.abs(this.m11()-t.m11())<e&&Math.abs(this.m12()-t.m12())<e&&Math.abs(this.m13()-t.m13())<e&&Math.abs(this.m20()-t.m20())<e&&Math.abs(this.m21()-t.m21())<e&&Math.abs(this.m22()-t.m22())<e&&Math.abs(this.m23()-t.m23())<e&&Math.abs(this.m30()-t.m30())<e&&Math.abs(this.m31()-t.m31())<e&&Math.abs(this.m32()-t.m32())<e&&Math.abs(this.m33()-t.m33())<e},copy:function(){return new n(this.m00(),this.m01(),this.m02(),this.m03(),this.m10(),this.m11(),this.m12(),this.m13(),this.m20(),this.m21(),this.m22(),this.m23(),this.m30(),this.m31(),this.m32(),this.m33(),this.type)},plus:function(t){return new n(this.m00()+t.m00(),this.m01()+t.m01(),this.m02()+t.m02(),this.m03()+t.m03(),this.m10()+t.m10(),this.m11()+t.m11(),this.m12()+t.m12(),this.m13()+t.m13(),this.m20()+t.m20(),this.m21()+t.m21(),this.m22()+t.m22(),this.m23()+t.m23(),this.m30()+t.m30(),this.m31()+t.m31(),this.m32()+t.m32(),this.m33()+t.m33())},minus:function(t){return new n(this.m00()-t.m00(),this.m01()-t.m01(),this.m02()-t.m02(),this.m03()-t.m03(),this.m10()-t.m10(),this.m11()-t.m11(),this.m12()-t.m12(),this.m13()-t.m13(),this.m20()-t.m20(),this.m21()-t.m21(),this.m22()-t.m22(),this.m23()-t.m23(),this.m30()-t.m30(),this.m31()-t.m31(),this.m32()-t.m32(),this.m33()-t.m33())},transposed:function(){return new n(this.m00(),this.m10(),this.m20(),this.m30(),this.m01(),this.m11(),this.m21(),this.m31(),this.m02(),this.m12(),this.m22(),this.m32(),this.m03(),this.m13(),this.m23(),this.m33())},negated:function(){return new n(-this.m00(),-this.m01(),-this.m02(),-this.m03(),-this.m10(),-this.m11(),-this.m12(),-this.m13(),-this.m20(),-this.m21(),-this.m22(),-this.m23(),-this.m30(),-this.m31(),-this.m32(),-this.m33())},inverted:function(){switch(this.type){case s.IDENTITY:return this;case s.TRANSLATION_3D:return new n(1,0,0,-this.m03(),0,1,0,-this.m13(),0,0,1,-this.m23(),0,0,0,1,s.TRANSLATION_3D);case s.SCALING:return new n(1/this.m00(),0,0,0,0,1/this.m11(),0,0,0,0,1/this.m22(),0,0,0,0,1/this.m33(),s.SCALING);case s.AFFINE:case s.OTHER:var t=this.getDeterminant();if(0!==t)return new n((-this.m31()*this.m22()*this.m13()+this.m21()*this.m32()*this.m13()+this.m31()*this.m12()*this.m23()-this.m11()*this.m32()*this.m23()-this.m21()*this.m12()*this.m33()+this.m11()*this.m22()*this.m33())/t,(this.m31()*this.m22()*this.m03()-this.m21()*this.m32()*this.m03()-this.m31()*this.m02()*this.m23()+this.m01()*this.m32()*this.m23()+this.m21()*this.m02()*this.m33()-this.m01()*this.m22()*this.m33())/t,(-this.m31()*this.m12()*this.m03()+this.m11()*this.m32()*this.m03()+this.m31()*this.m02()*this.m13()-this.m01()*this.m32()*this.m13()-this.m11()*this.m02()*this.m33()+this.m01()*this.m12()*this.m33())/t,(this.m21()*this.m12()*this.m03()-this.m11()*this.m22()*this.m03()-this.m21()*this.m02()*this.m13()+this.m01()*this.m22()*this.m13()+this.m11()*this.m02()*this.m23()-this.m01()*this.m12()*this.m23())/t,(this.m30()*this.m22()*this.m13()-this.m20()*this.m32()*this.m13()-this.m30()*this.m12()*this.m23()+this.m10()*this.m32()*this.m23()+this.m20()*this.m12()*this.m33()-this.m10()*this.m22()*this.m33())/t,(-this.m30()*this.m22()*this.m03()+this.m20()*this.m32()*this.m03()+this.m30()*this.m02()*this.m23()-this.m00()*this.m32()*this.m23()-this.m20()*this.m02()*this.m33()+this.m00()*this.m22()*this.m33())/t,(this.m30()*this.m12()*this.m03()-this.m10()*this.m32()*this.m03()-this.m30()*this.m02()*this.m13()+this.m00()*this.m32()*this.m13()+this.m10()*this.m02()*this.m33()-this.m00()*this.m12()*this.m33())/t,(-this.m20()*this.m12()*this.m03()+this.m10()*this.m22()*this.m03()+this.m20()*this.m02()*this.m13()-this.m00()*this.m22()*this.m13()-this.m10()*this.m02()*this.m23()+this.m00()*this.m12()*this.m23())/t,(-this.m30()*this.m21()*this.m13()+this.m20()*this.m31()*this.m13()+this.m30()*this.m11()*this.m23()-this.m10()*this.m31()*this.m23()-this.m20()*this.m11()*this.m33()+this.m10()*this.m21()*this.m33())/t,(this.m30()*this.m21()*this.m03()-this.m20()*this.m31()*this.m03()-this.m30()*this.m01()*this.m23()+this.m00()*this.m31()*this.m23()+this.m20()*this.m01()*this.m33()-this.m00()*this.m21()*this.m33())/t,(-this.m30()*this.m11()*this.m03()+this.m10()*this.m31()*this.m03()+this.m30()*this.m01()*this.m13()-this.m00()*this.m31()*this.m13()-this.m10()*this.m01()*this.m33()+this.m00()*this.m11()*this.m33())/t,(this.m20()*this.m11()*this.m03()-this.m10()*this.m21()*this.m03()-this.m20()*this.m01()*this.m13()+this.m00()*this.m21()*this.m13()+this.m10()*this.m01()*this.m23()-this.m00()*this.m11()*this.m23())/t,(this.m30()*this.m21()*this.m12()-this.m20()*this.m31()*this.m12()-this.m30()*this.m11()*this.m22()+this.m10()*this.m31()*this.m22()+this.m20()*this.m11()*this.m32()-this.m10()*this.m21()*this.m32())/t,(-this.m30()*this.m21()*this.m02()+this.m20()*this.m31()*this.m02()+this.m30()*this.m01()*this.m22()-this.m00()*this.m31()*this.m22()-this.m20()*this.m01()*this.m32()+this.m00()*this.m21()*this.m32())/t,(this.m30()*this.m11()*this.m02()-this.m10()*this.m31()*this.m02()-this.m30()*this.m01()*this.m12()+this.m00()*this.m31()*this.m12()+this.m10()*this.m01()*this.m32()-this.m00()*this.m11()*this.m32())/t,(-this.m20()*this.m11()*this.m02()+this.m10()*this.m21()*this.m02()+this.m20()*this.m01()*this.m12()-this.m00()*this.m21()*this.m12()-this.m10()*this.m01()*this.m22()+this.m00()*this.m11()*this.m22())/t);throw new Error("Matrix could not be inverted, determinant === 0");default:throw new Error("Matrix3.inverted with unknown type: "+this.type)}},timesMatrix:function(t){if(this.type===s.IDENTITY||t.type===s.IDENTITY)return this.type===s.IDENTITY?t:this;if(this.type===t.type){if(this.type===s.TRANSLATION_3D)return new n(1,0,0,this.m03()+t.m02(),0,1,0,this.m13()+t.m12(),0,0,1,this.m23()+t.m23(),0,0,0,1,s.TRANSLATION_3D);if(this.type===s.SCALING)return new n(this.m00()*t.m00(),0,0,0,0,this.m11()*t.m11(),0,0,0,0,this.m22()*t.m22(),0,0,0,0,1,s.SCALING)}return this.type!==s.OTHER&&t.type!==s.OTHER?new n(this.m00()*t.m00()+this.m01()*t.m10()+this.m02()*t.m20(),this.m00()*t.m01()+this.m01()*t.m11()+this.m02()*t.m21(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02()*t.m22(),this.m00()*t.m03()+this.m01()*t.m13()+this.m02()*t.m23()+this.m03(),this.m10()*t.m00()+this.m11()*t.m10()+this.m12()*t.m20(),this.m10()*t.m01()+this.m11()*t.m11()+this.m12()*t.m21(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12()*t.m22(),this.m10()*t.m03()+this.m11()*t.m13()+this.m12()*t.m23()+this.m13(),this.m20()*t.m00()+this.m21()*t.m10()+this.m22()*t.m20(),this.m20()*t.m01()+this.m21()*t.m11()+this.m22()*t.m21(),this.m20()*t.m02()+this.m21()*t.m12()+this.m22()*t.m22(),this.m20()*t.m03()+this.m21()*t.m13()+this.m22()*t.m23()+this.m23(),0,0,0,1,s.AFFINE):new n(this.m00()*t.m00()+this.m01()*t.m10()+this.m02()*t.m20()+this.m03()*t.m30(),this.m00()*t.m01()+this.m01()*t.m11()+this.m02()*t.m21()+this.m03()*t.m31(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02()*t.m22()+this.m03()*t.m32(),this.m00()*t.m03()+this.m01()*t.m13()+this.m02()*t.m23()+this.m03()*t.m33(),this.m10()*t.m00()+this.m11()*t.m10()+this.m12()*t.m20()+this.m13()*t.m30(),this.m10()*t.m01()+this.m11()*t.m11()+this.m12()*t.m21()+this.m13()*t.m31(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12()*t.m22()+this.m13()*t.m32(),this.m10()*t.m03()+this.m11()*t.m13()+this.m12()*t.m23()+this.m13()*t.m33(),this.m20()*t.m00()+this.m21()*t.m10()+this.m22()*t.m20()+this.m23()*t.m30(),this.m20()*t.m01()+this.m21()*t.m11()+this.m22()*t.m21()+this.m23()*t.m31(),this.m20()*t.m02()+this.m21()*t.m12()+this.m22()*t.m22()+this.m23()*t.m32(),this.m20()*t.m03()+this.m21()*t.m13()+this.m22()*t.m23()+this.m23()*t.m33(),this.m30()*t.m00()+this.m31()*t.m10()+this.m32()*t.m20()+this.m33()*t.m30(),this.m30()*t.m01()+this.m31()*t.m11()+this.m32()*t.m21()+this.m33()*t.m31(),this.m30()*t.m02()+this.m31()*t.m12()+this.m32()*t.m22()+this.m33()*t.m32(),this.m30()*t.m03()+this.m31()*t.m13()+this.m32()*t.m23()+this.m33()*t.m33())},timesVector4:function(t){var i=this.m00()*t.x+this.m01()*t.y+this.m02()*t.z+this.m03()*t.w,n=this.m10()*t.x+this.m11()*t.y+this.m12()*t.z+this.m13()*t.w,s=this.m20()*t.x+this.m21()*t.y+this.m22()*t.z+this.m23()*t.w,r=this.m30()*t.x+this.m31()*t.y+this.m32()*t.z+this.m33()*t.w;return new e.Vector4(i,n,s,r)},timesVector3:function(t){return this.timesVector4(t.toVector4()).toVector3()},timesTransposeVector4:function(t){var i=this.m00()*t.x+this.m10()*t.y+this.m20()*t.z+this.m30()*t.w,n=this.m01()*t.x+this.m11()*t.y+this.m21()*t.z+this.m31()*t.w,s=this.m02()*t.x+this.m12()*t.y+this.m22()*t.z+this.m32()*t.w,r=this.m03()*t.x+this.m13()*t.y+this.m23()*t.z+this.m33()*t.w;return new e.Vector4(i,n,s,r)},timesTransposeVector3:function(t){return this.timesTransposeVector4(t.toVector4()).toVector3()},timesRelativeVector3:function(t){var i=this.m00()*t.x+this.m10()*t.y+this.m20()*t.z,n=this.m01()*t.y+this.m11()*t.y+this.m21()*t.z,s=this.m02()*t.z+this.m12()*t.y+this.m22()*t.z;return new e.Vector3(i,n,s)},getDeterminant:function(){return this.m03()*this.m12()*this.m21()*this.m30()-this.m02()*this.m13()*this.m21()*this.m30()-this.m03()*this.m11()*this.m22()*this.m30()+this.m01()*this.m13()*this.m22()*this.m30()+this.m02()*this.m11()*this.m23()*this.m30()-this.m01()*this.m12()*this.m23()*this.m30()-this.m03()*this.m12()*this.m20()*this.m31()+this.m02()*this.m13()*this.m20()*this.m31()+this.m03()*this.m10()*this.m22()*this.m31()-this.m00()*this.m13()*this.m22()*this.m31()-this.m02()*this.m10()*this.m23()*this.m31()+this.m00()*this.m12()*this.m23()*this.m31()+this.m03()*this.m11()*this.m20()*this.m32()-this.m01()*this.m13()*this.m20()*this.m32()-this.m03()*this.m10()*this.m21()*this.m32()+this.m00()*this.m13()*this.m21()*this.m32()+this.m01()*this.m10()*this.m23()*this.m32()-this.m00()*this.m11()*this.m23()*this.m32()-this.m02()*this.m11()*this.m20()*this.m33()+this.m01()*this.m12()*this.m20()*this.m33()+this.m02()*this.m10()*this.m21()*this.m33()-this.m00()*this.m12()*this.m21()*this.m33()-this.m01()*this.m10()*this.m22()*this.m33()+this.m00()*this.m11()*this.m22()*this.m33()},get determinant(){return this.getDeterminant()},toString:function(){return this.m00()+" "+this.m01()+" "+this.m02()+" "+this.m03()+"\n"+this.m10()+" "+this.m11()+" "+this.m12()+" "+this.m13()+"\n"+this.m20()+" "+this.m21()+" "+this.m22()+" "+this.m23()+"\n"+this.m30()+" "+this.m31()+" "+this.m32()+" "+this.m33()},makeImmutable:function(){this.rowMajor=function(){throw new Error("Cannot modify immutable matrix")}}},n.IDENTITY=new n,n.IDENTITY.makeImmutable(),n}),i("DOT/Matrix3",["require","DOT/dot","PHET_CORE/Poolable","DOT/Vector2","DOT/Vector3","DOT/Matrix4"],function(t){var e=t("DOT/dot"),i=t("PHET_CORE/Poolable"),n=e.FastArray;t("DOT/Vector2"),t("DOT/Vector3"),t("DOT/Matrix4");var s=new n(9);s[0]=1,s[4]=1,s[8]=1;var r=n===Array?function(){return[1,0,0,0,1,0,0,0,1]}:function(){return new n(s)};e.Matrix3=function(){this.entries=r(),this.type=a.IDENTITY};var o=e.Matrix3;o.Types={OTHER:0,IDENTITY:1,TRANSLATION_2D:2,SCALING:3,AFFINE:4};var a=o.Types;return o.identity=function(){return o.dirtyFromPool().setToIdentity()},o.translation=function(t,e){return o.dirtyFromPool().setToTranslation(t,e)},o.translationFromVector=function(t){return o.translation(t.x,t.y)},o.scaling=function(t,e){return o.dirtyFromPool().setToScale(t,e)},o.scale=o.scaling,o.affine=function(t,e,i,n,s,r){return o.dirtyFromPool().setToAffine(t,i,s,e,n,r)},o.rowMajor=function(t,e,i,n,s,r,a,h,u,l){return o.dirtyFromPool().rowMajor(t,e,i,n,s,r,a,h,u,l)},o.rotationAxisAngle=function(t,e){return o.dirtyFromPool().setToRotationAxisAngle(t,e)},o.rotationX=function(t){return o.dirtyFromPool().setToRotationX(t)},o.rotationY=function(t){return o.dirtyFromPool().setToRotationY(t)},o.rotationZ=function(t){return o.dirtyFromPool().setToRotationZ(t)},o.rotation2=o.rotationZ,o.rotationAround=function(t,e,i){return o.translation(e,i).timesMatrix(o.rotation2(t)).timesMatrix(o.translation(-e,-i))},o.rotationAroundPoint=function(t,e){return o.rotationAround(t,e.x,e.y)},o.fromSVGMatrix=function(t){return o.dirtyFromPool().setToSVGMatrix(t)},o.rotateAToB=function(t,e){return o.dirtyFromPool().setRotationAToB(t,e)},o.prototype={constructor:o,m00:function(){return this.entries[0]},m01:function(){return this.entries[3]},m02:function(){return this.entries[6]},m10:function(){return this.entries[1]},m11:function(){return this.entries[4]},m12:function(){return this.entries[7]},m20:function(){return this.entries[2]},m21:function(){return this.entries[5]},m22:function(){return this.entries[8]},isIdentity:function(){return this.type===a.IDENTITY||this.equals(o.IDENTITY)},isAffine:function(){return this.type===a.AFFINE||0===this.m20()&&0===this.m21()&&1===this.m22()},isAligned:function(){return this.isAffine()&&0===this.m01()&&0===this.m10()},isAxisAligned:function(){return this.isAffine()&&(0===this.m01()&&0===this.m10()||0===this.m00()&&0===this.m11())},isFinite:function(){return isFinite(this.m00())&&isFinite(this.m01())&&isFinite(this.m02())&&isFinite(this.m10())&&isFinite(this.m11())&&isFinite(this.m12())&&isFinite(this.m20())&&isFinite(this.m21())&&isFinite(this.m22())},getDeterminant:function(){return this.m00()*this.m11()*this.m22()+this.m01()*this.m12()*this.m20()+this.m02()*this.m10()*this.m21()-this.m02()*this.m11()*this.m20()-this.m01()*this.m10()*this.m22()-this.m00()*this.m12()*this.m21()},get determinant(){return this.getDeterminant()},getTranslation:function(){return new e.Vector2(this.m02(),this.m12())},get translation(){return this.getTranslation()},getScaleVector:function(){return new e.Vector2(Math.sqrt(this.m00()*this.m00()+this.m10()*this.m10()),Math.sqrt(this.m01()*this.m01()+this.m11()*this.m11()))},get scaleVector(){return this.getScaleVector()},getRotation:function(){var t=this.timesVector2(e.Vector2.X_UNIT).minus(this.timesVector2(e.Vector2.ZERO));return Math.atan2(t.y,t.x)},get rotation(){return this.getRotation()},toMatrix4:function(){return new e.Matrix4(this.m00(),this.m01(),this.m02(),0,this.m10(),this.m11(),this.m12(),0,this.m20(),this.m21(),this.m22(),0,0,0,0,1)},toString:function(){return this.m00()+" "+this.m01()+" "+this.m02()+"\n"+this.m10()+" "+this.m11()+" "+this.m12()+"\n"+this.m20()+" "+this.m21()+" "+this.m22()},toSVGMatrix:function(){var t=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix();return t.a=this.m00(),t.b=this.m10(),t.c=this.m01(),t.d=this.m11(),t.e=this.m02(),t.f=this.m12(),t},getCSSTransform:function(){return"matrix("+this.entries[0].toFixed(20)+","+this.entries[1].toFixed(20)+","+this.entries[3].toFixed(20)+","+this.entries[4].toFixed(20)+","+this.entries[6].toFixed(20)+","+this.entries[7].toFixed(20)+")"},get cssTransform(){return this.getCSSTransform()},getSVGTransform:function(){function t(t){return t.toFixed(20)}switch(this.type){case a.IDENTITY:return"";case a.TRANSLATION_2D:return"translate("+t(this.entries[6])+","+t(this.entries[7])+")";case a.SCALING:return"scale("+t(this.entries[0])+(this.entries[0]===this.entries[4]?"":","+t(this.entries[4]))+")";default:return"matrix("+t(this.entries[0])+","+t(this.entries[1])+","+t(this.entries[3])+","+t(this.entries[4])+","+t(this.entries[6])+","+t(this.entries[7])+")"}},get svgTransform(){return this.getSVGTransform()},getCSSTransformStyles:function(){var t=this.getCSSTransform();return{"-webkit-perspective":1e3,"-webkit-backface-visibility":"hidden","-webkit-transform":t+" translateZ(0)","-moz-transform":t+" translateZ(0)","-ms-transform":t,"-o-transform":t,transform:t,"transform-origin":"top left","-ms-transform-origin":"top left"}},get cssTransformStyles(){return this.getCSSTransformStyles()},equals:function(t){return this.m00()===t.m00()&&this.m01()===t.m01()&&this.m02()===t.m02()&&this.m10()===t.m10()&&this.m11()===t.m11()&&this.m12()===t.m12()&&this.m20()===t.m20()&&this.m21()===t.m21()&&this.m22()===t.m22()},equalsEpsilon:function(t,e){return Math.abs(this.m00()-t.m00())<e&&Math.abs(this.m01()-t.m01())<e&&Math.abs(this.m02()-t.m02())<e&&Math.abs(this.m10()-t.m10())<e&&Math.abs(this.m11()-t.m11())<e&&Math.abs(this.m12()-t.m12())<e&&Math.abs(this.m20()-t.m20())<e&&Math.abs(this.m21()-t.m21())<e&&Math.abs(this.m22()-t.m22())<e},copy:function(){return o.createFromPool(this.m00(),this.m01(),this.m02(),this.m10(),this.m11(),this.m12(),this.m20(),this.m21(),this.m22(),this.type)},plus:function(t){return o.createFromPool(this.m00()+t.m00(),this.m01()+t.m01(),this.m02()+t.m02(),this.m10()+t.m10(),this.m11()+t.m11(),this.m12()+t.m12(),this.m20()+t.m20(),this.m21()+t.m21(),this.m22()+t.m22())},minus:function(t){return o.createFromPool(this.m00()-t.m00(),this.m01()-t.m01(),this.m02()-t.m02(),this.m10()-t.m10(),this.m11()-t.m11(),this.m12()-t.m12(),this.m20()-t.m20(),this.m21()-t.m21(),this.m22()-t.m22())},transposed:function(){return o.createFromPool(this.m00(),this.m10(),this.m20(),this.m01(),this.m11(),this.m21(),this.m02(),this.m12(),this.m22(),this.type===a.IDENTITY||this.type===a.SCALING?this.type:void 0)},negated:function(){return o.createFromPool(-this.m00(),-this.m01(),-this.m02(),-this.m10(),-this.m11(),-this.m12(),-this.m20(),-this.m21(),-this.m22())},inverted:function(){var t;switch(this.type){case a.IDENTITY:return this;case a.TRANSLATION_2D:return o.createFromPool(1,0,-this.m02(),0,1,-this.m12(),0,0,1,a.TRANSLATION_2D);case a.SCALING:return o.createFromPool(1/this.m00(),0,0,0,1/this.m11(),0,0,0,1/this.m22(),a.SCALING);case a.AFFINE:if(t=this.getDeterminant(),0!==t)return o.createFromPool((-this.m12()*this.m21()+this.m11()*this.m22())/t,(this.m02()*this.m21()-this.m01()*this.m22())/t,(-this.m02()*this.m11()+this.m01()*this.m12())/t,(this.m12()*this.m20()-this.m10()*this.m22())/t,(-this.m02()*this.m20()+this.m00()*this.m22())/t,(this.m02()*this.m10()-this.m00()*this.m12())/t,0,0,1,a.AFFINE);throw new Error("Matrix could not be inverted, determinant === 0");case a.OTHER:if(t=this.getDeterminant(),0!==t)return o.createFromPool((-this.m12()*this.m21()+this.m11()*this.m22())/t,(this.m02()*this.m21()-this.m01()*this.m22())/t,(-this.m02()*this.m11()+this.m01()*this.m12())/t,(this.m12()*this.m20()-this.m10()*this.m22())/t,(-this.m02()*this.m20()+this.m00()*this.m22())/t,(this.m02()*this.m10()-this.m00()*this.m12())/t,(-this.m11()*this.m20()+this.m10()*this.m21())/t,(this.m01()*this.m20()-this.m00()*this.m21())/t,(-this.m01()*this.m10()+this.m00()*this.m11())/t,a.OTHER);throw new Error("Matrix could not be inverted, determinant === 0");default:throw new Error("Matrix3.inverted with unknown type: "+this.type)}},timesMatrix:function(t){if(this.type===a.IDENTITY||t.type===a.IDENTITY)return this.type===a.IDENTITY?t:this;if(this.type===t.type){if(this.type===a.TRANSLATION_2D)return o.createFromPool(1,0,this.m02()+t.m02(),0,1,this.m12()+t.m12(),0,0,1,a.TRANSLATION_2D);if(this.type===a.SCALING)return o.createFromPool(this.m00()*t.m00(),0,0,0,this.m11()*t.m11(),0,0,0,1,a.SCALING)}return this.type!==a.OTHER&&t.type!==a.OTHER?o.createFromPool(this.m00()*t.m00()+this.m01()*t.m10(),this.m00()*t.m01()+this.m01()*t.m11(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02(),this.m10()*t.m00()+this.m11()*t.m10(),this.m10()*t.m01()+this.m11()*t.m11(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12(),0,0,1,a.AFFINE):o.createFromPool(this.m00()*t.m00()+this.m01()*t.m10()+this.m02()*t.m20(),this.m00()*t.m01()+this.m01()*t.m11()+this.m02()*t.m21(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02()*t.m22(),this.m10()*t.m00()+this.m11()*t.m10()+this.m12()*t.m20(),this.m10()*t.m01()+this.m11()*t.m11()+this.m12()*t.m21(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12()*t.m22(),this.m20()*t.m00()+this.m21()*t.m10()+this.m22()*t.m20(),this.m20()*t.m01()+this.m21()*t.m11()+this.m22()*t.m21(),this.m20()*t.m02()+this.m21()*t.m12()+this.m22()*t.m22())},timesVector2:function(t){var i=this.m00()*t.x+this.m01()*t.y+this.m02(),n=this.m10()*t.x+this.m11()*t.y+this.m12();return new e.Vector2(i,n)},timesVector3:function(t){var i=this.m00()*t.x+this.m01()*t.y+this.m02()*t.z,n=this.m10()*t.x+this.m11()*t.y+this.m12()*t.z,s=this.m20()*t.x+this.m21()*t.y+this.m22()*t.z;return new e.Vector3(i,n,s)},timesTransposeVector2:function(t){var i=this.m00()*t.x+this.m10()*t.y,n=this.m01()*t.x+this.m11()*t.y;return new e.Vector2(i,n)},timesRelativeVector2:function(t){var i=this.m00()*t.x+this.m01()*t.y,n=this.m10()*t.y+this.m11()*t.y;return new e.Vector2(i,n)},rowMajor:function(t,e,i,n,s,r,o,h,u,l){return this.entries[0]=t,this.entries[1]=n,this.entries[2]=o,this.entries[3]=e,this.entries[4]=s,this.entries[5]=h,this.entries[6]=i,this.entries[7]=r,this.entries[8]=u,this.type=void 0===l?0===o&&0===h&&1===u?a.AFFINE:a.OTHER:l,this},set:function(t){return this.rowMajor(t.m00(),t.m01(),t.m02(),t.m10(),t.m11(),t.m12(),t.m20(),t.m21(),t.m22(),t.type)},makeImmutable:function(){return this.rowMajor=function(){throw new Error("Cannot modify immutable matrix")},this},columnMajor:function(t,e,i,n,s,r,o,a,h,u){return this.rowMajor(t,n,o,e,s,a,i,r,h,u)},add:function(t){return this.rowMajor(this.m00()+t.m00(),this.m01()+t.m01(),this.m02()+t.m02(),this.m10()+t.m10(),this.m11()+t.m11(),this.m12()+t.m12(),this.m20()+t.m20(),this.m21()+t.m21(),this.m22()+t.m22())},subtract:function(t){return this.rowMajor(this.m00()-t.m00(),this.m01()-t.m01(),this.m02()-t.m02(),this.m10()-t.m10(),this.m11()-t.m11(),this.m12()-t.m12(),this.m20()-t.m20(),this.m21()-t.m21(),this.m22()-t.m22())},transpose:function(){return this.rowMajor(this.m00(),this.m10(),this.m20(),this.m01(),this.m11(),this.m21(),this.m02(),this.m12(),this.m22(),this.type===a.IDENTITY||this.type===a.SCALING?this.type:void 0)},negate:function(){return this.rowMajor(-this.m00(),-this.m01(),-this.m02(),-this.m10(),-this.m11(),-this.m12(),-this.m20(),-this.m21(),-this.m22())},invert:function(){var t;switch(this.type){case a.IDENTITY:return this;case a.TRANSLATION_2D:return this.rowMajor(1,0,-this.m02(),0,1,-this.m12(),0,0,1,a.TRANSLATION_2D);case a.SCALING:return this.rowMajor(1/this.m00(),0,0,0,1/this.m11(),0,0,0,1/this.m22(),a.SCALING);case a.AFFINE:if(t=this.getDeterminant(),0!==t)return this.rowMajor((-this.m12()*this.m21()+this.m11()*this.m22())/t,(this.m02()*this.m21()-this.m01()*this.m22())/t,(-this.m02()*this.m11()+this.m01()*this.m12())/t,(this.m12()*this.m20()-this.m10()*this.m22())/t,(-this.m02()*this.m20()+this.m00()*this.m22())/t,(this.m02()*this.m10()-this.m00()*this.m12())/t,0,0,1,a.AFFINE);throw new Error("Matrix could not be inverted, determinant === 0");case a.OTHER:if(t=this.getDeterminant(),0!==t)return this.rowMajor((-this.m12()*this.m21()+this.m11()*this.m22())/t,(this.m02()*this.m21()-this.m01()*this.m22())/t,(-this.m02()*this.m11()+this.m01()*this.m12())/t,(this.m12()*this.m20()-this.m10()*this.m22())/t,(-this.m02()*this.m20()+this.m00()*this.m22())/t,(this.m02()*this.m10()-this.m00()*this.m12())/t,(-this.m11()*this.m20()+this.m10()*this.m21())/t,(this.m01()*this.m20()-this.m00()*this.m21())/t,(-this.m01()*this.m10()+this.m00()*this.m11())/t,a.OTHER);throw new Error("Matrix could not be inverted, determinant === 0");default:throw new Error("Matrix3.inverted with unknown type: "+this.type)}},multiplyMatrix:function(t){if(t.type===a.IDENTITY)return this;if(this.type===a.IDENTITY)return this.set(t);if(this.type===t.type){if(this.type===a.TRANSLATION_2D)return this.rowMajor(1,0,this.m02()+t.m02(),0,1,this.m12()+t.m12(),0,0,1,a.TRANSLATION_2D);if(this.type===a.SCALING)return this.rowMajor(this.m00()*t.m00(),0,0,0,this.m11()*t.m11(),0,0,0,1,a.SCALING)}return this.type!==a.OTHER&&t.type!==a.OTHER?this.rowMajor(this.m00()*t.m00()+this.m01()*t.m10(),this.m00()*t.m01()+this.m01()*t.m11(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02(),this.m10()*t.m00()+this.m11()*t.m10(),this.m10()*t.m01()+this.m11()*t.m11(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12(),0,0,1,a.AFFINE):this.rowMajor(this.m00()*t.m00()+this.m01()*t.m10()+this.m02()*t.m20(),this.m00()*t.m01()+this.m01()*t.m11()+this.m02()*t.m21(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02()*t.m22(),this.m10()*t.m00()+this.m11()*t.m10()+this.m12()*t.m20(),this.m10()*t.m01()+this.m11()*t.m11()+this.m12()*t.m21(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12()*t.m22(),this.m20()*t.m00()+this.m21()*t.m10()+this.m22()*t.m20(),this.m20()*t.m01()+this.m21()*t.m11()+this.m22()*t.m21(),this.m20()*t.m02()+this.m21()*t.m12()+this.m22()*t.m22())},setToIdentity:function(){return this.rowMajor(1,0,0,0,1,0,0,0,1,a.IDENTITY)},setToTranslation:function(t,e){return this.rowMajor(1,0,t,0,1,e,0,0,1,a.TRANSLATION_2D)},setToScale:function(t,e){return e=void 0===e?t:e,this.rowMajor(t,0,0,0,e,0,0,0,1,a.SCALING)},setToAffine:function(t,e,i,n,s,r){return this.rowMajor(t,e,i,n,s,r,0,0,1,a.AFFINE)},setToRotationAxisAngle:function(t,e){var i=Math.cos(e),n=Math.sin(e),s=1-i;return this.rowMajor(t.x*t.x*s+i,t.x*t.y*s-t.z*n,t.x*t.z*s+t.y*n,t.y*t.x*s+t.z*n,t.y*t.y*s+i,t.y*t.z*s-t.x*n,t.z*t.x*s-t.y*n,t.z*t.y*s+t.x*n,t.z*t.z*s+i,a.OTHER)},setToRotationX:function(t){var e=Math.cos(t),i=Math.sin(t);return this.rowMajor(1,0,0,0,e,-i,0,i,e,a.OTHER)},setToRotationY:function(t){var e=Math.cos(t),i=Math.sin(t);return this.rowMajor(e,0,i,0,1,0,-i,0,e,a.OTHER)},setToRotationZ:function(t){var e=Math.cos(t),i=Math.sin(t);return this.rowMajor(e,-i,0,i,e,0,0,0,1,a.AFFINE)},setToSVGMatrix:function(t){return this.rowMajor(t.a,t.c,t.e,t.b,t.d,t.f,0,0,1,a.AFFINE)},setRotationAToB:function(t,i){var n,s,r,o=t,a=i,h=1e-4,u=o.cross(a);if(n=o.dot(a),r=0>n?-n:n,r>1-h){var l,c,d,m=new e.Vector3(o.x>0?o.x:-o.x,o.y>0?o.y:-o.y,o.z>0?o.z:-o.z);m=m.x<m.y?m.x<m.z?e.Vector3.X_UNIT:e.Vector3.Z_UNIT:m.y<m.z?e.Vector3.Y_UNIT:e.Vector3.Z_UNIT;var f=m.minus(o);return u=m.minus(a),l=2/f.dot(f),c=2/u.dot(u),d=l*c*f.dot(u),this.rowMajor(-l*f.x*f.x-c*u.x*u.x+d*u.x*f.x+1,-l*f.x*f.y-c*u.x*u.y+d*u.x*f.y,-l*f.x*f.z-c*u.x*u.z+d*u.x*f.z,-l*f.y*f.x-c*u.y*u.x+d*u.y*f.x,-l*f.y*f.y-c*u.y*u.y+d*u.y*f.y+1,-l*f.y*f.z-c*u.y*u.z+d*u.y*f.z,-l*f.z*f.x-c*u.z*u.x+d*u.z*f.x,-l*f.z*f.y-c*u.z*u.y+d*u.z*f.y,-l*f.z*f.z-c*u.z*u.z+d*u.z*f.z+1)}var g,p,v,y,x;return s=1/(1+n),g=s*u.x,p=s*u.z,v=g*u.y,y=g*u.z,x=p*u.y,this.rowMajor(n+g*u.x,v-u.z,y+u.y,v+u.z,n+s*u.y*u.y,x-u.x,y-u.y,x+u.x,n+p*u.z)},multiplyVector2:function(t){return t.setXY(this.m00()*t.x+this.m01()*t.y+this.m02(),this.m10()*t.x+this.m11()*t.y+this.m12())},multiplyVector3:function(t){return t.setXYZ(this.m00()*t.x+this.m01()*t.y+this.m02()*t.z,this.m10()*t.x+this.m11()*t.y+this.m12()*t.z,this.m20()*t.x+this.m21()*t.y+this.m22()*t.z)},multiplyTransposeVector2:function(t){return t.setXY(this.m00()*t.x+this.m10()*t.y,this.m01()*t.x+this.m11()*t.y)},multiplyRelativeVector2:function(t){return t.setXY(this.m00()*t.x+this.m01()*t.y,this.m10()*t.y+this.m11()*t.y)},canvasSetTransform:function(t){t.setTransform(this.entries[0],this.entries[1],this.entries[3],this.entries[4],this.entries[6],this.entries[7])},canvasAppendTransform:function(t){this.type!==a.IDENTITY&&t.transform(this.entries[0],this.entries[1],this.entries[3],this.entries[4],this.entries[6],this.entries[7])}},i(o,{defaultFactory:function(){return new o},constructorDuplicateFactory:function(t){return function(e,i,n,s,r,a,h,u,l,c){var d=t.length?t.pop():new o;return d.rowMajor(e,i,n,s,r,a,h,u,l,c)}}}),o.IDENTITY=o.identity(),o.IDENTITY.makeImmutable(),o.X_REFLECTION=o.createFromPool(-1,0,0,0,1,0,0,0,1,a.AFFINE),o.X_REFLECTION.makeImmutable(),o.Y_REFLECTION=o.createFromPool(1,0,0,0,-1,0,0,0,1,a.AFFINE),o.Y_REFLECTION.makeImmutable(),o.translationTimesMatrix=function(t,e,i){var n;return i.type===a.IDENTITY||i.type===a.TRANSLATION_2D?o.createFromPool(1,0,i.m02()+t,0,1,i.m12()+e,0,0,1,a.TRANSLATION_2D):(n=i.type===a.OTHER?a.OTHER:a.AFFINE,o.createFromPool(i.m00(),i.m01(),i.m02()+t,i.m10(),i.m11(),i.m12()+e,i.m20(),i.m21(),i.m22(),n))},o.printer={print:function(t){console.log(t.toString())}},o}),i("DOT/Ray2",["require","DOT/dot"],function(t){var e=t("DOT/dot");e.Ray2=function(t,e){this.pos=t,this.dir=e};var i=e.Ray2;return i.prototype={constructor:i,shifted:function(t){return new i(this.pointAtDistance(t),this.dir)},pointAtDistance:function(t){return this.pos.plus(this.dir.timesScalar(t))},toString:function(){return this.pos.toString()+" => "+this.dir.toString()
}},i}),i("DOT/Transform3",["require","DOT/dot","DOT/Matrix3","DOT/Vector2","DOT/Ray2"],function(t){var e=t("DOT/dot");t("DOT/Matrix3"),t("DOT/Vector2"),t("DOT/Ray2"),e.Transform3=function(t){this.listeners=[],this.setMatrix(void 0===t?e.Matrix3.IDENTITY:t)};var i=e.Transform3;return i.prototype={constructor:i,setMatrix:function(t){if(t.isFinite()){var e,i=this.matrix,n=this.listeners.length;for(e=0;n>e;e++)this.listeners[e].before(t,i);for(this.matrix=t,this.inverse=null,this.matrixTransposed=null,this.inverseTransposed=null,e=0;n>e;e++)this.listeners[e].after(t,i)}},prepend:function(t){this.setMatrix(t.timesMatrix(this.matrix))},prependTranslation:function(t,i){this.setMatrix(e.Matrix3.translationTimesMatrix(t,i,this.matrix))},append:function(t){this.setMatrix(this.matrix.timesMatrix(t))},prependTransform:function(t){this.prepend(t.matrix)},appendTransform:function(t){this.append(t.matrix)},applyToCanvasContext:function(t){t.setTransform(this.matrix.m00(),this.matrix.m10(),this.matrix.m01(),this.matrix.m11(),this.matrix.m02(),this.matrix.m12())},copy:function(){var t=new i(this.matrix);t.inverse=this.inverse,t.matrixTransposed=this.matrixTransposed,t.inverseTransposed=this.inverseTransposed},deepCopy:function(){var t=new i(this.matrix.copy());t.inverse=this.inverse?this.inverse.copy():null,t.matrixTransposed=this.matrixTransposed?this.matrixTransposed.copy():null,t.inverseTransposed=this.inverseTransposed?this.inverseTransposed.copy():null},getMatrix:function(){return this.matrix},getInverse:function(){return null===this.inverse&&(this.inverse=this.matrix.inverted()),this.inverse},getMatrixTransposed:function(){return null===this.matrixTransposed&&(this.matrixTransposed=this.matrix.transposed()),this.matrixTransposed},getInverseTransposed:function(){return null===this.inverseTransposed&&(this.inverseTransposed=this.getInverse().transposed()),this.inverseTransposed},isIdentity:function(){return this.matrix.type===e.Matrix3.Types.IDENTITY},isFinite:function(){return this.matrix.isFinite()},transformPosition2:function(t){return this.matrix.timesVector2(t)},transformDelta2:function(t){var i=this.getMatrix();return new e.Vector2(i.m00()*t.x+i.m01()*t.y,i.m10()*t.x+i.m11()*t.y)},transformNormal2:function(t){return this.getInverse().timesTransposeVector2(t)},transformX:function(t){var e=this.getMatrix();return e.m00()*t+e.m02()},transformY:function(t){var e=this.getMatrix();return e.m11()*t+e.m12()},transformDeltaX:function(t){var e=this.getMatrix();return e.m00()*t},transformDeltaY:function(t){var e=this.getMatrix();return e.m11()*t},transformBounds2:function(t){return t.transformed(this.matrix)},transformShape:function(t){return t.transformed(this.matrix)},transformRay2:function(t){return new e.Ray2(this.transformPosition2(t.pos),this.transformDelta2(t.dir).normalized())},inversePosition2:function(t){return this.getInverse().timesVector2(t)},inverseDelta2:function(t){var i=this.getInverse();return new e.Vector2(i.m00()*t.x+i.m01()*t.y,i.m10()*t.x+i.m11()*t.y)},inverseNormal2:function(t){return this.matrix.timesTransposeVector2(t)},inverseX:function(t){var e=this.getInverse();return e.m00()*t+e.m02()},inverseY:function(t){var e=this.getInverse();return e.m11()*t+e.m12()},inverseDeltaX:function(t){var e=this.getInverse();return e.m00()*t},inverseDeltaY:function(t){var e=this.getInverse();return e.m11()*t},inverseBounds2:function(t){return t.transformed(this.getInverse())},inverseShape:function(t){return t.transformed(this.getInverse())},inverseRay2:function(t){return new e.Ray2(this.inversePosition2(t.pos),this.inverseDelta2(t.dir).normalized())},addTransformListener:function(t){this.listeners.push(t)},prependTransformListener:function(t){this.listeners.unshift(t)},removeTransformListener:function(t){this.listeners.splice(_.indexOf(this.listeners,t),1)}},i}),i("DOT/Bounds2",["require","DOT/dot","PHET_CORE/Poolable","DOT/Vector2"],function(t){var e=t("DOT/dot"),i=t("PHET_CORE/Poolable");t("DOT/Vector2");var n=new e.Vector2;e.Bounds2=function(t,e,i,n){this.minX=t,this.minY=e,this.maxX=i,this.maxY=n};var s=e.Bounds2;return s.prototype={constructor:s,isBounds:!0,dimension:2,getWidth:function(){return this.maxX-this.minX},get width(){return this.getWidth()},getHeight:function(){return this.maxY-this.minY},get height(){return this.getHeight()},getX:function(){return this.minX},get x(){return this.getX()},getY:function(){return this.minY},get y(){return this.getY()},getMinX:function(){return this.minX},get left(){return this.minX},getMinY:function(){return this.minY},get top(){return this.minY},getMaxX:function(){return this.maxX},get right(){return this.maxX},getMaxY:function(){return this.maxY},get bottom(){return this.maxY},getCenterX:function(){return(this.maxX+this.minX)/2},get centerX(){return this.getCenterX()},getCenterY:function(){return(this.maxY+this.minY)/2},get centerY(){return this.getCenterY()},getLeftTop:function(){return new e.Vector2(this.minX,this.minY)},get leftTop(){return this.getLeftTop()},getCenterTop:function(){return new e.Vector2(this.getCenterX(),this.minY)},get centerTop(){return this.getCenterTop()},getRightTop:function(){return new e.Vector2(this.maxX,this.minY)},get rightTop(){return this.getRightTop()},getLeftCenter:function(){return new e.Vector2(this.minX,this.getCenterY())},get leftCenter(){return this.getLeftCenter()},getCenter:function(){return new e.Vector2(this.getCenterX(),this.getCenterY())},get center(){return this.getCenter()},getRightCenter:function(){return new e.Vector2(this.maxX,this.getCenterY())},get rightCenter(){return this.getRightCenter()},getLeftBottom:function(){return new e.Vector2(this.minX,this.maxY)},get leftBottom(){return this.getLeftBottom()},getCenterBottom:function(){return new e.Vector2(this.getCenterX(),this.maxY)},get centerBottom(){return this.getCenterBottom()},getRightBottom:function(){return new e.Vector2(this.maxX,this.maxY)},get rightBottom(){return this.getRightBottom()},isEmpty:function(){return this.getWidth()<0||this.getHeight()<0},isFinite:function(){return isFinite(this.minX)&&isFinite(this.minY)&&isFinite(this.maxX)&&isFinite(this.maxY)},hasNonzeroArea:function(){return this.getWidth()>0&&this.getHeight()>0},isValid:function(){return!this.isEmpty()&&this.isFinite()},containsCoordinates:function(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY},containsPoint:function(t){return this.containsCoordinates(t.x,t.y)},containsBounds:function(t){return this.minX<=t.minX&&this.maxX>=t.maxX&&this.minY<=t.minY&&this.maxY>=t.maxY},intersectsBounds:function(t){return!this.intersection(t).isEmpty()},minimumDistanceToPointSquared:function(t){var e,i=t.x<this.minX?this.minX:t.x>this.maxX?this.maxX:null,n=t.y<this.minY?this.minY:t.y>this.maxY?this.maxY:null;if(null===i&&null===n)return 0;if(null===i)return e=n-t.y,e*e;if(null===n)return e=i-t.x,e*e;var s=i-t.x,r=n-t.y;return s*s+r*r},maximumDistanceToPointSquared:function(t){var e=t.x>this.getCenterX()?this.minX:this.maxX,i=t.y>this.getCenterY()?this.minY:this.maxY;return e-=t.x,i-=t.y,e*e+i*i},toString:function(){return"[x:("+this.minX+","+this.maxX+"),y:("+this.minY+","+this.maxY+")]"},equals:function(t){return this.minX===t.minX&&this.minY===t.minY&&this.maxX===t.maxX&&this.maxY===t.maxY},equalsEpsilon:function(t,e){e=e||0;var i=this.isFinite(),n=t.isFinite();return i&&n?Math.abs(this.minX-t.minX)<e&&Math.abs(this.minY-t.minY)<e&&Math.abs(this.maxX-t.maxX)<e&&Math.abs(this.maxY-t.maxY)<e:i!==n?!1:this===t?!0:(isFinite(this.minX+t.minX)?Math.abs(this.minX-t.minX)<e:this.minX===t.minX)&&(isFinite(this.minY+t.minY)?Math.abs(this.minY-t.minY)<e:this.minY===t.minY)&&(isFinite(this.maxX+t.maxX)?Math.abs(this.maxX-t.maxX)<e:this.maxX===t.maxX)&&(isFinite(this.maxY+t.maxY)?Math.abs(this.maxY-t.maxY)<e:this.maxY===t.maxY)},copy:function(t){return t?t.set(this):new s(this.minX,this.minY,this.maxX,this.maxY)},union:function(t){return new s(Math.min(this.minX,t.minX),Math.min(this.minY,t.minY),Math.max(this.maxX,t.maxX),Math.max(this.maxY,t.maxY))},intersection:function(t){return new s(Math.max(this.minX,t.minX),Math.max(this.minY,t.minY),Math.min(this.maxX,t.maxX),Math.min(this.maxY,t.maxY))},withCoordinates:function(t,e){return new s(Math.min(this.minX,t),Math.min(this.minY,e),Math.max(this.maxX,t),Math.max(this.maxY,e))},withPoint:function(t){return this.withCoordinates(t.x,t.y)},withMinX:function(t){return new s(t,this.minY,this.maxX,this.maxY)},withMinY:function(t){return new s(this.minX,t,this.maxX,this.maxY)},withMaxX:function(t){return new s(this.minX,this.minY,t,this.maxY)},withMaxY:function(t){return new s(this.minX,this.minY,this.maxX,t)},roundedOut:function(){return new s(Math.floor(this.minX),Math.floor(this.minY),Math.ceil(this.maxX),Math.ceil(this.maxY))},roundedIn:function(){return new s(Math.ceil(this.minX),Math.ceil(this.minY),Math.floor(this.maxX),Math.floor(this.maxY))},transformed:function(t){return this.copy().transform(t)},dilated:function(t){return new s(this.minX-t,this.minY-t,this.maxX+t,this.maxY+t)},dilatedX:function(t){return new s(this.minX-t,this.minY,this.maxX+t,this.maxY)},dilatedY:function(t){return new s(this.minX,this.minY-t,this.maxX,this.maxY+t)},dilatedXY:function(t,e){return new s(this.minX-t,this.minY-e,this.maxX+t,this.maxY+e)},eroded:function(t){return this.dilated(-t)},erodedX:function(t){return this.dilatedX(-t)},erodedY:function(t){return this.dilatedY(-t)},erodedXY:function(t,e){return this.dilatedXY(-t,-e)},shiftedX:function(t){return new s(this.minX+t,this.minY,this.maxX+t,this.maxY)},shiftedY:function(t){return new s(this.minX,this.minY+t,this.maxX,this.maxY+t)},shifted:function(t,e){return new s(this.minX+t,this.minY+e,this.maxX+t,this.maxY+e)},setMinMax:function(t,e,i,n){return this.minX=t,this.minY=e,this.maxX=i,this.maxY=n,this},setMinX:function(t){return this.minX=t,this},setMinY:function(t){return this.minY=t,this},setMaxX:function(t){return this.maxX=t,this},setMaxY:function(t){return this.maxY=t,this},set:function(t){return this.setMinMax(t.minX,t.minY,t.maxX,t.maxY)},includeBounds:function(t){return this.setMinMax(Math.min(this.minX,t.minX),Math.min(this.minY,t.minY),Math.max(this.maxX,t.maxX),Math.max(this.maxY,t.maxY))},constrainBounds:function(t){return this.setMinMax(Math.max(this.minX,t.minX),Math.max(this.minY,t.minY),Math.min(this.maxX,t.maxX),Math.min(this.maxY,t.maxY))},addCoordinates:function(t,e){return this.setMinMax(Math.min(this.minX,t),Math.min(this.minY,e),Math.max(this.maxX,t),Math.max(this.maxY,e))},addPoint:function(t){return this.addCoordinates(t.x,t.y)},roundOut:function(){return this.setMinMax(Math.floor(this.minX),Math.floor(this.minY),Math.ceil(this.maxX),Math.ceil(this.maxY))},roundIn:function(){return this.setMinMax(Math.ceil(this.minX),Math.ceil(this.minY),Math.floor(this.maxX),Math.floor(this.maxY))},transform:function(t){if(this.isEmpty())return this;if(t.isIdentity())return this;var i=this.minX,s=this.minY,r=this.maxX,o=this.maxY;return this.set(e.Bounds2.NOTHING),this.addPoint(t.multiplyVector2(n.setXY(i,s))),this.addPoint(t.multiplyVector2(n.setXY(i,o))),this.addPoint(t.multiplyVector2(n.setXY(r,s))),this.addPoint(t.multiplyVector2(n.setXY(r,o))),this},dilate:function(t){return this.setMinMax(this.minX-t,this.minY-t,this.maxX+t,this.maxY+t)},dilateX:function(t){return this.setMinMax(this.minX-t,this.minY,this.maxX+t,this.maxY)},dilateY:function(t){return this.setMinMax(this.minX,this.minY-t,this.maxX,this.maxY+t)},dilateXY:function(t,e){return this.setMinMax(this.minX-t,this.minY-e,this.maxX+t,this.maxY+e)},erode:function(t){return this.dilate(-t)},erodeX:function(t){return this.dilateX(-t)},erodeY:function(t){return this.dilateY(-t)},erodeXY:function(t,e){return this.dilateXY(-t,-e)},shiftX:function(t){return this.setMinMax(this.minX+t,this.minY,this.maxX+t,this.maxY)},shiftY:function(t){return this.setMinMax(this.minX,this.minY+t,this.maxX,this.maxY+t)},shift:function(t,e){return this.setMinMax(this.minX+t,this.minY+e,this.maxX+t,this.maxY+e)},getClosestPoint:function(t,i,n){return n?n.setXY(t,i):n=new e.Vector2(t,i),n.x<this.minX&&(n.x=this.minX),n.x>this.maxX&&(n.x=this.maxX),n.y<this.minY&&(n.y=this.minY),n.y>this.maxY&&(n.y=this.maxY),n}},s.rect=function(t,e,i,n){return new s(t,e,t+i,e+n)},s.point=function(t,i){if(t instanceof e.Vector2){var n=t;return new s(n.x,n.y,n.x,n.y)}return new s(t,i,t,i)},i(s,{defaultFactory:function(){return s.NOTHING.copy()},constructorDuplicateFactory:function(t){return function(e,i,n,r){return t.length?t.pop().setMinMax(e,i,n,r):new s(e,i,n,r)}}}),s.EVERYTHING=new s(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),s.NOTHING=new s(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),s}),i("KITE/kite",["require","PHET_CORE/phetAllocation"],function(t){window.phetAllocation=t("PHET_CORE/phetAllocation");var e={svgNumber:function(t){return t.toFixed(20)}};return e}),i("KITE/segments/Segment",["require","KITE/kite","DOT/Util","DOT/Bounds2"],function(t){var e=t("KITE/kite"),i=t("DOT/Util"),n=t("DOT/Bounds2");e.Segment=function(){};var s=e.Segment,r=function(t){return t};return s.prototype={constructor:s,getBoundsWithTransform:function(t){var e=this.transformed(t);return e.getBounds()},subdivisions:function(t){for(var e=this,n=[],s=0;s<t.length;s++){var r=t[s],o=e.subdivided(r);n.push(o[0]),e=o[1];for(var a=s+1;a<t.length;a++)t[a]=i.linear(r,1,0,1,t[a])}return n.push(e),n},subdividedIntoMonotone:function(){return this.subdivisions(this.getInteriorExtremaTs())},toPiecewiseLinearSegments:function(t,e,n,o,a,h){e=void 0===e?t.minLevels:e,n=void 0===n?t.maxLevels:n,o=o||[];var u=t.pointMap||r;a=a||u(this.start),h=h||u(this.end);var l=u(this.positionAt(.5)),c=0===n;if(!c&&0>=e&&(c=(null===t.curveEpsilon||i.distToSegmentSquared(l,a,h)/a.distanceSquared(h)<t.curveEpsilon)&&(null===t.distanceEpsilon||i.distToSegmentSquared(l,a,h)<t.distanceEpsilon)),c)o.push(new s.Line(a,h));else{var d=this.subdivided(.5);d[0].toPiecewiseLinearSegments(t,e-1,n-1,o,a,l),d[1].toPiecewiseLinearSegments(t,e-1,n-1,o,l,h)}return o}},s.closestToPoint=function(t,e,i){var s=i*i,r=[],o=[],a=Number.POSITIVE_INFINITY,h=!1;for(_.each(t,function(t){if(t.explicitClosestToPoint){var i=t.explicitClosestToPoint(e);_.each(i,function(t){t.distanceSquared<a?(o=[t],a=t.distanceSquared):t.distanceSquared===a&&o.push(t)})}else for(var s=[0].concat(t.getInteriorExtremaTs()).concat([1]),h=0;h<s.length-1;h++){var u=s[h],l=s[h+1],c=t.positionAt(u),d=t.positionAt(l),m=n.point(c).addPoint(d),f=m.minimumDistanceToPointSquared(e);if(a>=f){var g=m.maximumDistanceToPointSquared(e);a>g&&(a=g,o=[]),r.push({ta:u,tb:l,pa:c,pb:d,segment:t,bounds:m,min:f,max:g})}}});r.length&&!h;){var u=r;r=[],h=!0,_.each(u,function(t){if(!(t.minDistanceSquared>a)){h&&t.pa.distanceSquared(t.pb)>s&&(h=!1);var i=(t.ta+t.tb)/2,u=t.segment.positionAt(i),l=n.point(t.pa).addPoint(u),c=n.point(t.pb).addPoint(u),d=l.minimumDistanceToPointSquared(e),m=c.minimumDistanceToPointSquared(e);if(a>=d){var f=l.maximumDistanceToPointSquared(e);a>f&&(a=f,o=[]),r.push({ta:t.ta,tb:i,pa:t.pa,pb:u,segment:t.segment,bounds:l,min:d,max:f})}if(a>=m){var g=c.maximumDistanceToPointSquared(e);a>g&&(a=g,o=[]),r.push({ta:i,tb:t.tb,pa:u,pb:t.pb,segment:t.segment,bounds:c,min:m,max:g})}}})}return _.each(r,function(t){var i=(t.ta+t.tb)/2,n=t.segment.positionAt(i);o.push({segment:t.segment,t:i,closestPoint:n,distanceSquared:e.distanceSquared(n)})}),o},s}),i("KITE/segments/Line",["require","PHET_CORE/inherit","DOT/Bounds2","DOT/Vector2","DOT/Util","KITE/kite","KITE/segments/Segment"],function(t){var e=t("PHET_CORE/inherit"),i=t("DOT/Bounds2"),n=t("DOT/Vector2"),s=t("DOT/Util"),r=t("KITE/kite"),o=t("KITE/segments/Segment"),a=new n;return o.Line=function(t,e){this._start=t,this._end=e,this._tangent=void 0,this._bounds=void 0},e(o,o.Line,{getStart:function(){return this._start},get start(){return this._start},getEnd:function(){return this._end},get end(){return this._end},getStartTangent:function(){return void 0===this._tangent&&(this._tangent=this._end.minus(this._start).normalized()),this._tangent},get startTangent(){return this.getStartTangent()},getEndTangent:function(){return this.getStartTangent()},get endTangent(){return this.getEndTangent()},getBounds:function(){return void 0===this._bounds&&(this._bounds=i.NOTHING.copy().addPoint(this._start).addPoint(this._end)),this._bounds},get bounds(){return this.getBounds()},getBoundsWithTransform:function(t){var e=i.NOTHING.copy();return e.addPoint(t.multiplyVector2(a.set(this._start))),e.addPoint(t.multiplyVector2(a.set(this._end))),e},getNondegenerateSegments:function(){return this._start.equals(this._end)?[]:[this]},positionAt:function(t){return this._start.plus(this._end.minus(this._start).times(t))},tangentAt:function(){return this.getStartTangent()},curvatureAt:function(){return 0},getSVGPathFragment:function(){return"L "+r.svgNumber(this._end.x)+" "+r.svgNumber(this._end.y)},strokeLeft:function(t){var e=this.getEndTangent().perpendicular().negated().times(t/2);return[new o.Line(this._start.plus(e),this._end.plus(e))]},strokeRight:function(t){var e=this.getStartTangent().perpendicular().times(t/2);return[new o.Line(this._end.plus(e),this._start.plus(e))]},getInteriorExtremaTs:function(){return[]},subdivided:function(t){var e=this.positionAt(t);return[new o.Line(this._start,e),new o.Line(e,this._end)]},intersectsBounds:function(){throw new Error("Segment.Line.intersectsBounds unimplemented")},intersection:function(t){var e=[],i=this._start,n=this._end,s=n.minus(i);if(0===s.magnitudeSquared())return e;var r=t.dir.y*s.x-t.dir.x*s.y;if(0===r)return e;var o=(t.dir.x*(i.y-t.pos.y)-t.dir.y*(i.x-t.pos.x))/r;if(0>o||o>=1)return e;var a=(s.x*(i.y-t.pos.y)-s.y*(i.x-t.pos.x))/r;if(1e-6>a)return e;var h=s.perpendicular();return e.push({distance:a,point:i.plus(s.times(o)),normal:h.dot(t.dir)>0?h.negated():h,wind:t.dir.perpendicular().dot(s)<0?1:-1,segment:this}),e},windingIntersection:function(t){var e=this.intersection(t);return e.length?e[0].wind:0},writeToContext:function(t){t.lineTo(this._end.x,this._end.y)},transformed:function(t){return new o.Line(t.timesVector2(this._start),t.timesVector2(this._end))},explicitClosestToPoint:function(t){var e=this._end.minus(this._start),i=t.minus(this._start).dot(e)/e.magnitudeSquared();i=s.clamp(i,0,1);var n=this.positionAt(i);return[{segment:this,t:i,closestPoint:n,distanceSquared:t.distanceSquared(n)}]},reparameterized:function(t,e){return new o.Line(this.positionAt(e),this.positionAt(t+e))},polarToCartesian:function(t){return this._start.x===this._end.x?[new o.Line(n.createPolar(this._start.y,this._start.x),n.createPolar(this._end.y,this._end.x))]:this._start.y===this._end.y?[new o.Arc(n.ZERO,this._start.y,this._start.x,this._end.x,this._start.x>this._end.x)]:this.toPiecewiseLinearSegments(t)}}),o.Line}),i("KITE/segments/Arc",["require","PHET_CORE/inherit","DOT/Vector2","DOT/Bounds2","DOT/Util","KITE/kite","KITE/segments/Segment"],function(t){var e=t("PHET_CORE/inherit"),i=t("DOT/Vector2"),n=t("DOT/Bounds2"),s=t("DOT/Util"),r=t("KITE/kite"),o=t("KITE/segments/Segment");return o.Arc=function(t,e,i,n,s){0>e&&(e=-e,i+=Math.PI,n+=Math.PI),this._center=t,this._radius=e,this._startAngle=i,this._endAngle=n,this._anticlockwise=s,this._start=void 0,this._end=void 0,this._startTangent=void 0,this._endTangent=void 0,this._actualEndAngle=void 0,this._isFullPerimeter=void 0,this._angleDifference=void 0},e(o,o.Arc,{getCenter:function(){return this._center},get center(){return this.getCenter()},getRadius:function(){return this._radius},get radius(){return this.getRadius()},getStartAngle:function(){return this._startAngle},get startAngle(){return this.getStartAngle()},getEndAngle:function(){return this._endAngle},get endAngle(){return this.getEndAngle()},getAnticlockwise:function(){return this._anticlockwise},get anticlockwise(){return this.getAnticlockwise()},getStart:function(){return void 0===this._start&&(this._start=this.positionAtAngle(this._startAngle)),this._start},get start(){return this.getStart()},getEnd:function(){return void 0===this._end&&(this._end=this.positionAtAngle(this._endAngle)),this._end},get end(){return this.getEnd()},getStartTangent:function(){return void 0===this._startTangent&&(this._startTangent=this.tangentAtAngle(this._startAngle)),this._startTangent},get startTangent(){return this.getStartTangent()},getEndTangent:function(){return void 0===this._endTangent&&(this._endTangent=this.tangentAtAngle(this._endAngle)),this._endTangent},get endTangent(){return this.getEndTangent()},getActualEndAngle:function(){return void 0===this._actualEndAngle&&(this._actualEndAngle=this._anticlockwise?this._startAngle>this._endAngle?this._endAngle:this._startAngle<this._endAngle?this._endAngle-2*Math.PI:this._startAngle:this._startAngle<this._endAngle?this._endAngle:this._startAngle>this._endAngle?this._endAngle+2*Math.PI:this._startAngle),this._actualEndAngle},get actualEndAngle(){return this.getActualEndAngle()},getIsFullPerimeter:function(){return void 0===this._isFullPerimeter&&(this._isFullPerimeter=!this._anticlockwise&&this._endAngle-this._startAngle>=2*Math.PI||this._anticlockwise&&this._startAngle-this._endAngle>=2*Math.PI),this._isFullPerimeter},get isFullPerimeter(){return this.getIsFullPerimeter()},getAngleDifference:function(){return void 0===this._angleDifference&&(this._angleDifference=this._anticlockwise?this._startAngle-this._endAngle:this._endAngle-this._startAngle,this._angleDifference<0&&(this._angleDifference+=2*Math.PI)),this._angleDifference},get angleDifference(){return this.getAngleDifference()},getBounds:function(){return void 0===this._bounds&&(this._bounds=n.NOTHING.copy().withPoint(this.getStart()).withPoint(this.getEnd()),this._startAngle!==this._endAngle&&(this.includeBoundsAtAngle(0),this.includeBoundsAtAngle(Math.PI/2),this.includeBoundsAtAngle(Math.PI),this.includeBoundsAtAngle(3*Math.PI/2))),this._bounds},get bounds(){return this.getBounds()},getNondegenerateSegments:function(){return this._radius<=0||this._startAngle===this._endAngle?[]:[this]},includeBoundsAtAngle:function(t){this.containsAngle(t)&&(this._bounds=this._bounds.withPoint(this._center.plus(i.createPolar(this._radius,t))))},mapAngle:function(t){return this._startAngle>this.getActualEndAngle()?s.moduloBetweenUp(t,this._startAngle-2*Math.PI,this._startAngle):s.moduloBetweenDown(t,this._startAngle,this._startAngle+2*Math.PI)},tAtAngle:function(t){return(this.mapAngle(t)-this._startAngle)/(this.getActualEndAngle()-this._startAngle)},angleAt:function(t){return this._startAngle+(this.getActualEndAngle()-this._startAngle)*t},positionAt:function(t){return this.positionAtAngle(this.angleAt(t))},tangentAt:function(t){return this.tangentAtAngle(this.angleAt(t))},curvatureAt:function(){return(this._anticlockwise?-1:1)/this._radius},positionAtAngle:function(t){return this._center.plus(i.createPolar(this._radius,t))},tangentAtAngle:function(t){var e=i.createPolar(1,t);return this._anticlockwise?e.perpendicular():e.perpendicular().negated()},containsAngle:function(t){var e=this._anticlockwise?t-this._endAngle:t-this._startAngle,i=s.moduloBetweenDown(e,0,2*Math.PI);return i<=this.angleDifference},getSVGPathFragment:function(){var t,e=.01,n=this._anticlockwise?"0":"1";if(this.angleDifference<2*Math.PI-e)return t=this.angleDifference<Math.PI?"0":"1","A "+r.svgNumber(this._radius)+" "+r.svgNumber(this._radius)+" 0 "+t+" "+n+" "+r.svgNumber(this.end.x)+" "+r.svgNumber(this.end.y);var s=(this._startAngle+this._endAngle)/2,o=this._center.plus(i.createPolar(this._radius,s));t="0";var a="A "+r.svgNumber(this._radius)+" "+r.svgNumber(this._radius)+" 0 "+t+" "+n+" "+r.svgNumber(o.x)+" "+r.svgNumber(o.y),h="A "+r.svgNumber(this._radius)+" "+r.svgNumber(this._radius)+" 0 "+t+" "+n+" "+r.svgNumber(this.end.x)+" "+r.svgNumber(this.end.y);return a+" "+h},strokeLeft:function(t){return[new o.Arc(this._center,this._radius+(this._anticlockwise?1:-1)*t/2,this._startAngle,this._endAngle,this._anticlockwise)]},strokeRight:function(t){return[new o.Arc(this._center,this._radius+(this._anticlockwise?-1:1)*t/2,this._endAngle,this._startAngle,!this._anticlockwise)]},getInteriorExtremaTs:function(){var t=this,e=[];return _.each([0,Math.PI/2,Math.PI,3*Math.PI/2],function(i){if(t.containsAngle(i)){var n=t.tAtAngle(i),s=1e-10;n>s&&1-s>n&&e.push(n)}}),e.sort()},subdivided:function(t){var e=this.angleAt(0),i=this.angleAt(t),n=this.angleAt(1);return[new o.Arc(this._center,this._radius,e,i,this._anticlockwise),new o.Arc(this._center,this._radius,i,n,this._anticlockwise)]},intersectsBounds:function(){throw new Error("Segment.intersectsBounds unimplemented!")},intersection:function(t){var e=[],i=0,n=t.pos.minus(this._center),s=t.dir.dot(n),r=n.magnitudeSquared(),o=4*s*s-4*(r-this._radius*this._radius);if(i>o)return e;var a=t.dir.dot(this._center)-t.dir.dot(t.pos),h=Math.sqrt(o)/2,u=a-h,l=a+h;if(i>l)return e;var c=t.pointAtDistance(l),d=c.minus(this._center).normalized();if(i>u)this.containsAngle(d.angle())&&e.push({distance:l,point:c,normal:d.negated(),wind:this._anticlockwise?-1:1});else{var m=t.pointAtDistance(u),f=m.minus(this._center).normalized();this.containsAngle(f.angle())&&e.push({distance:u,point:m,normal:f,wind:this._anticlockwise?1:-1}),this.containsAngle(d.angle())&&e.push({distance:l,point:c,normal:d.negated(),wind:this._anticlockwise?-1:1})}return e},windingIntersection:function(t){var e=0,i=this.intersection(t);return _.each(i,function(t){e+=t.wind}),e},writeToContext:function(t){t.arc(this._center.x,this._center.y,this._radius,this._startAngle,this._endAngle,this._anticlockwise)},transformed:function(t){var e=t.timesVector2(i.createPolar(1,this._startAngle)).minus(t.timesVector2(i.ZERO)).angle(),n=t.timesVector2(i.createPolar(1,this._endAngle)).minus(t.timesVector2(i.ZERO)).angle(),s=t.getDeterminant()>=0?this._anticlockwise:!this._anticlockwise;Math.abs(this._endAngle-this._startAngle)===2*Math.PI&&(n=s?e-2*Math.PI:e+2*Math.PI);var r=t.getScaleVector();if(r.x!==r.y){var a=r.x*this._radius,h=r.y*this._radius;return new o.EllipticalArc(t.timesVector2(this._center),a,h,0,e,n,s)}var u=r.x*this._radius;return new o.Arc(t.timesVector2(this._center),u,e,n,s)}}),o.Arc}),i("KITE/util/Subpath",["require","DOT/Bounds2","KITE/kite","KITE/segments/Line","KITE/segments/Arc"],function(t){var e=t("DOT/Bounds2"),i=t("KITE/kite");t("KITE/segments/Line"),t("KITE/segments/Arc"),i.Subpath=function(t,i,n){this.segments=t||[],this.points=i||(t&&t.length?_.map(t,function(t){return t.start}).concat(t[t.length-1].end):[]),this.closed=!!n,this._strokedSubpaths=null,this._strokedSubpathsComputed=!1,this._strokedStyles=null;var s=this.bounds=e.NOTHING.copy();_.each(this.segments,function(t){s.includeBounds(t.bounds)})};var n=i.Subpath;return n.prototype={copy:function(){return new n(this.segments.slice(0),this.points.slice(0),this.closed)},invalidate:function(){this._strokedSubpathsComputed=!1},addPoint:function(t){return this.points.push(t),this},addSegmentDirectly:function(t){return this.segments.push(t),this.invalidate(),this.bounds.includeBounds(t.getBounds()),this},addSegment:function(t){var e=this;return _.each(t.getNondegenerateSegments(),function(t){e.addSegmentDirectly(t)}),this},addClosingSegment:function(){if(this.hasClosingSegment()){var t=this.getClosingSegment();this.addSegmentDirectly(t),this.addPoint(this.getFirstPoint()),this.closed=!0}},close:function(){this.closed=!0},getLength:function(){return this.points.length},getFirstPoint:function(){return _.first(this.points)},getLastPoint:function(){return _.last(this.points)},getFirstSegment:function(){return _.first(this.segments)},getLastSegment:function(){return _.last(this.segments)},isDrawable:function(){return this.segments.length>0},isClosed:function(){return this.closed},hasClosingSegment:function(){return!this.getFirstPoint().equalsEpsilon(this.getLastPoint(),1e-9)},getClosingSegment:function(){return new i.Segment.Line(this.getLastPoint(),this.getFirstPoint())},writeToContext:function(t){if(this.isDrawable()){var e=this.getFirstSegment().start;t.moveTo(e.x,e.y);for(var i=this.segments.length,n=0;i>n;n++)this.segments[n].writeToContext(t);this.closed&&t.closePath()}},toPiecewiseLinear:function(t){return new n(_.flatten(_.map(this.segments,function(e){return e.toPiecewiseLinearSegments(t)})),null,this.closed)},transformed:function(t){return new n(_.map(this.segments,function(e){return e.transformed(t)}),_.map(this.points,function(e){return t.timesVector2(e)}),this.closed)},nonlinearTransformed:function(t){return this.closed&&this.hasClosingSegment()&&this.addClosingSegment(),new n(_.flatten(_.map(this.segments,function(e){return t.methodName&&e[t.methodName]?e[t.methodName](t):e.toPiecewiseLinearSegments(t)})),null,this.closed)},getBoundsWithTransform:function(t){for(var i=e.NOTHING.copy(),n=this.segments.length,s=0;n>s;s++)i.includeBounds(this.segments[s].getBoundsWithTransform(t));return i},offset:function(t){if(!this.isDrawable())return new n([],null,this.closed);if(0===t)return new n(this.segments.slice(),null,this.closed);var e,s=this.segments.slice();this.closed&&this.hasClosingSegment()&&s.push(this.getClosingSegment());var r=[];for(e=0;e<s.length;e++)r.push(s[e].strokeLeft(2*t));var o=[];for(e=0;e<s.length;e++){if(this.closed||e>0){var a=(e>0?e:s.length)-1,h=s[e].start,u=s[a].endTangent,l=s[e].startTangent,c=u.perpendicular().negated().times(t).angle(),d=l.perpendicular().negated().times(t).angle(),m=u.perpendicular().dot(l)>0;o.push(new i.Segment.Arc(h,Math.abs(t),c,d,m))}o=o.concat(r[e])}return new n(o,null,this.closed)},stroked:function(t){function e(t){a=a.concat(t)}function s(t){h=h.concat(t)}if(!this.isDrawable())return[];if(void 0===t&&(t=new i.LineStyles),this._strokedSubpathsComputed&&this._strokedStyles.equals(t))return this._strokedSubpaths;var r,o=t.lineWidth,a=[],h=[],u=this.getFirstSegment(),l=this.getLastSegment(),c=l.end.equals(u.start),d=c?null:new i.Segment.Line(this.segments[this.segments.length-1].end,this.segments[0].start);for(r=0;r<this.segments.length;r++)r>0&&e(t.leftJoin(this.segments[r].start,this.segments[r-1].endTangent,this.segments[r].startTangent)),e(this.segments[r].strokeLeft(o));for(r=this.segments.length-1;r>=0;r--)r<this.segments.length-1&&s(t.rightJoin(this.segments[r].end,this.segments[r].endTangent,this.segments[r+1].startTangent)),s(this.segments[r].strokeRight(o));var m;return this.closed?(c?(e(t.leftJoin(l.end,l.endTangent,u.startTangent)),s(t.rightJoin(l.end,l.endTangent,u.startTangent))):(e(t.leftJoin(d.start,l.endTangent,d.startTangent)),e(d.strokeLeft(o)),e(t.leftJoin(d.end,d.endTangent,u.startTangent)),s(t.rightJoin(d.end,d.endTangent,u.startTangent)),s(d.strokeRight(o)),s(t.rightJoin(d.start,l.endTangent,d.startTangent))),m=[new n(a,null,!0),new n(h,null,!0)]):m=[new n(a.concat(t.cap(l.end,l.endTangent)).concat(h).concat(t.cap(u.start,u.startTangent.negated())),null,!0)],this._strokedSubpaths=m,this._strokedSubpathsComputed=!0,this._strokedStyles=new i.LineStyles(t),m}},i.Subpath}),i("KITE/parser/svgPath",["require","KITE/kite"],function(t){function e(t){return'"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var i=t("KITE/kite");i.svgPath={parse:function(t,i){function n(t){j>K||(K>j&&(j=K,J=[]),J.push(t))}function s(){var t,e,i,n,s,o;for(s=K,o=K,t=[],e=z();null!==e;)t.push(e),e=z();if(null!==t)if(e=r(),e=null!==e?e:"",null!==e){for(i=[],n=z();null!==n;)i.push(n),n=z();null!==i?t=[t,e,i]:(t=null,K=o)}else t=null,K=o;else t=null,K=o;return null!==t&&(t=function(t,e){return e?e:[]}(s,t[1])),null===t&&(K=s),t}function r(){var t,e,i,n,s;if(n=K,s=K,t=o(),null!==t){for(e=[],i=z();null!==i;)e.push(i),i=z();null!==e?(i=r(),null!==i?t=[t,e,i]:(t=null,K=s)):(t=null,K=s)}else t=null,K=s;return null!==t&&(t=function(t,e,i){return e.concat(i)}(n,t[0],t[2])),null===t&&(K=n),null===t&&(n=K,t=o(),null!==t&&(t=function(t,e){return e
}(n,t)),null===t&&(K=n)),t}function o(){var t,e,i,n,s;if(n=K,s=K,t=u(),null!==t){for(e=[],i=z();null!==i;)e.push(i),i=z();null!==e?(i=a(),i=null!==i?i:"",null!==i?t=[t,e,i]:(t=null,K=s)):(t=null,K=s)}else t=null,K=s;return null!==t&&(t=function(t,e,i){return i.length?e.concat(i):e}(n,t[0],t[2])),null===t&&(K=n),t}function a(){var t,e,i,n,s;if(n=K,s=K,t=h(),null!==t){for(e=[],i=z();null!==i;)e.push(i),i=z();null!==e?(i=a(),null!==i?t=[t,e,i]:(t=null,K=s)):(t=null,K=s)}else t=null,K=s;return null!==t&&(t=function(t,e,i){return e.concat(i)}(n,t[0],t[2])),null===t&&(K=n),null===t&&(n=K,t=h(),null!==t&&(t=function(t,e){return e}(n,t)),null===t&&(K=n)),t}function h(){var t;return t=c(),null===t&&(t=d(),null===t&&(t=f(),null===t&&(t=p(),null===t&&(t=y(),null===t&&(t=E(),null===t&&(t=b(),null===t&&(t=R(),null===t&&(t=A())))))))),t}function u(){var e,i,s,r,o;if(r=K,o=K,77===t.charCodeAt(K)?(e="M",K++):(e=null,0===Q&&n('"M"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i?(s=l(),null!==s?e=[e,i,s]:(e=null,K=o)):(e=null,K=o)}else e=null,K=o;if(null!==e&&(e=function(t,e){return W(e,!1)}(r,e[2])),null===e&&(K=r),null===e){if(r=K,o=K,109===t.charCodeAt(K)?(e="m",K++):(e=null,0===Q&&n('"m"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i?(s=l(),null!==s?e=[e,i,s]:(e=null,K=o)):(e=null,K=o)}else e=null,K=o;null!==e&&(e=function(t,e){return W(e,!0)}(r,e[2])),null===e&&(K=r)}return e}function l(){var t,e,i,n,s;return n=K,s=K,t=I(),null!==t?(e=O(),e=null!==e?e:"",null!==e?(i=m(),null!==i?t=[t,e,i]:(t=null,K=s)):(t=null,K=s)):(t=null,K=s),null!==t&&(t=function(t,e,i){return[e].concat(i)}(n,t[0],t[2])),null===t&&(K=n),null===t&&(n=K,t=I(),null!==t&&(t=function(t,e){return[e]}(n,t)),null===t&&(K=n)),t}function c(){var e,i;return i=K,90===t.charCodeAt(K)?(e="Z",K++):(e=null,0===Q&&n('"Z"')),null===e&&(122===t.charCodeAt(K)?(e="z",K++):(e=null,0===Q&&n('"z"'))),null!==e&&(e=function(){return{cmd:"close"}}(i,e)),null===e&&(K=i),e}function d(){var e,i,s,r,o;if(r=K,o=K,76===t.charCodeAt(K)?(e="L",K++):(e=null,0===Q&&n('"L"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i?(s=m(),null!==s?e=[e,i,s]:(e=null,K=o)):(e=null,K=o)}else e=null,K=o;if(null!==e&&(e=function(t,e){return e.map(function(t){return{cmd:"lineTo",args:[t.x,t.y]}})}(r,e[2])),null===e&&(K=r),null===e){if(r=K,o=K,108===t.charCodeAt(K)?(e="l",K++):(e=null,0===Q&&n('"l"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i?(s=m(),null!==s?e=[e,i,s]:(e=null,K=o)):(e=null,K=o)}else e=null,K=o;null!==e&&(e=function(t,e){return e.map(function(t){return{cmd:"lineToRelative",args:[t.x,t.y]}})}(r,e[2])),null===e&&(K=r)}return e}function m(){var t,e,i,n,s;return n=K,s=K,t=I(),null!==t?(e=O(),e=null!==e?e:"",null!==e?(i=m(),null!==i?t=[t,e,i]:(t=null,K=s)):(t=null,K=s)):(t=null,K=s),null!==t&&(t=function(t,e,i){return[e].concat(i)}(n,t[0],t[2])),null===t&&(K=n),null===t&&(n=K,t=I(),null!==t&&(t=function(t,e){return[e]}(n,t)),null===t&&(K=n)),t}function f(){var e,i,s,r,o;if(r=K,o=K,72===t.charCodeAt(K)?(e="H",K++):(e=null,0===Q&&n('"H"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i?(s=g(),null!==s?e=[e,i,s]:(e=null,K=o)):(e=null,K=o)}else e=null,K=o;if(null!==e&&(e=function(t,e){return e.map(function(t){return{cmd:"horizontalLineTo",args:[t]}})}(r,e[2])),null===e&&(K=r),null===e){if(r=K,o=K,104===t.charCodeAt(K)?(e="h",K++):(e=null,0===Q&&n('"h"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i?(s=g(),null!==s?e=[e,i,s]:(e=null,K=o)):(e=null,K=o)}else e=null,K=o;null!==e&&(e=function(t,e){return e.map(function(t){return{cmd:"horizontalLineToRelative",args:[t]}})}(r,e[2])),null===e&&(K=r)}return e}function g(){var t,e,i,n,s;return n=K,s=K,t=Y(),null!==t?(e=O(),e=null!==e?e:"",null!==e?(i=g(),null!==i?t=[t,e,i]:(t=null,K=s)):(t=null,K=s)):(t=null,K=s),null!==t&&(t=function(t,e,i){return[e].concat(i)}(n,t[0],t[2])),null===t&&(K=n),null===t&&(n=K,t=Y(),null!==t&&(t=function(t,e){return[e]}(n,t)),null===t&&(K=n)),t}function p(){var e,i,s,r,o;if(r=K,o=K,86===t.charCodeAt(K)?(e="V",K++):(e=null,0===Q&&n('"V"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i?(s=v(),null!==s?e=[e,i,s]:(e=null,K=o)):(e=null,K=o)}else e=null,K=o;if(null!==e&&(e=function(t,e){return e.map(function(t){return{cmd:"verticalLineTo",args:[t]}})}(r,e[2])),null===e&&(K=r),null===e){if(r=K,o=K,118===t.charCodeAt(K)?(e="v",K++):(e=null,0===Q&&n('"v"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i?(s=v(),null!==s?e=[e,i,s]:(e=null,K=o)):(e=null,K=o)}else e=null,K=o;null!==e&&(e=function(t,e){return e.map(function(t){return{cmd:"verticalLineToRelative",args:[t]}})}(r,e[2])),null===e&&(K=r)}return e}function v(){var t,e,i,n,s;return n=K,s=K,t=Y(),null!==t?(e=O(),e=null!==e?e:"",null!==e?(i=v(),null!==i?t=[t,e,i]:(t=null,K=s)):(t=null,K=s)):(t=null,K=s),null!==t&&(t=function(t,e,i){return[e].concat(i)}(n,t[0],t[2])),null===t&&(K=n),null===t&&(n=K,t=Y(),null!==t&&(t=function(t,e){return[e]}(n,t)),null===t&&(K=n)),t}function y(){var e,i,s,r,o;if(r=K,o=K,67===t.charCodeAt(K)?(e="C",K++):(e=null,0===Q&&n('"C"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i?(s=x(),null!==s?e=[e,i,s]:(e=null,K=o)):(e=null,K=o)}else e=null,K=o;if(null!==e&&(e=function(t,e){return e.map(function(t){return{cmd:"cubicCurveTo",args:t}})}(r,e[2])),null===e&&(K=r),null===e){if(r=K,o=K,99===t.charCodeAt(K)?(e="c",K++):(e=null,0===Q&&n('"c"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i?(s=x(),null!==s?e=[e,i,s]:(e=null,K=o)):(e=null,K=o)}else e=null,K=o;null!==e&&(e=function(t,e){return e.map(function(t){return{cmd:"cubicCurveToRelative",args:t}})}(r,e[2])),null===e&&(K=r)}return e}function x(){var t,e,i,n,s;return n=K,s=K,t=_(),null!==t?(e=O(),e=null!==e?e:"",null!==e?(i=x(),null!==i?t=[t,e,i]:(t=null,K=s)):(t=null,K=s)):(t=null,K=s),null!==t&&(t=function(t,e,i){return[e].concat(i)}(n,t[0],t[2])),null===t&&(K=n),null===t&&(n=K,t=_(),null!==t&&(t=function(t,e){return[e]}(n,t)),null===t&&(K=n)),t}function _(){var t,e,i,n,s,r,o;return r=K,o=K,t=I(),null!==t?(e=O(),e=null!==e?e:"",null!==e?(i=I(),null!==i?(n=O(),n=null!==n?n:"",null!==n?(s=I(),null!==s?t=[t,e,i,n,s]:(t=null,K=o)):(t=null,K=o)):(t=null,K=o)):(t=null,K=o)):(t=null,K=o),null!==t&&(t=function(t,e,i,n){return[e.x,e.y,i.x,i.y,n.x,n.y]}(r,t[0],t[2],t[4])),null===t&&(K=r),t}function E(){var e,i,s,r,o;if(r=K,o=K,83===t.charCodeAt(K)?(e="S",K++):(e=null,0===Q&&n('"S"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i?(s=T(),null!==s?e=[e,i,s]:(e=null,K=o)):(e=null,K=o)}else e=null,K=o;if(null!==e&&(e=function(t,e){return e.map(function(t){return{cmd:"smoothCubicCurveTo",args:t}})}(r,e[2])),null===e&&(K=r),null===e){if(r=K,o=K,115===t.charCodeAt(K)?(e="s",K++):(e=null,0===Q&&n('"s"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i?(s=T(),null!==s?e=[e,i,s]:(e=null,K=o)):(e=null,K=o)}else e=null,K=o;null!==e&&(e=function(t,e){return e.map(function(t){return{cmd:"smoothCubicCurveToRelative",args:t}})}(r,e[2])),null===e&&(K=r)}return e}function T(){var t,e,i,n,s;return n=K,s=K,t=S(),null!==t?(e=O(),e=null!==e?e:"",null!==e?(i=T(),null!==i?t=[t,e,i]:(t=null,K=s)):(t=null,K=s)):(t=null,K=s),null!==t&&(t=function(t,e,i){return[e].concat(i)}(n,t[0],t[2])),null===t&&(K=n),null===t&&(n=K,t=S(),null!==t&&(t=function(t,e){return[e]}(n,t)),null===t&&(K=n)),t}function S(){var t,e,i,n,s;return n=K,s=K,t=I(),null!==t?(e=O(),e=null!==e?e:"",null!==e?(i=I(),null!==i?t=[t,e,i]:(t=null,K=s)):(t=null,K=s)):(t=null,K=s),null!==t&&(t=function(t,e,i){return[e.x,e.y,i.x,i.y]}(n,t[0],t[2])),null===t&&(K=n),t}function b(){var e,i,s,r,o;if(r=K,o=K,81===t.charCodeAt(K)?(e="Q",K++):(e=null,0===Q&&n('"Q"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i?(s=C(),null!==s?e=[e,i,s]:(e=null,K=o)):(e=null,K=o)}else e=null,K=o;if(null!==e&&(e=function(t,e){return e.map(function(t){return{cmd:"quadraticCurveTo",args:t}})}(r,e[2])),null===e&&(K=r),null===e){if(r=K,o=K,113===t.charCodeAt(K)?(e="q",K++):(e=null,0===Q&&n('"q"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i?(s=C(),null!==s?e=[e,i,s]:(e=null,K=o)):(e=null,K=o)}else e=null,K=o;null!==e&&(e=function(t,e){return e.map(function(t){return{cmd:"quadraticCurveToRelative",args:t}})}(r,e[2])),null===e&&(K=r)}return e}function C(){var t,e,i,n,s;return n=K,s=K,t=w(),null!==t?(e=O(),e=null!==e?e:"",null!==e?(i=C(),null!==i?t=[t,e,i]:(t=null,K=s)):(t=null,K=s)):(t=null,K=s),null!==t&&(t=function(t,e,i){return[e].concat(i)}(n,t[0],t[2])),null===t&&(K=n),null===t&&(n=K,t=w(),null!==t&&(t=function(t,e){return[e]}(n,t)),null===t&&(K=n)),t}function w(){var t,e,i,n,s;return n=K,s=K,t=I(),null!==t?(e=O(),e=null!==e?e:"",null!==e?(i=I(),null!==i?t=[t,e,i]:(t=null,K=s)):(t=null,K=s)):(t=null,K=s),null!==t&&(t=function(t,e,i){return[e.x,e.y,i.x,i.y]}(n,t[0],t[2])),null===t&&(K=n),t}function R(){var e,i,s,r,o;if(r=K,o=K,84===t.charCodeAt(K)?(e="T",K++):(e=null,0===Q&&n('"T"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i?(s=P(),null!==s?e=[e,i,s]:(e=null,K=o)):(e=null,K=o)}else e=null,K=o;if(null!==e&&(e=function(t,e){return e.map(function(t){return{cmd:"smoothQuadraticCurveTo",args:[t.x,t.y]}})}(r,e[2])),null===e&&(K=r),null===e){if(r=K,o=K,116===t.charCodeAt(K)?(e="t",K++):(e=null,0===Q&&n('"t"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i?(s=P(),null!==s?e=[e,i,s]:(e=null,K=o)):(e=null,K=o)}else e=null,K=o;null!==e&&(e=function(t,e){return e.map(function(t){return{cmd:"smoothQuadraticCurveToRelative",args:[t.x,t.y]}})}(r,e[2])),null===e&&(K=r)}return e}function P(){var t,e,i,n,s;return n=K,s=K,t=I(),null!==t?(e=O(),e=null!==e?e:"",null!==e?(i=P(),null!==i?t=[t,e,i]:(t=null,K=s)):(t=null,K=s)):(t=null,K=s),null!==t&&(t=function(t,e,i){return[e].concat(i)}(n,t[0],t[2])),null===t&&(K=n),null===t&&(n=K,t=I(),null!==t&&(t=function(t,e){return[e]}(n,t)),null===t&&(K=n)),t}function A(){var e,i,s,r,o;if(r=K,o=K,65===t.charCodeAt(K)?(e="A",K++):(e=null,0===Q&&n('"A"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i?(s=M(),null!==s?e=[e,i,s]:(e=null,K=o)):(e=null,K=o)}else e=null,K=o;if(null!==e&&(e=function(t,e){return e.map(function(t){return{cmd:"ellipticalArcTo",args:t}})}(r,e[2])),null===e&&(K=r),null===e){if(r=K,o=K,97===t.charCodeAt(K)?(e="a",K++):(e=null,0===Q&&n('"a"')),null!==e){for(i=[],s=z();null!==s;)i.push(s),s=z();null!==i?(s=M(),null!==s?e=[e,i,s]:(e=null,K=o)):(e=null,K=o)}else e=null,K=o;null!==e&&(e=function(t,e){return e.map(function(t){return{cmd:"ellipticalArcToRelative",args:t}})}(r,e[2])),null===e&&(K=r)}return e}function M(){var t,e,i,n,s;return n=K,s=K,t=N(),null!==t?(e=O(),e=null!==e?e:"",null!==e?(i=M(),null!==i?t=[t,e,i]:(t=null,K=s)):(t=null,K=s)):(t=null,K=s),null!==t&&(t=function(t,e,i){return[e].concat(i)}(n,t[0],t[2])),null===t&&(K=n),null===t&&(n=K,t=N(),null!==t&&(t=function(t,e){return[e]}(n,t)),null===t&&(K=n)),t}function N(){var t,e,i,n,s,r,o,a,h,u,l,c,d;return c=K,d=K,t=D(),null!==t?(e=O(),e=null!==e?e:"",null!==e?(i=D(),null!==i?(n=O(),n=null!==n?n:"",null!==n?(s=Y(),null!==s?(r=O(),null!==r?(o=L(),null!==o?(a=O(),a=null!==a?a:"",null!==a?(h=L(),null!==h?(u=O(),u=null!==u?u:"",null!==u?(l=I(),null!==l?t=[t,e,i,n,s,r,o,a,h,u,l]:(t=null,K=d)):(t=null,K=d)):(t=null,K=d)):(t=null,K=d)):(t=null,K=d)):(t=null,K=d)):(t=null,K=d)):(t=null,K=d)):(t=null,K=d)):(t=null,K=d)):(t=null,K=d),null!==t&&(t=function(t,e,i,n,s,r,o){return[e,i,n,s,r,o.x,o.y]}(c,t[0],t[2],t[4],t[6],t[8],t[10])),null===t&&(K=c),t}function I(){var t,e,i,n,s;return n=K,s=K,t=Y(),null!==t?(e=O(),e=null!==e?e:"",null!==e?(i=Y(),null!==i?t=[t,e,i]:(t=null,K=s)):(t=null,K=s)):(t=null,K=s),null!==t&&(t=function(t,e,i){return{x:e,y:i}}(n,t[0],t[2])),null===t&&(K=n),t}function D(){var t,e;return e=K,t=k(),null!==t&&(t=function(t,e){return parseFloat(e,10)}(e,t)),null===t&&(K=e),null===t&&(e=K,t=G(),null!==t&&(t=function(t,e){return parseInt(e,10)}(e,t)),null===t&&(K=e)),t}function Y(){var t,e,i,n;return i=K,n=K,t=X(),t=null!==t?t:"",null!==t?(e=k(),null!==e?t=[t,e]:(t=null,K=n)):(t=null,K=n),null!==t&&(t=function(t,e,i){return parseFloat(e+i,10)}(i,t[0],t[1])),null===t&&(K=i),null===t&&(i=K,n=K,t=X(),t=null!==t?t:"",null!==t?(e=G(),null!==e?t=[t,e]:(t=null,K=n)):(t=null,K=n),null!==t&&(t=function(t,e,i){return parseInt(e+i,10)}(i,t[0],t[1])),null===t&&(K=i)),t}function L(){var e,i;return i=K,48===t.charCodeAt(K)?(e="0",K++):(e=null,0===Q&&n('"0"')),null!==e&&(e=function(){return!1}(i)),null===e&&(K=i),null===e&&(i=K,49===t.charCodeAt(K)?(e="1",K++):(e=null,0===Q&&n('"1"')),null!==e&&(e=function(){return!0}(i)),null===e&&(K=i)),e}function O(){var t,e,i,n,s;if(s=K,e=z(),null!==e)for(t=[];null!==e;)t.push(e),e=z();else t=null;if(null!==t)if(e=B(),e=null!==e?e:"",null!==e){for(i=[],n=z();null!==n;)i.push(n),n=z();null!==i?t=[t,e,i]:(t=null,K=s)}else t=null,K=s;else t=null,K=s;if(null===t)if(s=K,t=B(),null!==t){for(e=[],i=z();null!==i;)e.push(i),i=z();null!==e?t=[t,e]:(t=null,K=s)}else t=null,K=s;return t}function B(){var e;return 44===t.charCodeAt(K)?(e=",",K++):(e=null,0===Q&&n('","')),e}function k(){var t,e,i,n;return i=K,n=K,t=V(),null!==t?(e=F(),e=null!==e?e:"",null!==e?t=[t,e]:(t=null,K=n)):(t=null,K=n),null!==t&&(t=function(t,e,i){return e+i}(i,t[0],t[1])),null===t&&(K=i),null===t&&(i=K,n=K,t=G(),null!==t?(e=F(),null!==e?t=[t,e]:(t=null,K=n)):(t=null,K=n),null!==t&&(t=function(t,e,i){return e+i}(i,t[0],t[1])),null===t&&(K=i)),t}function V(){var e,i,s,r,o;return r=K,o=K,e=G(),e=null!==e?e:"",null!==e?(46===t.charCodeAt(K)?(i=".",K++):(i=null,0===Q&&n('"."')),null!==i?(s=G(),null!==s?e=[e,i,s]:(e=null,K=o)):(e=null,K=o)):(e=null,K=o),null!==e&&(e=function(t,e,i){return e+"."+i}(r,e[0],e[2])),null===e&&(K=r),null===e&&(r=K,o=K,e=G(),null!==e?(46===t.charCodeAt(K)?(i=".",K++):(i=null,0===Q&&n('"."')),null!==i?e=[e,i]:(e=null,K=o)):(e=null,K=o),null!==e&&(e=function(t,e){return e}(r,e[0])),null===e&&(K=r)),e}function F(){var e,i,s,r,o;return r=K,o=K,101===t.charCodeAt(K)?(e="e",K++):(e=null,0===Q&&n('"e"')),null===e&&(69===t.charCodeAt(K)?(e="E",K++):(e=null,0===Q&&n('"E"'))),null!==e?(i=X(),i=null!==i?i:"",null!==i?(s=G(),null!==s?e=[e,i,s]:(e=null,K=o)):(e=null,K=o)):(e=null,K=o),null!==e&&(e=function(t,e,i,n){return e+i+n}(r,e[0],e[1],e[2])),null===e&&(K=r),e}function X(){var e;return 43===t.charCodeAt(K)?(e="+",K++):(e=null,0===Q&&n('"+"')),null===e&&(45===t.charCodeAt(K)?(e="-",K++):(e=null,0===Q&&n('"-"'))),e}function G(){var t,e,i,n;return i=K,n=K,t=H(),null!==t?(e=G(),null!==e?t=[t,e]:(t=null,K=n)):(t=null,K=n),null!==t&&(t=function(t,e,i){return e+i}(i,t[0],t[1])),null===t&&(K=i),null===t&&(t=H()),t}function H(){var e;return/^[0-9]/.test(t.charAt(K))?(e=t.charAt(K),K++):(e=null,0===Q&&n("[0-9]")),e}function z(){var e;return 32===t.charCodeAt(K)?(e=" ",K++):(e=null,0===Q&&n('" "')),null===e&&(9===t.charCodeAt(K)?(e="	",K++):(e=null,0===Q&&n('"\\t"')),null===e&&(13===t.charCodeAt(K)?(e="\r",K++):(e=null,0===Q&&n('"\\r"')),null===e&&(10===t.charCodeAt(K)?(e="\n",K++):(e=null,0===Q&&n('"\\n"'))))),e}function q(t){t.sort();for(var e=null,i=[],n=0;n<t.length;n++)t[n]!==e&&(i.push(t[n]),e=t[n]);return i}function U(){for(var e=1,i=1,n=!1,s=0;s<Math.max(K,j);s++){var r=t.charAt(s);"\n"===r?(n||e++,i=1,n=!1):"\r"===r||"\u2028"===r||"\u2029"===r?(e++,i=1,n=!0):(i++,n=!1)}return{line:e,column:i}}function W(t,e){var i=[{cmd:e?"moveToRelative":"moveTo",args:[t[0].x,t[0].y]}];if(t.length>1)for(var n=1;n<t.length;n++)i.push({cmd:e?"lineToRelative":"lineTo",args:[t[n].x,t[n].y]});return i}var Z={svgPath:s,movetoDrawtoCommandGroups:r,movetoDrawtoCommandGroup:o,drawtoCommands:a,drawtoCommand:h,moveto:u,movetoArgumentSequence:l,closepath:c,lineto:d,linetoArgumentSequence:m,horizontalLineto:f,horizontalLinetoArgumentSequence:g,verticalLineto:p,verticalLinetoArgumentSequence:v,curveto:y,curvetoArgumentSequence:x,curvetoArgument:_,smoothCurveto:E,smoothCurvetoArgumentSequence:T,smoothCurvetoArgument:S,quadraticBezierCurveto:b,quadraticBezierCurvetoArgumentSequence:C,quadraticBezierCurvetoArgument:w,smoothQuadraticBezierCurveto:R,smoothQuadraticBezierCurvetoArgumentSequence:P,ellipticalArc:A,ellipticalArcArgumentSequence:M,ellipticalArcArgument:N,coordinatePair:I,nonnegativeNumber:D,number:Y,flag:L,commaWsp:O,comma:B,floatingPointConstant:k,fractionalConstant:V,exponent:F,sign:X,digitSequence:G,digit:H,wsp:z};if(void 0!==i){if(void 0===Z[i])throw new Error("Invalid rule name: "+e(i)+".")}else i="svgPath";var K=0,Q=0,j=0,J=[],$=Z[i]();if(null===$||K!==t.length){var te=Math.max(K,j),ee=te<t.length?t.charAt(te):null,ie=U();throw new this.SyntaxError(q(J),ee,te,ie.line,ie.column)}return $},toSource:function(){return this._source}};var n=i.svgPath;return n.SyntaxError=function(t,i,n,s,r){function o(t,i){var n,s;switch(t.length){case 0:n="end of input";break;case 1:n=t[0];break;default:n=t.slice(0,t.length-1).join(", ")+" or "+t[t.length-1]}return s=i?e(i):"end of input","Expected "+n+" but "+s+" found."}this.name="SyntaxError",this.expected=t,this.found=i,this.message=o(t,i),this.offset=n,this.line=s,this.column=r},n.SyntaxError.prototype=Error.prototype,n}),i("KITE/util/LineStyles",["require","KITE/kite","DOT/Util"],function(t){var e=t("KITE/kite"),i=t("DOT/Util").lineLineIntersection;e.LineStyles=function(t){void 0===t&&(t={}),this.lineWidth=void 0!==t.lineWidth?t.lineWidth:1,this.lineCap=void 0!==t.lineCap?t.lineCap:"butt",this.lineJoin=void 0!==t.lineJoin?t.lineJoin:"miter",this.lineDash=t.lineDash?t.lineDash:[],this.lineDashOffset=void 0!==t.lineDashOffset?t.lineDashOffset:0,this.miterLimit=void 0!==t.miterLimit?t.miterLimit:10};var n=e.LineStyles;return n.prototype={constructor:n,equals:function(t){var e=this.lineWidth===t.lineWidth&&this.lineCap===t.lineCap&&this.lineJoin===t.lineJoin&&this.miterLimit===t.miterLimit&&this.lineDashOffset===t.lineDashOffset;if(!e)return!1;if(this.lineDash.length!==t.lineDash.length)return!1;for(var i=0;i<this.lineDash.length;i++)if(this.lineDash[i]!==t.lineDash[i])return!1;return!0},leftJoin:function(t,n,s){var r=t.plus(n.perpendicular().negated().times(this.lineWidth/2)),o=t.plus(s.perpendicular().negated().times(this.lineWidth/2)),a=r.equals(o)?[]:[new e.Segment.Line(r,o)];if(!(n.perpendicular().dot(s)>0))return a;switch(this.lineJoin){case"round":var h=n.angle()+Math.PI/2,u=s.angle()+Math.PI/2;return[new e.Segment.Arc(t,this.lineWidth/2,h,u,!0)];case"miter":var l=n.angleBetween(s.negated());if(1/Math.sin(l/2)<=this.miterLimit&&l<Math.PI-1e-5){var c=i(r,r.plus(n),o,o.plus(s));return[new e.Segment.Line(r,c),new e.Segment.Line(c,o)]}return a;case"bevel":return a}},rightJoin:function(t,e,i){return this.leftJoin(t,i.negated(),e.negated())},cap:function(t,i){var n=t.plus(i.perpendicular().times(-this.lineWidth/2)),s=t.plus(i.perpendicular().times(this.lineWidth/2));switch(this.lineCap){case"butt":return[new e.Segment.Line(n,s)];case"round":var r=i.angle();return[new e.Segment.Arc(t,this.lineWidth/2,r+Math.PI/2,r-Math.PI/2,!0)];case"square":var o=i.perpendicular().negated().times(this.lineWidth/2),a=i.perpendicular().times(this.lineWidth/2),h=i.times(this.lineWidth/2),u=t.plus(o).plus(h),l=t.plus(a).plus(h);return[new e.Segment.Line(n,u),new e.Segment.Line(u,l),new e.Segment.Line(l,s)]}}},e.LineStyles}),i("KITE/segments/Quadratic",["require","PHET_CORE/inherit","DOT/Bounds2","DOT/Matrix3","DOT/Util","DOT/Util","KITE/kite","KITE/segments/Segment"],function(t){var e=t("PHET_CORE/inherit"),i=t("DOT/Bounds2"),n=t("DOT/Matrix3"),s=t("DOT/Util").solveQuadraticRootsReal,r=t("DOT/Util").arePointsCollinear,o=t("KITE/kite"),a=t("KITE/segments/Segment");return a.Quadratic=function(t,e,i){this._start=t,this._control=e,this._end=i,this._startTangent=void 0,this._endTangent=void 0,this._tCriticalX=void 0,this._tCriticalY=void 0,this._bounds=void 0},e(a,a.Quadratic,{degree:2,getStart:function(){return this._start},get start(){return this._start},getControl:function(){return this._control},get control(){return this._control},getEnd:function(){return this._end},get end(){return this._end},getStartTangent:function(){if(void 0===this._startTangent){var t=this._start.equals(this._control);this._startTangent=t?this._end.minus(this._start).normalized():this._control.minus(this._start).normalized()}return this._startTangent},get startTangent(){return this.getStartTangent()},getEndTangent:function(){if(void 0===this._endTangent){var t=this._end.equals(this._control);this._endTangent=t?this._end.minus(this._start).normalized():this._end.minus(this._control).normalized()}return this._endTangent},get endTangent(){return this.getEndTangent()},getTCriticalX:function(){return void 0===this._tCriticalX&&(this._tCriticalX=a.Quadratic.extremaT(this._start.x,this._control.x,this._end.x)),this._tCriticalX},get tCriticalX(){return this.getTCriticalX()},getTCriticalY:function(){return void 0===this._tCriticalY&&(this._tCriticalY=a.Quadratic.extremaT(this._start.y,this._control.y,this._end.y)),this._tCriticalY},get tCriticalY(){return this.getTCriticalY()},getNondegenerateSegments:function(){var t=this._start,e=this._control,i=this._end,n=t.equals(i),s=t.equals(e),o=t.equals(e);if(n&&s)return[];if(n){var h=this.positionAt(.5);return[new a.Line(t,h),new a.Line(h,i)]}if(r(t,e,i)){if(s||o)return[new a.Line(t,i)];var u=i.minus(t),l=e.minus(t).dot(u.normalized)/u.magnitude(),c=a.Quadratic.extremaT(0,l,1);if(null!==c&&c>0&&1>c){var d=this.positionAt(c);return _.flatten([new a.Line(t,d).getNondegenerateSegments(),new a.Line(d,i).getNondegenerateSegments()])}return[new a.Line(t,i)]}return[this]},getBounds:function(){if(void 0===this._bounds){this._bounds=new i(Math.min(this._start.x,this._end.x),Math.min(this._start.y,this._end.y),Math.max(this._start.x,this._end.x),Math.max(this._start.y,this._end.y));var t=this.getTCriticalX(),e=this.getTCriticalY();null!==t&&t>0&&1>t&&(this._bounds=this._bounds.withPoint(this.positionAt(t))),null!==e&&e>0&&1>e&&(this._bounds=this._bounds.withPoint(this.positionAt(e)))}return this._bounds},get bounds(){return this.getBounds()},positionAt:function(t){var e=1-t;return this._start.times(e*e).plus(this._control.times(2*e*t)).plus(this._end.times(t*t))},tangentAt:function(t){return this._control.minus(this._start).times(2*(1-t)).plus(this._end.minus(this._control).times(2*t))},curvatureAt:function(t){var e=1e-7;if(Math.abs(t-.5)>.5-e){var i=.5>t,n=i?this._start:this._end,s=this._control,r=i?this._end:this._start,o=s.minus(n),a=o.magnitude(),h=(i?-1:1)*o.perpendicular().normalized().dot(r.minus(s));return h*(this.degree-1)/(this.degree*a*a)}return this.subdivided(t,!0)[0].curvatureAt(1)},offsetTo:function(t,e){for(var i=[this],n=5,s=0;n>s;s++)i=_.flatten(_.map(i,function(t){return t.subdivided(.5,!0)}));var r=_.map(i,function(e){return e.approximateOffset(t)});return e&&(r.reverse(),r=_.map(r,function(t){return t.reversed(!0)})),r},subdivided:function(t){var e=this._start.blend(this._control,t),i=this._control.blend(this._end,t),n=e.blend(i,t);return[new a.Quadratic(this._start,e,n),new a.Quadratic(n,i,this._end)]},degreeElevated:function(){return new a.Cubic(this._start,this._start.plus(this._control.timesScalar(2)).dividedScalar(3),this._end.plus(this._control.timesScalar(2)).dividedScalar(3),this._end)},reversed:function(){return new a.Quadratic(this._end,this._control,this._start)},approximateOffset:function(t){return new a.Quadratic(this._start.plus((this._start.equals(this._control)?this._end.minus(this._start):this._control.minus(this._start)).perpendicular().normalized().times(t)),this._control.plus(this._end.minus(this._start).perpendicular().normalized().times(t)),this._end.plus((this._end.equals(this._control)?this._end.minus(this._start):this._end.minus(this._control)).perpendicular().normalized().times(t)))},getSVGPathFragment:function(){return"Q "+o.svgNumber(this._control.x)+" "+o.svgNumber(this._control.y)+" "+o.svgNumber(this._end.x)+" "+o.svgNumber(this._end.y)},strokeLeft:function(t){return this.offsetTo(-t/2,!1)},strokeRight:function(t){return this.offsetTo(t/2,!0)},getInteriorExtremaTs:function(){var t=[],e=1e-10;return void 0!==this.tCriticalX&&this.tCriticalX>e&&this.tCriticalX<1-e&&t.push(this.tCriticalX),void 0!==this.tCriticalY&&this.tCriticalY>e&&this.tCriticalY<1-e&&t.push(this.tCriticalY),t.sort()},intersectsBounds:function(){throw new Error("Segment.Quadratic.intersectsBounds unimplemented")},intersection:function(t){var e=this,i=[],r=n.rotation2(-t.dir.angle()).timesMatrix(n.translation(-t.pos.x,-t.pos.y)),o=r.timesVector2(this._start),a=r.timesVector2(this._control),h=r.timesVector2(this._end),u=o.y-2*a.y+h.y,l=-2*o.y+2*a.y,c=o.y,d=s(u,l,c);return _.each(d,function(n){if(n>=0&&1>=n){var s=e.positionAt(n),r=e.tangentAt(n).normalized(),o=r.perpendicular(),a=s.minus(t.pos);a.dot(t.dir)>0&&i.push({distance:a.magnitude(),point:s,normal:o.dot(t.dir)>0?o.negated():o,wind:t.dir.perpendicular().dot(r)<0?1:-1})}}),i},windingIntersection:function(t){var e=0,i=this.intersection(t);return _.each(i,function(t){e+=t.wind}),e},writeToContext:function(t){t.quadraticCurveTo(this._control.x,this._control.y,this._end.x,this._end.y)},transformed:function(t){return new a.Quadratic(t.timesVector2(this._start),t.timesVector2(this._control),t.timesVector2(this._end))},reparameterized:function(t,e){var i=this._start.plus(this._end.plus(this._control.timesScalar(-2))),n=this._control.minus(this._start).timesScalar(2),s=this._start,r=i.timesScalar(t*t),o=i.timesScalar(t*e).timesScalar(2).plus(n.timesScalar(t)),h=i.timesScalar(e*e).plus(n.timesScalar(e)).plus(s);return new a.Quadratic(h,o.timesScalar(.5).plus(h),r.plus(o).plus(h))}}),a.Quadratic.extremaT=function(t,e,i){var n=2*(i-2*e+t);return 0!==n?-2*(e-t)/n:null},a.Quadratic}),i("KITE/segments/Cubic",["require","PHET_CORE/inherit","DOT/Bounds2","DOT/Vector2","DOT/Matrix3","DOT/Util","DOT/Util","DOT/Util","KITE/kite","KITE/segments/Segment","KITE/segments/Quadratic"],function(t){var e=t("PHET_CORE/inherit"),i=t("DOT/Bounds2"),n=t("DOT/Vector2"),s=t("DOT/Matrix3"),r=t("DOT/Util").solveQuadraticRootsReal,o=t("DOT/Util").solveCubicRootsReal,a=t("DOT/Util").arePointsCollinear,h=t("KITE/kite"),u=t("KITE/segments/Segment");return t("KITE/segments/Quadratic"),u.Cubic=function(t,e,i,n){this._start=t,this._control1=e,this._control2=i,this._end=n,this._startTangent=void 0,this._endTangent=void 0,this._r=void 0,this._s=void 0,this._tCusp=void 0,this._tDeterminant=void 0,this._tInflection1=void 0,this._tInflection2=void 0,this._startQuadratic=void 0,this._endQuadratic=void 0,this._xExtremaT=void 0,this._yExtremaT=void 0,this._bounds=void 0},e(u,u.Cubic,{degree:3,getStart:function(){return this._start},get start(){return this._start},getControl1:function(){return this._control1},get control1(){return this._control1},getControl2:function(){return this._control2},get control2(){return this._control2},getEnd:function(){return this._end},get end(){return this._end},getStartTangent:function(){return void 0===this._startTangent&&(this._startTangent=this.tangentAt(0).normalized()),this._startTangent},get startTangent(){return this.getStartTangent()},getEndTangent:function(){return void 0===this._endTangent&&(this._endTangent=this.tangentAt(1).normalized()),this._endTangent},get endTangent(){return this.getEndTangent()},getR:function(){return void 0===this._r&&(this._r=this._control1.minus(this._start).normalized()),this._r},get r(){return this.getR()},getS:function(){return void 0===this._s&&(this._s=this.getR().perpendicular()),this._s},get s(){return this.getS()},getTCusp:function(){return void 0===this._tCusp&&this.computeCuspInfo(),this._tCusp},get tCusp(){return this.getTCusp()},getTDeterminant:function(){return void 0===this._tDeterminant&&this.computeCuspInfo(),this._tDeterminant},get tDeterminant(){return this.getTDeterminant()},getTInflection1:function(){return void 0===this._tInflection1&&this.computeCuspInfo(),this._tInflection1},get tInflection1(){return this.getTInflection1()},getTInflection2:function(){return void 0===this._tInflection2&&this.computeCuspInfo(),this._tInflection2},get tInflection2(){return this.getTInflection2()},getStartQuadratic:function(){return void 0===this._startQuadratic&&this.computeCuspSegments(),this._startQuadratic},get startQuadratic(){return this.getStartQuadratic()},getEndQuadratic:function(){return void 0===this._endQuadratic&&this.computeCuspSegments(),this._endQuadratic},get endQuadratic(){return this.getEndQuadratic()},getXExtremaT:function(){return void 0===this._xExtremaT&&(this._xExtremaT=u.Cubic.extremaT(this._start.x,this._control1.x,this._control2.x,this._end.x)),this._xExtremaT},get xExtremaT(){return this.getXExtremaT()},getYExtremaT:function(){return void 0===this._yExtremaT&&(this._yExtremaT=u.Cubic.extremaT(this._start.y,this._control1.y,this._control2.y,this._end.y)),this._yExtremaT},get yExtremaT(){return this.getYExtremaT()},getBounds:function(){if(void 0===this._bounds){this._bounds=i.NOTHING,this._bounds=this._bounds.withPoint(this._start),this._bounds=this._bounds.withPoint(this._end);var t=this;_.each(this.getXExtremaT(),function(e){e>=0&&1>=e&&(t._bounds=t._bounds.withPoint(t.positionAt(e)))}),_.each(this.getYExtremaT(),function(e){e>=0&&1>=e&&(t._bounds=t._bounds.withPoint(t.positionAt(e)))}),this.hasCusp()&&(this._bounds=this._bounds.withPoint(this.positionAt(this.getTCusp())))}return this._bounds},get bounds(){return this.getBounds()},computeCuspInfo:function(){var t=this._start.times(-1).plus(this._control1.times(3)).plus(this._control2.times(-3)).plus(this._end),e=this._start.times(3).plus(this._control1.times(-6)).plus(this._control2.times(3)),i=this._start.times(-3).plus(this._control1.times(3)),n=t.perpendicular(),s=e.perpendicular(),r=n.dot(e);if(this._tCusp=-.5*(n.dot(i)/r),this._tDeterminant=this._tCusp*this._tCusp-1/3*(s.dot(i)/r),this._tDeterminant>=0){var o=Math.sqrt(this._tDeterminant);this._tInflection1=this._tCusp-o,this._tInflection2=this._tCusp+o}else this._tInflection1=null,this._tInflection2=null},computeCuspSegments:function(){if(this.hasCusp()){var t=this.subdivided(this.getTCusp);this._startQuadratic=new u.Quadratic(t[0].start,t[0].control1,t[0].end,!1),this._endQuadratic=new u.Quadratic(t[1].start,t[1].control2,t[1].end,!1)}else this._startQuadratic=null,this._endQuadratic=null},getNondegenerateSegments:function(){var t=this._start,e=this._control1,i=this._control2,n=this._end,s=this.degreeReduced(1e-9);if(t.equals(n)&&t.equals(e)&&t.equals(i))return[];if(this.hasCusp())return _.flatten([this._startQuadratic.getNondegenerateSegments(),this._endQuadratic.getNondegenerateSegments()]);if(s)return s.getNondegenerateSegments();if(a(t,e,n)&&a(t,i,n))throw new Error("TODO, use extrema T funcs");return[this]},hasCusp:function(){var t=this.getTCusp(),e=1e-7;return this.tangentAt(t).magnitude()<e&&t>=0&&1>=t},positionAt:function(t){var e=1-t;return this._start.times(e*e*e).plus(this._control1.times(3*e*e*t)).plus(this._control2.times(3*e*t*t)).plus(this._end.times(t*t*t))},tangentAt:function(t){var e=1-t;return this._start.times(-3*e*e).plus(this._control1.times(3*e*e-6*e*t)).plus(this._control2.times(6*e*t-3*t*t)).plus(this._end.times(3*t*t))},curvatureAt:function(t){var e=1e-7;if(Math.abs(t-.5)>.5-e){var i=.5>t,n=i?this._start:this._end,s=i?this._control1:this._control2,r=i?this._control2:this._control1,o=s.minus(n),a=o.magnitude(),h=(i?-1:1)*o.perpendicular().normalized().dot(r.minus(s));return h*(this.degree-1)/(this.degree*a*a)}return this.subdivided(t)[0].curvatureAt(1)},toRS:function(t){var e=t.minus(this._start);return new n(e.dot(this.getR()),e.dot(this.getS()))},subdivided:function(t){var e=this._start.blend(this._control1,t),i=this._control2.blend(this._end,t),n=this._control1.blend(this._control2,t),s=e.blend(n,t),r=n.blend(i,t),o=s.blend(r,t);return[new u.Cubic(this._start,e,s,o),new u.Cubic(o,r,i,this._end)]},offsetTo:function(t,e){for(var i=32,n=[],s=[],r=0;i>r;r++){var o=r/(i-1);e&&(o=1-o),n.push(this.positionAt(o).plus(this.tangentAt(o).perpendicular().normalized().times(t))),r>0&&s.push(new u.Line(n[r-1],n[r]))}return s},getSVGPathFragment:function(){return"C "+h.svgNumber(this._control1.x)+" "+h.svgNumber(this._control1.y)+" "+h.svgNumber(this._control2.x)+" "+h.svgNumber(this._control2.y)+" "+h.svgNumber(this._end.x)+" "+h.svgNumber(this._end.y)
},strokeLeft:function(t){return this.offsetTo(-t/2,!1)},strokeRight:function(t){return this.offsetTo(t/2,!0)},getInteriorExtremaTs:function(){var t=this.getXExtremaT().concat(this.getYExtremaT()),e=[];return _.each(t,function(t){var i=1e-10;t>i&&1-i>t&&_.every(e,function(e){return Math.abs(t-e)>i})&&e.push(t)}),e.sort()},intersectsBounds:function(){throw new Error("Segment.Cubic.intersectsBounds unimplemented")},intersection:function(t){var e=this,i=[],n=s.rotation2(-t.dir.angle()).timesMatrix(s.translation(-t.pos.x,-t.pos.y)),r=n.timesVector2(this._start),a=n.timesVector2(this._control1),h=n.timesVector2(this._control2),u=n.timesVector2(this._end),l=-r.y+3*a.y-3*h.y+u.y,c=3*r.y-6*a.y+3*h.y,d=-3*r.y+3*a.y,m=r.y,f=o(l,c,d,m);return _.each(f,function(n){if(n>=0&&1>=n){var s=e.positionAt(n),r=e.tangentAt(n).normalized(),o=r.perpendicular(),a=s.minus(t.pos);a.dot(t.dir)>0&&i.push({distance:a.magnitude(),point:s,normal:o.dot(t.dir)>0?o.negated():o,wind:t.dir.perpendicular().dot(r)<0?1:-1})}}),i},windingIntersection:function(t){var e=0,i=this.intersection(t);return _.each(i,function(t){e+=t.wind}),e},writeToContext:function(t){t.bezierCurveTo(this._control1.x,this._control1.y,this._control2.x,this._control2.y,this._end.x,this._end.y)},transformed:function(t){return new u.Cubic(t.timesVector2(this._start),t.timesVector2(this._control1),t.timesVector2(this._control2),t.timesVector2(this._end))},degreeReduced:function(t){t=t||0;var e=this._control1.timesScalar(3).minus(this._start).dividedScalar(2),i=this._control2.timesScalar(3).minus(this._end).dividedScalar(2);return e.minus(i).magnitude()<=t?new u.Quadratic(this._start,e.average(i),this._end):null}}),u.Cubic.extremaT=function(t,e,i,n){var s=-3*t+9*e-9*i+3*n,o=6*t-12*e+6*i,a=-3*t+3*e;return r(s,o,a)},u.Cubic}),i("KITE/segments/EllipticalArc",["require","PHET_CORE/inherit","DOT/Vector2","DOT/Bounds2","DOT/Matrix3","DOT/Transform3","DOT/Util","DOT/Util","KITE/kite","KITE/segments/Segment","KITE/util/Subpath"],function(t){var e=t("PHET_CORE/inherit"),i=t("DOT/Vector2"),n=t("DOT/Bounds2"),s=t("DOT/Matrix3"),r=t("DOT/Transform3"),o=t("DOT/Util").toDegrees,a=t("DOT/Util"),h=t("KITE/kite"),u=t("KITE/segments/Segment");return t("KITE/util/Subpath"),u.EllipticalArc=function(t,e,i,n,s,r,o){if(0>e&&(e=-e,s=Math.PI-s,r=Math.PI-r,o=!o),0>i&&(i=-i,s=-s,r=-r,o=!o),i>e){n+=Math.PI/2,s-=Math.PI/2,r-=Math.PI/2;var a=e;e=i,i=a}if(this._center=t,this._radiusX=e,this._radiusY=i,this._rotation=n,this._startAngle=s,this._endAngle=r,this._anticlockwise=o,this._unitTransform=void 0,this._start=void 0,this._end=void 0,this._startTangent=void 0,this._endTangent=void 0,this._actualEndAngle=void 0,this._isFullPerimeter=void 0,this._angleDifference=void 0,this._unitArcSegment=void 0,i>e)throw new Error("Not verified to work if radiusX < radiusY")},e(u,u.EllipticalArc,{getCenter:function(){return this._center},get center(){return this.getCenter()},getRadiusX:function(){return this._radiusX},get radiusX(){return this.getRadiusX()},getRadiusY:function(){return this._radiusY},get radiusY(){return this.getRadiusY()},getRotation:function(){return this._rotation},get rotation(){return this.getRotation()},getStartAngle:function(){return this._startAngle},get startAngle(){return this.getStartAngle()},getEndAngle:function(){return this._endAngle},get endAngle(){return this.getEndAngle()},getAnticlockwise:function(){return this._anticlockwise},get anticlockwise(){return this.getAnticlockwise()},getUnitTransform:function(){return void 0===this._unitTransform&&(this._unitTransform=u.EllipticalArc.computeUnitTransform(this._center,this._radiusX,this._radiusY,this._rotation)),this._unitTransform},get unitTransform(){return this.getUnitTransform()},getStart:function(){return void 0===this._start&&(this._start=this.positionAtAngle(this._startAngle)),this._start},get start(){return this.getStart()},getEnd:function(){return void 0===this._end&&(this._end=this.positionAtAngle(this._endAngle)),this._end},get end(){return this.getEnd()},getStartTangent:function(){return void 0===this._startTangent&&(this._startTangent=this.tangentAtAngle(this._startAngle)),this._startTangent},get startTangent(){return this.getStartTangent()},getEndTangent:function(){return void 0===this._endTangent&&(this._endTangent=this.tangentAtAngle(this._endAngle)),this._endTangent},get endTangent(){return this.getEndTangent()},getActualEndAngle:function(){return void 0===this._actualEndAngle&&(this._actualEndAngle=this._anticlockwise?this._startAngle>this._endAngle?this._endAngle:this._startAngle<this._endAngle?this._endAngle-2*Math.PI:this._startAngle:this._startAngle<this._endAngle?this._endAngle:this._startAngle>this._endAngle?this._endAngle+2*Math.PI:this._startAngle),this._actualEndAngle},get actualEndAngle(){return this.getActualEndAngle()},getIsFullPerimeter:function(){return void 0===this._isFullPerimeter&&(this._isFullPerimeter=!this._anticlockwise&&this._endAngle-this._startAngle>=2*Math.PI||this._anticlockwise&&this._startAngle-this._endAngle>=2*Math.PI),this._isFullPerimeter},get isFullPerimeter(){return this.getIsFullPerimeter()},getAngleDifference:function(){return void 0===this._angleDifference&&(this._angleDifference=this._anticlockwise?this._startAngle-this._endAngle:this._endAngle-this._startAngle,this._angleDifference<0&&(this._angleDifference+=2*Math.PI)),this._angleDifference},get angleDifference(){return this.getAngleDifference()},getUnitArcSegment:function(){return void 0===this._unitArcSegment&&(this._unitArcSegment=new u.Arc(i.ZERO,1,this._startAngle,this._endAngle,this._anticlockwise)),this._unitArcSegment},getBounds:function(){if(void 0===this._bounds&&(this._bounds=n.NOTHING.withPoint(this.getStart()).withPoint(this.getEnd()),this._startAngle!==this._endAngle)){var t=Math.atan(-(this._radiusY/this._radiusX)*Math.tan(this._rotation)),e=Math.atan(this._radiusY/this._radiusX/Math.tan(this._rotation));this.possibleExtremaAngles=[t,t+Math.PI,e,e+Math.PI],_.each(this.possibleExtremaAngles,this.includeBoundsAtAngle.bind(this))}return this._bounds},get bounds(){return this.getBounds()},getNondegenerateSegments:function(){if(this._radiusX<=0||this._radiusY<=0||this._startAngle===this._endAngle)return[];if(this._radiusX===this._radiusY){var t=this._startAngle-this._rotation,e=this._endAngle-this._rotation;return Math.abs(this._endAngle-this._startAngle)===2*Math.PI&&(e=this._anticlockwise?t-2*Math.PI:t+2*Math.PI),[new u.Arc(this._center,this._radiusX,t,e,this._anticlockwise)]}return[this]},includeBoundsAtAngle:function(t){this.containsAngle(t)&&(this._bounds=this._bounds.withPoint(this.positionAtAngle(t)))},mapAngle:function(t){return this._startAngle>this.getActualEndAngle()?a.moduloBetweenUp(t,this._startAngle-2*Math.PI,this._startAngle):a.moduloBetweenDown(t,this._startAngle,this._startAngle+2*Math.PI)},tAtAngle:function(t){return(this.mapAngle(t)-this._startAngle)/(this.getActualEndAngle()-this._startAngle)},angleAt:function(t){return this._startAngle+(this.getActualEndAngle()-this._startAngle)*t},positionAt:function(t){return this.positionAtAngle(this.angleAt(t))},tangentAt:function(t){return this.tangentAtAngle(this.angleAt(t))},curvatureAt:function(t){var e=this.angleAt(t),i=this._radiusX*Math.sin(e),n=this._radiusY*Math.cos(e),s=Math.pow(n*n+i*i,1.5);return(this._anticlockwise?-1:1)*this._radiusX*this._radiusY/s},positionAtAngle:function(t){return this.getUnitTransform().transformPosition2(i.createPolar(1,t))},tangentAtAngle:function(t){var e=this.getUnitTransform().transformNormal2(i.createPolar(1,t));return this._anticlockwise?e.perpendicular():e.perpendicular().negated()},containsAngle:function(t){var e=this._anticlockwise?t-this._endAngle:t-this._startAngle,i=e%(2*Math.PI);return 0>i&&(i+=2*Math.PI),i<=this.getAngleDifference()},offsetTo:function(t,e){for(var i=32,n=[],s=[],r=0;i>r;r++){var o=r/(i-1);e&&(o=1-o);var a=this.angleAt(o);n.push(this.positionAtAngle(a).plus(this.tangentAtAngle(a).perpendicular().normalized().times(t))),r>0&&s.push(new u.Line(n[r-1],n[r]))}return s},getSVGPathFragment:function(){var t,e=.01,i=this._anticlockwise?"0":"1",n=o(this._rotation);if(this.getAngleDifference()<2*Math.PI-e)return t=this.getAngleDifference()<Math.PI?"0":"1","A "+h.svgNumber(this._radiusX)+" "+h.svgNumber(this._radiusY)+" "+n+" "+t+" "+i+" "+h.svgNumber(this.getEnd().x)+" "+h.svgNumber(this.getEnd().y);var s=(this._startAngle+this._endAngle)/2,r=this.positionAtAngle(s);t="0";var a="A "+h.svgNumber(this._radiusX)+" "+h.svgNumber(this._radiusY)+" "+n+" "+t+" "+i+" "+h.svgNumber(r.x)+" "+h.svgNumber(r.y),u="A "+h.svgNumber(this._radiusX)+" "+h.svgNumber(this._radiusY)+" "+n+" "+t+" "+i+" "+h.svgNumber(this.getEnd().x)+" "+h.svgNumber(this.getEnd().y);return a+" "+u},strokeLeft:function(t){return this.offsetTo(-t/2,!1)},strokeRight:function(t){return this.offsetTo(t/2,!0)},getInteriorExtremaTs:function(){var t=this,e=[];return _.each(this.possibleExtremaAngles,function(i){if(t.containsAngle(i)){var n=t.tAtAngle(i),s=1e-10;n>s&&1-s>n&&e.push(n)}}),e.sort()},subdivided:function(t){var e=this.angleAt(0),i=this.angleAt(t),n=this.angleAt(1);return[new u.EllipticalArc(this._center,this._radiusX,this._radiusY,this._rotation,e,i,this._anticlockwise),new u.EllipticalArc(this._center,this._radiusX,this._radiusY,this._rotation,i,n,this._anticlockwise)]},intersectsBounds:function(){throw new Error("Segment.EllipticalArc.intersectsBounds unimplemented")},intersection:function(t){var e=this.getUnitTransform(),i=e.inverseRay2(t),n=this.getUnitArcSegment().intersection(i);return _.map(n,function(i){var n=e.transformPosition2(i.point);return{distance:t.pos.distance(n),point:n,normal:e.inverseNormal2(i.normal),wind:i.wind}})},windingIntersection:function(t){var e=this.getUnitTransform().inverseRay2(t);return this.getUnitArcSegment().windingIntersection(e)},writeToContext:function(t){t.ellipse?t.ellipse(this._center.x,this._center.y,this._radiusX,this._radiusY,this._rotation,this._startAngle,this._endAngle,this._anticlockwise):(this.getUnitTransform().getMatrix().canvasAppendTransform(t),t.arc(0,0,1,this._startAngle,this._endAngle,this._anticlockwise),this.getUnitTransform().getInverse().canvasAppendTransform(t))},transformed:function(t){var e=t.timesVector2(i.createPolar(this._radiusX,this._rotation)).minus(t.timesVector2(i.ZERO)),n=t.timesVector2(i.createPolar(this._radiusY,this._rotation+Math.PI/2)).minus(t.timesVector2(i.ZERO)),s=e.angle(),r=e.magnitude(),o=n.magnitude(),a=t.getDeterminant()<0,h=a?!this._anticlockwise:this._anticlockwise,l=a?-this._startAngle:this._startAngle,c=a?-this._endAngle:this._endAngle;return Math.abs(this._endAngle-this._startAngle)===2*Math.PI&&(c=h?l-2*Math.PI:l+2*Math.PI),new u.EllipticalArc(t.timesVector2(this._center),r,o,s,l,c,h)}}),u.EllipticalArc.computeUnitTransform=function(t,e,i,n){return new r(s.translation(t.x,t.y).timesMatrix(s.rotation2(n)).timesMatrix(s.scaling(e,i)))},u.EllipticalArc}),i("KITE/Shape",["require","KITE/kite","DOT/Vector2","DOT/Bounds2","DOT/Ray2","KITE/util/Subpath","KITE/parser/svgPath","KITE/util/LineStyles","KITE/segments/Arc","KITE/segments/Cubic","KITE/segments/EllipticalArc","KITE/segments/Line","KITE/segments/Quadratic"],function(t){function e(t,e){return new s(t,e)}function i(t,e){return new s(t,e)}var n=t("KITE/kite"),s=t("DOT/Vector2"),r=t("DOT/Bounds2"),o=t("DOT/Ray2"),a=t("KITE/util/Subpath"),h=t("KITE/parser/svgPath");t("KITE/util/LineStyles"),t("KITE/segments/Arc"),t("KITE/segments/Cubic"),t("KITE/segments/EllipticalArc"),t("KITE/segments/Line"),t("KITE/segments/Quadratic"),n.Shape=function(t,e){this.subpaths="object"==typeof t?t:[],this.bounds=(e||r.NOTHING).copy();var i=this;t&&"object"!=typeof t&&_.each(h.parse(t),function(t){i[t.cmd].apply(i,t.args)}),this.resetControlPoints()};var u=n.Shape;return u.prototype={constructor:u,resetControlPoints:function(){this.lastQuadraticControlPoint=null,this.lastCubicControlPoint=null},setQuadraticControlPoint:function(t){this.lastQuadraticControlPoint=t,this.lastCubicControlPoint=null},setCubicControlPoint:function(t){this.lastQuadraticControlPoint=null,this.lastCubicControlPoint=t},moveTo:function(t,e){return this.moveToPoint(i(t,e))},moveToRelative:function(t,e){return this.moveToPointRelative(i(t,e))},moveToPointRelative:function(t){return this.moveToPoint(this.getRelativePoint().plus(t))},moveToPoint:function(t){return this.addSubpath((new n.Subpath).addPoint(t)),this.resetControlPoints(),this},lineTo:function(t,e){return this.lineToPoint(i(t,e))},lineToRelative:function(t,e){return this.lineToPointRelative(i(t,e))},lineToPointRelative:function(t){return this.lineToPoint(this.getRelativePoint().plus(t))},lineToPoint:function(t){if(this.hasSubpaths()){var e=this.getLastSubpath().getLastPoint(),i=t,s=new n.Segment.Line(e,i);this.getLastSubpath().addPoint(i),this.addSegmentAndBounds(s)}else this.ensure(t);return this.resetControlPoints(),this},horizontalLineTo:function(t){return this.lineTo(t,this.getRelativePoint().y)},horizontalLineToRelative:function(t){return this.lineToRelative(t,0)},verticalLineTo:function(t){return this.lineTo(this.getRelativePoint().x,t)},verticalLineToRelative:function(t){return this.lineToRelative(0,t)},quadraticCurveTo:function(t,e,n,s){return this.quadraticCurveToPoint(i(t,e),i(n,s))},quadraticCurveToRelative:function(t,e,n,s){return this.quadraticCurveToPointRelative(i(t,e),i(n,s))},quadraticCurveToPointRelative:function(t,e){var i=this.getRelativePoint();return this.quadraticCurveToPoint(i.plus(t),i.plus(e))},smoothQuadraticCurveTo:function(t,e){return this.quadraticCurveToPoint(this.getSmoothQuadraticControlPoint(),i(t,e))},smoothQuadraticCurveToRelative:function(t,e){return this.quadraticCurveToPoint(this.getSmoothQuadraticControlPoint(),i(t,e).plus(this.getRelativePoint()))},quadraticCurveToPoint:function(t,e){var i=this;this.ensure(t);var s=this.getLastSubpath().getLastPoint(),r=new n.Segment.Quadratic(s,t,e);this.getLastSubpath().addPoint(e);var o=r.getNondegenerateSegments();return _.each(o,function(t){i.addSegmentAndBounds(t)}),this.setQuadraticControlPoint(t),this},cubicCurveTo:function(t,e,n,s,r,o){return this.cubicCurveToPoint(i(t,e),i(n,s),i(r,o))},cubicCurveToRelative:function(t,e,n,s,r,o){return this.cubicCurveToPointRelative(i(t,e),i(n,s),i(r,o))},cubicCurveToPointRelative:function(t,e,i){var n=this.getRelativePoint();return this.cubicCurveToPoint(n.plus(t),n.plus(e),n.plus(i))},smoothCubicCurveTo:function(t,e,n,s){return this.cubicCurveToPoint(this.getSmoothCubicControlPoint(),i(t,e),i(n,s))},smoothCubicCurveToRelative:function(t,e,n,s){return this.cubicCurveToPoint(this.getSmoothCubicControlPoint(),i(t,e).plus(this.getRelativePoint()),i(n,s).plus(this.getRelativePoint()))},cubicCurveToPoint:function(t,e,i){var s=this;this.ensure(t);var r=this.getLastSubpath().getLastPoint(),o=new n.Segment.Cubic(r,t,e,i),a=o.getNondegenerateSegments();return _.each(a,function(t){s.addSegmentAndBounds(t)}),this.getLastSubpath().addPoint(i),this.setCubicControlPoint(e),this},arc:function(t,e,n,s,r,o){return this.arcPoint(i(t,e),n,s,r,o)},arcPoint:function(t,e,i,s,r){var o=new n.Segment.Arc(t,e,i,s,r),a=o.getStart(),h=o.getEnd();return this.hasSubpaths()&&this.getLastSubpath().getLength()>0&&!a.equals(this.getLastSubpath().getLastPoint(),0)&&this.addSegmentAndBounds(new n.Segment.Line(this.getLastSubpath().getLastPoint(),a)),this.hasSubpaths()||this.addSubpath(new n.Subpath),this.getLastSubpath().addPoint(a),this.getLastSubpath().addPoint(h),this.addSegmentAndBounds(o),this.resetControlPoints(),this},ellipticalArc:function(t,e,n,s,r,o,a,h){return this.ellipticalArcPoint(i(t,e),n,s,r,o,a,h)},ellipticalArcPoint:function(t,e,i,s,r,o,a){var h=new n.Segment.EllipticalArc(t,e,i,s,r,o,a),u=h.start,l=h.end;return this.hasSubpaths()&&this.getLastSubpath().getLength()>0&&!u.equals(this.getLastSubpath().getLastPoint(),0)&&this.addSegmentAndBounds(new n.Segment.Line(this.getLastSubpath().getLastPoint(),u)),this.hasSubpaths()||this.addSubpath(new n.Subpath),this.getLastSubpath().addPoint(u),this.getLastSubpath().addPoint(l),this.addSegmentAndBounds(h),this.resetControlPoints(),this},close:function(){if(this.hasSubpaths()){var t=this.getLastSubpath(),e=new n.Subpath;t.close(),this.addSubpath(e),e.addPoint(t.getFirstPoint())}return this.resetControlPoints(),this},ellipticalArcToRelative:function(t,e,i,n,s,r,o){var a=this.getRelativePoint();return this.ellipticalArcTo(t,e,i,n,s,r+a.x,o+a.y)},ellipticalArcTo:function(){throw new Error("ellipticalArcTo unimplemented")},circle:function(t,i,n){if("object"==typeof t){var s=t;return n=i,this.arcPoint(s,n,0,2*Math.PI,!1)}return this.arcPoint(e(t,i),n,0,2*Math.PI,!1)},ellipse:function(t,e,n,s,r){if("object"==typeof t){var o=t;return r=s,s=n,n=e,this.ellipticalArcPoint(o,n,s,r||0,0,2*Math.PI,!1)}return this.ellipticalArcPoint(i(t,e),n,s,r||0,0,2*Math.PI,!1)},rect:function(t,e,s,r){var o=new n.Subpath;return this.addSubpath(o),o.addPoint(i(t,e)),o.addPoint(i(t+s,e)),o.addPoint(i(t+s,e+r)),o.addPoint(i(t,e+r)),this.addSegmentAndBounds(new n.Segment.Line(o.points[0],o.points[1])),this.addSegmentAndBounds(new n.Segment.Line(o.points[1],o.points[2])),this.addSegmentAndBounds(new n.Segment.Line(o.points[2],o.points[3])),o.close(),this.addSubpath(new n.Subpath),this.getLastSubpath().addPoint(i(t,e)),this.resetControlPoints(),this},roundRect:function(t,e,i,n,s,r){var o=t+s,a=t+i-s,h=e+r,u=e+n-r;return s===r?this.arc(a,h,s,-Math.PI/2,0,!1).arc(a,u,s,0,Math.PI/2,!1).arc(o,u,s,Math.PI/2,Math.PI,!1).arc(o,h,s,Math.PI,3*Math.PI/2,!1).close():this.ellipticalArc(a,h,s,r,0,-Math.PI/2,0,!1).ellipticalArc(a,u,s,r,0,0,Math.PI/2,!1).ellipticalArc(o,u,s,r,0,Math.PI/2,Math.PI,!1).ellipticalArc(o,h,s,r,0,Math.PI,3*Math.PI/2,!1).close(),this},polygon:function(t){var e=t.length;if(e>0){this.moveToPoint(t[0]);for(var i=1;e>i;i++)this.lineToPoint(t[i])}return this.close()},copy:function(){return new u(_.map(this.subpaths,function(t){return t.copy()}),this.bounds)},writeToContext:function(t){for(var e=this.subpaths.length,i=0;e>i;i++)this.subpaths[i].writeToContext(t)},getSVGPath:function(){for(var t=[],e=this.subpaths.length,i=0;e>i;i++){var s=this.subpaths[i];if(s.isDrawable()){var r=s.getFirstSegment().start,o="M "+n.svgNumber(r.x)+" "+n.svgNumber(r.y)+" ";o+=_.map(s.segments,function(t){return t.getSVGPathFragment()}).join(" "),s.isClosed()&&(o+=" Z"),t.push(o)}}return t.join(" ")},transformed:function(t){var e=_.map(this.subpaths,function(e){return e.transformed(t)}),i=_.reduce(e,function(t,e){return t.union(e.bounds)},r.NOTHING);return new u(e,i)},nonlinearTransformed:function(t){t=_.extend({minLevels:0,maxLevels:7,distanceEpsilon:.16,curveEpsilon:t&&t.includeCurvature?.002:null},t);var e=_.map(this.subpaths,function(e){return e.nonlinearTransformed(t)}),i=_.reduce(e,function(t,e){return t.union(e.bounds)},r.NOTHING);return new u(e,i)},polarToCartesian:function(t){return this.nonlinearTransformed(_.extend({pointMap:function(t){return s.createPolar(t.y,t.x)},methodName:"polarToCartesian"},t))},toPiecewiseLinear:function(t){return this.nonlinearTransformed(t)},computeBounds:function(t){return t?this.bounds.union(this.getStrokedShape(t).bounds):this.bounds},getBoundsWithTransform:function(t,e){if(t.isAxisAligned())return this.computeBounds(e);for(var i=r.NOTHING.copy(),n=this.subpaths.length,s=0;n>s;s++){var o=this.subpaths[s];i.includeBounds(o.getBoundsWithTransform(t))}return e&&i.includeBounds(this.getStrokedShape(e).getBoundsWithTransform(t)),i},containsPoint:function(t){var e=new o(t,s.X_UNIT);return 0!==this.windingIntersection(e)},intersection:function(t){for(var e=[],i=this.subpaths.length,n=0;i>n;n++){var s=this.subpaths[n];if(s.isDrawable()){for(var r=s.segments.length,o=0;r>o;o++){var a=s.segments[o];e=e.concat(a.intersection(t))}s.hasClosingSegment()&&(e=e.concat(s.getClosingSegment().intersection(t)))}}return _.sortBy(e,function(t){return t.distance})},windingIntersection:function(t){for(var e=0,i=this.subpaths.length,n=0;i>n;n++){var s=this.subpaths[n];if(s.isDrawable()){for(var r=s.segments.length,o=0;r>o;o++)e+=s.segments[o].windingIntersection(t);s.hasClosingSegment()&&(e+=s.getClosingSegment().windingIntersection(t))}}return e},intersectsBounds:function(t){for(var e=this.subpaths.length,i=0;e>i;i++){var n=this.subpaths[i];if(n.isDrawable()){for(var s=n.segments.length,r=0;s>r;r++)if(n.segments[r].intersectsBounds(t))return!0;if(n.hasClosingSegment()&&n.getClosingSegment().intersectsBounds(t))return!0}}return!1},getStrokedShape:function(t){for(var e=[],i=r.NOTHING.copy(),n=this.subpaths.length,s=0;n>s;s++){var o=this.subpaths[s],a=o.stroked(t);e=e.concat(a)}for(n=e.length,s=0;n>s;s++)i.includeBounds(e[s].bounds);return new u(e,i)},getOffsetShape:function(t){for(var e=[],i=r.NOTHING.copy(),n=this.subpaths.length,s=0;n>s;s++)e.push(this.subpaths[s].offset(t));for(n=e.length,s=0;n>s;s++)i.includeBounds(e[s].bounds);return new u(e,i)},toString:function(){return"new kite.Shape( '"+this.getSVGPath()+"' )"},addSegmentAndBounds:function(t){this.getLastSubpath().addSegment(t),this.bounds=this.bounds.includeBounds(this.getLastSubpath().bounds)},ensure:function(t){this.hasSubpaths()||(this.addSubpath(new a),this.getLastSubpath().addPoint(t))},addSubpath:function(t){return this.subpaths.push(t),this},hasSubpaths:function(){return this.subpaths.length>0},getLastSubpath:function(){return _.last(this.subpaths)},getLastPoint:function(){return this.hasSubpaths()?this.getLastSubpath().getLastPoint():null},getLastSegment:function(){if(!this.hasSubpaths())return null;var t=this.getLastSubpath();return t.isDrawable()?t.getLastSegment():null},getSmoothQuadraticControlPoint:function(){var t=this.getLastPoint();return this.lastQuadraticControlPoint?t.plus(t.minus(this.lastQuadraticControlPoint)):t},getSmoothCubicControlPoint:function(){var t=this.getLastPoint();return this.lastCubicControlPoint?t.plus(t.minus(this.lastCubicControlPoint)):t},getRelativePoint:function(){var t=this.getLastPoint();return t?t:s.ZERO}},u.rectangle=function(t,e,i,n){return(new u).rect(t,e,i,n)},u.rect=u.rectangle,u.roundRect=function(t,e,i,n,s,r){return(new u).roundRect(t,e,i,n,s,r)},u.roundRectangle=u.roundRect,u.polygon=function(t){return(new u).polygon(t)},u.bounds=function(t){return(new u).rect(t.minX,t.minY,t.maxX-t.minX,t.maxY-t.minY)},u.lineSegment=function(t,e,i,n){return"number"==typeof t?(new u).moveTo(t,e).lineTo(i,n):(new u).moveToPoint(t).lineToPoint(e)},u.regularPolygon=function(t,e){var i=new u;return _.each(_.range(t),function(n){var r=s.createPolar(e,2*Math.PI*n/t);0===n?i.moveToPoint(r):i.lineToPoint(r)}),i.close()},u.circle=function(t,e,i){return void 0===e?(new u).circle(0,0,t):(new u).circle(t,e,i).close()},u.ellipse=function(t,e,i,n,s){return void 0===n?(new u).ellipse(0,0,t,e,i):(new u).ellipse(t,e,i,n,s).close()},u.arc=function(t,e,i,n,s,r){return(new u).arc(t,e,i,n,s,r)},u}),i("SCENERY/util/FixedNodeEvents",["require","SCENERY/scenery"],function(t){var e=t("SCENERY/scenery"),i=["selfBounds","childBounds","bounds","resize","boundsAccuracy"];e.FixedNodeEvents=function(t){var e=t.prototype;e.initializeNodeEvents=function(){this._events={};for(var t=this,e=i.length,n=0;e>n;n++)t._events[i[n]]=[]},e.addEventListener=function(t,e){return this._events[t].push(e),this},e.containsEventListener=function(t,e){return _.indexOf(this._events[t],e)>=0},e.removeEventListener=function(t,e){return this._events[t].splice(_.indexOf(this._events[t],e),1),this},e.fireEvent=function(t,e){var i=this._events[t],n=i.length;if(n)for(var s=i.slice(0),r=0;n>r;r++)s[r](e)}};var n=e.FixedNodeEvents;return n}),i("SCENERY/nodes/Node",["require","DOT/Bounds2","DOT/Transform3","DOT/Matrix3","DOT/Vector2","DOT/Util","KITE/Shape","SCENERY/scenery","SCENERY/util/FixedNodeEvents"],function(t){var e=t("DOT/Bounds2"),i=t("DOT/Transform3"),n=t("DOT/Matrix3"),s=t("DOT/Vector2"),r=t("DOT/Util").clamp;t("KITE/Shape");var o=t("SCENERY/scenery"),a=t("SCENERY/util/FixedNodeEvents"),h=1;o.Node=function(t){var n=this;this._id=h++,this._instances=[],this._visible=!0,this._opacity=1,this._pickable=null,this._clipArea=null,this._mouseArea=null,this._touchArea=null,this._cursor=null,this._children=[],this._parents=[],this._peers=[],this._liveRegions=[],this._transformBounds=!1,this._transform=new i,this._transformListener={before:function(){n.beforeTransformChange()},after:function(){n.afterTransformChange()}},this._transform.addTransformListener(this._transformListener),this._inputListeners=[],this.initializeNodeEvents(),this._bounds=e.NOTHING,this._selfBounds=e.NOTHING,this._childBounds=e.NOTHING,this._localBounds=null,this._boundsDirty=!0,this._selfBoundsDirty=this.isPainted(),this._childBoundsDirty=!0,this._mouseBounds=null,this._mouseBoundsDirty=!0,this._touchBounds=null,this._touchBoundsDirty=!0,this._paintDirty=!1,this._subtreePaintDirty=!1,this._childPaintDirty=!1,this._renderer=null,this._rendererOptions=null,this._rendererLayerType=null,this._layerSplit=!1,this._subtreePickableCount=0,this._rendererBitmask=o.bitmaskNodeDefault,this._subtreeRendererBitmask=o.bitmaskNodeDefault,t&&this.mutate(t)};var u=o.Node;return u.prototype={constructor:u,insertChild:function(t,e){this.changePickableCount(e._subtreePickableCount),e._parents.push(this),this._children.splice(t,0,e),e.invalidateBounds(),this._boundsDirty=!0,this.markForInsertion(e,t),this.notifyStitch(!1),e.invalidateSubtreePaint()},addChild:function(t){this.insertChild(this._children.length,t)},removeChild:function(t){var e=_.indexOf(this._children,t);this.removeChildWithIndex(t,e)},removeChildAt:function(t){var e=this._children[t];this.removeChildWithIndex(e,t)},removeChildWithIndex:function(t,e){this.changePickableCount(-t._subtreePickableCount),t.markOldPaint(!1);var i=_.indexOf(t._parents,this);this.markForRemoval(t,e),t._parents.splice(i,1),this._children.splice(e,1),this.invalidateBounds(),this._childBoundsDirty=!0,this.notifyStitch(!1)},removeAllChildren:function(){this.setChildren([])},setChildren:function(t){if(this._children!==t){for(;this._children.length;)this.removeChild(this._children[this._children.length-1]);for(var e=t.length,i=0;e>i;i++)this.addChild(t[i])}},getChildren:function(){return this._children.slice(0)},getChildrenCount:function(){return this._children.length},getParents:function(){return this._parents.slice(0)},getParent:function(){return this._parents.length?this._parents[0]:null},getChildAt:function(t){return this._children[t]},indexOfParent:function(t){return _.indexOf(this._parents,t)},indexOfChild:function(t){return _.indexOf(this._children,t)},moveToFront:function(){var t=this;_.each(this._parents.slice(0),function(e){e.moveChildToFront(t)})},moveChildToFront:function(t){this.indexOfChild(t)!==this._children.length-1&&(this.removeChild(t),this.addChild(t))},moveToBack:function(){var t=this;_.each(this._parents.slice(0),function(e){e.moveChildToBack(t)})},moveChildToBack:function(t){0!==this.indexOfChild(t)&&(this.removeChild(t),this.insertChild(0,t))},detach:function(){var t=this;_.each(this._parents.slice(0),function(e){e.removeChild(t)})},changePickableCount:function(t){this._subtreePickableCount+=t;for(var e=this._parents.length,i=0;e>i;i++)this._parents[i].changePickableCount(t)},addPeer:function(t,e){this._peers.push({element:t,options:e})},addLiveRegion:function(t,e){this._liveRegions.push({property:t,options:e})},overrideBounds:function(t){return t},validateBounds:function(){var t;if(this._selfBoundsDirty&&(this._selfBoundsDirty=!1,this.fireEvent("selfBounds",this._selfBounds)),this._childBoundsDirty){for(t=this._children.length;t--;)this._children[t].validateBounds();var i=this._childBounds;for(this._childBounds=e.NOTHING.copy(),t=this._children.length;t--;)this._childBounds.includeBounds(this._children[t]._bounds);this._childBoundsDirty=!1,this._childBounds.equals(i)||this.fireEvent("childBounds",this._childBounds)}if(this._boundsDirty){this._boundsDirty=!1;var n,s=this._bounds;if(this._localBounds)n=this.localToParentBounds(this._localBounds);else if(this._transformBounds&&!this._transform.getMatrix().isAxisAligned()){var r=this._transform.getMatrix().copy();n=e.NOTHING.copy(),this.includeTransformedSubtreeBounds(r,n),this.hasClipArea()&&(n=n.intersection(this._clipArea.getBoundsWithTransform(r)))}else{var o=this._selfBounds.copy().includeBounds(this._childBounds);this.hasClipArea()&&(o=o.intersection(this._clipArea.bounds)),n=this.transformBoundsFromLocalToParent(o)}n=this.overrideBounds(n);var a=!n.equals(s);if(a){for(this._bounds=n,t=this._parents.length;t--;)this._parents[t].invalidateBounds();this.fireEvent("bounds",this._bounds)}}(this._selfBoundsDirty||this._childBoundsDirty||this._boundsDirty)&&this.validateBounds()},includeTransformedSubtreeBounds:function(t,e){this._selfBounds.isEmpty()||e.includeBounds(this.getTransformedSelfBounds(t));for(var i=this._children.length,n=0;i>n;n++){var s=this._children[n];t.multiplyMatrix(s._transform.getMatrix()),s.includeTransformedSubtreeBounds(t,e),t.multiplyMatrix(s._transform.getInverse())}return e},validateMouseBounds:function(){var t=this;if(this._mouseBoundsDirty){var e=!1;this._mouseBounds=this._selfBounds.copy();for(var i=this._children.length;i--;){var n=this._children[i];n.validateMouseBounds(),n._mouseBounds&&(e=!0,t._mouseBounds.includeBounds(n._mouseBounds))}this._mouseArea&&(e=!0,this._mouseBounds.includeBounds(this._mouseArea.isBounds?this._mouseArea:this._mouseArea.bounds)),this.hasClipArea()&&(this._mouseBounds=this._mouseBounds.intersection(this._clipArea.bounds)),e?(this.transformBoundsFromLocalToParent(this._mouseBounds),this._mouseBounds.includeBounds(this._bounds)):this._mouseBounds=null,this._mouseBoundsDirty=!1}},validateTouchBounds:function(){var t=this;if(this._touchBoundsDirty){var e=!1;this._touchBounds=this._selfBounds.copy();for(var i=this._children.length;i--;){var n=this._children[i];n.validateTouchBounds(),n._touchBounds&&(e=!0,t._touchBounds.includeBounds(n._touchBounds))}this._touchArea&&(e=!0,this._touchBounds.includeBounds(this._touchArea.isBounds?this._touchArea:this._touchArea.bounds)),this.hasClipArea()&&(this._touchBounds=this._touchBounds.intersection(this._clipArea.bounds)),e?(this.transformBoundsFromLocalToParent(this._touchBounds),this._touchBounds.includeBounds(this._bounds)):this._touchBounds=null,this._touchBoundsDirty=!1}},validatePaint:function(){if(this._paintDirty&&(this._subtreePaintDirty||this.notifyDirtySelfPaint(),this._paintDirty=!1),this._subtreePaintDirty&&(this.notifyDirtySubtreePaint(),this._subtreePaintDirty=!1),this._childPaintDirty){this._childPaintDirty=!1;for(var t=this._children,e=t.length,i=0;e>i;i++)t[i].validatePaint()}},invalidateBounds:function(){this._boundsDirty=!0,this._mouseBoundsDirty=!0,this._touchBoundsDirty=!0;for(var t=this._parents.length;t--;)this._parents[t].invalidateChildBounds()},invalidateChildBounds:function(){if(!this._childBoundsDirty){this._childBoundsDirty=!0,this._mouseBoundsDirty=!0,this._touchBoundsDirty=!0;for(var t=this._parents.length;t--;)this._parents[t].invalidateChildBounds()}},invalidatePaint:function(){this._paintDirty=!0;for(var t=this._parents.length;t--;)this._parents[t].invalidateChildPaint()},invalidateSubtreePaint:function(){this._subtreePaintDirty=!0;for(var t=this._parents.length;t--;)this._parents[t].invalidateChildPaint()},invalidateChildPaint:function(){if(!this._childPaintDirty){this._childPaintDirty=!0;for(var t=this._parents.length;t--;)this._parents[t].invalidateChildPaint()}},invalidateSelf:function(t){this.notifyBeforeSelfChange(),this._selfBounds.equals(t)||(this._selfBoundsDirty=!0,this.invalidateBounds(),this._selfBounds=t),this.invalidatePaint()},markOldSelfPaint:function(){this.notifyBeforeSelfChange()},markLayerRefreshNeeded:function(){this.markForLayerRefresh(),this.notifyStitch(!0)},markOldPaint:function(t){t?this.notifyBeforeSelfChange():this.notifyBeforeSubtreeChange()},isChild:function(t){var e=_.contains(this._children,t);return _.contains(t._parents,this),e},getSelfBounds:function(){return this._selfBounds},getSafeSelfBounds:function(){return this._selfBounds
},getTransformedSelfBounds:function(t){return this._selfBounds.transformed(t)},getChildBounds:function(){return this.validateBounds(),this._childBounds},getLocalBounds:function(){if(this._localBounds)return this._localBounds;var t=this.getSelfBounds().union(this.getChildBounds());return this.hasClipArea()&&(t=t.intersection(this._clipArea.bounds)),t},setLocalBounds:function(t){if(null===t)this._localBounds=null,this.invalidateBounds();else{var e=t!==this._localBounds||!this._localBounds;e&&(this._localBounds=t,this.invalidateBounds())}return this},getBounds:function(){return this.validateBounds(),this._bounds},getVisibleBounds:function(){for(var t=this._selfBounds.copy(),e=this._children.length;e--;){var i=this._children[e];i.isVisible()&&t.includeBounds(i.getVisibleBounds())}return this.localToParentBounds(t)},trailUnderPointer:function(t){var e={};return t.isMouse&&(e.isMouse=!0),t.isTouch&&(e.isTouch=!0),t.isPen&&(e.isPen=!0),this.trailUnderPoint(t.point,e)},trailUnderPoint:function(t,e,i,n){void 0===e&&(e={});var r=void 0===e.pruneInvisible?!0:e.pruneInvisible,a=void 0===e.pruneUnpickable?!0:e.pruneUnpickable;if(n=n||this._inputListeners.length>0||this._pickable===!0,r&&!this.isVisible())return null;if(a&&(this._pickable===!1||this._pickable!==!0&&!n&&0===this._subtreePickableCount))return null;this.validateBounds(),e.isMouse&&this.validateMouseBounds(),e.isTouch&&this.validateTouchBounds();var h=e&&(e.isMouse&&this._mouseBounds||e.isTouch&&this._touchBounds||e.isPen);if(h?e.isMouse&&!this._mouseBounds.containsPoint(t)||e.isTouch&&!this._touchBounds.containsPoint(t):!this._bounds.containsPoint(t))return null;var u=null,l=this._transform.getInverse().multiplyVector2(s.createFromPool(t.x,t.y));if(this.hasClipArea()&&!this._clipArea.containsPoint(l))return null;if(this._children.length>0&&(h||this._childBounds.containsPoint(l)))for(var c=this._children.length-1;c>=0;c--){var d=this._children[c],m=d.trailUnderPoint(l,e,!0,n);if(m)return m.addAncestor(this,c),l.freeToPool(),m}if(h){if(e.isMouse&&this._mouseArea)return u=this._mouseArea.containsPoint(l)?new o.Trail(this):null,l.freeToPool(),u;if((e.isTouch||e.isPen)&&this._touchArea)return u=this._touchArea.containsPoint(l)?new o.Trail(this):null,l.freeToPool(),u}return(h||this._selfBounds.containsPoint(l))&&this.containsPointSelf(l)?(l.freeToPool(),new o.Trail(this)):(l.freeToPool(),null)},containsPoint:function(t){return null!==this.trailUnderPoint(t)},containsPointSelf:function(t){return this._selfBounds.containsPoint(t)},intersectsBoundsSelf:function(t){return this._selfBounds.intersectsBounds(t)},isPainted:function(){return!1},hasParent:function(){return 0!==this._parents.length},hasChildren:function(){return this._children.length>0},walkDepthFirst:function(t){t(this);for(var e=this._children.length,i=0;e>i;i++)this._children[i].walkDepthFirst(t)},getChildrenWithinBounds:function(t){for(var e=[],i=this._children.length,n=0;i>n;n++){var s=this._children[n];s._bounds.intersection(t).isEmpty()||e.push(s)}return e},addInputListener:function(t){return-1===_.indexOf(this._inputListeners,t)&&(this._inputListeners.push(t),this.changePickableCount(1)),this},removeInputListener:function(t){return this._inputListeners.splice(_.indexOf(this._inputListeners,t),1),this.changePickableCount(-1),this},getInputListeners:function(){return this._inputListeners.slice(0)},dispatchEvent:function(t,e){function i(r){n.addAncestor(r),r.fireEvent(t,e);var o=r._parents,a=o.length;s=s||a>1;for(var h=0;a>h;h++)i(o[h]);s&&n.removeAncestor()}var n=new o.Trail;n.setMutable(),e.trail=n;var s=!1;i(this)},translate:function(t,e,i){if("number"==typeof t){if(!t&&!e)return;i?this.prependTranslation(t,e):this.appendMatrix(n.translation(t,e))}else{var s=t;if(!s.x&&!s.y)return;this.translate(s.x,s.y,e)}},scale:function(t,e,i){if("number"==typeof t)if(void 0===e){if(1===t)return;this.appendMatrix(n.scaling(t,t))}else{if(1===t&&1===e)return;i?this.prependMatrix(n.scaling(t,e)):this.appendMatrix(n.scaling(t,e))}else{var s=t;this.scale(s.x,s.y,e)}},rotate:function(t,e){0!==t%(2*Math.PI)&&(e?this.prependMatrix(n.rotation2(t)):this.appendMatrix(n.rotation2(t)))},rotateAround:function(t,e){var i=n.translation(-t.x,-t.y);i=n.rotation2(e).timesMatrix(i),i=n.translation(t.x,t.y).timesMatrix(i),this.prependMatrix(i)},getX:function(){return this._transform.getMatrix().m02()},setX:function(t){return this.translate(t-this.getX(),0,!0),this},getY:function(){return this._transform.getMatrix().m12()},setY:function(t){return this.translate(0,t-this.getY(),!0),this},getScaleVector:function(){return this._transform.getMatrix().getScaleVector()},setScaleMagnitude:function(t,e){var i=this.getScaleVector();return"number"==typeof t?(void 0===e&&(e=t),this.appendMatrix(n.scaling(t/i.x,e/i.y))):this.appendMatrix(n.scaling(t.x/i.x,t.y/i.y)),this},getRotation:function(){return this._transform.getMatrix().getRotation()},setRotation:function(t){return this.appendMatrix(n.rotation2(t-this.getRotation())),this},setTranslation:function(t,e){var i,n,s=this._transform.getMatrix(),r=s.m02(),o=s.m12();return"number"==typeof t?(i=t-r,n=e-o):(i=t.x-r,n=t.y-o),this.translate(i,n,!0),this},getTranslation:function(){var t=this._transform.getMatrix();return new s(t.m02(),t.m12())},appendMatrix:function(t){this._transform.append(t)},prependMatrix:function(t){this._transform.prepend(t)},prependTranslation:function(t,e){this._transform.prependTranslation(t,e)},setMatrix:function(t){this._transform.setMatrix(t)},getMatrix:function(){return this._transform.getMatrix()},setTransform:function(t){this._transform!==t&&(this.beforeTransformChange(),this._transform.removeTransformListener(this._transformListener),this._transform=t,this._transform.prependTransformListener(this._transformListener),this.afterTransformChange())},getTransform:function(){return this._transform},resetTransform:function(){this.setMatrix(n.IDENTITY)},beforeTransformChange:function(){this.notifyBeforeSubtreeChange()},afterTransformChange:function(){this.notifyTransformChange(),this.invalidateBounds(),this.invalidateSubtreePaint()},getLeft:function(){return this.getBounds().minX},setLeft:function(t){return this.translate(t-this.getLeft(),0,!0),this},getRight:function(){return this.getBounds().maxX},setRight:function(t){return this.translate(t-this.getRight(),0,!0),this},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(t){return this.translate(t.minus(this.getCenter()),!0),this},getCenterX:function(){return this.getBounds().getCenterX()},setCenterX:function(t){return this.translate(t-this.getCenterX(),0,!0),this},getCenterY:function(){return this.getBounds().getCenterY()},setCenterY:function(t){return this.translate(0,t-this.getCenterY(),!0),this},getTop:function(){return this.getBounds().minY},setTop:function(t){return this.translate(0,t-this.getTop(),!0),this},getBottom:function(){return this.getBounds().maxY},setBottom:function(t){return this.translate(0,t-this.getBottom(),!0),this},getLeftTop:function(){return this.getBounds().getLeftTop()},setLeftTop:function(t){this.translate(t.minus(this.getLeftTop()),!0)},getCenterTop:function(){return this.getBounds().getCenterTop()},setCenterTop:function(t){this.translate(t.minus(this.getCenterTop()),!0)},getRightTop:function(){return this.getBounds().getRightTop()},setRightTop:function(t){this.translate(t.minus(this.getRightTop()),!0)},getLeftCenter:function(){return this.getBounds().getLeftCenter()},setLeftCenter:function(t){this.translate(t.minus(this.getLeftCenter()),!0)},getRightCenter:function(){return this.getBounds().getRightCenter()},setRightCenter:function(t){this.translate(t.minus(this.getRightCenter()),!0)},getLeftBottom:function(){return this.getBounds().getLeftBottom()},setLeftBottom:function(t){this.translate(t.minus(this.getLeftBottom()),!0)},getCenterBottom:function(){return this.getBounds().getCenterBottom()},setCenterBottom:function(t){this.translate(t.minus(this.getCenterBottom()),!0)},getRightBottom:function(){return this.getBounds().getRightBottom()},setRightBottom:function(t){this.translate(t.minus(this.getRightBottom()),!0)},getWidth:function(){return this.getBounds().getWidth()},getHeight:function(){return this.getBounds().getHeight()},getId:function(){return this._id},isVisible:function(){return this._visible},setVisible:function(t){return t!==this._visible&&(this._visible&&this.notifyBeforeSubtreeChange(),this._visible=t,this.notifyVisibilityChange()),this},getOpacity:function(){return this._opacity},setOpacity:function(t){var e=r(t,0,1);e!==this._opacity&&(this.notifyBeforeSubtreeChange(),this._opacity=e,this.notifyOpacityChange())},isPickable:function(){return this._pickable},setPickable:function(t){if(this._pickable!==t){var e=this._pickable===!0?-1:0;this._pickable=t,e+=this._pickable===!0?1:0,e&&this.changePickableCount(e)}},setCursor:function(t){this._cursor="auto"===t?null:t},getCursor:function(){return this._cursor},setMouseArea:function(t){this._mouseArea!==t&&(this._mouseArea=t,this.invalidateBounds())},getMouseArea:function(){return this._mouseArea},setTouchArea:function(t){this._touchArea!==t&&(this._touchArea=t,this.invalidateBounds())},getTouchArea:function(){return this._touchArea},setClipArea:function(t){this._clipArea!==t&&(this.notifyBeforeSubtreeChange(),this._clipArea=t,this.notifyClipChange(),this.invalidateBounds())},getClipArea:function(){return this._clipArea},hasClipArea:function(){return null!==this._clipArea},setTransformBounds:function(t){this._transformBounds!==t&&(this._transformBounds=t,this.invalidateBounds())},getTransformBounds:function(){return this._transformBounds},updateLayerType:function(){this._renderer&&this._rendererOptions?(this._rendererOptions.cssTransform||this._rendererOptions.cssTranslation||this._rendererOptions.cssRotation||this._rendererOptions.cssScale?this._rendererOptions.baseNode=this:this._rendererOptions.hasOwnProperty("baseNode")&&delete this._rendererOptions.baseNode,this._rendererLayerType=this._renderer.createLayerType(this._rendererOptions)):this._rendererLayerType=null},getRendererLayerType:function(){return this._rendererLayerType},hasRendererLayerType:function(){return!!this._rendererLayerType},supportsCanvas:function(){return 0!==(this._rendererBitmask&o.bitmaskSupportsCanvas)},supportsSVG:function(){return 0!==(this._rendererBitmask&o.bitmaskSupportsSVG)},supportsDOM:function(){return 0!==(this._rendererBitmask&o.bitmaskSupportsDOM)},supportsWebGL:function(){return 0!==(this._rendererBitmask&o.bitmaskSupportsWebGL)},supportsRenderer:function(t){return 0!==(this._rendererBitmask&t.bitmask)},pickARenderer:function(){return this.supportsCanvas()?o.Renderer.Canvas:this.supportsSVG()?o.Renderer.SVG:this.supportsDOM()?o.Renderer.DOM:this.supportsWebGL()?o.Renderer.WebGL:void 0},setRendererBitmask:function(t){t!==this._rendererBitmask&&(this._rendererBitmask=t,this.markLayerRefreshNeeded())},invalidateSupportedRenderers:function(){},setRenderer:function(t){var e;if("string"==typeof t)e=o.Renderer[t];else if(t instanceof o.Renderer)e=t;else{if(t)throw new Error("unrecognized type of renderer: "+t);e=null}e!==this._renderer&&(this._renderer=e,this.updateLayerType(),this.markLayerRefreshNeeded())},getRenderer:function(){return this._renderer},hasRenderer:function(){return!!this._renderer},setRendererOptions:function(t){this._rendererOptions=t,this.updateLayerType(),this.markLayerRefreshNeeded()},getRendererOptions:function(){return this._rendererOptions},hasRendererOptions:function(){return!!this._rendererOptions},setLayerSplit:function(t){t!==this._layerSplit&&(this._layerSplit=t,this.markLayerRefreshNeeded())},isLayerSplit:function(){return this._layerSplit},getUniqueTrail:function(){for(var t=new o.Trail,e=this;e;)t.addAncestor(e),e=e._parents[0];return t},getConnectedNodes:function(){for(var t=[],e=this._children.concat(this._parents).concat(this);e.length;){var i=e.pop();_.contains(t,i)||(t.push(i),e=e.concat(i._children,i._parents))}return t},getTopologicallySortedNodes:function(){function t(t){delete i[e.id][t.id],_.every(i,function(e){return!e[t.id]})&&n.push(t)}var e,i={},n=[],s=[];for(_.each(this.getConnectedNodes(),function(t){i[t.id]={},_.each(t.children,function(e){i[t.id][e.id]=!0}),t.parents.length||n.push(t)});n.length;)e=n.pop(),s.push(e),_.each(e.children,t);return s},canAddChild:function(t){function e(t){delete n[i.id][t.id],_.every(n,function(e){return!e[t.id]})&&s.push(t)}if(this===t||_.contains(this.children,t))return!1;var i,n={},s=[],r=[];for(_.each(this.getConnectedNodes().concat(t.getConnectedNodes()),function(e){n[e.id]={},_.each(e.children,function(t){n[e.id][t.id]=!0}),e.parents.length||e===t||s.push(e)}),n[this.id][t.id]=!0;s.length;)i=s.pop(),r.push(i),_.each(i.children,e),i===this&&e(t);return _.every(n,function(t){return _.every(t,function(){return!1})})},debugText:function(){var t=new o.TrailPointer(new o.Trail(this),!0),e=new o.TrailPointer(new o.Trail(this),!1),i=0;t.depthFirstUntil(e,function(t){if(t.isBefore){var e=new Array(2*i).join(" ");console.log(e+t.trail.lastNode().getId()+" "+t.trail.toString())}i+=t.isBefore?1:-1},!1)},toCanvas:function(t,e,i,n,s){var r=this,a=2,h=this.getBounds().union(this.localToParentBounds(this.getSafeSelfBounds()));e=void 0!==e?e:Math.ceil(a-h.minX),i=void 0!==i?i:Math.ceil(a-h.minY),n=void 0!==n?n:Math.ceil(h.getWidth()+2*a),s=void 0!==s?s:Math.ceil(h.getHeight()+2*a);var u=document.createElement("canvas");u.width=n,u.height=s;var l=u.getContext("2d"),c=$(document.createElement("div"));c.width(n).height(s);var d=new o.Scene(c);d.addChild(r),d.x=e,d.y=i,d.updateScene(),d.renderToCanvas(u,l,function(){t(u,e,i),d.removeChild(r)})},toDataURL:function(t,e,i,n,s){this.toCanvas(function(e,i,n){t(e.toDataURL(),i,n)},e,i,n,s)},toImage:function(t,e,i,n,s){this.toDataURL(function(e,i,n){var s=document.createElement("img");s.onload=function(){t(s,i,n);try{delete s.onload}catch(e){}},s.src=e},e,i,n,s)},toImageNodeAsynchronous:function(t,e,i,n,s){this.toImage(function(e,i,n){t(new o.Node({children:[new o.Image(e,{x:-i,y:-n})]}))},e,i,n,s)},toCanvasNodeSynchronous:function(t,e,i,n){var s;return this.toCanvas(function(t,e,i){s=new o.Node({children:[new o.Image(t,{x:-e,y:-i})]})},t,e,i,n),s},toDataURLNodeSynchronous:function(t,e,i,n){var s;return this.toDataURL(function(t,e,i){s=new o.Node({children:[new o.Image(t,{x:-e,y:-i})]})},t,e,i,n),s},getInstances:function(){return this._instances},addInstance:function(t){this._instances.push(t),1===this._instances.length&&this.firstInstanceAdded()},firstInstanceAdded:function(){},getInstanceFromTrail:function(t){var e,i=this._instances.length;if(1===i)e=this._instances[0];else for(var n=i;n--;)if(this._instances[n].trail.equals(t)){e=this._instances[n];break}return e},removeInstance:function(t){var e=_.indexOf(this._instances,t);this._instances.splice(e,1),0===this._instances.length&&this.lastInstanceRemoved()},lastInstanceRemoved:function(){},notifyVisibilityChange:function(){for(var t=this._instances.length;t--;)this._instances[t].notifyVisibilityChange()},notifyOpacityChange:function(){for(var t=this._instances.length;t--;)this._instances[t].notifyOpacityChange()},notifyClipChange:function(){for(var t=this._instances.length;t--;)this._instances[t].notifyClipChange()},notifyBeforeSelfChange:function(){for(var t=this._instances.length;t--;)this._instances[t].notifyBeforeSelfChange()},notifyBeforeSubtreeChange:function(){for(var t=this._instances.length;t--;)this._instances[t].notifyBeforeSubtreeChange()},notifyDirtySelfPaint:function(){for(var t=this._instances.length;t--;)this._instances[t].notifyDirtySelfPaint()},notifyDirtySubtreePaint:function(){for(var t=this._instances.length;t--;)this._instances[t].notifyDirtySubtreePaint()},notifyTransformChange:function(){for(var t=this._instances.length;t--;)this._instances[t].notifyTransformChange()},notifyBoundsAccuracyChange:function(){for(var t=this._instances.length;t--;)this._instances[t].notifyBoundsAccuracyChange()},notifyStitch:function(t){for(var e=this._instances.length;e--;)this._instances[e].notifyStitch(t)},markForLayerRefresh:function(){for(var t=this._instances.length;t--;)this._instances[t].markForLayerRefresh()},markForInsertion:function(t,e){for(var i=this._instances.length;i--;)this._instances[i].markForInsertion(t,e)},markForRemoval:function(t,e){for(var i=this._instances.length;i--;)this._instances[i].markForRemoval(t,e)},localToParentPoint:function(t){return this._transform.transformPosition2(t)},localToParentBounds:function(t){return this._transform.transformBounds2(t)},parentToLocalPoint:function(t){return this._transform.inversePosition2(t)},parentToLocalBounds:function(t){return this._transform.inverseBounds2(t)},transformBoundsFromLocalToParent:function(t){return t.transform(this._transform.getMatrix())},transformBoundsFromParentToLocal:function(t){return t.transform(this._transform.getInverse())},getLocalToGlobalMatrix:function(){for(var t=this,e=[];t;)e.push(t._transform.getMatrix()),t=t._parents[0];for(var i=n.identity(),s=e.length-1;s>=0;s--)i.multiplyMatrix(e[s]);return i},getUniqueTransform:function(){return new i(this.getLocalToGlobalMatrix())},getGlobalToLocalMatrix:function(){return this.getLocalToGlobalMatrix().invert()},localToGlobalPoint:function(t){for(var e=this,i=t.copy();e;)e._transform.getMatrix().multiplyVector2(i),e=e._parents[0];return i},globalToLocalPoint:function(t){for(var e=this,i=[];e;)i.push(e._transform),e=e._parents[0];for(var n=t.copy(),s=i.length-1;s>=0;s--)i[s].getInverse().multiplyVector2(n);return n},localToGlobalBounds:function(t){return t.transformed(this.getLocalToGlobalMatrix())},globalToLocalBounds:function(t){return t.transformed(this.getGlobalToLocalMatrix())},parentToGlobalPoint:function(t){return this.parents.length?this.parents[0].localToGlobalPoint(t):t},parentToGlobalBounds:function(t){return this.parents.length?this.parents[0].localToGlobalBounds(t):t},globalToParentPoint:function(t){return this.parents.length?this.parents[0].globalToLocalPoint(t):t},globalToParentBounds:function(t){return this.parents.length?this.parents[0].globalToLocalBounds(t):t},getGlobalBounds:function(){return this.parentToGlobalBounds(this.getBounds())},boundsOf:function(t){return this.globalToLocalBounds(t.getGlobalBounds())},boundsTo:function(t){return t.globalToLocalBounds(this.getGlobalBounds())},set layerSplit(t){this.setLayerSplit(t)},get layerSplit(){return this.isLayerSplit()},set renderer(t){this.setRenderer(t)},get renderer(){return this.getRenderer()},set rendererOptions(t){this.setRendererOptions(t)},get rendererOptions(){return this.getRendererOptions()},set cursor(t){this.setCursor(t)},get cursor(){return this.getCursor()},set mouseArea(t){this.setMouseArea(t)},get mouseArea(){return this.getMouseArea()},set touchArea(t){this.setTouchArea(t)},get touchArea(){return this.getTouchArea()},set clipArea(t){this.setClipArea(t)},get clipArea(){return this.getClipArea()},set transformBounds(t){this.setTransformBounds(t)},get transformBounds(){return this.getTransformBounds()},set visible(t){this.setVisible(t)},get visible(){return this.isVisible()},set opacity(t){this.setOpacity(t)},get opacity(){return this.getOpacity()},set pickable(t){this.setPickable(t)},get pickable(){return this.isPickable()},set transform(t){this.setTransform(t)},get transform(){return this.getTransform()},set matrix(t){this.setMatrix(t)},get matrix(){return this.getMatrix()},set translation(t){this.setTranslation(t)},get translation(){return this.getTranslation()},set rotation(t){this.setRotation(t)},get rotation(){return this.getRotation()},set x(t){this.setX(t)},get x(){return this.getX()},set y(t){this.setY(t)},get y(){return this.getY()},set left(t){this.setLeft(t)},get left(){return this.getLeft()},set right(t){this.setRight(t)},get right(){return this.getRight()},set top(t){this.setTop(t)},get top(){return this.getTop()},set bottom(t){this.setBottom(t)},get bottom(){return this.getBottom()},set center(t){this.setCenter(t)},get center(){return this.getCenter()},set centerX(t){this.setCenterX(t)},get centerX(){return this.getCenterX()},set centerY(t){this.setCenterY(t)},get centerY(){return this.getCenterY()},set leftTop(t){this.setLeftTop(t)},get leftTop(){return this.getLeftTop()},set centerTop(t){this.setCenterTop(t)},get centerTop(){return this.getCenterTop()},set rightTop(t){this.setRightTop(t)},get rightTop(){return this.getRightTop()},set leftCenter(t){this.setLeftCenter(t)},get leftCenter(){return this.getLeftCenter()},set rightCenter(t){this.setRightCenter(t)},get rightCenter(){return this.getRightCenter()},set leftBottom(t){this.setLeftBottom(t)},get leftBottom(){return this.getLeftBottom()},set centerBottom(t){this.setCenterBottom(t)},get centerBottom(){return this.getCenterBottom()},set rightBottom(t){this.setRightBottom(t)},get rightBottom(){return this.getRightBottom()},set children(t){this.setChildren(t)},get children(){return this.getChildren()},get parents(){return this.getParents()},get width(){return this.getWidth()},get height(){return this.getHeight()},get bounds(){return this.getBounds()},get selfBounds(){return this.getSelfBounds()},get childBounds(){return this.getChildBounds()},get localBounds(){return this.getLocalBounds()},set localBounds(t){return this.setLocalBounds(t)},get globalBounds(){return this.getGlobalBounds()},get visibleBounds(){return this.getVisibleBounds()},get id(){return this.getId()},get instances(){return this.getInstances()},mutate:function(t){if(!t)return this;var e=this;return _.each(this._mutatorKeys,function(i){if(void 0!==t[i]){var n=Object.getOwnPropertyDescriptor(u.prototype,i);n&&"function"==typeof n.value?e[i](t[i]):e[i]=t[i]}}),this},toString:function(t,e){t=t||"";var i=this.getPropString(t+"  ",void 0===e?!0:e);return t+this.getBasicConstructor(i?"\n"+i+"\n"+t:"")},getBasicConstructor:function(t){return"new scenery.Node( {"+t+"} )"},getPropString:function(t,e){function i(e,i,s){n&&(n+=",\n"),n+=s||"string"!=typeof i?t+e+": "+i:t+e+": '"+i+"'"}var n="";if(this._children.length&&e){var s="";_.each(this._children,function(e){s&&(s+=",\n"),s+=e.toString(t+"  ")}),i("children","[\n"+s+"\n"+t+"]",!0)}if(this.cursor&&i("cursor",this.cursor),this.visible||i("visible",this.visible),null!==this.pickable&&i("pickable",this.pickable),1!==this.opacity&&i("opacity",this.opacity),!this.transform.isIdentity()){var r=this.transform.getMatrix();i("matrix","dot.Matrix3.createFromPool( "+r.m00()+", "+r.m01()+", "+r.m02()+", "+r.m10()+", "+r.m11()+", "+r.m12()+", "+r.m20()+", "+r.m21()+", "+r.m22()+" )",!0)}return this.renderer&&(i("renderer",this.renderer.name),this.rendererOptions),this._layerSplit&&i("layerSplit",!0),n}},u.prototype._mutatorKeys=["children","cursor","visible","pickable","opacity","matrix","translation","x","y","rotation","scale","leftTop","centerTop","rightTop","leftCenter","center","rightCenter","leftBottom","centerBottom","rightBottom","left","right","top","bottom","centerX","centerY","renderer","rendererOptions","layerSplit","mouseArea","touchArea","clipArea","transformBounds"],a(u),u}),i("SCENERY/util/Trail",["require","DOT/Matrix3","DOT/Transform3","SCENERY/scenery","SCENERY/nodes/Node"],function(t){var e=t("DOT/Matrix3"),i=t("DOT/Transform3"),n=t("SCENERY/scenery");t("SCENERY/nodes/Node"),n.Trail=function r(t){if(t instanceof r){var e=t;return this.nodes=e.nodes.slice(0),this.length=e.length,this.uniqueId=e.uniqueId,this.indices=e.indices.slice(0),void 0}this.nodes=[],this.length=0,this.uniqueId="",this.indices=[];var i=this;if(t)if(t instanceof n.Node){var s=t;i.addDescendant(s)}else for(var o=t.length,a=0;o>a;a++)i.addDescendant(t[a])};var s=n.Trail;return s.prototype={constructor:s,copy:function(){return new s(this)},isPainted:function(){return this.lastNode().isPainted()},isVisible:function(){for(var t=this.nodes.length;t--;)if(!this.nodes[t].isVisible())return!1;return!0},getOpacity:function(){for(var t=1,e=this.nodes.length;e--;)t*=this.nodes[e].getOpacity();return t},isPickable:function(){return _.some(this.nodes,function(t){return t._pickable===!1||t._visible===!1})?!1:_.some(this.nodes,function(t){return t._pickable===!0||t._inputListeners.length>0})?!0:this.lastNode()._subtreePickableCount>0?!0:!1},get:function(t){return t>=0?this.nodes[t]:this.nodes[this.nodes.length+t]},slice:function(t,e){return new s(this.nodes.slice(t,e))},subtrailTo:function(t,e){return this.slice(0,_.indexOf(this.nodes,t)+(e?0:1))},isEmpty:function(){return 0===this.nodes.length},getInstance:function(){return this.lastNode().getInstanceFromTrail(this)},getMatrix:function(){for(var t=e.identity(),i=this.nodes,n=i.length,s=0;n>s;s++)t.multiplyMatrix(i[s]._transform.getMatrix());return t},getParentMatrix:function(){for(var t=e.identity(),i=this.nodes,n=i.length,s=0;n-1>s;s++)t.multiplyMatrix(i[s]._transform.getMatrix());return t},getTransform:function(){return new i(this.getMatrix())},getParentTransform:function(){return new i(this.getParentMatrix())},addAncestor:function(t,e){if(this.nodes.length){var i=this.nodes[0];this.indices.unshift(void 0===e?_.indexOf(t._children,i):e)}return this.nodes.unshift(t),this.length++,this.uniqueId=this.uniqueId?t._id+"-"+this.uniqueId:t._id+"",this},removeAncestor:function(){return this.nodes.shift(),this.indices.length&&this.indices.shift(),this.length--,this.updateUniqueId(),this},addDescendant:function(t,e){if(this.nodes.length){var i=this.lastNode();this.indices.push(void 0===e?_.indexOf(i._children,t):e)}return this.nodes.push(t),this.length++,this.uniqueId=this.uniqueId?this.uniqueId+"-"+t._id:t._id+"",this},removeDescendant:function(){return this.nodes.pop(),this.indices.length&&this.indices.pop(),this.length--,this.updateUniqueId(),this},reindex:function(){for(var t=this.length,e=1;t>e;e++){var i=this.indices[e-1],n=this.nodes[e-1];n._children[i]!==this.nodes[e]&&(this.indices[e-1]=_.indexOf(n._children,this.nodes[e]))}},setImmutable:function(){return this},setMutable:function(){return this},areIndicesValid:function(){for(var t=1;t<this.length;t++){var e=this.indices[t-1];if(this.nodes[t-1]._children[e]!==this.nodes[t])return!1}return!0},equals:function(t){if(this.length!==t.length)return!1;for(var e=0;e<this.nodes.length;e++)if(this.nodes[e]!==t.nodes[e])return!1;return!0},upToNode:function(t){return _.indexOf(this.nodes,t),this.slice(0,_.indexOf(this.nodes,t)+1)},isExtensionOf:function(t,e){if(this.length<=t.length-(e?1:0))return!1;for(var i=0;i<t.nodes.length;i++)if(this.nodes[i]!==t.nodes[i])return!1;return!0},getTransformTo:function(t){return new i(this.getMatrixTo(t))},getMatrixTo:function(t){this.reindex(),t.reindex();var i,n=this.getBranchIndexTo(t),s=e.IDENTITY;for(i=this.length-1;i>=n;i--)s=this.nodes[i].getTransform().getMatrix().timesMatrix(s);for(i=n;i<t.length;i++)s=t.nodes[i].getTransform().getInverse().timesMatrix(s);return s},getBranchIndexTo:function(t){var e;for(e=0;e<Math.min(this.length,t.length)&&this.nodes[e]===t.nodes[e];e++);return e},nodeFromTop:function(t){return this.nodes[this.length-1-t]},lastNode:function(){return this.nodeFromTop(0)},rootNode:function(){return this.nodes[0]},previous:function(){if(this.nodes.length<=1)return null;var t=this.nodeFromTop(0),e=this.nodeFromTop(1),i=_.indexOf(e._children,t),n=this.nodes.slice(0,this.nodes.length-1);if(0===i)return new s(n);for(n.push(e._children[i-1]);0!==n[n.length-1]._children.length;){var r=n[n.length-1];n.push(r._children[r._children.length-1])}return new s(n)},previousPainted:function(){for(var t=this.previous();t&&!t.isPainted();)t=t.previous();return t},next:function(){var t=this.nodes.slice(0),e=this.nodeFromTop(0);if(e._children.length>0)return t.push(e._children[0]),new s(t);for(var i=this.nodes.length-1;i>0;){var n=this.nodes[i],r=this.nodes[i-1];t.pop();var o=_.indexOf(r._children,n);if(o!==r._children.length-1)return t.push(r._children[o+1]),new s(t);i--}return null},nextPainted:function(){for(var t=this.next();t&&!t.isPainted();)t=t.next();return t},eachTrailUnder:function(t){new n.TrailPointer(this,!0).eachTrailBetween(new n.TrailPointer(this,!1),t)},compare:function(t){for(var e=Math.min(this.indices.length,t.indices.length),i=0;e>i;i++)if(this.indices[i]!==t.indices[i])return this.indices[i]<t.indices[i]?-1:1;return this.nodes.length<t.nodes.length?-1:this.nodes.length>t.nodes.length?1:0},isBefore:function(t){return-1===this.compare(t)},isAfter:function(t){return 1===this.compare(t)},localToGlobalPoint:function(t){return this.getMatrix().timesVector2(t)},localToGlobalBounds:function(t){return t.transformed(this.getMatrix())},globalToLocalPoint:function(t){return this.getTransform().inversePosition2(t)},globalToLocalBounds:function(t){return this.getTransform().inverseBounds2(t)},parentToGlobalPoint:function(t){return this.getParentMatrix().timesVector2(t)},parentToGlobalBounds:function(t){return t.transformed(this.getParentMatrix())},globalToParentPoint:function(t){return this.getParentTransform().inversePosition2(t)},globalToParentBounds:function(t){return this.getParentTransform().inverseBounds2(t)},updateUniqueId:function(){var t="",e=this.nodes.length;e>0&&(t+=this.nodes[0]._id);for(var i=1;e>i;i++)t+="-"+this.nodes[i]._id;this.uniqueId=t},getUniqueId:function(){return this.uniqueId},toString:function(){return this.reindex(),this.length?"[Trail "+this.indices.join(".")+" "+this.getUniqueId()+"]":"Empty Trail"}},s.eachPaintedTrailBetween=function(t,e,i,n,r){s.eachTrailBetween(t,e,function(t){return t&&t.isPainted()?i(t):void 0},n,r)},s.eachTrailBetween=function(t,e,i,s,r){var o=t?new n.TrailPointer(t.copy(),!0):new n.TrailPointer(new n.Trail(r),!0),a=e?new n.TrailPointer(e.copy(),!0):new n.TrailPointer(new n.Trail(r),!1);s&&(o.nestedForwards(),a.nestedBackwards(),1===o.compareNested(a))||o.depthFirstUntil(a,function(t){return t.isBefore?i(t.trail):void 0},!1)},s.branchIndex=function(t,e){var i,n=Math.min(t.length,e.length);for(i=0;n>i&&t.nodes[i]===e.nodes[i];i++);return i},s.sharedTrail=function(t,e){return t.slice(0,s.branchIndex(t,e))},s.spannedSubtrees=function(){},s}),i("SCENERY/display/DisplayInstance",["require","PHET_CORE/inherit","SCENERY/scenery"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=1;i.DisplayInstance=function(t){this.id=n++,this.trail=t,this.parent=null,this.children=[],this.proxyChild=null,this.proxyParent=null,this.state=null,this.renderer=null,this.firstPainted=null,this.lastPainted=null,this.nextPainted=null,this.previousPainted=null};var s=i.DisplayInstance;return e(Object,s,{appendInstance:function(t){this.children.push(t)},isEffectivelyPainted:function(){return null!==this.renderer}}),s}),i("SCENERY/layers/LayerType",["require","SCENERY/scenery"],function(t){var e=t("SCENERY/scenery");e.LayerType=function(t,e,i,n,s){this.Constructor=t,this.name=e,this.bitmask=i,this.renderer=n,this.args=s};var i=e.LayerType;return i.prototype={constructor:i,supportsRenderer:function(t){return this.renderer===t},supportsBitmask:function(t){return 0!==(this.bitmask&t)},supportsNode:function(t){return t.supportsRenderer(this.renderer)},createLayer:function(t){var e=this.Constructor;return new e(_.extend({},t,this.args))}},i}),i("SCENERY/layers/Layer",["require","DOT/Bounds2","DOT/Transform3","SCENERY/scenery","SCENERY/util/Trail"],function(t){var e=t("DOT/Bounds2"),i=t("DOT/Transform3"),n=t("SCENERY/scenery");t("SCENERY/util/Trail");var s=1;n.Layer=function(t){this._id=s++,this.$main=t.$main,this.scene=t.scene,this.baseNode=t.baseNode,this.usesPartialCSSTransforms=t.cssTranslation||t.cssRotation||t.cssScale,this.cssTranslation=t.cssTranslation,this.cssRotation=t.cssRotation,this.cssScale=t.cssScale,this.cssTransform=t.cssTransform,this.dirtyBounds=e.EVERYTHING,this.setStartBoundary(t.startBoundary),this.setEndBoundary(t.endBoundary),this.baseTrail=this.baseNode===this.scene?new n.Trail(this.scene):this.startPaintedTrail.upToNode(this.baseNode),this._layerTrails=[],this._instanceCount=0;var r=this;this.baseNodeBoundsListener=function(){r.baseNodeInternalBoundsChange()},this.baseNode.addEventListener("selfBounds",this.baseNodeBoundsListener),this.baseNode.addEventListener("childBounds",this.baseNodeBoundsListener),this.fitToBounds=this.usesPartialCSSTransforms||this.cssTransform,this.baseNodeTransform=new i,this.disposed=!1
};var r=n.Layer;return r.prototype={constructor:r,setStartBoundary:function(t){this.startBoundary=t,this.startPaintedTrail=this.startBoundary.nextPaintedTrail,this.startPaintedTrail.setImmutable()},setEndBoundary:function(t){this.endBoundary=t,this.endPaintedTrail=this.endBoundary.previousPaintedTrail,this.endPaintedTrail.setImmutable()},toString:function(){return this.getName()+" "+(this.startPaintedTrail?this.startPaintedTrail.toString():"!")+" => "+(this.endPaintedTrail?this.endPaintedTrail.toString():"!")},getId:function(){return this._id},get id(){return this._id},getLayerTrails:function(){return this._layerTrails.slice(0)},getPaintedTrailCount:function(){return this._layerTrails.length},render:function(){throw new Error("Layer.render unimplemented")},applyTransformationMatrix:function(){throw new Error("Layer.applyTransformationMatrix unimplemented")},addInstance:function(t){var e=t.trail;this._layerTrails.push(e),e.setImmutable()},removeInstance:function(t){var e;for(e=0;e<this._layerTrails.length&&(this._layerTrails[e].reindex(),0!==this._layerTrails[e].compare(t.trail));e++);this._layerTrails.splice(e,1)},reindex:function(){this.startBoundary.reindex(),this.endBoundary.reindex()},pushClipShape:function(){throw new Error("Layer.pushClipShape unimplemented")},popClipShape:function(){throw new Error("Layer.popClipShape unimplemented")},renderToCanvas:function(){throw new Error("Layer.renderToCanvas unimplemented")},dispose:function(){this.disposed=!0,this.baseNode.removeEventListener("selfBounds",this.baseNodeBoundsListener),this.baseNode.removeEventListener("childBounds",this.baseNodeBoundsListener)},getName:function(){throw new Error("Layer.getName unimplemented")},baseNodeInternalBoundsChange:function(){}},r.cssTransformPadding=3,r}),i("SCENERY/util/CanvasContextWrapper",["require","SCENERY/scenery"],function(t){var e=t("SCENERY/scenery");e.CanvasContextWrapper=function(t,e){this.canvas=t,this.context=e,this.resetStyles()};var i=e.CanvasContextWrapper;return i.prototype={constructor:i,resetStyles:function(){this.fillStyle=void 0,this.strokeStyle=void 0,this.lineWidth=void 0,this.lineCap=void 0,this.lineJoin=void 0,this.lineDash=void 0,this.lineDashOffset=void 0,this.miterLimit=void 0,this.font=void 0,this.direction=void 0},setDimensions:function(t,e){this.canvas.width=t,this.canvas.height=e,this.resetStyles()},setFillStyle:function(t){this.fillStyle!==t&&(this.fillStyle=t,this.context.fillStyle=t&&t.getCanvasStyle?t.getCanvasStyle():t)},setStrokeStyle:function(t){this.strokeStyle!==t&&(this.strokeStyle=t,this.context.strokeStyle=t&&t.getCanvasStyle?t.getCanvasStyle():t)},setLineWidth:function(t){this.lineWidth!==t&&(this.lineWidth=t,this.context.lineWidth=t)},setLineCap:function(t){this.lineCap!==t&&(this.lineCap=t,this.context.lineCap=t)},setLineJoin:function(t){this.lineJoin!==t&&(this.lineJoin=t,this.context.lineJoin=t)},setLineDash:function(t){this.lineDash!==t&&(this.lineDash=t,this.context.setLineDash?this.context.setLineDash(null===t?[]:t):void 0!==this.context.mozDash?this.context.mozDash=t:void 0!==this.context.webkitLineDash&&(this.context.webkitLineDash=t?t:[]))},setLineDashOffset:function(t){this.lineDashOffset!==t&&(this.lineDashOffset=t,void 0!==this.context.lineDashOffset?this.context.lineDashOffset=t:void 0!==this.context.webkitLineDashOffset&&(this.context.webkitLineDashOffset=t))},setFont:function(t){this.font!==t&&(this.font=t,this.context.font=t)},setDirection:function(t){this.direction!==t&&(this.direction=t,this.context.direction=t)}},i}),i("SCENERY/util/TrailPointer",["require","SCENERY/scenery","SCENERY/util/Trail"],function(t){var e=t("SCENERY/scenery");t("SCENERY/util/Trail"),e.TrailPointer=function(t,e){this.trail=t,this.setBefore(e)};var i=e.TrailPointer;return i.prototype={constructor:i,copy:function(){return new i(this.trail.copy(),this.isBefore)},setBefore:function(t){this.isBefore=t,this.isAfter=!t},getRenderSwappedPointer:function(){var t=this.isBefore?this.trail.previous():this.trail.next();return null===t?null:new i(t,!this.isBefore)},getRenderBeforePointer:function(){return this.isBefore?this:this.getRenderSwappedPointer()},getRenderAfterPointer:function(){return this.isAfter?this:this.getRenderSwappedPointer()},compareRender:function(t){var e=this.getRenderBeforePointer(),i=t.getRenderBeforePointer();return null!==e&&null!==i?e.trail.compare(i.trail):e===i?0:null===e?1:-1},compareNested:function(t){var e=this.trail.compare(t.trail);return 0===e?this.isBefore===t.isBefore?0:this.isBefore?-1:1:this.trail.isExtensionOf(t.trail)?t.isBefore?1:-1:t.trail.isExtensionOf(this.trail)?this.isBefore?-1:1:e},equalsRender:function(t){return 0===this.compareRender(t)},equalsNested:function(t){return 0===this.compareNested(t)},hasTrail:function(){return!!this.trail},nestedForwards:function(){if(this.isBefore)this.trail.lastNode()._children.length>0?this.trail.addDescendant(this.trail.lastNode()._children[0],0):this.setBefore(!1);else{if(0===this.trail.indices.length)return this.trail=null,null;var t=this.trail.indices[this.trail.indices.length-1];this.trail.removeDescendant(),this.trail.lastNode()._children.length>t+1&&(this.trail.addDescendant(this.trail.lastNode()._children[t+1],t+1),this.setBefore(!0))}return this},nestedBackwards:function(){if(this.isBefore){if(0===this.trail.indices.length)return this.trail=null,null;var t=this.trail.indices[this.trail.indices.length-1];this.trail.removeDescendant(),t-1>=0&&(this.trail.addDescendant(this.trail.lastNode()._children[t-1],t-1),this.setBefore(!1))}else if(this.trail.lastNode()._children.length>0){var e=this.trail.lastNode()._children;this.trail.addDescendant(e[e.length-1],e.length-1)}else this.setBefore(!0);return this},eachNodeBetween:function(t,e){this.eachTrailBetween(t,function(t){return e(t.lastNode())})},eachTrailBetween:function(t,e){this.isBefore&&e(this.trail),this.depthFirstUntil(t,function(t){return t.isBefore?e(t.trail):void 0},!0)},depthFirstUntil:function(t,e,i){this.trail.reindex(),t.trail.reindex();var n=this.copy();n.trail.setMutable();for(var s=!0;!n.equalsNested(t);){var r=!1;if(s?(i||(r=e(n)),s=!1):r=e(n),r&&n.isBefore){if(n.setBefore(!1),1===n.compareNested(t))break}else n.nestedForwards()}i||e(n)},toString:function(){return"["+(this.isBefore?"before":"after")+" "+this.trail.toString().slice(1)}},i.compareNested=function(t,e,i,n){var s=t.compare(i);return 0===s?e===n?0:e?-1:1:t.isExtensionOf(i)?n?1:-1:i.isExtensionOf(t)?e?-1:1:s},i}),i("SCENERY/util/Features",["require","SCENERY/scenery"],function(t){function e(t){try{var e=document.createElement("canvas");e.width=1,e.height=1;var i=e.getContext("2d");i.fillStyle="black",i.fillRect(0,0,1,1);var n=e.toDataURL([t]),s="data:"+t;return n.slice(0,s.length)===s}catch(r){return!1}}function i(t,e){var i=document.createElement("canvas");i.width=1,i.height=1;var n=i.getContext("2d"),s=document.createElement("img");s.crossOrigin="Anonymous";var r=function(){try{n.drawImage(s,0,0),i.toDataURL(),o[t]=!0}catch(e){o[t]=!1}};s.onload=r;try{s.src=e,s.complete&&r()}catch(a){o[t]=!1}}function n(t){var e=[];return e.push(t),t=t.charAt(0).toUpperCase()+t.slice(1),e.push("moz"+t),e.push("Moz"+t),e.push("webkit"+t),e.push("ms"+t),e.push("o"+t),e}function s(t,e){for(var i=0;i<e.length;i++)if(void 0!==t[e[i]])return e[i];return void 0}var r=t("SCENERY/scenery"),o=r.Features={};o.canvasPNGOutput=e("image/png"),o.canvasJPEGOutput=e("image/jpeg"),o.canvasGIFOutput=e("image/gif"),o.canvasICONOutput=e("image/x-icon"),i("canvasPNGInput","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQIW2NkYGD4DwABCQEBtxmN7wAAAABJRU5ErkJggg=="),i("canvasJPEGInput","data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAMCAgICAgMCAgIDAwMDBAYEBAQEBAgGBgUGCQgKCgkICQkKDA8MCgsOCwkJDRENDg8QEBEQCgwSExIQEw8QEBD/2wBDAQMDAwQDBAgEBAgQCwkLEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBD/wAARCAABAAEDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD8qqKKKAP/2Q=="),i("canvasSVGInput","data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIj8+DQo8c3ZnIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3cG9ydD0iMCAwIDEgMSIgd2lkdGg9IjEiIGhlaWdodD0iMSIgPg0KICA8cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMSIgaGVpZ2h0PSIxIiByeD0iMCIgcnk9IjAiIHN0eWxlPSJmaWxsOiBibGFjazsgc3Ryb2tlOiBub25lOyI+PC9yZWN0Pg0KPC9zdmc+DQo="),i("canvasGIFInput","data:image/gif;base64,R0lGODlhAQABAJEAAAAAAP///////wAAACH5BAEAAAIALAAAAAABAAEAAAICRAEAOw==");var a=document.createElement("canvas"),h=a.getContext("2d");o.toDataURLHD=s(a,n("toDataURLHD")),o.createImageDataHD=s(h,n("createImageDataHD")),o.getImageDataHD=s(h,n("getImageDataHD")),o.putImageDataHD=s(h,n("putImageDataHD")),o.currentTransform=s(h,n("currentTransform"));var u=document.createElement("span"),l=document.createElement("div");return o.textStroke=s(u.style,n("textStroke")),o.textStrokeColor=s(u.style,n("textStrokeColor")),o.textStrokeWidth=s(u.style,n("textStrokeWidth")),o.transform=s(l.style,n("transform")),o.transformOrigin=s(l.style,n("transformOrigin")),o.backfaceVisibility=s(l.style,n("backfaceVisibility")),o.borderRadius=s(l.style,n("borderRadius")),o}),i("SCENERY/util/Util",["require","SCENERY/scenery","DOT/Matrix3","DOT/Transform3","DOT/Bounds2","DOT/Vector2","SCENERY/util/Features"],function(t){function e(t,e){return new o(t,e)}var i=t("SCENERY/scenery"),n=t("DOT/Matrix3"),s=t("DOT/Transform3"),r=t("DOT/Bounds2"),o=t("DOT/Vector2"),a=t("SCENERY/util/Features"),h=!1,u=a.transform,l=a.transformOrigin||"transformOrigin",c=function(){var t=document.createElement("canvas"),e={failIfMajorPerformanceCaveat:!0};try{var i=!!window.WebGLRenderingContext&&(t.getContext("webgl",e)||t.getContext("experimental-webgl",e));return!!i}catch(n){return!1}};i.Util={extend:function(t){return _.each(Array.prototype.slice.call(arguments,1),function(e){if(e)for(var i in e)Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))}),t},objectCreate:Object.create||function(t){function e(){}if(arguments.length>1)throw new Error("Object.create implementation only accepts the first parameter.");return e.prototype=t,new e},applyCSSTransform:function(t,e,i){var n=t.getCSSTransform();i&&(e.style.webkitBackfaceVisibility="hidden",n+=" translateZ(0)"),e.style[u]=n,e.style[l]="top left"},testAssert:function(){return"assert.basic: false"},testAssertExtra:function(){return"assert.slow: false"},polyfillRequestAnimationFrame:function(){for(var t=0,e=["ms","moz","webkit","o"],i=0;i<e.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]||window[e[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var i=(new Date).getTime(),n=Math.max(0,16-(i-t)),s=window.setTimeout(function(){e(i+n)},n);return t=i+n,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})},backingStorePixelRatio:function(t){return t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1},backingScale:function(t){if("devicePixelRatio"in window){var e=d.backingStorePixelRatio(t);return window.devicePixelRatio/e}return 1},scanBounds:function(t,i,n){for(var s=_.map(_.range(i),function(){return!1}),o=_.map(_.range(i),function(){return!1}),a=0;i>a;a++)for(var h=0;i>h;h++){var u=4*(h*i+a);(0!==t.data[u]||0!==t.data[u+1]||0!==t.data[u+2]||0!==t.data[u+3])&&(s[a]=!0,o[h]=!0)}var l=_.indexOf(s,!0),c=_.lastIndexOf(s,!0),d=_.indexOf(o,!0),m=_.lastIndexOf(o,!0),f=i/16;return{minBounds:new r(1>l||l>=i-1?Number.POSITIVE_INFINITY:n.inversePosition2(e(l+1+f,0)).x,1>d||d>=i-1?Number.POSITIVE_INFINITY:n.inversePosition2(e(0,d+1+f)).y,1>c||c>=i-1?Number.NEGATIVE_INFINITY:n.inversePosition2(e(c-f,0)).x,1>m||m>=i-1?Number.NEGATIVE_INFINITY:n.inversePosition2(e(0,m-f)).y),maxBounds:new r(1>l||l>=i-1?Number.NEGATIVE_INFINITY:n.inversePosition2(e(l-1-f,0)).x,1>d||d>=i-1?Number.NEGATIVE_INFINITY:n.inversePosition2(e(0,d-1-f)).y,1>c||c>=i-1?Number.POSITIVE_INFINITY:n.inversePosition2(e(c+2+f,0)).x,1>m||m>=i-1?Number.POSITIVE_INFINITY:n.inversePosition2(e(0,m+2+f)).y)}},canvasAccurateBounds:function(t,i){function o(e){function i(t){var e=document.createElement("canvas");e.width=l,e.height=l;var i=e.getContext("2d");i.putImageData(t,0,0),$(e).css("border","1px solid black"),$(window).ready(function(){$("#display").append(e)})}p.save(),e.matrix.canvasSetTransform(p),t(p),p.restore();var n=p.getImageData(0,0,l,l),s=d.scanBounds(n,l,e);return h&&i(n),p.clearRect(0,0,l,l),s}function a(t){var e=2,i=(l-2*e)/(t.maxX-t.minX),r=(l-2*e)/(t.maxY-t.minY),o=-i*t.minX+e,a=-r*t.minY+e;return new s(n.translation(o,a).timesMatrix(n.scaling(i,r)))}var u=i&&i.precision?i.precision:.001,l=i&&i.resolution?i.resolution:128,c=i&&i.initialScale?i.initialScale:1/16,m=r.NOTHING,f=r.EVERYTHING,g=document.createElement("canvas");g.width=l,g.height=l;var p=g.getContext("2d");h&&$(window).ready(function(){var t=document.createElement("h2");$(t).text("Bounds Scan"),$("#display").append(t)});var v=new s;v.append(n.translation(l/2,l/2)),v.append(n.scaling(c));var y=o(v);m=m.union(y.minBounds),f=f.intersection(y.maxBounds);var x,_,E;for(x=f.minY,_=f.maxY;isFinite(m.minX)&&isFinite(f.minX)&&Math.abs(m.minX-f.minX)>u;){if(E=o(a(new r(f.minX,x,m.minX,_))),m.minX<=E.minBounds.minX&&f.minX>=E.maxBounds.minX){h&&(console.log("warning, exiting infinite loop!"),console.log('transformed "min" minX: '+a(new r(f.minX,f.minY,m.minX,f.maxY)).transformPosition2(e(m.minX,0))),console.log('transformed "max" minX: '+a(new r(f.minX,f.minY,m.minX,f.maxY)).transformPosition2(e(f.minX,0))));break}m=m.withMinX(Math.min(m.minX,E.minBounds.minX)),f=f.withMinX(Math.max(f.minX,E.maxBounds.minX)),x=Math.max(x,E.maxBounds.minY),_=Math.min(_,E.maxBounds.maxY)}for(x=f.minY,_=f.maxY;isFinite(m.maxX)&&isFinite(f.maxX)&&Math.abs(m.maxX-f.maxX)>u;){if(E=o(a(new r(m.maxX,x,f.maxX,_))),m.maxX>=E.minBounds.maxX&&f.maxX<=E.maxBounds.maxX){h&&console.log("warning, exiting infinite loop!");break}m=m.withMaxX(Math.max(m.maxX,E.minBounds.maxX)),f=f.withMaxX(Math.min(f.maxX,E.maxBounds.maxX)),x=Math.max(x,E.maxBounds.minY),_=Math.min(_,E.maxBounds.maxY)}for(x=f.minX,_=f.maxX;isFinite(m.minY)&&isFinite(f.minY)&&Math.abs(m.minY-f.minY)>u;){if(E=o(a(new r(x,f.minY,_,m.minY))),m.minY<=E.minBounds.minY&&f.minY>=E.maxBounds.minY){h&&console.log("warning, exiting infinite loop!");break}m=m.withMinY(Math.min(m.minY,E.minBounds.minY)),f=f.withMinY(Math.max(f.minY,E.maxBounds.minY)),x=Math.max(x,E.maxBounds.minX),_=Math.min(_,E.maxBounds.maxX)}for(x=f.minX,_=f.maxX;isFinite(m.maxY)&&isFinite(f.maxY)&&Math.abs(m.maxY-f.maxY)>u;){if(E=o(a(new r(x,m.maxY,_,f.maxY))),m.maxY>=E.minBounds.maxY&&f.maxY<=E.maxBounds.maxY){h&&console.log("warning, exiting infinite loop!");break}m=m.withMaxY(Math.max(m.maxY,E.minBounds.maxY)),f=f.withMaxY(Math.min(f.maxY,E.maxBounds.maxY)),x=Math.max(x,E.maxBounds.minX),_=Math.min(_,E.maxBounds.maxX)}h&&(console.log("minBounds: "+m),console.log("maxBounds: "+f));var T=new r((m.minX+f.minX)/2,(m.minY+f.minY)/2,(m.maxX+f.maxX)/2,(m.maxY+f.maxY)/2);return T.minBounds=m,T.maxBounds=f,T.isConsistent=f.containsBounds(m),T.precision=Math.max(Math.abs(m.minX-f.minX),Math.abs(m.minY-f.minY),Math.abs(m.maxX-f.maxX),Math.abs(m.maxY-f.maxY)),T},toPowerOf2:function(t){for(var e=1;t>e;)e*=2;return e},createShader:function(t,e,i){var n=t.createShader(i);return t.shaderSource(n,e),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)||(console.log("GLSL compile error:"),console.log(t.getShaderInfoLog(n)),console.log(e)),n},isWebGLSupported:c()};var d=i.Util;return d}),i("SCENERY/layers/CanvasLayer",["require","PHET_CORE/inherit","DOT/Bounds2","SCENERY/scenery","KITE/Shape","SCENERY/layers/Layer","SCENERY/util/CanvasContextWrapper","SCENERY/util/Trail","SCENERY/util/TrailPointer","SCENERY/util/Util"],function(t){var e=t("PHET_CORE/inherit"),i=t("DOT/Bounds2"),n=t("SCENERY/scenery"),s=t("KITE/Shape"),r=t("SCENERY/layers/Layer");t("SCENERY/util/CanvasContextWrapper"),t("SCENERY/util/Trail"),t("SCENERY/util/TrailPointer"),t("SCENERY/util/Util");var o=[];n.CanvasLayer=function(t){r.call(this,t),this.backingScale=t.scene.backingScale,void 0!==t.fullResolution&&(this.backingScale=t.fullResolution?n.Util.backingScale(document.createElement("canvas").getContext("2d")):1),this.logicalWidth=this.scene.sceneBounds.width,this.logicalHeight=this.scene.sceneBounds.height;var e=document.createElement("canvas");e.width=this.logicalWidth*this.backingScale,e.height=this.logicalHeight*this.backingScale,e.style.width=this.logicalWidth+"px",e.style.height=this.logicalHeight+"px",e.style.position="absolute",e.style.left="0",e.style.top="0",this.$main.append(e),this.canvas=e,this.context=e.getContext("2d"),this.scene=t.scene,this.context.miterLimit=20,this.context.miterLimit=10,this.isCanvasLayer=!0,this.wrapper=new n.CanvasContextWrapper(this.canvas,this.context),this.boundlessCount=0};var a=n.CanvasLayer;return e(r,a,{render:function(t,e){e=e||{};var n=this.canUseDirtyRegions()&&!e.fullRender;if(!n||!this.dirtyBounds.isEmpty()){this.context.setTransform(this.backingScale,0,0,this.backingScale,0,0);var r=n?this.dirtyBounds.intersection(t.sceneBounds):t.sceneBounds;r.isEmpty()||(this.clearGlobalBounds(r),n&&this.pushClipShape(s.bounds(r)),this.recursiveRender(t,e),n&&this.popClipShape()),this.dirtyBounds=i.NOTHING}},recursiveRender:function(){function t(t){return t.lastNode().getOpacity()<1}function e(){var t=h.logicalWidth*h.backingScale,e=h.logicalHeight*h.backingScale;if(o.length){var i=o.pop();return i.setDimensions(t,e),i}var s=document.createElement("canvas");s.width=h.logicalWidth*h.backingScale,s.height=h.logicalHeight*h.backingScale;var r=s.getContext("2d");return new n.CanvasContextWrapper(s,r)}function i(){return c[c.length-1]}function s(n){var s=n.lastNode();if(t(n)){var r=e();c.push(r);var o=r.context;o.setTransform(h.backingScale,0,0,h.backingScale,0,0);for(var a=n.nodes.length,u=0;a>u;u++)n.nodes[u].transform.getMatrix().canvasAppendTransform(o)}else s.transform.getMatrix().canvasAppendTransform(i().context);s._clipArea&&h.pushClipShape(s._clipArea)}function r(e){var n=e.lastNode();if(n._clipArea&&h.popClipShape(),t(e)){var s=c[c.length-2].context,r=c[c.length-1].canvas,a=e.lastNode().getOpacity()<1;a&&(s.globalAlpha=e.lastNode().getOpacity()),s.save(),s.setTransform(1,0,0,1,0,0),s.drawImage(r,0,0),s.restore(),a&&(s.globalAlpha=1);var u=c.pop();u!==h.wrapper&&o.push(u)}else n.transform.getInverse().canvasAppendTransform(i().context)}var a,h=this,u=new n.TrailPointer(this.startPaintedTrail,!0),l=new n.TrailPointer(this.endPaintedTrail,!0),c=[this.wrapper];this.wrapper.resetStyles();var d,m=0;u.trail.reindex(),l.trail.reindex();var f=u.trail.length-(u.isBefore?1:0);for(d=new n.Trail,a=0;f>a;a++){var g=u.trail.nodes[a];d.addDescendant(g),m+=g.isVisible()?0:1,0===m&&s(d)}u.depthFirstUntil(l,function(t){var e=t.trail.lastNode();if(t.isBefore){if(m+=e.isVisible()?0:1,0!==m)return!0;if(s(t.trail),e.isPainted()){var i=c[c.length-1];e.paintCanvas(i)}}else 0===m&&r(t.trail),m-=e.isVisible()?0:1},!1),d=l.trail.copy();var p=l.trail.length-(l.isAfter?1:0);for(a=p-1;a>=0;a--){var v=l.trail.nodes[a];m-=v.isVisible()?0:1,0===m&&r(d),d.removeDescendant()}},dispose:function(){r.prototype.dispose.call(this),this.canvas.parentNode.removeChild(this.canvas)},applyTransformationMatrix:function(t){t.canvasAppendTransform(this.context)},reindex:function(t){return r.prototype.reindex.call(this,t),this.zIndex!==t&&(this.canvas.style.zIndex=t,this.zIndex=t),t+1},pushClipShape:function(t){this.context.save(),this.writeClipShape(t)},popClipShape:function(){this.context.restore()},writeClipShape:function(t){this.context.beginPath(),t.writeToContext(this.context),this.context.clip()},clearGlobalBounds:function(t){t.isEmpty()||(this.context.save(),this.context.setTransform(this.backingScale,0,0,this.backingScale,0,0),this.context.clearRect(t.getX(),t.getY(),t.getWidth(),t.getHeight()),this.context.restore())},getSVGString:function(){return'<image xmlns:xlink="'+n.xlinkns+'" xlink:href="'+this.canvas.toDataURL()+'" x="0" y="0" height="'+this.canvas.height+'px" width="'+this.canvas.width+'px"/>'},renderToCanvas:function(t,e){e.drawImage(this.canvas,0,0)},addInstance:function(t){var e=t.trail;r.prototype.addInstance.call(this,t),this.canvasMarkLocalBounds(e.lastNode().getBounds(),e.slice(0,e.length-1)),e.lastNode().boundsInaccurate&&this.boundlessCount++},removeInstance:function(t){var e=t.trail;r.prototype.removeInstance.call(this,t),this.canvasMarkLocalBounds(e.lastNode().getBounds(),e.slice(0,e.length-1)),e.lastNode().boundsInaccurate&&this.boundlessCount--},canUseDirtyRegions:function(){return 0===this.boundlessCount},canvasMarkGlobalBounds:function(t){this.dirtyBounds=this.dirtyBounds.union(t.dilate(2).roundOut())},canvasMarkLocalBounds:function(t,e){this.canUseDirtyRegions()?this.canvasMarkGlobalBounds(e.localToGlobalBounds(t)):this.dirtyBounds=i.EVERYTHING},canvasMarkParentBounds:function(t,e){this.canUseDirtyRegions()?this.canvasMarkGlobalBounds(e.parentToGlobalBounds(t)):this.dirtyBounds=i.EVERYTHING},canvasMarkSelf:function(t){this.canvasMarkLocalBounds(t.getNode().getSelfBounds(),t.trail)},canvasMarkSubtree:function(t){this.canvasMarkParentBounds(t.getNode().getBounds(),t.trail)},getName:function(){return"canvas"},notifyVisibilityChange:function(t){t.trail.isVisible()&&this.canvasMarkSubtree(t)},notifyOpacityChange:function(t){this.canvasMarkSubtree(t)},notifyClipChange:function(t){this.canvasMarkSubtree(t)},notifyBeforeSelfChange:function(t){this.canvasMarkSelf(t)},notifyBeforeSubtreeChange:function(t){this.canvasMarkSubtree(t)},notifyDirtySelfPaint:function(t){this.canvasMarkSelf(t)},notifyDirtySubtreePaint:function(t){this.canvasMarkSubtree(t)},notifyTransformChange:function(){},notifyBoundsAccuracyChange:function(t){t.node.boundsInaccurate?this.boundlessCount++:this.boundlessCount--}}),a}),i("SCENERY/layers/DOMLayer",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/layers/Layer","SCENERY/util/Trail"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/layers/Layer");t("SCENERY/util/Trail"),i.DOMLayer=function(t){n.call(this,t);var e=t.scene.sceneBounds.width,i=t.scene.sceneBounds.height;this.div=document.createElement("div");var s=this.div;s.style.position="absolute",s.style.left="0",s.style.top="0",s.style.width="0",s.style.height="0",s.style.clip="rect(0px,"+e+"px,"+i+"px,0px)",this.$div=$(this.div),this.$main.append(this.div),this.scene=t.scene,this.isDOMLayer=!0,this.idElementMap={},this.idTrailMap={},this.trails=[]};var s=i.DOMLayer;return e(n,s,{addInstance:function(t){n.prototype.addInstance.call(this,t);var e=t.trail;this.reindexTrails();var i=e.lastNode(),s=i.getDOMElement();i.updateDOMElement(s),this.updateVisibility(e,s),this.idElementMap[e.getUniqueId()]=s,this.idTrailMap[e.getUniqueId()]=e;var r;for(r=0;r<this.trails.length;r++){var o=this.trails[r];o.reindex();var a=o.compare(e);if(1===a)break}r===this.div.childNodes.length?(this.div.appendChild(s),this.trails.push(e)):(this.div.insertBefore(this.getElementFromTrail(this.trails[r])),this.trails.splice(r,0,e)),i.updateCSSTransform(e.getTransform(),s)},removeInstance:function(t){n.prototype.removeInstance.call(this,t);var e=t.trail;this.reindexTrails();var i=this.getElementFromTrail(e);delete this.idElementMap[e.getUniqueId],delete this.idTrailMap[e.getUniqueId],this.div.removeChild(i);var s=this.getIndexOfTrail(e);this.trails.splice(s,1)},getElementFromTrail:function(t){return this.idElementMap[t.getUniqueId()]},reindexTrails:function(t){n.prototype.reindex.call(this,t);for(var e=this.trails.length;e--;)this.trails[e].reindex()},getIndexOfTrail:function(t){var e;for(e=0;e<this.trails.length;e++)if(0===this.trails[e].compare(t))return e;throw new Error("DOMLayer.getIndexOfTrail unable to find trail: "+t.toString())},render:function(){},dispose:function(){n.prototype.dispose.call(this),this.div.parentNode.removeChild(this.div)},updateVisibility:function(t,e){e.style.visibility=t.isVisible()?"visible":"hidden"},applyTransformationMatrix:function(){},getContainer:function(){return this.div},reindex:function(t){return n.prototype.reindex.call(this,t),this.zIndex!==t&&(this.div.style.zIndex=t,this.zIndex=t),t+1},pushClipShape:function(){},popClipShape:function(){},getSVGString:function(){return"<svg xmlns='"+i.svgns+"' width='"+this.$main.width()+"' height='"+this.$main.height()+"'>"+"<foreignObject width='100%' height='100%'>"+$(this.div).html()+"</foreignObject></svg>"},renderToCanvas:function(){},getName:function(){return"dom"},notifyVisibilityChange:function(t){var e=t.trail;for(var i in this.idTrailMap){var n=this.idTrailMap[i];n.reindex(),n.isExtensionOf(e,!0)&&this.updateVisibility(n,this.idElementMap[i])}},notifyOpacityChange:function(t){},notifyClipChange:function(t){},notifyBeforeSelfChange:function(){},notifyBeforeSubtreeChange:function(){},notifyDirtySelfPaint:function(t){var e=t.getNode(),i=t.trail,n=this.idElementMap[i.getUniqueId()];n&&(e.updateDOMElement(n),e.domUpdateTransformOnRepaint&&e.updateCSSTransform(i.getTransform(),n))},notifyDirtySubtreePaint:function(t){t.layer===this&&this.notifyDirtySelfPaint(t)},notifyTransformChange:function(t){var e=this,n=t.trail;i.Trail.eachPaintedTrailBetween(this.startPaintedTrail,this.endPaintedTrail,function(t){if(t.isExtensionOf(n,!0)){var i=e.idElementMap[t.getUniqueId()],s=t.lastNode();s.updateCSSTransform(t.getTransform(),i)}},!1,this.scene)},notifyBoundsAccuracyChange:function(){}}),s}),i("SCENERY/layers/SVGLayer",["require","PHET_CORE/inherit","DOT/Bounds2","DOT/Transform3","DOT/Matrix3","SCENERY/scenery","SCENERY/layers/Layer","SCENERY/util/Trail","SCENERY/util/Util"],function(t){var e=t("PHET_CORE/inherit"),i=t("DOT/Bounds2"),n=t("DOT/Transform3"),s=t("DOT/Matrix3"),r=t("SCENERY/scenery"),o=t("SCENERY/layers/Layer");t("SCENERY/util/Trail"),t("SCENERY/util/Util"),r.SVGLayer=function(t){var e=t.$main;this.scene=t.scene,this.svg=document.createElementNS(r.svgns,"svg"),this.g=document.createElementNS(r.svgns,"g"),this.defs=document.createElementNS(r.svgns,"defs");var i=t.scene.sceneBounds.width,n=t.scene.sceneBounds.height;this.svg.appendChild(this.defs),this.svg.appendChild(this.g),this.$svg=$(this.svg),this.svg.setAttribute("width",i),this.svg.setAttribute("height",n),this.svg.setAttribute("stroke-miterlimit",10),this.svg.style.position="absolute",this.svg.style.left="0",this.svg.style.top="0",this.svg.style.clip="rect(0px,"+i+"px,"+n+"px,0px)",this.svg.style["pointer-events"]="none",e.append(this.svg),this.isSVGLayer=!0,this.idFragmentMap={},this.idGroupMap={},o.call(this,t),this.baseTransformDirty=!0,this.baseTransformChange=!0};var a=r.SVGLayer,h=i.NOTHING.copy();return e(o,a,{addInstance:function(t){var e=t.trail;o.prototype.addInstance.call(this,t);for(var i=this.baseTrail.copy(),n=null;i.length<=e.length;){var s=i.getUniqueId(),a=this.idGroupMap[s];if(a||(n?(a=document.createElementNS(r.svgns,"g"),this.applyTransform(i.lastNode().getTransform(),a),this.insertGroupIntoParent(a,this.idGroupMap[n],i)):(a=this.g,this.initializeBase(),this.refreshBaseTransform()),this.updateNodeGroup(i.lastNode(),a),a.referenceCount=0,a.trail=i.copy(),this.idGroupMap[s]=a),a.referenceCount++,i.length===e.length)break;i.addDescendant(e.nodes[i.length]),n=s}var h=e.lastNode(),u=e.getUniqueId(),l=this.idGroupMap[u],c=h.createSVGFragment(this.svg,this.defs,l);this.updateNode(h,c),this.updateNodeGroup(h,l),this.idFragmentMap[u]=c,l.appendChild(c)},removeInstance:function(t){var e=t.trail;o.prototype.removeInstance.call(this,t);var i=e.getUniqueId(),n=e.lastNode(),s=this.idFragmentMap[i];this.idGroupMap[i].removeChild(s),delete this.idFragmentMap[i],n.removeSVGDefs&&n.removeSVGDefs(this.svg,this.defs);for(var r=e.copy();r.length>this.baseTrail.length;){var a=r.getUniqueId(),h=this.idGroupMap[a];h.referenceCount--,0===h.referenceCount&&(h.parentNode.removeChild(h),delete h.trail,delete this.idGroupMap[a]),r.removeDescendant()}this.g.referenceCount--},insertGroupIntoParent:function(t,e,i){if(e.childNodes.length){var n,s=i.length-2,r=i.indices[s];for(n=0;n<e.childNodes.length;n++){var o=e.childNodes[n];if(o.trail){o.trail.reindex();var a=o.trail.indices[s];if(a>r)break}}n===e.childNodes.length?e.appendChild(t):e.insertBefore(t,e.childNodes[n])}else e.appendChild(t)},updateNode:function(t,e){t.updateSVGFragment&&t.updateSVGFragment(e),t.updateSVGDefs&&t.updateSVGDefs(this.svg,this.defs)},updateNodeGroup:function(t,e){this.updateGroupVisibility(t,e),this.updateGroupOpacity(t,e),this.updateGroupClip(t,e)},updateGroupVisibility:function(t,e){e.style.display=(t===this.baseNode?this.baseTrail.isVisible():t.isVisible())?"inherit":"none"},updateGroupOpacity:function(t,e){var i;i=t===this.baseNode?this.baseTrail.getOpacity():t.getOpacity(),e.setAttribute("opacity",i)},updateGroupClip:function(t,e){var i="clip"+t.getId(),n=this.svg.getElementById(i);if(n&&this.defs.removeChild(n),t._clipArea){var s=document.createElementNS(r.svgns,"clipPath");s.setAttribute("id",i),s.setAttribute("clipPathUnits","userSpaceOnUse");var o=document.createElementNS(r.svgns,"path");o.setAttribute("d",t._clipArea.getSVGPath()),s.appendChild(o),this.defs.appendChild(s),e.setAttribute("clip-path","url(#"+i+")")}else e.removeAttribute("clip-path")},getFragmentFromInstance:function(t){return this.idFragmentMap[t.trail.getUniqueId()]},getGroupFromInstance:function(t){return this.idGroupMap[t.trail.getUniqueId()]},applyTransform:function(t,e){t.isIdentity()?e.hasAttribute("transform")&&e.removeAttribute("transform"):e.setAttribute("transform",t.getMatrix().getSVGTransform())},render:function(){this.refreshBaseTransform()},refreshBaseTransform:function(){if(this.baseTransformDirty){var t=this.baseTransformChange;this.updateBaseTransform(t),this.baseTransformDirty=!1,this.baseTransformChange=!1}},dispose:function(){o.prototype.dispose.call(this),this.svg.parentNode.removeChild(this.svg)},markBaseTransformDirty:function(t){var e=this.baseTransformChange||!!t;this.baseTransformDirty=!0,this.baseTransformChange=e},initializeBase:function(){this.cssTransform?this.baseNodeInternalBoundsChange():this.markBaseTransformDirty(!0)},baseNodeInternalBoundsChange:function(){if(this.cssTransform){var t=h;t.set(this.baseNode.getBounds()),this.baseNode.transformBoundsFromParentToLocal(t);var e=r.Layer.cssTransformPadding;if(!t.isEmpty()){this.baseNodeTransform.setMatrix(s.translation(Math.ceil(-t.minX+e),Math.ceil(-t.minY+e)));var i=t.transform(this.baseNodeTransform.getMatrix());this.updateContainerDimensions(Math.ceil(i.maxX+e),Math.ceil(i.maxY+e))}this.markBaseTransformDirty(!0)}else this.usesPartialCSSTransforms&&this.markBaseTransformDirty(!0)},updateContainerDimensions:function(t,e){this.svg.setAttribute("width",t),this.svg.setAttribute("height",e)},updateBaseTransform:function(t){var e=this.baseTrail.getTransform();if(this.cssTransform)r.Util.applyCSSTransform(e.getMatrix().timesMatrix(this.baseNodeTransform.getInverse()),this.svg),t&&this.applyTransform(this.baseNodeTransform,this.g);else if(this.usesPartialCSSTransforms){var i=new n,o=e.getMatrix();if(this.cssTranslation&&i.append(s.translation(o.m02(),o.m12())),this.cssRotation&&i.append(s.rotation2(o.getRotation())),this.cssScale){var a=o.getScaleVector();i.append(s.scaling(a.x,a.y))}e.prepend(i.getInverse());var h=r.Layer.cssTransformPadding,u=this.baseNode.parentToLocalBounds(this.baseNode.getBounds()),l=e.transformBounds2(u),c=s.translation(Math.ceil(-l.minX+h),Math.ceil(-l.minY+h)),d=c.inverted();
this.updateContainerDimensions(Math.ceil(l.getWidth()+2*h),Math.ceil(l.getHeight()+2*h)),i.append(d),e.prepend(c),r.Util.applyCSSTransform(i.getMatrix(),this.svg),this.applyTransform(e,this.g)}else this.applyTransform(e,this.g)},applyTransformationMatrix:function(){},getContainer:function(){return this.svg},reindex:function(t){return o.prototype.reindex.call(this,t),this.zIndex!==t&&(this.svg.style.zIndex=t,this.zIndex=t),t+1},pushClipShape:function(){},popClipShape:function(){},getSVGString:function(){return $("<div>").append(this.$svg.clone()).html()},renderToCanvas:function(t,e,i){if(this.applyTransform(this.baseTrail.getTransform(),this.g),!window.canvg){var n=window.URL||window.webkitURL||window,s=new Image,r=this.getSVGString();console.log(r);var o=new Blob([r],{type:"image/svg+xml;charset=utf-8"}),a=n.createObjectURL(o);throw i.increment(),s.onload=function(){e.drawImage(s,0,0),n.revokeObjectURL(a),i.decrement()},s.src=a,new Error("this implementation hits Chrome bugs, won't work on IE9/10, etc. deprecated")}i.increment(),canvg(t,this.getSVGString(),{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,renderCallback:function(){i.decrement()}}),this.updateBaseTransform()},getName:function(){return"svg"},notifyVisibilityChange:function(t){var e=this.getGroupFromInstance(t);e?this.updateGroupVisibility(t.getNode(),e):this.baseNode!==this.scene&&this.updateGroupVisibility(this.baseNode,this.getGroupFromInstance(this.baseTrail.getInstance()))},notifyOpacityChange:function(t){var e=this.getGroupFromInstance(t);e?this.updateGroupOpacity(t.getNode(),e):this.baseNode!==this.scene&&this.updateGroupOpacity(this.baseNode,this.getGroupFromInstance(this.baseTrail.getInstance()))},notifyClipChange:function(t){var e=this.getGroupFromInstance(t);e?this.updateGroupClip(t.getNode(),e):this.baseNode!==this.scene&&this.updateGroupClip(this.baseNode,this.getGroupFromInstance(this.baseTrail.getInstance()))},notifyBeforeSelfChange:function(){},notifyBeforeSubtreeChange:function(){},notifyDirtySelfPaint:function(t){var e=this.getFragmentFromInstance(t);if(e){var i=t.getNode();i.updateSVGFragment&&i.updateSVGFragment(e),i.updateSVGDefs&&i.updateSVGDefs(this.svg,this.defs)}},notifyDirtySubtreePaint:function(t){t.layer===this&&this.notifyDirtySelfPaint(t)},notifyTransformChange:function(t){var e=t.node,i=t.trail;if(i.lastNode()===this.baseNode)this.markBaseTransformDirty();else if(_.contains(i.nodes,this.baseNode)){var n=this.idGroupMap[i.getUniqueId()];this.applyTransform(e.getTransform(),n)}else this.markBaseTransformDirty()},notifyBoundsAccuracyChange:function(){}}),a}),i("SCENERY/util/ShaderProgram",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/util/Util"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/util/Util"),s=i.ShaderProgram=function(t,e,i,n,s){this.vertexSource=e,this.fragmentSource=i,this.attributeNames=n,this.uniformNames=s,this.initialize(t)};return e(Object,s,{initialize:function(t){var e=this;this.gl=t,this.used=!1,this.program=this.gl.createProgram(),this.vertexShader=n.createShader(this.gl,this.vertexSource,this.gl.VERTEX_SHADER),this.fragmentShader=n.createShader(this.gl,this.fragmentSource,this.gl.FRAGMENT_SHADER),this.gl.attachShader(this.program,this.vertexShader),this.gl.attachShader(this.program,this.fragmentShader),this.gl.linkProgram(this.program),this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS)||(console.log("GLSL link error:"),console.log(this.gl.getProgramInfoLog(this.program)),console.log("for vertex shader"),console.log(this.vertexSource),console.log("for fragment shader"),console.log(this.fragmentSource)),this.gl.deleteShader(this.vertexShader),this.gl.deleteShader(this.fragmentShader),this.uniformLocations={},this.attributeLocations={},this.activeAttributes={},_.each(this.attributeNames,function(t){e.attributeLocations[t]=e.gl.getAttribLocation(e.program,t),e.activeAttributes[t]=!0}),_.each(this.uniformNames,function(t){e.uniformLocations[t]=e.gl.getUniformLocation(e.program,t)}),this.isInitialized=!0},use:function(){if(!this.used){var t=this;this.used=!0,this.gl.useProgram(this.program),_.each(this.attributeNames,function(e){t.activeAttributes[e]&&t.gl.enableVertexAttribArray(t.attributeLocations[e])})}},unuse:function(){if(this.used){var t=this;this.used=!1,_.each(this.attributeNames,function(e){t.activeAttributes[e]&&t.gl.disableVertexAttribArray(t.attributeLocations[e])})}},activateAttribute:function(t){this.activeAttributes[t]||(this.activeAttributes[t]=!0,this.used&&this.gl.enableVertexAttribArray(this.attributeLocations[t]))},deactivateAttribute:function(t){this.activeAttributes[t]&&(this.activeAttributes[t]=!1,this.used&&this.gl.disableVertexAttribArray(this.attributeLocations[t]))},dispose:function(){this.gl.deleteProgram(this.program)}})}),i("SCENERY/layers/WebGLLayer",["require","PHET_CORE/inherit","DOT/Matrix4","SCENERY/scenery","SCENERY/layers/Layer","SCENERY/util/Trail","SCENERY/util/TrailPointer","SCENERY/util/Util","SCENERY/util/ShaderProgram"],function(t){function e(t){return new n(t.m00(),t.m01(),0,t.m02(),t.m10(),t.m11(),0,t.m12(),0,0,1,0,0,0,0,1)}var i=t("PHET_CORE/inherit"),n=t("DOT/Matrix4"),s=t("SCENERY/scenery"),r=t("SCENERY/layers/Layer");t("SCENERY/util/Trail"),t("SCENERY/util/TrailPointer"),t("SCENERY/util/Util");var o=t("SCENERY/util/ShaderProgram");s.WebGLLayer=function(t){var e=this;r.call(this,t),this.dirty=!0,this.backingScale=t.scene.backingScale,this.backingScale=s.Util.backingScale(document.createElement("canvas").getContext("2d")),this.logicalWidth=this.scene.sceneBounds.width,this.logicalHeight=this.scene.sceneBounds.height,this.projectionMatrix=n.translation(-1,1,0).timesMatrix(n.scaling(2/this.logicalWidth,-2/this.logicalHeight,1)),this.canvas=document.createElement("canvas"),this.webglContextIsLost=!1,this.scene.webglMakeLostContextSimulatingCanvas&&(this.canvas=WebGLDebugUtils.makeLostContextSimulatingCanvas(this.canvas)),this.canvas.addEventListener("webglcontextlost",function(t){console.log("context lost"),t.preventDefault(),e.webglContextIsLost=!0},!1);var i=1;this.canvas.addEventListener("webglcontextrestored",function(){console.log("context restored"),e.webglContextIsLost=!1,e.scene.webglContextLossIncremental&&(console.log("simulating context loss in ",i,"gl calls."),e.canvas.loseContextInNCalls(i),i++),e.initialize();for(var t=e.instances.length,n=0;t>n;n++)e.instances[n].data.drawable.initialize();e.dirty=!0},!1),this.canvas.width=this.logicalWidth*this.backingScale,this.canvas.height=this.logicalHeight*this.backingScale,this.canvas.style.width=this.logicalWidth+"px",this.canvas.style.height=this.logicalHeight+"px",this.canvas.style.position="absolute",this.canvas.style.left="0",this.canvas.style.top="0",this.$main.append(this.canvas),this.scene=t.scene,this.isWebGLLayer=!0,this.gl=null;try{this.gl=this.canvas.getContext("webgl")||this.canvas.getContext("experimental-webgl")}catch(o){throw o}if(!this.gl)throw new Error("Unable to load WebGL");this.initialize(),this.instances=[]};var a=s.WebGLLayer;return i(r,a,{initialize:function(){var t=this.gl;t.clearColor(0,0,0,0),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),this.shaderProgram=new o(t,"precision mediump float;\nattribute vec3 aVertex;\nuniform mat4 uProjectionMatrix;\nuniform mat4 uModelViewMatrix;\nvarying vec2 texCoord;\nuniform vec4 uColor;\nvoid main() {\n  texCoord = aVertex.xy;\n  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4( aVertex, 1 );\n}","precision mediump float;\nvarying vec2 texCoord;\nuniform vec4 uColor;\nuniform int uFragmentType;\nuniform sampler2D uTexture;\nvoid main() {\n  if (uFragmentType=="+a.fragmentTypeFill+"){\n"+"    gl_FragColor = uColor;\n"+"  }else if (uFragmentType=="+a.fragmentTypeTexture+"){\n"+"    gl_FragColor = texture2D( uTexture, texCoord );\n"+"  }\n"+"}",["aVertex"],["uTexture","uProjectionMatrix","uModelViewMatrix","uColor","uFragmentType"]),this.setSize(this.canvas.width,this.canvas.height),this.shaderProgram.use()},render:function(){if(!this.webglContextIsLost){var t=this.gl;if(this.dirty){t.clear(this.gl.COLOR_BUFFER_BIT),t.uniformMatrix4fv(this.shaderProgram.uniformLocations.uProjectionMatrix,!1,this.projectionMatrix.entries);for(var i=this.instances.length,n=0;i>n;n++){var s=this.instances[n];if(s.trail.isVisible()){var r=e(s.trail.getMatrix());s.data.drawable.render(this.shaderProgram,r)}}}}},switchToProgram:function(t){t!==this.shaderProgram&&(this.shaderProgram&&this.shaderProgram.unuse(),t.use(),this.shaderProgram=t)},setSize:function(t,e){this.gl.viewport(0,0,t,e)},dispose:function(){r.prototype.dispose.call(this),this.canvas.parentNode.removeChild(this.canvas),this.shaderProgram.unuse(),this.shaderProgram.dispose()},applyTransformationMatrix:function(){},reindex:function(t){return r.prototype.reindex.call(this,t),this.zIndex!==t&&(this.canvas.style.zIndex=t,this.zIndex=t),t+1},pushClipShape:function(){},popClipShape:function(){},getSVGString:function(){return'<image xmlns:xlink="'+s.xlinkns+'" xlink:href="'+this.canvas.toDataURL()+'" x="0" y="0" height="'+this.canvas.height+'px" width="'+this.canvas.width+'px"/>'},renderToCanvas:function(t,e){e.drawImage(this.canvas,0,0)},addInstance:function(t){{t.trail}r.prototype.addInstance.call(this,t),t.data.drawable=t.node.createWebGLDrawable(this.gl);for(var e=!1,i=0;i<this.instances.length;i++)if(t.trail.compare(this.instances[i].trail)<0){this.instances.splice(i,0,t),e=!0;break}e||this.instances.push(t),this.markWebGLDirty()},removeInstance:function(t){{t.trail}r.prototype.removeInstance.call(this,t),t.data.drawable.dispose(),t.data.drawable=null,this.instances.splice(this.instances.indexOf(t),1),this.markWebGLDirty()},getName:function(){return"webgl"},markWebGLDirty:function(){this.dirty=!0},notifyVisibilityChange:function(t){this.markWebGLDirty()},notifyOpacityChange:function(t){this.markWebGLDirty()},notifyClipChange:function(t){this.markWebGLDirty()},notifyBeforeSelfChange:function(t){this.markWebGLDirty(),t.node.updateWebGLDrawable(t.data.drawable)},notifyBeforeSubtreeChange:function(t){this.markWebGLDirty()},notifyDirtySelfPaint:function(t){this.markWebGLDirty(),t.node.updateWebGLDrawable(t.data.drawable)},notifyDirtySubtreePaint:function(t){this.markWebGLDirty()},notifyTransformChange:function(){this.markWebGLDirty()},notifyBoundsAccuracyChange:function(t){this.markWebGLDirty()},simulateWebGLContextLoss:function(){console.log("simulating webgl context loss in WebGLLayer"),this.canvas.loseContextInNCalls(5)}},{fragmentTypeFill:0,fragmentTypeTexture:1})}),i("SCENERY/layers/Renderer",["require","SCENERY/scenery","SCENERY/layers/LayerType","SCENERY/layers/CanvasLayer","SCENERY/layers/DOMLayer","SCENERY/layers/SVGLayer","SCENERY/layers/WebGLLayer"],function(t){var e=t("SCENERY/scenery");t("SCENERY/layers/LayerType"),t("SCENERY/layers/CanvasLayer"),t("SCENERY/layers/DOMLayer"),t("SCENERY/layers/SVGLayer"),t("SCENERY/layers/WebGLLayer"),e.Renderer=function(t,e,i,n){this.layerConstructor=t,this.name=e,this.bitmask=i,this.defaultOptions=n,this.defaultLayerType=this.createLayerType({})};var i=e.Renderer;return i.prototype={constructor:i,createLayerType:function(t){return new e.LayerType(this.layerConstructor,this.name,this.bitmask,this,_.extend({},this.defaultOptions,t))}},i.Canvas=new i(e.CanvasLayer,"canvas",e.bitmaskSupportsCanvas,{}),i.DOM=new i(e.DOMLayer,"dom",e.bitmaskSupportsDOM,{}),i.SVG=new i(e.SVGLayer,"svg",e.bitmaskSupportsSVG,{}),i.WebGL=new i(e.WebGLLayer,"webgl",e.bitmaskSupportsWebGL,{}),e.CanvasDefaultLayerType=i.Canvas.defaultLayerType,e.DOMDefaultLayerType=i.DOM.defaultLayerType,e.SVGDefaultLayerType=i.SVG.defaultLayerType,e.WebGLDefaultLayerType=i.WebGL.defaultLayerType,i.canvas=i.Canvas,i.dom=i.DOM,i.svg=i.SVG,i.webgl=i.WebGL,i}),i("SCENERY/display/RenderState",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/layers/Renderer","SCENERY/util/Trail"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery");t("SCENERY/layers/Renderer"),t("SCENERY/util/Trail"),i.RenderState=function(){};var n=i.RenderState;return e(Object,n,{isBackbone:function(){return!1},isCanvasCache:function(){return!1},isCacheShared:function(){return!1},requestsSplit:function(){return!1},getStateForDescendant:function(){},getPaintedRenderer:function(){},getCacheRenderer:function(){},getTransformBaseTrail:function(){},isBackboneTransformed:function(){}}),n.TestState=function(t,e,n,s,r){t.setImmutable();var o=t.lastNode(),a=o._subtreeRendererBitmask;this.trail=t,this.renderers=e,this.isProxy=n,this.isUnderCanvasCache,this.nextRenderers=null,this.backbone=!1,this.canvasCache=!1,this.cacheShared=!1,this.splits=!1,this.renderer=null,this.cacheRenderer=null,this.transformBaseTrail=r,this.nextTransformBaseTrail=r,this.backboneTransformed=!1;var h=o.hints||{};if(n||(1!==o.opacity||h.requireElement||h.cssTransformBackbone?(this.backbone=!0,this.backboneTransformed=!!h.cssTransformBackbone,this.backboneTransformed&&(this.nextTransformBaseTrail=t),this.renderer=i.Renderer.DOM,this.nextRenderers=e):h.canvasCache&&a&0!==i.bitmaskSupportsCanvas&&(this.canvasCache=!0,h.singleCache&&(this.cacheShared=!0,this.nextTransformBaseTrail=new i.Trail),this.renderer=i.Renderer.Canvas,this.nextRenderers=[i.Renderer.Canvas])),!this.backbone&&!this.canvasCache){if(h.layerSplit&&(this.splits=!0),o.isPainted())for(var u=e.length-1;u>=0;u--){var l=e[u];if(l.bitmask&0!==o._rendererBitmask){this.renderer=l;break}}this.nextRenderers=e}},n.TestState.prototype={constructor:n.TestState,isBackbone:function(){return this.backbone},isCanvasCache:function(){return this.canvasCache},isCacheShared:function(){return this.cacheShared},requestsSplit:function(){return this.splits},getStateForDescendant:function(t){return this.backbone||this.canvasCache?new n.TestState(t,this.nextRenderers,!0,!0,this.nextTransformBaseTrail):new n.TestState(t,this.nextRenderers,!1,this.isUnderCanvasCache,this.nextTransformBaseTrail)},getPaintedRenderer:function(){return this.renderer},getCacheRenderer:function(){return this.renderer},getTransformBaseTrail:function(){return this.transformBaseTrail},isBackboneTransformed:function(){return this.backboneTransformed}},n}),i("SCENERY/display/Display",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/util/Trail","SCENERY/display/DisplayInstance","SCENERY/display/RenderState","SCENERY/layers/Renderer"],function(t){function e(t){var i=l.bitmaskAll;i&=t._rendererBitmask;for(var n=t._children,s=n.length,r=0;s>r;r++)i&=e(n[r]);return t._subtreeRendererBitmask=i,i}function i(t,e){t.nextPainted=e,e.previousPainted=t}function n(t,e,i){var n=new l.DisplayInstance(e);return n.state=i,n.renderer=l.Renderer.DOM,o(t,e,i,n),n}function s(t,e,i){var n=new l.DisplayInstance(e);return n.state=i,n.renderer=i.getCacheRenderer(),o(t,e,i,n),n}function r(t,e,i){var n=e.lastNode().getId(),s=t._sharedCanvasInstances[n];if(s)return s;var r=new l.DisplayInstance(new l.Trail(e.lastNode()));return r.state=i,r.renderer=i.getCacheRenderer(),o(t,e,i,r),t._sharedCanvasInstances[n]=r,r}function o(t,e,i,n){var s=h(t,e,i);return n.proxyChild=s,s.proxyParent=n,n.firstPainted=n,n.lastPainted=n,s}function a(){return new l.DisplayInstance(null)}function h(t,e,o){var u=o.getStateForDescendant(e);if(u.isBackbone())return n(t,e,u);if(u.isCanvasCache())return u.isCacheShared()?r(t,e,u):s(t,e,u);var c=new l.DisplayInstance(e),d=e.lastNode();c.state=u,c.renderer=d.isPainted()?u.getPaintedRenderer():null;var m=null;c.isEffectivelyPainted()&&(m=c,c.firstPainted=c);for(var f=e.lastNode().children,g=f.length,p=0;g>p;p++){var v=h(t,e.copy().addDescendant(f[p],p),u);c.appendInstance(v),v.firstPainted&&(m?i(m,v.firstPainted):c.firstPainted=v.firstPainted,m=v.lastPainted)}if(null!==m&&(c.lastPainted=m),u.requestsSplit())if(c.firstPainted){var y=a(),x=a();i(y,c.firstPainted),i(c.lastPainted,x),c.firstPainted=y,c.lastPainted=x}else c.firstPainted=c.lastPainted=a();return c}var u=t("PHET_CORE/inherit"),l=t("SCENERY/scenery");t("SCENERY/util/Trail"),t("SCENERY/display/DisplayInstance"),t("SCENERY/display/RenderState"),t("SCENERY/layers/Renderer"),l.Display=function(t){this._rootNode=t,this._domElement=null,this._sharedCanvasInstances={},this._baseInstance=null};var c=l.Display;return u(Object,c,{getRootNode:function(){return this._rootNode},get rootNode(){return this.getRootNode()},buildTemporaryDisplay:function(){e(this._rootNode);var t=new l.Trail(this._rootNode),i=new l.RenderState.TestState(t,[l.Renderer.DOM,l.Renderer.Canvas,l.Renderer.SVG,new l.Trail],!1,!1);this._baseInstance=n(this,t,i)}}),c}),i("SCENERY/input/DownUpListener",["require","SCENERY/scenery","SCENERY/util/Trail"],function(t){var e=t("SCENERY/scenery");t("SCENERY/util/Trail"),e.DownUpListener=function(t){var e=this;this.options=_.extend({mouseButton:0},t),this.isDown=!1,this.downCurrentTarget=null,this.downTrail=null,this.pointer=null,this.downListener={up:function(t){t.pointer.isMouse&&t.domEvent.button!==e.options.mouseButton||e.buttonUp(t)},cancel:function(t){e.buttonUp(t)}}};var i=e.DownUpListener;return i.prototype={constructor:i,buttonDown:function(t){this.isDown||t.pointer.isMouse&&t.domEvent.button!==this.options.mouseButton||(t.pointer.addInputListener(this.downListener),this.isDown=!0,this.downCurrentTarget=t.currentTarget,this.downTrail=t.trail.subtrailTo(t.currentTarget,!1),this.pointer=t.pointer,this.options.down&&this.options.down(t,this.downTrail))},buttonUp:function(t){this.isDown=!1,this.pointer.removeInputListener(this.downListener);var e=t.currentTarget;if(t.currentTarget=this.downCurrentTarget,this.options.upInside||this.options.upOutside){var i=t.trail,n=i.isExtensionOf(this.downTrail,!0);n&&this.options.upInside?this.options.upInside(t,this.downTrail):!n&&this.options.upOutside&&this.options.upOutside(t,this.downTrail)}this.options.up&&this.options.up(t,this.downTrail),t.currentTarget=e},down:function(t){this.buttonDown(t)}},i}),i("SCENERY/input/ButtonListener",["require","SCENERY/scenery","SCENERY/util/Trail","PHET_CORE/inherit","SCENERY/input/DownUpListener"],function(t){var e=t("SCENERY/scenery");t("SCENERY/util/Trail");var i=t("PHET_CORE/inherit"),n=t("SCENERY/input/DownUpListener");e.ButtonListener=function(t){this.buttonState="up",this._overCount=0,this._buttonOptions=t;var e=this;n.call(this,{mouseButton:t.mouseButton||0,down:function(t){e.setButtonState(t,"down")},up:function(t){e.setButtonState(t,e._overCount>0?"over":"up")}})};var s=e.ButtonListener;return i(n,s,{setButtonState:function(t,e){if(e!==this.buttonState){var i=this.buttonState;this.buttonState=e,this._buttonOptions[e]&&this._buttonOptions[e](t,i),this._buttonOptions.fire&&this._overCount>0&&(this._buttonOptions.fireOnDown?"down"===e:"down"===i)&&this._buttonOptions.fire(t)}},enter:function(t){this._overCount++,1===this._overCount&&this.setButtonState(t,this.isDown?"down":"over")},exit:function(t){this._overCount--,0===this._overCount&&this.setButtonState(t,this.isDown?"out":"up")}}),s.TEST_LISTENER=new s({up:function(t,e){console.log("ButtonListener.up oldState="+e)},over:function(t,e){console.log("ButtonListener.over oldState="+e)},down:function(t,e){console.log("ButtonListener.down oldState="+e)},out:function(t,e){console.log("ButtonListener.out oldState="+e)},fire:function(){console.log("ButtonListener.fire")}}),s}),i("SCENERY/input/Event",["require","SCENERY/scenery"],function(t){var e=t("SCENERY/scenery");e.Event=function(t){this.handled=!1,this.aborted=!1,this.trail=t.trail,this.type=t.type,this.pointer=t.pointer,this.domEvent=t.domEvent,this.currentTarget=t.currentTarget,this.target=t.target};var i=e.Event;return i.prototype={constructor:i,handle:function(){this.handled=!0},abort:function(){this.handled=!0,this.aborted=!0}},i}),i("SCENERY/input/Pointer",["require","SCENERY/scenery"],function(t){var e=t("SCENERY/scenery");e.Pointer=function(){this.listeners=[],this.active=!1};var i=e.Pointer;return i.prototype={constructor:i,addInputListener:function(t){this.listeners.push(t)},removeInputListener:function(t){var e=_.indexOf(this.listeners,t);this.listeners.splice(e,1)},hasPointChanged:function(t){return!(this.point===t||t&&this.point&&this.point.equals(t))}},i}),i("SCENERY/input/Mouse",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/input/Pointer"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/input/Pointer");i.Mouse=function(){n.call(this),this.point=null,this.leftDown=!1,this.middleDown=!1,this.rightDown=!1,this.isMouse=!0,this.trail=null,this.isDown=!1,this._cursor=null,this.type="mouse"};var s=i.Mouse;return e(n,s,{set cursor(t){return this.setCursor(t)},get cursor(){return this._cursor},setCursor:function(t){return this._cursor=t,this},clearCursor:function(){this.setCursor(null)},down:function(t,e){var i=this.hasPointChanged(t);switch(this.point=t,this.isDown=!0,e.button){case 0:this.leftDown=!0;break;case 1:this.middleDown=!0;break;case 2:this.rightDown=!0}return i},up:function(t,e){var i=this.hasPointChanged(t);switch(this.point=t,this.isDown=!1,e.button){case 0:this.leftDown=!1;break;case 1:this.middleDown=!1;break;case 2:this.rightDown=!1}return i},move:function(t){var e=this.hasPointChanged(t);return this.point=t,e},over:function(t){var e=this.hasPointChanged(t);return this.point=t,e},out:function(t){var e=this.hasPointChanged(t);return this.point=null,e},toString:function(){return"Mouse"}}),s}),i("SCENERY/input/Touch",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/input/Pointer"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/input/Pointer");i.Touch=function(t,e){n.call(this),this.id=t,this.point=e,this.isTouch=!0,this.trail=null,this.isDown=!0,this.type="touch"};var s=i.Touch;return e(n,s,{move:function(t){var e=this.hasPointChanged(t);return this.point=t,e},end:function(t){var e=this.hasPointChanged(t);return this.point=t,this.isDown=!1,e},cancel:function(t){var e=this.hasPointChanged(t);return this.point=t,this.isDown=!1,e},toString:function(){return"Touch#"+this.id}}),s}),i("SCENERY/input/Pen",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/input/Pointer"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/input/Pointer");i.Pen=function(t,e){n.call(this),this.id=t,this.point=e,this.isPen=!0,this.trail=null,this.isDown=!0,this.type="pen"};var s=i.Pen;return e(n,s,{move:function(t){var e=this.hasPointChanged(t);return this.point=t,e},end:function(t){var e=this.hasPointChanged(t);return this.point=t,this.isDown=!1,e},cancel:function(t){var e=this.hasPointChanged(t);return this.point=t,this.isDown=!1,e},toString:function(){return"Pen#"+this.id}}),s}),i("SCENERY/input/Key",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/input/Pointer"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/input/Pointer");i.Key=function(t){n.call(this),this.event=t,this.isKey=!0,this.trail=null,this.type="key"};var s=i.Key;return e(n,s,{}),s}),i("SCENERY/input/Input",["require","SCENERY/scenery","SCENERY/util/Trail","SCENERY/input/Mouse","SCENERY/input/Touch","SCENERY/input/Pen","SCENERY/input/Key","SCENERY/input/Event"],function(t){var e=t("SCENERY/scenery");t("SCENERY/util/Trail"),t("SCENERY/input/Mouse"),t("SCENERY/input/Touch"),t("SCENERY/input/Pen"),t("SCENERY/input/Key"),t("SCENERY/input/Event"),e.Input=function(t,e,i){this.scene=t,this.listenerTarget=e,this.batchDOMEvents=i,this.batchedCallbacks=[],this.mouse=null,this.pointers=[],this.listenerReferences=[],this.eventLog=[],this.logEvents=!1,this.pointerAddedListeners=[]};var i=e.Input;return i.prototype={constructor:i,addPointer:function(t){if(this.pointers.push(t),this.pointerAddedListeners.length)for(var e=0;e<this.pointerAddedListeners.length;e++)this.pointerAddedListeners[e](t)},addPointerAddedListener:function(t){this.pointerAddedListeners.push(t)},removePointerAddedListener:function(t){var e=this.pointerAddedListeners.indexOf(t);-1!==e&&this.pointerAddedListeners.splice(e,e+1)},removePointer:function(t){for(var e=this.pointers.length-1;e>=0;e--)this.pointers[e]===t&&this.pointers.splice(e,1)},findTouchById:function(t){for(var e=this.pointers.length;e--;){var i=this.pointers[e];if(i.id===t)return i}return void 0},findKeyByEvent:function(t){var e=_.find(this.pointers,function(e){return e.keyCode===t.keyCode&&e.charCode===t.charCode});return e},initMouse:function(){this.mouse=new e.Mouse,this.addPointer(this.mouse)},mouseDown:function(t,e){this.logEvents&&this.eventLog.push("mouseDown("+i.serializeVector2(t)+","+i.serializeDomEvent(e)+");"),this.mouse||this.initMouse();var n=this.mouse.down(t,e);n&&this.moveEvent(this.mouse,e),this.downEvent(this.mouse,e)},mouseUp:function(t,e){this.logEvents&&this.eventLog.push("mouseUp("+i.serializeVector2(t)+","+i.serializeDomEvent(e)+");"),this.mouse||this.initMouse();var n=this.mouse.up(t,e);n&&this.moveEvent(this.mouse,e),this.upEvent(this.mouse,e)},mouseUpImmediate:function(t,e){this.logEvents&&this.eventLog.push("mouseUpImmediate("+i.serializeVector2(t)+","+i.serializeDomEvent(e)+");"),this.mouse||this.initMouse(),this.mouse.point&&this.upImmediateEvent(this.mouse,e)},mouseMove:function(t,e){this.logEvents&&this.eventLog.push("mouseMove("+i.serializeVector2(t)+","+i.serializeDomEvent(e)+");"),this.mouse||this.initMouse(),this.mouse.move(t,e),this.moveEvent(this.mouse,e)},mouseOver:function(t,e){this.logEvents&&this.eventLog.push("mouseOver("+i.serializeVector2(t)+","+i.serializeDomEvent(e)+");"),this.mouse||this.initMouse(),this.mouse.over(t,e)},mouseOut:function(t,e){this.logEvents&&this.eventLog.push("mouseOut("+i.serializeVector2(t)+","+i.serializeDomEvent(e)+");"),this.mouse||this.initMouse(),this.mouse.out(t,e)},keyDown:function(t){this.logEvents&&this.eventLog.push("keyDown("+i.serializeDomEvent(t)+");");var n=new e.Key(t);this.addPointer(n);var s=this.scene.getTrailFromKeyboardFocus();this.dispatchEvent(s,"keyDown",n,t,!0)},keyUp:function(t){this.logEvents&&this.eventLog.push("keyUp("+i.serializeDomEvent(t)+");");var e=this.findKeyByEvent(t);if(e){this.removePointer(e);var n=this.scene.getTrailFromKeyboardFocus();this.dispatchEvent(n,"keyUp",e,t,!0)}},keyPress:function(t){this.logEvents&&this.eventLog.push("keyPress("+i.serializeDomEvent(t)+");")},touchStart:function(t,n,s){this.logEvents&&this.eventLog.push("touchStart('"+t+"',"+i.serializeVector2(n)+","+i.serializeDomEvent(s)+");");var r=new e.Touch(t,n,s);this.addPointer(r),this.downEvent(r,s)},touchEnd:function(t,e,n){this.logEvents&&this.eventLog.push("touchEnd('"+t+"',"+i.serializeVector2(e)+","+i.serializeDomEvent(n)+");");var s=this.findTouchById(t);if(s){var r=s.end(e,n);r&&this.moveEvent(s,n),this.removePointer(s),this.upEvent(s,n)}},touchEndImmediate:function(t,e,n){this.logEvents&&this.eventLog.push("touchEndImmediate('"+t+"',"+i.serializeVector2(e)+","+i.serializeDomEvent(n)+");");var s=this.findTouchById(t);s&&this.upImmediateEvent(s,n)},touchMove:function(t,e,n){this.logEvents&&this.eventLog.push("touchMove('"+t+"',"+i.serializeVector2(e)+","+i.serializeDomEvent(n)+");");var s=this.findTouchById(t);s&&(s.move(e,n),this.moveEvent(s,n))},touchCancel:function(t,e,n){this.logEvents&&this.eventLog.push("touchCancel('"+t+"',"+i.serializeVector2(e)+","+i.serializeDomEvent(n)+");");var s=this.findTouchById(t);if(s){var r=s.cancel(e,n);r&&this.moveEvent(s,n),this.removePointer(s),this.cancelEvent(s,n)}},penStart:function(t,n,s){this.logEvents&&this.eventLog.push("penStart('"+t+"',"+i.serializeVector2(n)+","+i.serializeDomEvent(s)+");");var r=new e.Pen(t,n,s);this.addPointer(r),this.downEvent(r,s)},penEnd:function(t,e,n){this.logEvents&&this.eventLog.push("penEnd('"+t+"',"+i.serializeVector2(e)+","+i.serializeDomEvent(n)+");");var s=this.findTouchById(t);if(s){var r=s.end(e,n);r&&this.moveEvent(s,n),this.removePointer(s),this.upEvent(s,n)}},penEndImmediate:function(t,e,n){this.logEvents&&this.eventLog.push("penEndImmediate('"+t+"',"+i.serializeVector2(e)+","+i.serializeDomEvent(n)+");");var s=this.findTouchById(t);s&&this.upImmediateEvent(s,n)},penMove:function(t,e,n){this.logEvents&&this.eventLog.push("penMove('"+t+"',"+i.serializeVector2(e)+","+i.serializeDomEvent(n)+");");var s=this.findTouchById(t);s&&(s.move(e,n),this.moveEvent(s,n))},penCancel:function(t,e,n){this.logEvents&&this.eventLog.push("penCancel('"+t+"',"+i.serializeVector2(e)+","+i.serializeDomEvent(n)+");");var s=this.findTouchById(t);if(s){var r=s.cancel(e,n);r&&this.moveEvent(s,n),this.removePointer(s),this.cancelEvent(s,n)}},pointerDown:function(t,e,i,n){switch(e){case"mouse":this.mouseDown(i,n);break;case"touch":this.touchStart(t,i,n);break;case"pen":this.penStart(t,i,n);break;default:console.log&&console.log("Unknown pointer type: "+e)}},pointerUp:function(t,e,i,n){switch(e){case"mouse":this.mouseUp(i,n);break;case"touch":this.touchEnd(t,i,n);break;case"pen":this.penEnd(t,i,n);break;default:console.log&&console.log("Unknown pointer type: "+e)}},pointerUpImmediate:function(t,e,i,n){switch(e){case"mouse":this.mouseUpImmediate(i,n);break;case"touch":this.touchEndImmediate(t,i,n);break;case"pen":this.penEndImmediate(t,i,n);break;default:console.log&&console.log("Unknown pointer type: "+e)}},pointerCancel:function(t,e,i,n){switch(e){case"mouse":console&&console.log&&console.log("WARNING: Pointer mouse cancel was received");break;case"touch":this.touchCancel(t,i,n);break;case"pen":this.penCancel(t,i,n);break;default:console.log&&console.log("Unknown pointer type: "+e)}},pointerMove:function(t,e,i,n){switch(e){case"mouse":this.mouseMove(i,n);break;case"touch":this.touchMove(t,i,n);break;case"pen":this.penMove(t,i,n);break;default:console.log&&console.log("Unknown pointer type: "+e)}},pointerOver:function(){},pointerOut:function(){},pointerEnter:function(){},pointerLeave:function(){},upEvent:function(t,i){var n=this.scene.trailUnderPointer(t)||new e.Trail(this.scene);this.dispatchEvent(n,"up",t,i,!0),t.isTouch&&this.exitEvents(t,i,n,0,!0),t.trail=n},upImmediateEvent:function(t,i){var n=this.scene.trailUnderPointer(t)||new e.Trail(this.scene);this.dispatchEvent(n,"upImmediate",t,i,!0)},downEvent:function(t,i){var n=this.scene.trailUnderPointer(t)||new e.Trail(this.scene);t.isTouch&&this.enterEvents(t,i,n,0,!0),this.dispatchEvent(n,"down",t,i,!0),t.trail=n},moveEvent:function(t,e){{this.branchChangeEvents(t,e,!0)}},cancelEvent:function(t,i){var n=this.scene.trailUnderPointer(t)||new e.Trail(this.scene);this.dispatchEvent(n,"cancel",t,i,!0),t.isTouch&&this.exitEvents(t,i,n,0,!0),t.trail=n},branchChangeEvents:function(t,i,n){var s=this.scene.trailUnderPointer(t)||new e.Trail(this.scene),r=t.trail||new e.Trail(this.scene),o=r.lastNode()!==s.lastNode();if(!o&&!n)return!1;var a=e.Trail.branchIndex(s,r),h=a!==s.length||a!==r.length;return n&&this.dispatchEvent(s,"move",t,i,!0),this.exitEvents(t,i,r,a,o),this.enterEvents(t,i,s,a,o),t.trail=s,h},enterEvents:function(t,e,i,n,s){if(i.length>n)for(var r=i.length-1;r>=n;r--)this.dispatchEvent(i.slice(0,r+1),"enter",t,e,!1);s&&this.dispatchEvent(i,"over",t,e,!0)},exitEvents:function(t,e,i,n,s){if(s&&this.dispatchEvent(i,"out",t,e,!0),i.length>n)for(var r=n;r<i.length;r++)this.dispatchEvent(i.slice(0,r+1),"exit",t,e,!1)},validatePointers:function(){for(var t=this,e=this.pointers.length;e--;){var i=this.pointers[e];if(i.point){t.branchChangeEvents(i,null,!1)}}},dispatchEvent:function(t,i,n,s,r){if(!t)try{throw new Error("falsy trail for dispatchEvent")}catch(o){throw console.log(o.stack),o}var a=new e.Event({trail:t,type:i,pointer:n,domEvent:s,currentTarget:null,target:t.lastNode()});this.dispatchToPointer(i,n,a),this.dispatchToTargets(t,n,i,a,r),!t.lastNode().interactive&&!n.isKey&&s&&s.preventDefault&&s.preventDefault()},dispatchToPointer:function(t,e,i){if(!i.aborted&&!i.handled)for(var n=e.type+t,s=e.listeners.slice(0),r=0;r<s.length;r++){var o=s[r],a=!1;if(!a&&o[n]&&(o[n](i),a=i.aborted),!a&&o[t]&&(o[t](i),a=i.aborted),a)return}},dispatchToTargets:function(t,e,i,n,s){if(!n.aborted&&!n.handled)for(var r=e.type+i,o=t.length-1;o>=0;s?o--:o=-1){var a=t.nodes[o];n.currentTarget=a;
for(var h=a.getInputListeners(),u=0;u<h.length;u++){var l=h[u],c=!1;if(!c&&l[r]&&(l[r](n),c=n.aborted),!c&&l[i]&&(l[i](n),c=n.aborted),c)return}if(n.handled)return}},addListener:function(t,e,i){var n=this,s="keydown"!==t&&"keyup"!==t&&"keypress"!==t;if(this.listenerTarget===window&&document.addEventListener(t,function(){}),this.batchDOMEvents){var r=function(t){s&&t.preventDefault(),n.batchedCallbacks.push(function(){n.validatePointers(),n.logEvents&&n.eventLog.push("validatePointers();"),e(t)})};this.listenerTarget.addEventListener(t,r,i),this.listenerReferences.push({type:t,callback:r,useCapture:i})}else this.listenerTarget.addEventListener(t,e,i),this.listenerReferences.push({type:t,callback:function(t){n.validatePointers(),n.logEvents&&n.eventLog.push("validatePointers();"),e(t)},useCapture:i})},addImmediateListener:function(t,e,i){this.listenerTarget.addEventListener(t,e,i),this.listenerReferences.push({type:t,callback:function(t){e(t)},useCapture:i})},disposeListeners:function(){var t=this;_.each(this.listenerReferences,function(e){t.listenerTarget.removeEventListener(e.type,e.callback,e.useCapture)})},fireBatchedEvents:function(){if(this.batchedCallbacks.length){for(var t=this.batchedCallbacks.length,e=0;t>e;e++)this.batchedCallbacks[e]();this.batchedCallbacks.length=0}},clearBatchedEvents:function(){this.batchedCallbacks.length=0}},i.serializeDomEvent=function n(t){var e=[];for(var i in t)if(t.hasOwnProperty(i))if("touches"===i||"targetTouches"===i||"changedTouches"===i){for(var s=[],r=0;r<t[i].length;r++){var o=t[i].item(r);s.push(n(o))}e.push(i+":["+s.join(",")+"]")}else e.push(i+":"+("object"==typeof t[i]&&null!==t[i]?"{}":JSON.stringify(t[i])));return"{"+e.join(",")+"}"},i.serializeVector2=function(t){return"dot("+t.x+","+t.y+")"},i}),i("SCENERY/input/SimpleDragHandler",["require","SCENERY/scenery"],function(t){var e=t("SCENERY/scenery");e.SimpleDragHandler=function(t){var e=this;this.options=_.extend({allowTouchSnag:!1,mouseButton:0,dragCursor:"pointer"},t),this.dragging=!1,this.pointer=null,this.trail=null,this.transform=null,this.node=null,this.lastDragPoint=null,this.startTransformMatrix=null,this.mouseButton=void 0,this.transformListener={transform:function(t){if(e.trail.isExtensionOf(t.trail,!0)){var i=t.trail.getTransform().getMatrix(),n=e.transform.getMatrix();e.node.prependMatrix(i.inverted().timesMatrix(n)),e.transform.setMatrix(i)}}},this.dragListener={up:function(t){if(!t.pointer.isMouse||t.domEvent.button===e.mouseButton){var i=t.currentTarget;t.currentTarget=e.node,e.endDrag(t),t.currentTarget=i}},cancel:function(t){var i=t.currentTarget;t.currentTarget=e.node,e.endDrag(t),t.currentTarget=i,e.transform||e.node.setMatrix(e.startTransformMatrix)},move:function(t){var i=e.pointer.point.minus(e.lastDragPoint);if(0!==i.magnitudeSquared()){var n=e.transform.inverseDelta2(i);if(e.options.translate){var s=e.node.getTransform().getMatrix().getTranslation();e.options.translate({delta:n,oldPosition:s,position:s.plus(n)})}if(e.lastDragPoint=e.pointer.point,e.options.drag){var r=t.currentTarget;t.currentTarget=e.node,e.options.drag(t,e.trail),t.currentTarget=r}}}}};var i=e.SimpleDragHandler;return i.prototype={constructor:i,startDrag:function(t){t.pointer.active=!0,t.pointer.cursor=this.options.dragCursor,t.pointer.addInputListener(this.dragListener),this.dragging=!0,this.pointer=t.pointer,this.trail=t.trail.subtrailTo(t.currentTarget,!0),this.transform=this.trail.getTransform(),this.node=t.currentTarget,this.lastDragPoint=t.pointer.point,this.startTransformMatrix=t.currentTarget.getMatrix(),this.mouseButton=t.pointer.isMouse?t.domEvent.button:void 0,this.options.start&&this.options.start(t,this.trail)},endDrag:function(t){this.pointer.active=!1,this.pointer.cursor=null,this.pointer.removeInputListener(this.dragListener),this.dragging=!1,this.options.end&&this.options.end(t,this.trail)},tryToSnag:function(t){t.pointer.isMouse&&t.domEvent&&this.options.mouseButton!==t.domEvent.button&&-1!==this.options.mouseButton||this.dragging||t.pointer.active||this.startDrag(t)},tryTouchToSnag:function(t){this.options.allowTouchSnag&&(this.options.allowTouchSnag===!0||this.options.allowTouchSnag(t))&&this.tryToSnag(t)},down:function(t){this.tryToSnag(t)},touchenter:function(t){this.tryTouchToSnag(t)},touchmove:function(t){this.tryTouchToSnag(t)}},i}),i("SCENERY/layers/LayerBoundary",["require","SCENERY/scenery"],function(t){var e=t("SCENERY/scenery");e.LayerBoundary=function(){this.previousLayerType=null,this.nextLayerType=null,this.previousPaintedTrail=null,this.nextPaintedTrail=null};var i=e.LayerBoundary;return i.prototype={constructor:i,hasPrevious:function(){return!!this.previousPaintedTrail},hasNext:function(){return!!this.nextPaintedTrail},reindex:function(){this.previousPaintedTrail&&this.previousPaintedTrail.reindex(),this.nextPaintedTrail&&this.nextPaintedTrail.reindex()},equivalentPreviousTrail:function(t){return this.previousPaintedTrail&&t?(this.previousPaintedTrail.reindex(),this.previousPaintedTrail.equals(t)):this.previousPaintedTrail===t},equivalentNextTrail:function(t){return this.nextPaintedTrail&&t?(this.nextPaintedTrail.reindex(),this.nextPaintedTrail.equals(t)):this.nextPaintedTrail===t},toString:function(){return"boundary:\n    types:    "+(this.previousLayerType?this.previousLayerType.name:"")+" => "+(this.nextLayerType?this.nextLayerType.name:"")+"\n    trails:   "+(this.previousPaintedTrail?this.previousPaintedTrail.getUniqueId():"")+" => "+(this.nextPaintedTrail?this.nextPaintedTrail.getUniqueId():"")}},i}),i("SCENERY/layers/LayerStrategy",["require","SCENERY/scenery","SCENERY/layers/Renderer"],function(t){var e=t("SCENERY/scenery"),i=t("SCENERY/layers/Renderer");e.LayerStrategy={hasPreferredLayerType:function(t){return t.trail.lastNode().hasRenderer()},getPreferredLayerType:function(t,e){var i,n=t.trail.lastNode();return n.hasRendererLayerType()?i=n.getRendererLayerType():(i=e.bestPreferredLayerTypeFor(n.getRenderer().bitmask),i||(i=n.getRenderer().defaultLayerType)),i},hasCompatibleRenderer:function(t,e){return e||t._renderer!==i.WebGL?t.hasRenderer():!1},enter:function(t,e){var i,n=t.trail,s=n.lastNode();if(this.hasCompatibleRenderer(s,e.scene.usingWebGL))i=this.getPreferredLayerType(t,e),e.pushPreferredLayerType(i),e.getCurrentLayerType()!==i&&e.switchToType(t,i);else if(s.isPainted()){var r=e.getCurrentLayerType();i=e.bestPreferredLayerTypeFor(s._rendererBitmask),i?r!==i&&e.switchToType(t,i):r&&r.supportsNode(s)||e.switchToType(t,s.pickARenderer().defaultLayerType)}(s.isLayerSplit()||this.hasSplitFlags(s))&&e.switchToType(t,e.getCurrentLayerType()),s.isPainted()&&e.markPainted(t)},exit:function(t,e){var i=t.trail,n=i.lastNode();this.hasCompatibleRenderer(n,e.scene.usingWebGL)&&e.popPreferredLayerType(),(n.isLayerSplit()||this.hasSplitFlags(n))&&e.switchToType(t,e.getCurrentLayerType())},hasSplitFlags:function(t){var e=t.getRendererOptions();return t.hasRenderer()&&e&&(e.cssTranslation||e.cssRotation||e.cssScale||e.cssTransform)}};var n=e.LayerStrategy;return n}),i("SCENERY/layers/LayerBuilder",["require","SCENERY/scenery","SCENERY/layers/LayerBoundary","SCENERY/util/Trail","SCENERY/util/TrailPointer","SCENERY/layers/LayerStrategy"],function(t){var e=t("SCENERY/scenery");t("SCENERY/layers/LayerBoundary"),t("SCENERY/util/Trail"),t("SCENERY/util/TrailPointer");var i=t("SCENERY/layers/LayerStrategy");e.LayerBuilder=function(t,i,n,s){this.scene=t,this.layerTypeStack=[],this.boundaries=[],this.pendingBoundary=new e.LayerBoundary,this.pendingBoundary.previousLayerType=i,this.pendingBoundary.previousPaintedTrail=n,this.currentLayerType=i,this.layerChangePending=null===n,n?(this.startPointer=new e.TrailPointer(n.copy(),!0),this.startPointer.nestedForwards()):this.startPointer=new e.TrailPointer(new e.Trail(t),!0),this.endPointer=s?new e.TrailPointer(s.copy(),!0):new e.TrailPointer(new e.Trail(t),!1),this.includesEndTrail=null!==s};var n=e.LayerBuilder;return n.prototype={constructor:n,prepareLayerStack:function(){for(var t=new e.TrailPointer(new e.Trail(this.startPointer.trail.rootNode()),!0),n=this.startPointer.trail.length-(this.startPointer.isBefore?1:0);t.trail.length<=n&&(i.hasPreferredLayerType(t,this)&&this.pushPreferredLayerType(i.getPreferredLayerType(t,this)),t.trail.length<this.startPointer.trail.nodes.length);)t.trail.addDescendant(this.startPointer.trail.nodes[t.trail.length])},run:function(){var t=this;this.prepareLayerStack(),t.startPointer.depthFirstUntil(t.endPointer,function(e){e.isBefore?i.enter(e,t):i.exit(e,t)},!1),this.includesEndTrail||this.layerChange(null)},layerChange:function(t){this.layerChangePending=!1;var i=this.pendingBoundary;i.nextPaintedTrail=t?t.trail.copy():null,this.boundaries.push(i),this.pendingBoundary=new e.LayerBoundary,this.pendingBoundary.previousLayerType=i.nextLayerType,this.pendingBoundary.previousPaintedTrail=i.nextPaintedTrail},switchToType:function(t,e){this.currentLayerType=e,this.pendingBoundary.nextLayerType=e,this.layerChangePending=!0},markPainted:function(t){this.layerChangePending?this.layerChange(t):this.pendingBoundary.previousPaintedTrail=t.trail.copy()},getCurrentLayerType:function(){return this.currentLayerType},pushPreferredLayerType:function(t){this.layerTypeStack.push(t)},popPreferredLayerType:function(){this.layerTypeStack.pop()},getPreferredLayerType:function(){return 0!==this.layerTypeStack.length?this.layerTypeStack[this.layerTypeStack.length-1]:null},bestPreferredLayerTypeFor:function(t){for(var e=this.layerTypeStack.length-1;e>=0;e--){var i=this.layerTypeStack[e];if(i.supportsBitmask(t))return i}return null}},n}),i("SCENERY/nodes/CanvasNode",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/nodes/Node","SCENERY/layers/Renderer"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/nodes/Node");t("SCENERY/layers/Renderer"),i.CanvasNode=function(t){n.call(this,t),this.setRendererBitmask(i.bitmaskSupportsCanvas),t&&t.canvasBounds&&this.setCanvasBounds(t.canvasBounds)};var s=i.CanvasNode;return e(n,s,{setCanvasBounds:function(t){this.invalidateSelf(t)},set canvasBounds(t){this.setCanvasBounds(t)},get canvasBounds(){return this.getSelfBounds()},isPainted:function(){return!0},paintCanvas:function(){throw new Error("CanvasNode needs paintCanvas implemented")},containsPointSelf:function(){return!1},getBasicConstructor:function(t){return"new scenery.CanvasNode( {"+t+"} )"}}),s.prototype._mutatorKeys=["canvasBounds"].concat(n.prototype._mutatorKeys),s}),i("PHET_CORE/platform",["require","PHET_CORE/core"],function(t){function e(t){return i()===t}function i(){var t=-1,e=null;return"Microsoft Internet Explorer"===navigator.appName?(e=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),null!==e.exec(s)&&(t=parseFloat(RegExp.$1))):"Netscape"===navigator.appName&&(e=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),null!==e.exec(s)&&(t=parseFloat(RegExp.$1))),t}var n=t("PHET_CORE/core"),s=navigator.userAgent;return n.platform={get firefox(){return s.toLowerCase().indexOf("firefox")>-1},get mobileSafari(){return s.match(/(iPod|iPhone|iPad)/)&&s.match(/AppleWebKit/)},get safari5(){return s.match(/Version\/5\./)&&s.match(/Safari\//)&&s.match(/AppleWebKit/)},get safari6(){return s.match(/Version\/6\./)&&s.match(/Safari\//)&&s.match(/AppleWebKit/)},get safari7(){return s.match(/Version\/7\./)&&s.match(/Safari\//)&&s.match(/AppleWebKit/)},get ie9(){return e(9)},get ie10(){return e(10)},get ie11(){return e(11)},get ie(){return-1!==i()},get android(){return s.indexOf("Android")>0},get chromium(){return/chrom(e|ium)/.test(s.toLowerCase())}},n.platform}),i("SCENERY/nodes/Fillable",["require","SCENERY/scenery","PHET_CORE/platform"],function(t){var e=t("SCENERY/scenery"),i=t("PHET_CORE/platform"),n=i.safari5;e.Fillable=function(t){var i=t.prototype;i.initializeFillable=function(){this._fill=null,this._fillPickable=!0,this._fillKept=!1;var t=this;this._fillListener=function(){t.invalidatePaint(),t.invalidateFill()}},i.hasFill=function(){return null!==this._fill},i.getFill=function(){return this._fill},i.setFill=function(t){if(this.getFill()!==t){var e=this._instances.length>0;e&&this._fill&&this._fill.removeChangeListener&&this._fill.removeChangeListener(this._fillListener),this._fill=t,e&&this._fill&&this._fill.addChangeListener&&this._fill.addChangeListener(this._fillListener),this.invalidatePaint(),this.invalidateFill()}return this},i.isFillPickable=function(){return this._fillPickable},i.setFillPickable=function(t){return this._fillPickable!==t&&(this._fillPickable=t,this.invalidateFill()),this},i.isFillKept=function(){return this._fillKept},i.setFillKept=function(t){this._fillKept=t};var s=i.firstInstanceAdded;i.firstInstanceAdded=function(){this._fill&&this._fill.addChangeListener&&this._fill.addChangeListener(this._fillListener),s&&s.call(this)};var r=i.lastInstanceRemoved;if(i.lastInstanceRemoved=function(){this._fill&&this._fill.removeChangeListener&&this._fill.removeChangeListener(this._fillListener),r&&r.call(this)},i.beforeCanvasFill=function(t){t.setFillStyle(this._fill),this._fill.transformMatrix&&(t.context.save(),this._fill.transformMatrix.canvasAppendTransform(t.context))},i.afterCanvasFill=function(t){this._fill.transformMatrix&&t.context.restore()},i.getSVGFillStyle=function(){var t="fill: ";return t+=this._fill?this._fill.toCSS?this._fill.toCSS()+";":this._fill.getSVGDefinition?"url(#"+this.getFillId()+");":this._fill+";":"none;"},i.getFillId=function(){return this._fill.id+"-"+this.getId()},i.getCSSFill=function(){return this._fill?this._fill.toCSS?this._fill.toCSS():this._fill:"transparent"},i.addSVGFillDef=function(t,e){var i=this.getFill();if(i&&i.getSVGDefinition){var n=this.getFillId();e.appendChild(i.getSVGDefinition(n))}},i.removeSVGFillDef=function(t,e){var i="fill"+this.getId(),n=t.getElementById(i);n&&!this._fillKept&&e.removeChild(n)},i.appendFillablePropString=function(t,e){return this._fill&&(e&&(e+=",\n"),e+="string"==typeof this._fill?t+"fill: '"+this._fill+"'":t+"fill: "+this._fill.toString()),e},i.getFillRendererBitmask=function(){var t=0;return n&&this._fill&&this._fill.isGradient||(t|=e.bitmaskSupportsSVG),t|=e.bitmaskSupportsCanvas,this._fill?this._fill.isPattern||this._fill.isGradient||(t|=e.bitmaskSupportsDOM,t|=e.bitmaskSupportsWebGL):t|=e.bitmaskSupportsDOM,t},i._mutatorKeys=["fill","fillPickable","fillKept"].concat(i._mutatorKeys),Object.defineProperty(i,"fill",{set:i.setFill,get:i.getFill}),Object.defineProperty(i,"fillPickable",{set:i.setFillPickable,get:i.isFillPickable}),Object.defineProperty(i,"fillKept",{set:i.setFillKept,get:i.isFillKept}),i.invalidateFill){var o=i.invalidateFill;i.invalidateFill=function(){this.invalidateSupportedRenderers(),o.call(this)}}else i.invalidateFill=function(){this.invalidateSupportedRenderers()}};var s=e.Fillable;return s}),i("SCENERY/nodes/Strokable",["require","SCENERY/scenery","KITE/util/LineStyles","PHET_CORE/platform"],function(t){var e=t("SCENERY/scenery"),i=t("KITE/util/LineStyles"),n=t("PHET_CORE/platform"),s=n.ie9;e.Strokable=function(t){var n=t.prototype;n.initializeStrokable=function(){this._stroke=null,this._strokePickable=!1,this._strokeKept=!1,this._lineDrawingStyles=new i;var t=this;this._strokeListener=function(){t.invalidatePaint(),t.invalidateStroke()}},n.hasStroke=function(){return null!==this._stroke},n.getLineWidth=function(){return this._lineDrawingStyles.lineWidth},n.setLineWidth=function(t){return this.getLineWidth()!==t&&(this.markOldSelfPaint(),this._lineDrawingStyles.lineWidth=t,this.invalidateStroke()),this},n.getLineCap=function(){return this._lineDrawingStyles.lineCap},n.setLineCap=function(t){return this._lineDrawingStyles.lineCap!==t&&(this.markOldSelfPaint(),this._lineDrawingStyles.lineCap=t,this.invalidateStroke()),this},n.getLineJoin=function(){return this._lineDrawingStyles.lineJoin},n.setLineJoin=function(t){return this._lineDrawingStyles.lineJoin!==t&&(this.markOldSelfPaint(),this._lineDrawingStyles.lineJoin=t,this.invalidateStroke()),this},n.getLineDash=function(){return this._lineDrawingStyles.lineDash},n.hasLineDash=function(){return!!this._lineDrawingStyles.lineDash.length},n.setLineDash=function(t){return this._lineDrawingStyles.lineDash!==t&&(this.markOldSelfPaint(),this._lineDrawingStyles.lineDash=t||[],this.invalidateStroke()),this},n.getLineDashOffset=function(){return this._lineDrawingStyles.lineDashOffset},n.setLineDashOffset=function(t){return this._lineDrawingStyles.lineDashOffset!==t&&(this.markOldSelfPaint(),this._lineDrawingStyles.lineDashOffset=t,this.invalidateStroke()),this},n.isStrokePickable=function(){return this._strokePickable},n.setStrokePickable=function(t){return this._strokePickable!==t&&(this._strokePickable=t,this.invalidateStroke()),this},n.isStrokeKept=function(){return this._strokeKept},n.setStrokeKept=function(t){this._strokeKept=t},n.setLineStyles=function(t){return this.markOldSelfPaint(),this._lineDrawingStyles=t,this.invalidateStroke(),this},n.getLineStyles=function(){return this._lineDrawingStyles},n.getStroke=function(){return this._stroke},n.setStroke=function(t){if(this.getStroke()!==t){this.markOldSelfPaint();var e=this._instances.length>0;e&&this._stroke&&this._stroke.removeChangeListener&&this._stroke.removeChangeListener(this._strokeListener),this._stroke=t,e&&this._stroke&&this._stroke.addChangeListener&&this._stroke.addChangeListener(this._strokeListener),this.invalidateStroke()}return this};var r=n.firstInstanceAdded;n.firstInstanceAdded=function(){this._stroke&&this._stroke.addChangeListener&&this._stroke.addChangeListener(this._strokeListener),r&&r.call(this)};var o=n.lastInstanceRemoved;if(n.lastInstanceRemoved=function(){this._stroke&&this._stroke.removeChangeListener&&this._stroke.removeChangeListener(this._strokeListener),o&&o.call(this)},n.beforeCanvasStroke=function(t){t.setStrokeStyle(this._stroke),t.setLineWidth(this.getLineWidth()),t.setLineCap(this.getLineCap()),t.setLineJoin(this.getLineJoin()),t.setLineDash(this.getLineDash()),t.setLineDashOffset(this.getLineDashOffset()),this._stroke.transformMatrix&&(t.context.save(),this._stroke.transformMatrix.canvasAppendTransform(t.context))},n.afterCanvasStroke=function(t){this._stroke.transformMatrix&&t.context.restore()},n.getSVGStrokeStyle=function(){if(!this._stroke)return"stroke: none;";var t="stroke: ";return t+=this._stroke.toCSS?this._stroke.toCSS()+";":this._stroke.getSVGDefinition?"url(#"+this.getStrokeId()+");":this._stroke+";",t+="stroke-width: "+this.getLineWidth()+";",t+="stroke-linecap: "+this.getLineCap()+";",t+="stroke-linejoin: "+this.getLineJoin()+";",this.hasLineDash()&&(t+="stroke-dasharray: "+this.getLineDash().join(",")+";",t+="stroke-dashoffset: "+this.getLineDashOffset()+";"),t},n.getStrokeId=function(){return"stroke-"+this._stroke.id+"-"+this.getId()},n.requiresSVGBoundsWorkaround=function(){if(!this._stroke||!this._stroke.getSVGDefinition)return!1;var t=this.computeShapeBounds(!1);return 0===t.x*t.y},n.getSimpleCSSFill=function(){return this._stroke?this._stroke.toCSS?this._stroke.toCSS():this._stroke:"transparent"},n.addSVGStrokeDef=function(t,e){var i=this.getStroke();if(i&&i.getSVGDefinition){var n=this.getStrokeId();e.appendChild(i.getSVGDefinition(n))}},n.removeSVGStrokeDef=function(t,e){var i="stroke"+this.getId(),n=t.getElementById(i);n&&!this._strokeKept&&e.removeChild(n)},n.appendStrokablePropString=function(t,e){function n(i,n,s){e&&(e+=",\n"),e+=s||"string"!=typeof n?t+i+": "+n:t+i+": '"+n+"'"}var s=this;if(this._stroke){var r=new i;"string"==typeof this._stroke?n("stroke",this._stroke):n("stroke",this._stroke.toString(),!0),_.each(["lineWidth","lineCap","lineJoin","lineDashOffset"],function(t){s[t]!==r[t]&&n(t,s[t])}),this.lineDash.length&&n("lineDash",JSON.stringify(this.lineDash),!0)}return e},n.getStrokeRendererBitmask=function(){var t=0;return s&&this.hasStroke()&&this.hasLineDash()||(t|=e.bitmaskSupportsCanvas),t|=e.bitmaskSupportsSVG,this.hasStroke()||(t|=e.bitmaskSupportsDOM),t},n._mutatorKeys=["stroke","lineWidth","lineCap","lineJoin","lineDash","lineDashOffset","strokePickable","strokeKept"].concat(n._mutatorKeys),Object.defineProperty(n,"stroke",{set:n.setStroke,get:n.getStroke}),Object.defineProperty(n,"lineWidth",{set:n.setLineWidth,get:n.getLineWidth}),Object.defineProperty(n,"lineCap",{set:n.setLineCap,get:n.getLineCap}),Object.defineProperty(n,"lineJoin",{set:n.setLineJoin,get:n.getLineJoin}),Object.defineProperty(n,"lineDash",{set:n.setLineDash,get:n.getLineDash}),Object.defineProperty(n,"lineDashOffset",{set:n.setLineDashOffset,get:n.getLineDashOffset}),Object.defineProperty(n,"strokePickable",{set:n.setStrokePickable,get:n.isStrokePickable}),Object.defineProperty(n,"strokeKept",{set:n.setStrokeKept,get:n.isStrokeKept}),n.invalidateStroke){var a=n.invalidateStroke;n.invalidateStroke=function(){this.invalidateSupportedRenderers(),a.call(this)}}else n.invalidateStroke=function(){this.invalidateSupportedRenderers()}};var r=e.Strokable;return r}),i("SCENERY/nodes/Path",["require","PHET_CORE/inherit","KITE/Shape","SCENERY/scenery","SCENERY/nodes/Node","SCENERY/layers/Renderer","SCENERY/nodes/Fillable","SCENERY/nodes/Strokable"],function(t){var e=t("PHET_CORE/inherit"),i=t("KITE/Shape"),n=t("SCENERY/scenery"),s=t("SCENERY/nodes/Node");t("SCENERY/layers/Renderer");var r=t("SCENERY/nodes/Fillable"),o=t("SCENERY/nodes/Strokable");n.Path=function(t,e){this._shape=null,this._strokedShape=null,e=e||{},this.initializeFillable(),this.initializeStrokable(),s.call(this),this.invalidateSupportedRenderers(),this.setShape(t),this.mutate(e)};var a=n.Path;return e(s,a,{getPathRendererBitmask:function(){return n.bitmaskSupportsCanvas|n.bitmaskSupportsSVG},invalidateSupportedRenderers:function(){this.setRendererBitmask(this.getFillRendererBitmask()&this.getStrokeRendererBitmask()&this.getPathRendererBitmask())},setShape:function(t){return this._shape!==t&&("string"==typeof t&&(t=new i(t)),this._shape=t,this.invalidateShape()),this},getShape:function(){return this._shape},getStrokedShape:function(){return this._strokedShape||(this._strokedShape=this.getShape().getStrokedShape(this._lineDrawingStyles)),this._strokedShape},invalidateShape:function(){this.markOldSelfPaint(),this._strokedShape=null,this.hasShape()&&(this.invalidateSelf(this.computeShapeBounds()),this.invalidatePaint())},computeShapeBounds:function(){return this._stroke?this.getStrokedShape().bounds:this.getShape().bounds},getTransformedSelfBounds:function(t){return(this._stroke?this.getStrokedShape():this.getShape()).getBoundsWithTransform(t)},invalidateStroke:function(){this.invalidateShape()},hasShape:function(){return this._shape},paintCanvas:function(t){var e=t.context;this.hasShape()&&(e.beginPath(),this._shape.writeToContext(e),this._fill&&(this.beforeCanvasFill(t),e.fill(),this.afterCanvasFill(t)),this._stroke&&(this.beforeCanvasStroke(t),e.stroke(),this.afterCanvasStroke(t)))},paintWebGL:function(){throw new Error("Path.prototype.paintWebGL unimplemented")},createSVGFragment:function(){return document.createElementNS(n.svgns,"path")},updateSVGFragment:function(t){var e=this.hasShape()?this._shape.getSVGPath():"";e||(e="M0 0"),e?t.setAttribute("d",e):t.hasAttribute("d")&&t.removeAttribute("d"),t.setAttribute("style",this.getSVGFillStyle()+this.getSVGStrokeStyle())},updateSVGDefs:function(t,e){this.removeSVGDefs(t,e),this.addSVGFillDef(t,e),this.addSVGStrokeDef(t,e)},removeSVGDefs:function(t,e){this.removeSVGFillDef(t,e),this.removeSVGStrokeDef(t,e)},isPainted:function(){return!0},containsPointSelf:function(t){var e=!1;return this.hasShape()?(this._fillPickable&&(e=this.getShape().containsPoint(t)),!e&&this._strokePickable&&(e=this.getStrokedShape().containsPoint(t)),e):e},intersectsBoundsSelf:function(t){return this.hasShape()?this._shape.intersectsBounds(t):!1},set shape(t){this.setShape(t)},get shape(){return this.getShape()},getBasicConstructor:function(t){return"new scenery.Path( "+(this._shape?this._shape.toString():this._shape)+", {"+t+"} )"},getPropString:function(t,e){var i=s.prototype.getPropString.call(this,t,e);return i=this.appendFillablePropString(t,i),i=this.appendStrokablePropString(t,i)}}),a.prototype._mutatorKeys=["shape"].concat(s.prototype._mutatorKeys),r(a),o(a),a}),i("SCENERY/nodes/Circle",["require","PHET_CORE/inherit","SCENERY/scenery","DOT/Bounds2","DOT/Matrix3","SCENERY/nodes/Path","KITE/Shape","SCENERY/util/Features"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("DOT/Bounds2"),s=t("DOT/Matrix3"),r=t("SCENERY/nodes/Path"),o=t("KITE/Shape"),a=t("SCENERY/util/Features");i.Circle=function(t,e){"object"==typeof t?(e=t,this._radius=e.radius):(this._radius=t,e=e||{}),r.call(this,null,e)};var h=i.Circle;return e(r,h,{getStrokeRendererBitmask:function(){var t=r.prototype.getStrokeRendererBitmask.call(this);return this.hasStroke()&&!this.getStroke().isGradient&&!this.getStroke().isPattern&&this.getLineWidth()<=this.getRadius()&&(t|=i.bitmaskSupportsDOM),t},getPathRendererBitmask:function(){return i.bitmaskSupportsCanvas|i.bitmaskSupportsSVG|(a.borderRadius?i.bitmaskSupportsDOM:0)},invalidateCircle:function(){this._shape=null,this.invalidateShape()},createCircleShape:function(){return o.circle(0,0,this._radius)},intersectsBoundsSelf:function(t){var e=Math.abs(t.centerX),i=Math.abs(t.centerY),n=t.maxX-e,s=t.maxY-i;return e>n+this._radius||i>s+this._radius?!1:n>=e||s>=i?!0:(e-=n,i-=s,e*e+i*i<=this._radius*this._radius)},paintCanvas:function(t){var e=t.context;e.beginPath(),e.arc(0,0,this._radius,0,2*Math.PI,!1),e.closePath(),this._fill&&(this.beforeCanvasFill(t),e.fill(),this.afterCanvasFill(t)),this._stroke&&(this.beforeCanvasStroke(t),e.stroke(),this.afterCanvasStroke(t))},createSVGFragment:function(){return document.createElementNS(i.svgns,"circle")},updateSVGFragment:function(t){t.setAttribute("r",this._radius),t.setAttribute("style",this.getSVGFillStyle()+this.getSVGStrokeStyle())},domUpdateTransformOnRepaint:!0,getDOMElement:function(){var t=document.createElement("div"),e=document.createElement("div");return t.appendChild(e),t.style.display="block",t.style.position="absolute",t.style.left="0",t.style.top="0",e.style.display="block",e.style.position="absolute",e.style.left="0",e.style.top="0",t},updateDOMElement:function(t){t.style.width=2*this._radius+"px",t.style.height=2*this._radius+"px",t.style[a.borderRadius]=this._radius+"px",t.style.backgroundColor=this.getCSSFill();var e=t.childNodes[0];this.hasStroke()?(e.style.width=2*this._radius-this.getLineWidth()+"px",e.style.height=2*this._radius-this.getLineWidth()+"px",e.style.left=-this.getLineWidth()/2+"px",e.style.top=-this.getLineWidth()/2+"px",e.style.borderStyle="solid",e.style.borderColor=this.getSimpleCSSFill(),e.style.borderWidth=this.getLineWidth()+"px",e.style[a.borderRadius]=this._radius+this.getLineWidth()/2+"px"):e.style.borderStyle="none"},updateCSSTransform:function(t,e){var n=t.getMatrix().timesMatrix(s.translation(-this._radius,-this._radius));i.Util.applyCSSTransform(n,e)},getBasicConstructor:function(t){return"new scenery.Circle( "+this._radius+", {"+t+"} )"},getRadius:function(){return this._radius},setRadius:function(t){return this._radius!==t&&(this._radius=t,this.invalidateCircle()),this},computeShapeBounds:function(){var t=new n(-this._radius,-this._radius,this._radius,this._radius);return this._stroke&&(t=t.dilated(this.getLineWidth()/2)),t},containsPointSelf:function(t){var e,i=t.x*t.x+t.y*t.y,n=!0;if(this._strokePickable){e=this.getLineWidth()/2;var s=this._radius+e;n=n&&s*s>=i}if(this._fillPickable)return this._strokePickable?n:i<=this._radius*this._radius;if(this._strokePickable){var r=this._radius-e;return n&&i>=r*r}return!1},get radius(){return this.getRadius()},set radius(t){return this.setRadius(t)},setShape:function(t){if(null!==t)throw new Error("Cannot set the shape of a scenery.Circle to something non-null");this.invalidateShape()},getShape:function(){return this._shape||(this._shape=this.createCircleShape()),this._shape},hasShape:function(){return!0}}),h.prototype._mutatorKeys=["radius"].concat(r.prototype._mutatorKeys),h}),i("PHET_CORE/escapeHTML",["require","PHET_CORE/core"],function(t){var e=t("PHET_CORE/core");return e.escapeHTML=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/\'/g,"&#x27;").replace(/\//g,"&#x2F;")},e.escapeHTML}),i("SCENERY/nodes/DOM",["require","PHET_CORE/inherit","PHET_CORE/escapeHTML","DOT/Bounds2","SCENERY/scenery","SCENERY/nodes/Node","SCENERY/layers/Renderer","SCENERY/util/Util"],function(t){var e=t("PHET_CORE/inherit"),i=t("PHET_CORE/escapeHTML"),n=t("DOT/Bounds2"),s=t("SCENERY/scenery"),r=t("SCENERY/nodes/Node");t("SCENERY/layers/Renderer"),t("SCENERY/util/Util"),s.DOM=function(t,e){e=e||{},this._interactive=!1,t&&t.jquery&&(t=t[0]),this._container=document.createElement("div"),this._$container=$(this._container),this._$container.css("position","absolute"),this._$container.css("left",0),this._$container.css("top",0),this.invalidateDOMLock=!1,e.element=t,r.call(this,e),this.setRendererBitmask(s.bitmaskSupportsDOM)};var o=s.DOM;return e(r,o,{allowsMultipleDOMInstances:!1,calculateDOMBounds:function(){var t=$(this._element);return new n(0,0,t.width(),t.height())},createTemporaryContainer:function(){var t=document.createElement("div");return $(t).css({display:"hidden",padding:"0 !important",margin:"0 !important",position:"absolute",left:0,top:0,width:65535,height:65535}),t},invalidateDOM:function(){if(!this.invalidateDOMLock){this.invalidateDOMLock=!0;var t=this.createTemporaryContainer();this._container.removeChild(this._element),t.appendChild(this._element),document.body.appendChild(t);var e=this.calculateDOMBounds();this.invalidateSelf(e),this._$container.width(e.getWidth()),this._$container.height(e.getHeight()),document.body.removeChild(t),t.removeChild(this._element),this._container.appendChild(this._element),this.invalidateDOMLock=!1}},getDOMElement:function(){return this._container},updateDOMElement:function(){},updateCSSTransform:function(t){s.Util.applyCSSTransform(t.getMatrix(),this._container)},isPainted:function(){return!0},setElement:function(t){return this._element!==t&&(this._element&&this._container.removeChild(this._element),this._element=t,this._$element=$(t),this._container.appendChild(this._element),this.invalidateDOM()),this},getElement:function(){return this._element},setInteractive:function(t){this._interactive!==t&&(this._interactive=t)},isInteractive:function(){return this._interactive},set element(t){this.setElement(t)},get element(){return this.getElement()},set interactive(t){this.setInteractive(t)},get interactive(){return this.isInteractive()},getBasicConstructor:function(t){return"new scenery.DOM( $( '"+i(this._container.innerHTML.replace(/'/g,"\\'"))+"' ), {"+t+"} )"},getPropString:function(t,e){var i=r.prototype.getPropString.call(this,t,e);return this.interactive&&(i&&(i+=",\n"),i+=t+"interactive: true"),i}}),o.prototype._mutatorKeys=["element","interactive"].concat(r.prototype._mutatorKeys),o}),i("SCENERY/nodes/LayoutBox",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/nodes/Node"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/nodes/Node");i.LayoutBox=function(t){if(n.call(this),this.boundsListener=this.updateLayout.bind(this),this.options=_.extend({orientation:"vertical",spacing:function(){return 0},align:"center",resize:!0},t),"vertical"===this.options.orientation,"number"==typeof this.options.spacing){var e=this.options.spacing;this.options.spacing=function(){return e}}this.inited=!1,this.mutate(this.options),this.inited=!0};var s=i.LayoutBox;return e(n,s,{layout:function(){var t,e=0;if("vertical"===this.options.orientation){var i=_.min(_.map(this.children,function(t){return t.left})),n=_.max(_.map(this.children,function(t){return t.left+t.width})),s=(n+i)/2,r=0;for(e=0;e<this.children.length;e++)t=this.children[e],t.top=r,"left"===this.options.align?t.left=i:"right"===this.options.align?t.right=n:t.centerX=s,r+=t.height+this.options.spacing(t,this.children[e+1])}else{var o=_.min(_.map(this.children,function(t){return t.top
})),a=_.max(_.map(this.children,function(t){return t.top+t.height})),h=(a+o)/2,u=0;for(e=0;e<this.children.length;e++)t=this.children[e],t.left=u,"top"===this.options.align?t.top=o:"bottom"===this.options.align?t.bottom=a:t.centerY=h,u+=t.width+this.options.spacing(t,this.children[e+1])}},updateLayout:function(){this.updatingLayout||(this.updatingLayout=!0,this.layout(),this.updatingLayout=!1)},insertChild:function(t,e){var i=this;this.options.resize&&this.children.forEach(function(t){t.containsEventListener("bounds",i.boundsListener)&&t.removeEventListener("bounds",i.boundsListener)}),n.prototype.insertChild.call(this,t,e),(this.options.resize||!this.inited)&&this.updateLayout(),this.options.resize&&this.children.forEach(function(t){t.containsEventListener("bounds",i.boundsListener)||t.addEventListener("bounds",i.boundsListener)})},removeChildWithIndex:function(t,e){var i=this;this.options.resize&&this.children.forEach(function(t){t.containsEventListener("bounds",i.boundsListener)&&t.removeEventListener("bounds",i.boundsListener)}),n.prototype.removeChildWithIndex.call(this,t,e),(this.options.resize||!this.inited)&&this.updateLayout(),this.options.resize&&this.children.forEach(function(t){t.containsEventListener("bounds",i.boundsListener)||t.addEventListener("bounds",i.boundsListener)})}})}),i("SCENERY/nodes/HBox",["require","PHET_CORE/inherit","SCENERY/nodes/LayoutBox","SCENERY/scenery"],function(t){function e(t){n.call(this,_.extend({},t,{orientation:"horizontal"}))}var i=t("PHET_CORE/inherit"),n=t("SCENERY/nodes/LayoutBox"),s=t("SCENERY/scenery");return s.HBox=e,i(n,e)}),i("SCENERY/util/Font",["require","SCENERY/scenery"],function(t){function e(t){return"number"==typeof t?t+"px":t}var i=t("SCENERY/scenery"),n=["normal","italic","oblique"],s=["normal","small-caps"],r=["normal","bold","bolder","lighter","100","200","300","400","500","600","700","800","900"],o=["normal","ultra-condensed","extra-condensed","condensed","semi-condensed","semi-expanded","expanded","extra-expanded","ultra-expanded"];i.Font=function(t){this._style="normal",this._variant="normal",this._weight="normal",this._stretch="normal",this._size="10px",this._lineHeight="normal",this._family="sans-serif";var i=typeof t;if("string"===i)for(var a=_.filter(t.split(/[\x09\x0A\x0C\x0D\x20]/),function(t){return t.length>0}),h=0;h<a.length;h++){var u=a[h];if("normal"===u);else if(_.contains(n,u))this._style=u;else if(_.contains(s,u))this._variant=u;else if(_.contains(r,u))this._weight=u;else{if(!_.contains(o,u)){var l=u.split(/\//);this._size=l[0],l[1]&&(this._lineHeight=l[1]),this._family=a.slice(h+1).join(" ");break}this._stretch=u}}else"object"===i&&(void 0!==t.style&&(this._style=t.style),void 0!==t.variant&&(this._variant=t.variant),void 0!==t.weight&&(this._weight=""+t.weight),void 0!==t.stretch&&(this._stretch=t.stretch),void 0!==t.size&&(this._size=e(t.size)),void 0!==t.lineHeight&&(this._lineHeight=t.lineHeight),void 0!==t.family&&(this._family=t.family));this._font=this.computeShorthand()};var a=i.Font;return a.prototype={constructor:a,getFont:function(){return this._font},getStyle:function(){return this._style},getVariant:function(){return this._variant},getWeight:function(){return this._weight},getStretch:function(){return this._stretch},getSize:function(){return this._size},getLineHeight:function(){return this._lineHeight},getFamily:function(){return this._family},get font(){return this.getFont()},get style(){return this.getStyle()},get variant(){return this.getVariant()},get weight(){return this.getWeight()},get stretch(){return this.getStretch()},get size(){return this.getSize()},get lineHeight(){return this.getLineHeight()},get family(){return this.getFamily()},copy:function(t){return new a(_.extend({style:this._style,variant:this._variant,weight:this._weight,stretch:this._stretch,size:this._size,lineHeight:this._lineHeight,family:this._family},t))},computeShorthand:function(){var t="";return"normal"!==this._style&&(t+=this._style+" "),"normal"!==this._variant&&(t+=this._variant+" "),"normal"!==this._weight&&(t+=this._weight+" "),"normal"!==this._stretch&&(t+=this._stretch+" "),t+=this._size,"normal"!==this._lineHeight&&(t+="/"+this._lineHeight),t+=" "+this._family},toCSS:function(){return this.getFont()}},a.DEFAULT=new a,a}),i("SCENERY/nodes/Text",["require","PHET_CORE/inherit","PHET_CORE/escapeHTML","DOT/Bounds2","DOT/Matrix3","SCENERY/scenery","SCENERY/nodes/Node","SCENERY/layers/Renderer","SCENERY/nodes/Fillable","SCENERY/nodes/Strokable","SCENERY/util/Font","SCENERY/util/Util"],function(t){function e(t,e,i){var n="get"+e,s="set"+e;v.prototype[n]=function(){return this._font[i]},v.prototype[s]=function(t){var e={};e[i]=t;var n=this._font.copy(e);return this.setFont(n),this},Object.defineProperty(v.prototype,t,{set:v.prototype[s],get:v.prototype[n]})}var i=t("PHET_CORE/inherit"),n=t("PHET_CORE/escapeHTML"),s=t("DOT/Bounds2"),r=t("DOT/Matrix3"),o=t("SCENERY/scenery"),a=t("SCENERY/nodes/Node");t("SCENERY/layers/Renderer");var h=t("SCENERY/nodes/Fillable"),u=t("SCENERY/nodes/Strokable");t("SCENERY/util/Font"),t("SCENERY/util/Util");var l="sceneryTextSizeContainer",c="sceneryTextSizeElement",d=document.getElementById(l),m=document.getElementById(c);d||(d=document.createElementNS(o.svgns,"svg"),d.setAttribute("width","2"),d.setAttribute("height","2"),d.setAttribute("id",l),d.setAttribute("style","visibility: hidden; pointer-events: none; position: absolute; left: -65535; right: -65535;")),m||(m=document.createElementNS(o.svgns,"text"),m.appendChild(document.createTextNode("")),m.setAttribute("dominant-baseline","alphabetic"),m.setAttribute("text-rendering","geometricPrecision"),m.setAttribute("lengthAdjust","spacingAndGlyphs"),m.setAttribute("id",c),d.appendChild(m));var f,g=-1!==window.navigator.userAgent.indexOf("like Gecko) Version/5")&&-1!==window.navigator.userAgent.indexOf("Safari/"),p=!1;o.Text=function(t,e){this._text="",this._font=o.Font.DEFAULT,this._direction="ltr",this._boundsMethod="hybrid",this._isHTML=void 0===this._isHTML?!1:this._isHTML,e=e||{},void 0===e.fill&&(e.fill="#000000"),void 0!==t&&(e.text=t),this.initializeFillable(),this.initializeStrokable(),a.call(this,e),this.updateTextFlags()};var v=o.Text;return i(a,v,{domUpdateTransformOnRepaint:!0,setText:function(t){return t=""+t,t!==this._text&&(this._text=t,this.invalidateText()),this},getText:function(){return this._text},getNonBreakingText:function(){return this._text.replace(" "," ")},setBoundsMethod:function(t){return t!==this._boundsMethod&&(this._boundsMethod=t,this.updateTextFlags(),this.dispatchEvent("boundsAccuracy",{node:this}),this.invalidateText()),this},getBoundsMethod:function(){return this._boundsMethod},getTextRendererBitmask:function(){var t=0;return"fast"===this._boundsMethod||this._isHTML||(t|=o.bitmaskSupportsCanvas),this._isHTML||(t|=o.bitmaskSupportsSVG),t|=o.bitmaskSupportsDOM},invalidateSupportedRenderers:function(){this.setRendererBitmask(this.getFillRendererBitmask()&this.getStrokeRendererBitmask()&this.getTextRendererBitmask())},updateTextFlags:function(){this.boundsInaccurate="accurate"!==this._boundsMethod,this.invalidateSupportedRenderers()},invalidateText:function(){this._isHTML||g&&"accurate"!==this._boundsMethod?this.invalidateSelf(this.approximateDOMBounds()):"hybrid"===this._boundsMethod?this.invalidateSelf(this.approximateHybridBounds()):"fast"===this._boundsMethod||"fastCanvas"===this._boundsMethod?this.invalidateSelf(this.approximateSVGBounds()):this.invalidateSelf(this.accurateCanvasBounds()),this.updateTextFlags()},invalidateStroke:function(){this.invalidateText()},invalidateFill:function(){this.invalidateText()},paintCanvas:function(t){var e=t.context;(this.hasFill()||this.hasStroke())&&(t.setFont(this._font.getFont()),t.setDirection(this._direction)),this.hasFill()&&(this.beforeCanvasFill(t),e.fillText(this._text,0,0),this.afterCanvasFill(t)),this.hasStroke()&&(this.beforeCanvasStroke(t),e.strokeText(this._text,0,0),this.afterCanvasStroke(t))},paintWebGL:function(){throw new Error("Text.prototype.paintWebGL unimplemented")},createSVGFragment:function(){var t=document.createElementNS(o.svgns,"text");return t.appendChild(document.createTextNode("")),t.setAttribute("dominant-baseline","alphabetic"),t.setAttribute("text-rendering","geometricPrecision"),t.setAttribute("lengthAdjust","spacingAndGlyphs"),t.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),t},updateSVGFragment:function(t){t.lastChild.nodeValue=this.getNonBreakingText(),t.setAttribute("style",this.getSVGFillStyle()+this.getSVGStrokeStyle()),t.setAttribute("direction",this._direction),isFinite(this._selfBounds.width)&&t.setAttribute("textLength",this._selfBounds.width),t.setAttribute("font-family",this._font.getFamily()),t.setAttribute("font-size",this._font.getSize()),t.setAttribute("font-style",this._font.getStyle()),t.setAttribute("font-weight",this._font.getWeight()),t.setAttribute("font-stretch",this._font.getStretch())},updateSVGDefs:function(t,e){this.removeSVGDefs(t,e),this.addSVGFillDef(t,e),this.addSVGStrokeDef(t,e)},removeSVGDefs:function(t,e){this.removeSVGFillDef(t,e),this.removeSVGStrokeDef(t,e)},allowsMultipleDOMInstances:!0,getDOMElement:function(){var t=document.createElement("div");return t.style.position="absolute",t},updateDOMElement:function(t){var e=$(t);t.style.font=this.getFont(),t.style.color=this.getCSSFill(),e.width(this.getSelfBounds().width),e.height(this.getSelfBounds().height),e.empty(),t.appendChild(this.getDOMTextNode()),t.setAttribute("dir",this._direction)},updateCSSTransform:function(t,e){var i=this.getSelfBounds().minY,n=t.getMatrix().timesMatrix(r.translation(0,i));o.Util.applyCSSTransform(n,e)},getDOMTextNode:function(){if(this._isHTML){var t=document.createElement("span");return t.innerHTML=this._text,t}return document.createTextNode(this.getNonBreakingText())},accurateCanvasBounds:function(){var t=this,e=this.approximateSVGBounds();return this._text&&0!==e.width?o.Util.canvasAccurateBounds(function(e){e.font=t.font,e.direction=t.direction,e.fillText(t.text,0,0)},{precision:.5,resolution:128,initialScale:32/Math.max(Math.abs(e.minX),Math.abs(e.minY),Math.abs(e.maxX),Math.abs(e.maxY))}):e},approximateCanvasWidth:function(){var t=o.scratchContext;return t.font=this.font,t.direction=this.direction,t.measureText(this.text).width},approximateSVGBounds:function(){if(!d.parentNode){if(!document.body){if(p)return s.NOTHING;throw new Error("No document.body and trying to get approximate SVG bounds of a Text node")}document.body.appendChild(d)}this.updateSVGFragment(m),m.removeAttribute("textLength");var t=m.getBBox();return new s(t.x,t.y,t.x+t.width,t.y+t.height)},approximateHybridBounds:function(){if(!f)return s.NOTHING;void 0===this._font._cachedSVGBounds&&(f.setFont(this._font),this._font._cachedSVGBounds=f.getBounds());var t=this.approximateCanvasWidth(),e=this._font._cachedSVGBounds;return new s(0,e.minY,t,e.maxY)},approximateDOMBounds:function(){var t=1024,e="rtl"===this.direction,i=document.createElement("div");$(i).css({position:"absolute",left:0,top:0,padding:"0 !important",margin:"0 !important",display:"hidden"});var n=document.createElement("span");$(n).css("font",this.getFont()),n.appendChild(this.getDOMTextNode()),n.setAttribute("direction",this._direction);var r=document.createElement("div");$(r).css({"vertical-align":"baseline",display:"inline-block",width:0,height:t+"px",margin:"0 !important",padding:"0 !important"}),i.appendChild(n),i.appendChild(r),document.body.appendChild(i);var o=n.getBoundingClientRect(),a=i.getBoundingClientRect(),h=new s(o.left,o.top-t,o.right+1,o.bottom-t).shifted(-a.left,-a.top);document.body.removeChild(i);var u=o.right-o.left;return h.shiftedX(e?-u:0)},getSafeSelfBounds:function(){var t=1,e=this.getSelfBounds();return e.dilatedXY(t*e.width,t*e.height)},setFont:function(t){return this.font!==t&&(this._font=t instanceof o.Font?t:new o.Font(t),this.invalidateText()),this},getFont:function(){return this._font.getFont()},setDirection:function(t){return this._direction=t,this.invalidateText(),this},getDirection:function(){return this._direction},isPainted:function(){return!0},getBasicConstructor:function(t){return"new scenery.Text( '"+n(this._text.replace(/'/g,"\\'"))+"', {"+t+"} )"},getPropString:function(t,e){function i(e,i,s){n&&(n+=",\n"),n+=s||"string"!=typeof i?t+e+": "+i:t+e+": '"+i+"'"}var n=a.prototype.getPropString.call(this,t,e);return n=this.appendFillablePropString(t,n),n=this.appendStrokablePropString(t,n),this.font!==(new o.Font).getFont()&&i("font",this.font.replace(/'/g,"\\'")),"ltr"!==this._direction&&i("direction",this._direction),n}}),e("fontWeight","FontWeight","weight"),e("fontFamily","FontFamily","family"),e("fontStretch","FontStretch","stretch"),e("fontStyle","FontStyle","style"),e("fontSize","FontSize","size"),e("lineHeight","LineHeight","lineHeight"),v.prototype._mutatorKeys=["boundsMethod","text","font","fontWeight","fontFamily","fontStretch","fontStyle","fontSize","lineHeight","direction"].concat(a.prototype._mutatorKeys),Object.defineProperty(v.prototype,"font",{set:v.prototype.setFont,get:v.prototype.getFont}),Object.defineProperty(v.prototype,"text",{set:v.prototype.setText,get:v.prototype.getText}),Object.defineProperty(v.prototype,"direction",{set:v.prototype.setDirection,get:v.prototype.getDirection}),Object.defineProperty(v.prototype,"boundsMethod",{set:v.prototype.setBoundsMethod,get:v.prototype.getBoundsMethod}),h(v),u(v),p=!0,f=new v("m",{boundsMethod:"fast"}),p=!1,v}),i("SCENERY/nodes/HTMLText",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/nodes/Text"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/nodes/Text");i.HTMLText=function(t,e){this._isHTML=!0,n.call(this,t,e)};var s=i.HTMLText;return e(n,s,{}),s}),i("SCENERY/nodes/drawables/ImageWebGLDrawable",["require","PHET_CORE/inherit","DOT/Matrix4","SCENERY/scenery","SCENERY/util/Util","SCENERY/layers/WebGLLayer"],function(t){var e=t("PHET_CORE/inherit"),i=t("DOT/Matrix4"),n=t("SCENERY/scenery"),s=t("SCENERY/util/Util"),r=t("SCENERY/layers/WebGLLayer");return n.ImageWebGLDrawable=function(t,e){this.imageNode=e,this.gl=t,this.initialize(t)},e(Object,n.ImageWebGLDrawable,{initialize:function(){var t=this.gl;this.texture=null;var e=this.vertexBuffer=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,1]),t.STATIC_DRAW),this.updateImage()},updateImage:function(){var t=this.gl;null!==this.texture&&t.deleteTexture(this.texture);var e=document.createElement("canvas"),i=e.getContext("2d");this.canvasWidth=e.width=s.toPowerOf2(this.imageNode.getImageWidth()),this.canvasHeight=e.height=s.toPowerOf2(this.imageNode.getImageHeight()),i.drawImage(this.imageNode._image,0,0);var n=this.texture=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_NEAREST),t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null)},render:function(t,e){var n=this.gl,s=e.timesMatrix(i.scaling(this.canvasWidth,-this.canvasHeight,1).timesMatrix(i.translation(0,-1)));n.uniformMatrix4fv(t.uniformLocations.uModelViewMatrix,!1,s.entries),n.uniform1i(t.uniformLocations.uTexture,0),n.uniform1i(t.uniformLocations.uFragmentType,r.fragmentTypeTexture),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,this.texture),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer),n.vertexAttribPointer(t.attributeLocations.aVertex,2,n.FLOAT,!1,0,0),n.drawArrays(n.TRIANGLE_STRIP,0,4),n.bindTexture(n.TEXTURE_2D,null)},dispose:function(){this.gl.deleteTexture(this.texture),this.gl.deleteBuffer(this.vertexBuffer)}})}),i("SCENERY/nodes/Image",["require","PHET_CORE/inherit","DOT/Bounds2","SCENERY/scenery","SCENERY/nodes/Node","SCENERY/layers/Renderer","SCENERY/util/Util","SCENERY/nodes/drawables/ImageWebGLDrawable"],function(t){var e=t("PHET_CORE/inherit"),i=t("DOT/Bounds2"),n=t("SCENERY/scenery"),s=t("SCENERY/nodes/Node");t("SCENERY/layers/Renderer"),t("SCENERY/util/Util");var r=t("SCENERY/nodes/drawables/ImageWebGLDrawable");n.Image=function(t,e){e=e||{},t&&(e.image=t);var i=this;this.loadListener=function(){i.invalidateImage(),i._image.removeEventListener("load",i.loadListener)},s.call(this,e),this.invalidateSupportedRenderers()};var o=n.Image;return e(s,o,{allowsMultipleDOMInstances:!1,invalidateImage:function(){this.invalidateSelf(new i(0,0,this.getImageWidth(),this.getImageHeight()))},getImage:function(){return this._image},invalidateSupportedRenderers:function(){this._image instanceof HTMLCanvasElement?this.setRendererBitmask(n.bitmaskSupportsCanvas|n.bitmaskSupportsWebGL):this.setRendererBitmask(n.bitmaskSupportsCanvas|n.bitmaskSupportsSVG|n.bitmaskSupportsDOM|n.bitmaskSupportsWebGL)},setImage:function(t){if(this._image!==t&&("string"!=typeof t||!this._image||t!==this._image.src)){if(this._image&&this._image.removeEventListener("load",this.loadListener),"string"==typeof t){var e=t;t=document.createElement("img"),t.addEventListener("load",this.loadListener),t.src=e}else t instanceof HTMLImageElement&&(t.width&&t.height||t.addEventListener("load",this.loadListener));this.invalidateSupportedRenderers(),this._image=t,this.invalidateImage()}return this},getImageWidth:function(){return this._image.naturalWidth||this._image.width},getImageHeight:function(){return this._image.naturalHeight||this._image.height},getImageURL:function(){return this._image.src},isPainted:function(){return!0},paintCanvas:function(t){t.context.drawImage(this._image,0,0)},createWebGLDrawable:function(t){return new r(t,this)},updateWebGLDrawable:function(t){t.updateImage()},createSVGFragment:function(){var t=document.createElementNS(n.svgns,"image");return t.setAttribute("x",0),t.setAttribute("y",0),t},updateSVGFragment:function(t){t.setAttribute("width",this.getImageWidth()+"px"),t.setAttribute("height",this.getImageHeight()+"px"),t.setAttributeNS(n.xlinkns,"xlink:href",this.getImageURL())},getDOMElement:function(){return this._image.style.display="block",this._image.style.position="absolute",this._image.style.left="0",this._image.style.top="0",this._image},updateDOMElement:function(t){t.src!==this._image.src&&(t.src=this._image.src)},updateCSSTransform:function(t,e){n.Util.applyCSSTransform(t.getMatrix(),e)},set image(t){this.setImage(t)},get image(){return this.getImage()},getBasicConstructor:function(t){return"new scenery.Image( '"+(this._image.src?this._image.src.replace(/'/g,"\\'"):"other")+"', {"+t+"} )"}}),o.prototype._mutatorKeys=["image"].concat(s.prototype._mutatorKeys),o.createSVGImage=function(t,e,i){var s=document.createElementNS(n.svgns,"image");return s.setAttribute("x",0),s.setAttribute("y",0),s.setAttribute("width",e+"px"),s.setAttribute("height",i+"px"),s.setAttributeNS(n.xlinkns,"xlink:href",t),s},o}),i("SCENERY/nodes/LayoutNode",["require","PHET_CORE/inherit","PHET_CORE/extend","SCENERY/scenery","SCENERY/nodes/Node","DOT/Bounds2"],function(t){var e=t("PHET_CORE/inherit"),i=t("PHET_CORE/extend"),n=t("SCENERY/scenery"),s=t("SCENERY/nodes/Node"),r=t("DOT/Bounds2");n.LayoutNode=function(t,e){var n=this;e=i({updateOnBounds:!0,defaultMethod:t},e),this._activelyLayingOut=!1,this._updateOnBounds=!0,this._defaultMethod=null,this._elements=[],this._elementMap={},this._boundsListener=function(){n._updateOnBounds&&n.updateLayout()},s.call(this,e),this.updateLayout()};var o=n.LayoutNode;e(s,o,{get layoutProperties(){return new h(this._elements)},get layoutBounds(){var t=r.NOTHING.copy();return _.each(this._elements,function(e){t.includeBounds(e.layoutBounds)}),t},set defaultMethod(t){return this._defaultMethod=t,this.updateLayout(),this},get defaultMethod(){return this._defaultMethod},set updateOnBounds(t){return this._updateOnBounds=t,this},get updateOnBounds(){return this._updateOnBounds},insertChild:function(t,e,n){var o=this;n=i({useVisibleBounds:!1,padLeft:0,padRight:0,padTop:0,padBottom:0},n),s.prototype.insertChild.call(this,t,e);var a=n.layoutMethod?function(){return n.layoutMethod}:function(){return o._defaultMethod},h=new u(e,a,n.boundsMethod?n.boundsMethod:function(t){return n.useVisibleBounds&&(t=e.visibleBounds),new r(t.minX-n.padLeft,t.minY-n.padTop,t.maxX+n.padRight,t.maxY+n.padBottom)});this.addElement(h),this.updateLayout()},addChild:function(t,e){this.insertChild(this._children.length,t,e)},removeChildWithIndex:function(t,e){s.prototype.removeChildWithIndex.call(this,t,e),this._elementMap[t.id]&&delete this._elementMap[t.id],this.updateLayout()},addElement:function(t){this._elements.push(t),t.node.addEventListener("bounds",this._boundsListener)},removeElement:function(t){this._elements.splice(this._elements.indexOf(t),1),t.node.removeEventListener("bounds",this._boundsListener)},overrideBounds:function(){return this.layoutBounds},updateLayout:function(){if(!this._activelyLayingOut){this._activelyLayingOut=!0;for(var t=this.layoutProperties,e=0;e<this._elements.length;e++){var i=this._elements[e];i.layoutMethod.layout(i,e,e>0?this._elements[e-1]:null,t)}this._activelyLayingOut=!1}}});var a=o.LayoutMethod=function(t){t&&(this.layout=t)};a.prototype={constructor:a,and:function(t){var e=this;return new a(function(i,n,s,r){e.layout(i,n,s,r),t.layout(i,n,s,r)})}},o.Vertical=new a(function(t,e,i){t.layoutTop=i?i.layoutBounds.bottom:0}),o.Horizontal=new a(function(t,e,i){t.layoutLeft=i?i.layoutBounds.right:0}),o.AlignLeft=new a(function(t){t.layoutLeft=0}),o.AlignHorizontalCenter=new a(function(t,e,i,n){t.layoutLeft=(n.maxWidth-t.layoutBounds.width)/2}),o.AlignRight=new a(function(t,e,i,n){t.layoutLeft=n.maxWidth-t.layoutBounds.width}),o.AlignTop=new a(function(t){t.layoutTop=0}),o.AlignVerticalCenter=new a(function(t,e,i,n){t.layoutTop=(n.maxHeight-t.layoutBounds.height)/2}),o.AlignBottom=new a(function(t,e,i,n){t.layoutTop=n.maxHeight-t.layoutBounds.height});var h=o.LayoutProperties=function(t){var e=0,i=0;_.each(t,function(t){e=Math.max(e,t.layoutBounds.width),i=Math.max(i,t.layoutBounds.height)}),this.maxWidth=e,this.maxHeight=i},u=o.LayoutElement=function(t,e,i){this.node=t,this.layoutMethodGetter=e,this.boundsMethod=i};return u.prototype={get bounds(){return this.node.bounds},get layoutBounds(){return this.boundsMethod(this.bounds)},get layoutMethod(){return this.layoutMethodGetter()},get layoutTop(){throw new Error("JSHint wants this getter")},set layoutTop(t){var e=this.bounds.top-this.layoutBounds.top;this.node.top=t+e},get layoutLeft(){throw new Error("JSHint wants this getter")},set layoutLeft(t){var e=this.bounds.left-this.layoutBounds.left;this.node.left=t+e}},o.prototype._mutatorKeys=["defaultMethod","updateOnBounds"].concat(s.prototype._mutatorKeys),o}),i("SCENERY/nodes/Line",["require","PHET_CORE/inherit","SCENERY/scenery","KITE/segments/Line","SCENERY/nodes/Path","KITE/Shape","DOT/Vector2"],function(t){function e(t){var e=t.toLowerCase(),i="get"+t,n="set"+t,s="_"+e;h.prototype[i]=function(){return this[s]},h.prototype[n]=function(t){return this[s]!==t&&(this[s]=t,this.invalidateLine()),this},Object.defineProperty(h.prototype,e,{set:h.prototype[n],get:h.prototype[i]})}var i=t("PHET_CORE/inherit"),n=t("SCENERY/scenery"),s=t("KITE/segments/Line"),r=t("SCENERY/nodes/Path"),o=t("KITE/Shape"),a=t("DOT/Vector2");n.Line=function(t,e,i,n,s){"object"==typeof t?t instanceof a?(this._x1=t.x,this._y1=t.y,this._x2=e.x,this._y2=e.y,s=i||{}):(this._x1=0,this._y1=0,this._x2=0,this._y2=0,s=t||{}):(this._x1=t,this._y1=e,this._x2=i,this._y2=n,s=s||{}),r.call(this,null,s)};var h=n.Line;return i(r,h,{setLine:function(t,e,i,n){this._x1=t,this._y1=e,this._x2=i,this._y2=n,this.invalidateLine()},setPoint1:function(t,e){"number"==typeof t?this.setLine(t,e,this._x2,this._y2):this.setLine(t.x,t.y,this._x2,this._y2)},set p1(t){this.setPoint1(t)},get p1(){return new a(this._x1,this._y1)},setPoint2:function(t,e){"number"==typeof t?this.setLine(this._x1,this._y1,t,e):this.setLine(this._x1,this._y1,t.x,t.y)},set p2(t){this.setPoint2(t)},get p2(){return new a(this._x2,this._y2)},createLineShape:function(){return o.lineSegment(this._x1,this._y1,this._x2,this._y2)},invalidateLine:function(){this._shape=null,this.invalidateShape()},containsPointSelf:function(t){return this._strokePickable?r.prototype.containsPointSelf.call(this,t):!1},intersectsBoundsSelf:function(t){return new s(this.p1,this.p2).intersectsBounds(t)},paintCanvas:function(t){var e=t.context;e.beginPath(),e.moveTo(this._x1,this._y1),e.lineTo(this._x2,this._y2),e.closePath(),this._stroke&&(this.beforeCanvasStroke(t),e.stroke(),this.afterCanvasStroke(t))},computeShapeBounds:function(){return r.prototype.computeShapeBounds.call(this)},createSVGFragment:function(){return document.createElementNS(n.svgns,"line")},updateSVGFragment:function(t){t.setAttribute("x1",this._x1),t.setAttribute("y1",this._y1),t.setAttribute("x2",this._x2),t.setAttribute("y2",this._y2),t.setAttribute("style",this.getSVGFillStyle()+this.getSVGStrokeStyle())},getBasicConstructor:function(t){return"new scenery.Line( "+this._x1+", "+this._y1+", "+this._x1+", "+this._y1+", {"+t+"} )"},setShape:function(t){if(null!==t)throw new Error("Cannot set the shape of a scenery.Line to something non-null");this.invalidateShape()},getShape:function(){return this._shape||(this._shape=this.createLineShape()),this._shape},hasShape:function(){return!0}}),e("X1"),e("Y1"),e("X2"),e("Y2"),h.prototype._mutatorKeys=["p1","p2","x1","y1","x2","y2"].concat(r.prototype._mutatorKeys),h}),i("SCENERY/util/Color",["require","SCENERY/scenery","DOT/Util","DOT/Util"],function(t){function e(t){var e=1;return"%"===t.charAt(t.length-1)&&(e=2.55,t=t.slice(0,t.length-1)),Math.round(parseInt(t,10)*e)}var i=t("SCENERY/scenery"),n=t("DOT/Util").clamp,s=t("DOT/Util").linear;i.Color=function u(t,e,i,n){if(this.listeners=[],"string"==typeof t){var s=t.replace(/ /g,"").toLowerCase(),r=!1,o=u.colorKeywords[s];o&&(s="#"+o);for(var a=0;a<u.formatParsers.length;a++){var h=u.formatParsers[a],l=h.regexp.exec(s);if(l){h.apply(this,l),r=!0;break}}if(!r)throw new Error("scenery.Color unable to parse color string: "+t)}else if(t instanceof u)this.setRGBA(t.r,t.g,t.b,t.a);else{var c=void 0===n?1:n;void 0===e||void 0===i?this.setRGBA(t>>16&&255,t>>8&&255,t>>0&&255,c):this.setRGBA(t,e,i,c)}};var r=i.Color,o="(-?\\d{1,3}%?)",a="(\\d+|\\d*\\.\\d+)",h="(\\d{1,3})";return r.formatParsers=[{regexp:/^transparent$/,apply:function(t){t.setRGBA(0,0,0,0)}},{regexp:/^#(\w{1})(\w{1})(\w{1})$/,apply:function(t,e){t.setRGBA(parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),1)}},{regexp:/^#(\w{2})(\w{2})(\w{2})$/,apply:function(t,e){t.setRGBA(parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),1)}},{regexp:new RegExp("^rgb\\("+o+","+o+","+o+"\\)$"),apply:function(t,i){t.setRGBA(e(i[1]),e(i[2]),e(i[3]),1)}},{regexp:new RegExp("^rgba\\("+o+","+o+","+o+","+a+"\\)$"),apply:function(t,i){t.setRGBA(e(i[1]),e(i[2]),e(i[3]),parseFloat(i[4]))}},{regexp:new RegExp("^hsl\\("+h+","+h+"%,"+h+"%\\)$"),apply:function(t,e){t.setHSLA(parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3],10),1)}},{regexp:new RegExp("^hsla\\("+h+","+h+"%,"+h+"%,"+a+"\\)$"),apply:function(t,e){t.setHSLA(parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3],10),parseFloat(e[4]))}}],r.hueToRGB=function(t,e,i){return 0>i&&(i+=1),i>1&&(i-=1),1>6*i?t+6*(e-t)*i:1>2*i?e:2>3*i?t+6*(e-t)*(2/3-i):t},r.toColor=function(t){return t instanceof r?t:new r(t)},r.prototype={constructor:r,copy:function(){return new r(this.r,this.g,this.b,this.a)},getRed:function(){return this.r},setRed:function(t){return this.setRGBA(t,this.g,this.b,this.a)},get red(){return this.getRed()},set red(t){return this.setRed(t)},getGreen:function(){return this.g},setGreen:function(t){return this.setRGBA(this.r,t,this.b,this.a)},get green(){return this.getGreen()},set green(t){return this.setGreen(t)},getBlue:function(){return this.b},setBlue:function(t){return this.setRGBA(this.r,this.g,t,this.a)},get blue(){return this.getBlue()},set blue(t){return this.setBlue(t)},getAlpha:function(){return this.a},setAlpha:function(t){return this.setRGBA(this.r,this.g,this.b,t)},get alpha(){return this.getAlpha()},set alpha(t){return this.setAlpha(t)},setRGBA:function(t,e,i,s){return this.r=Math.round(n(t,0,255)),this.g=Math.round(n(e,0,255)),this.b=Math.round(n(i,0,255)),this.a=n(s,0,1),this.updateColor(),this},computeCSS:function(){if(1===this.a)return"rgb("+this.r+","+this.g+","+this.b+")";var t=0===this.a||1===this.a?this.a:this.a.toFixed(20);return"rgba("+this.r+","+this.g+","+this.b+","+t+")"},toCSS:function(){return this._css},toNumber:function(){return(this.r<<16)+(this.g<<8)+this.b},updateColor:function(){var t=this._css;if(this._css=this.computeCSS(),t!==this._css&&this.listeners.length)for(var e=this.listeners.slice(0),i=e.length,n=0;i>n;n++)e[n]()},setImmutable:function(){return this},getCanvasStyle:function(){return this.toCSS()},setHSLA:function(t,e,i,s){t=t%360/360,e=n(e/100,0,1),i=n(i/100,0,1);var o,a;return a=.5>i?i*(e+1):i+e-i*e,o=2*i-a,this.r=Math.round(255*r.hueToRGB(o,a,t+1/3)),this.g=Math.round(255*r.hueToRGB(o,a,t)),this.b=Math.round(255*r.hueToRGB(o,a,t-1/3)),this.a=n(s,0,1),this.updateColor(),this},equals:function(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a},withAlpha:function(t){return new r(this.r,this.g,this.b,t)},checkFactor:function(t){if(0>t||t>1)throw new Error("factor must be between 0 and 1: "+t);return void 0===t?.7:t},brighterColor:function(t){t=this.checkFactor(t);var e=Math.min(255,Math.floor(this.r/t)),i=Math.min(255,Math.floor(this.g/t)),n=Math.min(255,Math.floor(this.b/t));return new r(e,i,n,this.a)},colorUtilsBrighter:function(t){t=this.checkFactor(t);var e=Math.min(255,this.getRed()+Math.floor(t*(255-this.getRed()))),i=Math.min(255,this.getGreen()+Math.floor(t*(255-this.getGreen()))),n=Math.min(255,this.getBlue()+Math.floor(t*(255-this.getBlue())));return new r(e,i,n,this.getAlpha())},darkerColor:function(t){t=this.checkFactor(t);var e=Math.max(0,Math.floor(t*this.r)),i=Math.max(0,Math.floor(t*this.g)),n=Math.max(0,Math.floor(t*this.b));return new r(e,i,n,this.a)},colorUtilsDarker:function(t){t=this.checkFactor(t);var e=Math.max(0,this.getRed()-Math.floor(t*this.getRed())),i=Math.max(0,this.getGreen()-Math.floor(t*this.getGreen())),n=Math.max(0,this.getBlue()-Math.floor(t*this.getBlue()));return new r(e,i,n,this.getAlpha())},colorUtilsBrightness:function(t){return 0===t?this:t>0?this.colorUtilsBrighter(t):this.colorUtilsDarker(-t)},addChangeListener:function(t){this.listeners.push(t)},removeChangeListener:function(t){this.listeners.splice(_.indexOf(this.listeners,t),1)},toString:function(){return this.constructor.name+"[r:"+this.r+" g:"+this.g+" b:"+this.b+" a:"+this.a+"]"}},r.basicColorKeywords={aqua:"00ffff",black:"000000",blue:"0000ff",fuchsia:"ff00ff",gray:"808080",green:"008000",lime:"00ff00",maroon:"800000",navy:"000080",olive:"808000",purple:"800080",red:"ff0000",silver:"c0c0c0",teal:"008080",white:"ffffff",yellow:"ffff00"},r.colorKeywords={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"},r.BLACK=new r(0,0,0).setImmutable(),r.BLUE=new r(0,0,255).setImmutable(),r.CYAN=new r(0,255,255).setImmutable(),r.DARK_GRAY=new r(64,64,64).setImmutable(),r.GRAY=new r(128,128,128).setImmutable(),r.GREEN=new r(0,255,0).setImmutable(),r.LIGHT_GRAY=new r(192,192,192).setImmutable(),r.MAGENTA=new r(255,0,255).setImmutable(),r.ORANGE=new r(255,200,0).setImmutable(),r.PINK=new r(255,175,175).setImmutable(),r.RED=new r(255,0,0).setImmutable(),r.WHITE=new r(255,255,255).setImmutable(),r.YELLOW=new r(255,255,0).setImmutable(),r.interpolateRGBA=function(t,e,i){if(0>i||i>1)throw new Error("distance must be between 0 and 1: "+i);
var n=Math.floor(s(0,1,t.r,e.r,i)),o=Math.floor(s(0,1,t.g,e.g,i)),a=Math.floor(s(0,1,t.b,e.b,i)),h=s(0,1,t.a,e.a,i);return new r(n,o,a,h)},r}),i("SCENERY/nodes/drawables/RectangleWebGLDrawable",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/layers/WebGLLayer","SCENERY/util/Color"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/layers/WebGLLayer"),s=t("SCENERY/util/Color");return i.RectangleWebGLDrawable=function(t,e){this.rectangleNode=e,this.gl=t,this.initialize(t)},e(Object,i.RectangleWebGLDrawable,{initialize:function(){var t=this.gl;this.vertexCoordinates=new Float32Array([0,0,1,0,0,1,1,1]),this.buffer=t.createBuffer(),this.updateRectangle()},updateRectangle:function(){var t=this.gl,e=this.rectangleNode;this.vertexCoordinates[0]=e._rectX,this.vertexCoordinates[1]=e._rectY,this.vertexCoordinates[2]=e._rectX+e._rectWidth,this.vertexCoordinates[3]=e._rectY,this.vertexCoordinates[4]=e._rectX,this.vertexCoordinates[5]=e._rectY+e._rectHeight,this.vertexCoordinates[6]=e._rectX+e._rectWidth,this.vertexCoordinates[7]=e._rectY+e._rectHeight,t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,this.vertexCoordinates,t.STATIC_DRAW),this.color=s.toColor(this.rectangleNode._fill)},render:function(t,e){var i=this.gl;i.uniformMatrix4fv(t.uniformLocations.uModelViewMatrix,!1,e.entries),i.uniform1i(t.uniformLocations.uFragmentType,n.fragmentTypeFill),i.uniform4f(t.uniformLocations.uColor,this.color.r/255,this.color.g/255,this.color.b/255,this.color.a),i.bindBuffer(i.ARRAY_BUFFER,this.buffer),i.vertexAttribPointer(t.attributeLocations.aVertex,2,i.FLOAT,!1,0,0),i.drawArrays(i.TRIANGLE_STRIP,0,4)},dispose:function(){this.gl.deleteBuffer(this.buffer)}})}),i("SCENERY/nodes/Rectangle",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/nodes/Path","KITE/Shape","DOT/Bounds2","DOT/Matrix3","SCENERY/util/Features","SCENERY/nodes/drawables/RectangleWebGLDrawable"],function(t){function e(t){var e="getRect"+t,i="setRect"+t,n="_rect"+t;l.prototype[e]=function(){return this[n]},l.prototype[i]=function(t){return this[n]!==t&&(this[n]=t,this.invalidateRectangle()),this},Object.defineProperty(l.prototype,"rect"+t,{set:l.prototype[i],get:l.prototype[e]})}var i=t("PHET_CORE/inherit"),n=t("SCENERY/scenery"),s=t("SCENERY/nodes/Path"),r=t("KITE/Shape"),o=t("DOT/Bounds2"),a=t("DOT/Matrix3"),h=t("SCENERY/util/Features"),u=t("SCENERY/nodes/drawables/RectangleWebGLDrawable");n.Rectangle=function(t,e,i,n,r,a,h){"object"==typeof t?t instanceof o?(this._rectX=t.minX,this._rectY=t.minY,this._rectWidth=t.width,this._rectHeight=t.height,arguments.length<3?(h=e,this._rectArcWidth=0,this._rectArcHeight=0):(h=n,this._rectArcWidth=e,this._rectArcHeight=i)):(h=t,this._rectX=h.rectX||0,this._rectY=h.rectY||0,this._rectWidth=h.rectWidth,this._rectHeight=h.rectHeight,this._rectArcWidth=h.rectArcWidth||0,this._rectArcHeight=h.rectArcHeight||0):arguments.length<6?(this._rectX=t,this._rectY=e,this._rectWidth=i,this._rectHeight=n,this._rectArcWidth=0,this._rectArcHeight=0,h=r||{}):(this._rectX=t,this._rectY=e,this._rectWidth=i,this._rectHeight=n,this._rectArcWidth=r,this._rectArcHeight=a,h=h||{}),s.call(this,null,h)};var l=n.Rectangle;return i(s,l,{getMaximumArcSize:function(){return Math.min(this._rectWidth/2,this._rectHeight/2)},getStrokeRendererBitmask:function(){var t=s.prototype.getStrokeRendererBitmask.call(this);return!this.hasStroke()||this.getStroke().isGradient||this.getStroke().isPattern||("miter"===this.getLineJoin()||"round"===this.getLineJoin()&&h.borderRadius)&&(t|=n.bitmaskSupportsDOM),this.hasStroke()||(t|=n.bitmaskSupportsWebGL),t},getPathRendererBitmask:function(){var t=n.bitmaskSupportsCanvas|n.bitmaskSupportsSVG,e=this.getMaximumArcSize();return(!this.hasStroke()||this.getLineWidth()<=this._rectHeight&&this.getLineWidth()<=this._rectWidth)&&(!this.isRounded()||h.borderRadius&&this._rectArcWidth===this._rectArcHeight)&&this._rectArcHeight<=e&&this._rectArcWidth<=e&&(t|=n.bitmaskSupportsDOM),this.isRounded()||this.hasStroke()&&"round"===this.getLineJoin()||(t|=n.bitmaskSupportsWebGL),t},setRect:function(t,e,i,n,s,r){this._rectX=t,this._rectY=e,this._rectWidth=i,this._rectHeight=n,this._rectArcWidth=s||0,this._rectArcHeight=r||0,this.invalidateRectangle()},setRectBounds:function(t){this.setRect(t.x,t.y,t.width,t.height)},isRounded:function(){return 0!==this._rectArcWidth&&0!==this._rectArcHeight},computeShapeBounds:function(){var t=new o(this._rectX,this._rectY,this._rectX+this._rectWidth,this._rectY+this._rectHeight);return this._stroke&&(t=t.dilated(this.getLineWidth()/2)),t},createRectangleShape:function(){if(this.isRounded()){var t=Math.min(this._rectWidth/2,this._rectHeight/2);return r.roundRectangle(this._rectX,this._rectY,this._rectWidth,this._rectHeight,Math.min(t,this._rectArcWidth),Math.min(t,this._rectArcHeight))}return r.rectangle(this._rectX,this._rectY,this._rectWidth,this._rectHeight)},invalidateRectangle:function(){this._shape=null,this.invalidateShape(),this.invalidateSupportedRenderers()},containsPointSelf:function(t){var e=this._rectX,i=this._rectY,n=this._rectWidth,r=this._rectHeight,o=this._rectArcWidth,a=this._rectArcHeight,h=this.getLineWidth()/2,u=!0;if(this._strokePickable){var c=this.isRounded();if(!c&&"bevel"===this.getLineJoin())return s.prototype.containsPointSelf.call(this,t);var d="miter"===this.getLineJoin()&&!c;u=u&&l.intersects(e-h,i-h,n+2*h,r+2*h,d?0:o+h,d?0:a+h,t)}return this._fillPickable?this._strokePickable?u:l.intersects(e,i,n,r,o,a,t):this._strokePickable?u&&!l.intersects(e+h,i+h,n-2*h,r-2*h,o-h,a-h,t):!1},intersectsBoundsSelf:function(t){return!this.computeShapeBounds().intersection(t).isEmpty()},paintCanvas:function(t){var e=t.context;if(this.isRounded()){e.beginPath();var i=this.getMaximumArcSize(),n=Math.min(this._rectArcWidth,i),s=Math.min(this._rectArcHeight,i),r=this._rectX+n,o=this._rectX+this._rectWidth-n,a=this._rectY+s,h=this._rectY+this._rectHeight-s;n===s?(e.arc(o,a,n,-Math.PI/2,0,!1),e.arc(o,h,n,0,Math.PI/2,!1),e.arc(r,h,n,Math.PI/2,Math.PI,!1),e.arc(r,a,n,Math.PI,3*Math.PI/2,!1)):(e.ellipse(o,a,n,s,0,-Math.PI/2,0,!1),e.ellipse(o,h,n,s,0,0,Math.PI/2,!1),e.ellipse(r,h,n,s,0,Math.PI/2,Math.PI,!1),e.ellipse(r,a,n,s,0,Math.PI,3*Math.PI/2,!1)),e.closePath(),this._fill&&(this.beforeCanvasFill(t),e.fill(),this.afterCanvasFill(t)),this._stroke&&(this.beforeCanvasStroke(t),e.stroke(),this.afterCanvasStroke(t))}else this._fill&&(this.beforeCanvasFill(t),e.fillRect(this._rectX,this._rectY,this._rectWidth,this._rectHeight),this.afterCanvasFill(t)),this._stroke&&(this.beforeCanvasStroke(t),e.strokeRect(this._rectX,this._rectY,this._rectWidth,this._rectHeight),this.afterCanvasStroke(t))},createSVGFragment:function(){return document.createElementNS(n.svgns,"rect")},updateSVGFragment:function(t){if(t.setAttribute("x",this._rectX),t.setAttribute("y",this._rectY),t.setAttribute("width",this._rectWidth),t.setAttribute("height",this._rectHeight),this.isRounded()){var e=this.getMaximumArcSize(),i=Math.min(this._rectArcWidth,e),n=Math.min(this._rectArcHeight,e);t.setAttribute("rx",i),t.setAttribute("ry",n)}else t.setAttribute("rx",0),t.setAttribute("ry",0);t.setAttribute("style",this.getSVGFillStyle()+this.getSVGStrokeStyle())},createWebGLDrawable:function(t){return new u(t,this)},updateWebGLDrawable:function(t){t.updateRectangle()},domUpdateTransformOnRepaint:!0,getDOMElement:function(){var t=document.createElement("div"),e=document.createElement("div");return t.appendChild(e),t.style.display="block",t.style.position="absolute",t.style.left="0",t.style.top="0",e.style.display="block",e.style.position="absolute",e.style.left="0",e.style.top="0",t},updateDOMElement:function(t){var e=Math.min(this._rectArcWidth,this._rectArcHeight);t.style.width=this._rectWidth+"px",t.style.height=this._rectHeight+"px",t.style[h.borderRadius]=e+"px",t.style.backgroundColor=this.getCSSFill();var i=t.childNodes[0];this.hasStroke()?(i.style.width=this._rectWidth-this.getLineWidth()+"px",i.style.height=this._rectHeight-this.getLineWidth()+"px",i.style.left=-this.getLineWidth()/2+"px",i.style.top=-this.getLineWidth()/2+"px",i.style.borderStyle="solid",i.style.borderColor=this.getSimpleCSSFill(),i.style.borderWidth=this.getLineWidth()+"px",i.style[h.borderRadius]=this.isRounded()||"round"===this.getLineJoin()?e+this.getLineWidth()/2+"px":"0"):i.style.borderStyle="none"},updateCSSTransform:function(t,e){var i=t.getMatrix().timesMatrix(a.translation(this._rectX,this._rectY));n.Util.applyCSSTransform(i,e)},getBasicConstructor:function(t){return"new scenery.Rectangle( "+this._rectX+", "+this._rectY+", "+this._rectWidth+", "+this._rectHeight+", "+this._rectArcWidth+", "+this._rectArcHeight+", {"+t+"} )"},setShape:function(t){if(null!==t)throw new Error("Cannot set the shape of a scenery.Rectangle to something non-null");this.invalidateShape()},getShape:function(){return this._shape||(this._shape=this.createRectangleShape()),this._shape},hasShape:function(){return!0}}),e("X"),e("Y"),e("Width"),e("Height"),e("ArcWidth"),e("ArcHeight"),l.prototype._mutatorKeys=["rectX","rectY","rectWidth","rectHeight","rectArcWidth","rectArcHeight"].concat(s.prototype._mutatorKeys),l.intersects=function(t,e,i,n,s,r,o){var a=o.x>=t&&o.x<=t+i&&o.y>=e&&o.y<=e+n;if(!a||0>=s||0>=r)return a;var h=Math.min(i/2,n/2);s=Math.min(h,s),r=Math.min(h,r);var u,l,c=!1;if(o.x<t+i/2?(u=t+s,c=c||o.x>=u):(u=t+i-s,c=c||o.x<=u),c)return!0;if(o.y<e+n/2?(l=e+r,c=c||o.y>=l):(l=e+n-r,c=c||o.y<=l),c)return!0;var d=o.x-u,m=o.y-l;return d/=s,m/=r,d*=d,m*=m,1>=d+m},l.rect=function(t,e,i,n,s){return new l(t,e,i,n,0,0,s)},l.roundedRect=function(t,e,i,n,s,r,o){return new l(t,e,i,n,s,r,o)},l.bounds=function(t,e){return new l(t.minX,t.minY,t.width,t.height,0,0,e)},l.roundedBounds=function(t,e,i,n){return new l(t.minX,t.minY,t.width,t.height,e,i,n)},l}),i("SCENERY/nodes/Plane",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/nodes/Rectangle"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/nodes/Rectangle");i.Plane=function(t){n.call(this,-2e3,-2e3,6e3,6e3,t)};var s=i.Plane;return e(n,s)}),i("SCENERY/nodes/VBox",["require","PHET_CORE/inherit","SCENERY/nodes/LayoutBox","SCENERY/scenery"],function(t){function e(t){n.call(this,_.extend({},t,{orientation:"vertical"}))}var i=t("PHET_CORE/inherit"),n=t("SCENERY/nodes/LayoutBox"),s=t("SCENERY/scenery");return s.VBox=e,i(n,e)}),i("SCENERY/nodes/drawables/WebGLNodeDrawable",["require","PHET_CORE/inherit","SCENERY/scenery"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery");return i.WebGLNodeDrawable=function(t,e){this.webGLNode=e,this.gl=t,this.initialize(t)},e(Object,i.WebGLNodeDrawable,{initialize:function(){this.webGLNode.initialize(this.gl)},render:function(t,e){this.webGLNode.render(this.gl,t,e)},dispose:function(){this.webGLNode.dispose(this.gl)}})}),i("SCENERY/overlays/PointerOverlay",["require","DOT/Matrix3","SCENERY/scenery","SCENERY/util/Trail","SCENERY/util/Util"],function(t){var e=t("DOT/Matrix3"),i=t("SCENERY/scenery");t("SCENERY/util/Trail");var n=t("SCENERY/util/Util");i.PointerOverlay=function(t){var s=this;this.scene=t,this.pointerSVGContainer=document.createElement("div"),this.pointerSVGContainer.style.position="absolute",this.pointerSVGContainer.style.top=0,this.pointerSVGContainer.style.left=0,this.pointerSVGContainer.style["pointer-events"]="none";var r=10,o=1,a=2*(r+o/2),h=a/2;t.addEventListener("resize",function(t){s.pointerSVGContainer.setAttribute("width",t.width),s.pointerSVGContainer.setAttribute("height",t.height),s.pointerSVGContainer.style.clip="rect(0px,"+t.width+"px,"+t.height+"px,0px)"},!1);var u=this.pointerAdded=function(t){if(!t.isKey){var u=document.createElementNS(i.svgns,"svg");u.style.position="absolute",u.style.top=0,u.style.left=0,u.style["pointer-events"]="none",u.setAttribute("width",a),u.setAttribute("height",a);var l=document.createElementNS(i.svgns,"circle");l.setAttribute("cx",r+o/2),l.setAttribute("cy",r+o/2),l.setAttribute("r",r),l.setAttribute("style","fill:black;"),l.setAttribute("opacity",.4);var c=function(){t.isTouch&&(s.pointerSVGContainer.removeChild(u),t.removeInputListener(d))},d={move:function(){t.point&&n.applyCSSTransform(e.translation(t.point.x-h,t.point.y-h),u)},up:c,cancel:c};t.addInputListener(d),d.move(),u.appendChild(l),s.pointerSVGContainer.appendChild(u)}};t.input.addPointerAddedListener(u),t.input&&t.input.mouse&&u(t.input.mouse),t.reindexLayers(),t.$main[0].appendChild(this.pointerSVGContainer)};var s=i.PointerOverlay;return s.prototype={dispose:function(){this.scene.$main[0].removeChild(this.pointerSVGContainer),this.scene.input.removePointerAddedListener(this.pointerAdded)},reindex:function(t){this.pointerSVGContainer.style.zIndex=t}},s}),i("SCENERY/util/AccessibilityPeer",["require","SCENERY/scenery"],function(t){var e=t("SCENERY/scenery"),i=e.AccessibilityPeer=function(t,e,i){var n=this;if(i=i||{},i.tabIndex=i.tabIndex||1,this.element="string"==typeof e?$(e)[0]:e,i.label){this.peerElement=document.createElement("div"),this.element.id="peer-"+t.trail.getUniqueId();var s=document.createElement("label");s.appendChild(document.createTextNode(i.label)),s.setAttribute("for",this.element.id),this.peerElement.appendChild(s),this.peerElement.appendChild(this.element)}else this.peerElement=this.element;this.instance=t,this.trail=t.trail,this.element.setAttribute("tabindex",i.tabIndex),this.element.style.position="absolute";var r=t.getScene();this.clickListener=function(t){i.click&&i.click(t)},this.focusListener=function(){r.focusPeer(n)},this.blurListener=function(){r.blurPeer(n)},this.element.addEventListener("click",this.clickListener),this.element.addEventListener("focus",this.focusListener),this.element.addEventListener("blur",this.blurListener),this.keepPeerBoundsInSync=!0,this.keepPeerBoundsInSync&&(this.boundsSyncListener=this.syncBounds.bind(this),t.getNode().addEventListener("bounds",this.boundsSyncListener),this.syncBounds(),t.getScene().addEventListener("resize",this.boundsSyncListener),window.setTimeout(this.syncBounds.bind(this),30))};return i.prototype={constructor:i,dispose:function(){this.element.removeEventListener("click",this.clickListener),this.element.removeEventListener("focus",this.focusListener),this.element.removeEventListener("blur",this.blurListener),this.keepPeerBoundsInSync&&(this.instance.getNode().removeEventListener("bounds",this.boundsSyncListener),this.instance.getScene().removeEventListener("resize",this.boundsSyncListener))},getGlobalBounds:function(){return this.trail.parentToGlobalBounds(this.trail.lastNode().getBounds()).roundedOut()},syncBounds:function(){var t=this.getGlobalBounds();this.element.style.left=t.x+"px",this.element.style.top=t.y+"px",this.element.style.width=t.width+"px",this.element.style.height=t.height+"px"}},i}),i("SCENERY/util/Gradient",["require","SCENERY/util/Color","SCENERY/scenery"],function(t){t("SCENERY/util/Color");var e=t("SCENERY/scenery"),i=1;e.Gradient=function(t){this.id="gradient"+i++,this.stops=[],this.lastStopRatio=0,this.canvasGradient=t,this.transformMatrix=null};var n=e.Gradient;return n.prototype={constructor:n,isGradient:!0,addColorStop:function(t,i){if(this.lastStopRatio>t)throw new Error("Color stops not specified in the order of increasing ratios");return this.lastStopRatio=t,"string"==typeof i&&(i=new e.Color(i)),this.stops.push({ratio:t,color:i}),this.canvasGradient.addColorStop(t,i.toCSS()),this},setTransformMatrix:function(t){return this.transformMatrix!==t&&(this.transformMatrix=t),this},getCanvasStyle:function(){return this.canvasGradient}},n}),i("SCENERY/util/LinearGradient",["require","SCENERY/scenery","PHET_CORE/inherit","DOT/Vector2","SCENERY/util/Gradient"],function(t){var e=t("SCENERY/scenery"),i=t("PHET_CORE/inherit"),n=t("DOT/Vector2"),s=t("SCENERY/util/Gradient");e.LinearGradient=function(t,i,r,o){var a=void 0===o;this.start=a?t:new n(t,i),this.end=a?i:new n(r,o),s.call(this,e.scratchContext.createLinearGradient(t,i,r,o))};var r=e.LinearGradient;return i(s,r,{isLinearGradient:!0,getSVGDefinition:function(t){var i=document.createElementNS(e.svgns,"linearGradient");return i.setAttribute("id",t),i.setAttribute("gradientUnits","userSpaceOnUse"),i.setAttribute("x1",this.start.x),i.setAttribute("y1",this.start.y),i.setAttribute("x2",this.end.x),i.setAttribute("y2",this.end.y),this.transformMatrix&&i.setAttribute("gradientTransform",this.transformMatrix.getSVGTransform()),_.each(this.stops,function(t){var n=document.createElementNS(e.svgns,"stop");n.setAttribute("offset",t.ratio),n.setAttribute("style","stop-color: "+t.color.withAlpha(1).toCSS()+"; stop-opacity: "+t.color.a.toFixed(20)+";"),i.appendChild(n)}),i},toString:function(){var t="new scenery.LinearGradient( "+this.start.x+", "+this.start.y+", "+this.end.x+", "+this.end.y+" )";return _.each(this.stops,function(e){t+=".addColorStop( "+e.ratio+", '"+e.color.toString()+"' )"}),t}}),r}),i("SCENERY/util/LiveRegion",["require","SCENERY/scenery"],function(t){var e=t("SCENERY/scenery"),i=e.LiveRegion=function(t,e,i){var n=this;this.property=e,i=i||{},i.tabIndex=i.tabIndex||1,this.element=document.createElement("div"),this.element.setAttribute("aria-live","polite"),this.element.setAttribute("role","region"),this.textNode=document.createTextNode(""),this.element.appendChild(this.textNode),this.listener=function(t){n.element.removeChild(n.textNode),n.textNode=document.createTextNode(t),n.element.appendChild(n.textNode)},e.link(this.listener)};return i.prototype={constructor:e.LiveRegion,dispose:function(){this.property.unlink(this.listener)}},i}),i("SCENERY/util/Instance",["require","SCENERY/scenery","SCENERY/util/AccessibilityPeer","SCENERY/util/LiveRegion"],function(t){var e=t("SCENERY/scenery");t("SCENERY/util/AccessibilityPeer"),t("SCENERY/util/LiveRegion");var i=window.has&&window.has("scenery.accessibility");e.Instance=function(t,e,n){this.trail=t,this.layer=e,this.oldLayer=e,this.data={},this.parent=n,this.children=[],this.peers=[],this.liveRegions=[],this.startAffectedLayer=null,this.endAffectedLayer=null,t.setImmutable(),i&&(this.addPeers(),this.addLiveRegions())};var n=e.Instance;return n.prototype={constructor:n,getScene:function(){return this.trail.rootNode()},get scene(){return this.getScene()},getNode:function(){return this.trail.lastNode()},get node(){return this.getNode()},changeLayer:function(t){t!==this.layer&&(this.layer&&(this.layer._instanceCount-=1),this.layer=t,this.layer&&(this.layer._instanceCount+=1))},updateLayer:function(){this.layer!==this.oldLayer&&(this.reindex(),this.oldLayer&&this.oldLayer.removeInstance(this),this.layer&&this.layer.addInstance(this),this.oldLayer=this.layer)},createChild:function(t,i){var n=this.trail.copy().addDescendant(t),s=new e.Instance(n,null,this);return this.insertInstance(i,s),s.getNode().addInstance(s),s},addInstance:function(t){this.children.push(t)},insertInstance:function(t,e){this.children.splice(t,0,e)},removeInstance:function(t){this.children.splice(t,1)},reindex:function(){this.trail.reindex()},dispose:function(){this.layer&&(this.changeLayer(null),this.updateLayer()),this.parent=null,this.children.length=0,this.getNode().removeInstance(this),i&&(this.removePeers(),this.removeLiveRegions())},equals:function(t){return this===t},compare:function(t){return this.trail.compare(t.trail)},getLayerString:function(){return this.layer?this.layer.getName()+"#"+this.layer.getId():"-"},getTrailString:function(){return this.trail.toString()},toString:function(){return"{"+this.getTrailString()+", "+this.getLayerString()+"}"},getAffectedLayers:function(){return this.reindex(),this.getScene().affectedLayers(this.trail)},addPeers:function(){var t=this.getNode(),i=this.getScene(),n=t._peers.length;if(n)for(var s=0;n>s;s++){var r=t._peers[s],o=new e.AccessibilityPeer(this,r.element,r.options);i.addPeer(o),this.peers.push(o)}},removePeers:function(){for(var t=this.getScene(),e=this.peers.length;e--;){var i=this.peers[e];t.removePeer(i),i.dispose()}this.peers.length=0},addLiveRegions:function(){var t=this,i=this.getNode(),n=this.getScene();i._liveRegions.length&&_.each(i._liveRegions,function(i){var s=new e.LiveRegion(t,i.property,i.options);n.addLiveRegion(s),t.liveRegions.push(s)})},removeLiveRegions:function(){var t=this.getScene();_.each(this.liveRegions,function(e){t.removeLiveRegion(e),e.dispose()}),this.peers.length=0},notifyVisibilityChange:function(){for(var t=this.getAffectedLayers(),e=t.length;e--;)t[e].notifyVisibilityChange(this)},notifyOpacityChange:function(){for(var t=this.getAffectedLayers(),e=t.length;e--;)t[e].notifyOpacityChange(this)},notifyClipChange:function(){for(var t=this.getAffectedLayers(),e=t.length;e--;)t[e].notifyClipChange(this)},notifyBeforeSelfChange:function(){this.layer.notifyBeforeSelfChange(this)},notifyBeforeSubtreeChange:function(){for(var t=this.getAffectedLayers(),e=t.length;e--;)t[e].notifyBeforeSubtreeChange(this)},notifyDirtySelfPaint:function(){this.layer.notifyDirtySelfPaint(this)},notifyDirtySubtreePaint:function(){for(var t=this.getAffectedLayers(),e=t.length;e--;)t[e].notifyDirtySubtreePaint(this)},notifyDirtySubtreeBounds:function(){for(var t=this.getAffectedLayers(),e=t.length;e--;)t[e].notifyDirtySubtreeBounds(this)},notifyTransformChange:function(){for(var t=this.getAffectedLayers(),e=t.length;e--;)t[e].notifyTransformChange(this)},notifyBoundsAccuracyChange:function(){this.layer.notifyBoundsAccuracyChange(this)},notifyStitch:function(t){this.getScene().stitch(t)},markForLayerRefresh:function(){this.getScene().markSceneForLayerRefresh(this)},markForInsertion:function(t,e){this.reindex(),this.getScene().markSceneForInsertion(this,t,e)},markForRemoval:function(t,e){this.reindex(),this.getScene().markSceneForRemoval(this,t,e)}},n}),i("SCENERY/util/Pattern",["require","SCENERY/scenery"],function(t){var e=t("SCENERY/scenery"),i=1;e.Pattern=function(t){this.image=t,this.id="pattern"+i++,this.canvasPattern=e.scratchContext.createPattern(t,"repeat"),this.transformMatrix=null};var n=e.Pattern;return n.prototype={constructor:n,isPattern:!0,setTransformMatrix:function(t){return this.transformMatrix=t,this},getCanvasStyle:function(){return this.canvasPattern},getSVGDefinition:function(t){var i=document.createElementNS(e.svgns,"pattern");return i.setAttribute("id",t),i.setAttribute("patternUnits","userSpaceOnUse"),i.setAttribute("patternContentUnits","userSpaceOnUse"),i.setAttribute("x",0),i.setAttribute("y",0),i.setAttribute("width",this.image.width),i.setAttribute("height",this.image.height),this.transformMatrix&&i.setAttribute("patternTransform",this.transformMatrix.getSVGTransform()),i.appendChild(e.Image.createSVGImage(this.image.src,this.image.width,this.image.height)),i},toString:function(){return"new scenery.Pattern( $( '<img src=\""+this.image.src+"\"/>' )[0] )"}},n}),i("SCENERY/util/RadialGradient",["require","SCENERY/scenery","PHET_CORE/inherit","DOT/Vector2","SCENERY/util/Gradient"],function(t){var e=t("SCENERY/scenery"),i=t("PHET_CORE/inherit"),n=t("DOT/Vector2"),s=t("SCENERY/util/Gradient");e.RadialGradient=function(t,i,r,o,a,h){this.start=new n(t,i),this.end=new n(o,a),this.startRadius=r,this.endRadius=h,this.focalPoint=this.start.plus(this.end.minus(this.start).times(this.startRadius/(this.startRadius-this.endRadius))),this.startRadius>=this.endRadius,s.call(this,e.scratchContext.createRadialGradient(t,i,r,o,a,h))};var r=e.RadialGradient;return i(s,r,{isRadialGradient:!0,getSVGDefinition:function(t){function i(t,e,i,n,s){return i+(s-t)*(n-i)/(e-t)}function n(t){var n=s?1-t.ratio:t.ratio;a>0&&(n=i(0,1,a/o,1,n));var r=document.createElementNS(e.svgns,"stop");r.setAttribute("offset",n),r.setAttribute("style","stop-color: "+t.color.withAlpha(1).toCSS()+"; stop-opacity: "+t.color.a.toFixed(20)+";"),h.appendChild(r)}var s=this.startRadius>this.endRadius,r=s?this.start:this.end,o=Math.max(this.startRadius,this.endRadius),a=Math.min(this.startRadius,this.endRadius),h=document.createElementNS(e.svgns,"radialGradient");h.setAttribute("id",t),h.setAttribute("gradientUnits","userSpaceOnUse"),h.setAttribute("cx",r.x),h.setAttribute("cy",r.y),h.setAttribute("r",o),h.setAttribute("fx",this.focalPoint.x),h.setAttribute("fy",this.focalPoint.y),this.transformMatrix&&h.setAttribute("gradientTransform",this.transformMatrix.getSVGTransform());var u;if(s)for(u=this.stops.length-1;u>=0;u--)n(this.stops[u]);else for(u=0;u<this.stops.length;u++)n(this.stops[u]);return h},toString:function(){var t="new scenery.RadialGradient( "+this.start.x+", "+this.start.y+", "+this.startRadius+", "+this.end.x+", "+this.end.y+", "+this.endRadius+" )";return _.each(this.stops,function(e){t+=".addColorStop( "+e.ratio+", '"+e.color.toString()+"' )"}),t}}),r}),i("SCENERY/util/RenderInterval",["require","SCENERY/scenery","SCENERY/util/Trail"],function(t){var e=t("SCENERY/scenery");t("SCENERY/util/Trail"),e.RenderInterval=function(t,e){this.start=t,this.end=e};var i=e.RenderInterval;return i.compareDisjoint=function(t,e){return t.start||e.start?t.start&&e.start?t.start.compare(e.start):t.start?1:-1:0},i.prototype={constructor:i,reindex:function(){this.start&&this.start.reindex(),this.end&&this.end.reindex()},isValidExclusive:function(){return!this.start||!this.end||this.start.compare(this.end)<0},exclusiveUnionable:function(t){return!(this.start&&t.end&&-1!==this.start.compare(t.end)||this.end&&t.start&&1!==this.end.compare(t.start))},exclusiveContains:function(t){return(!this.start||this.start.compare(t)<0)&&(!this.end||this.end.compare(t)>0)},union:function(t){var e=!this.start||t.start&&-1===this.start.compare(t.start),n=!this.end||t.end&&1===this.end.compare(t.end);return new i(e?this.start:t.start,n?this.end:t.end)},toString:function(){return"["+(this.start?this.start.toString():this.start)+","+(this.end?this.end.toString():this.end)+"]"}},i}),i("SCENERY/util/SceneImage",["require","SCENERY/scenery"],function(t){var e=t("SCENERY/scenery");e.SceneImage=function(t){this.scene=t,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.img=document.createElement("img"),this.update()};var i=e.SceneImage;return i.prototype={constructor:i,update:function(t){var e=this;this.scene.updateScene(),this.canvas.width=this.scene.getSceneWidth(),this.canvas.height=this.scene.getSceneHeight(),this.scene.renderToCanvas(this.canvas,this.context,function(){var i=e.toDataURL();e.img.onload=function(){t(),delete e.img.onload},e.img.src=i})}},i}),i("SCENERY/util/SceneryStyle",["require","SCENERY/scenery"],function(t){t("SCENERY/scenery");var e=document.createElement("style");e.type="text/css",document.head.appendChild(e);var i=document.styleSheets[document.styleSheets.length-1];return{stylesheet:i,styleElement:e,addRule:function(t){this.stylesheet.insertRule(t,0)}}}),i("SCENERY/overlays/PointerAreaOverlay",["require","KITE/Shape","SCENERY/scenery","SCENERY/util/Trail"],function(t){var e=t("KITE/Shape"),i=t("SCENERY/scenery");t("SCENERY/util/Trail"),i.PointerAreaOverlay=function(t){function e(t,e){n.setAttribute("width",t),n.setAttribute("height",e),n.style.clip="rect(0px,"+t+"px,"+e+"px,0px)"}this.scene=t;var n=this.svg=document.createElementNS(i.svgns,"svg");n.style.position="absolute",n.style.top=0,n.style.left=0,n.style["pointer-events"]="none",t.addEventListener("resize",function(t){e(t.width,t.height)}),e(t.getSceneWidth(),t.getSceneHeight()),t.$main[0].appendChild(n),t.reindexLayers()};var n=i.PointerAreaOverlay;return n.prototype={dispose:function(){this.scene.$main[0].removeChild(this.svg)},reindex:function(t){this.svg.style.zIndex=t},addShape:function(t,e,n){var s=document.createElementNS(i.svgns,"path"),r=t.getSVGPath();r||(r="M0 0"),r?s.setAttribute("d",r):s.hasAttribute("d")&&s.removeAttribute("d"),s.setAttribute("style","fill: none; stroke: "+e+"; stroke-dasharray: 5, 3; stroke-dashoffset: "+(n?5:0)+"; stroke-width: 3;"),this.svg.appendChild(s)},update:function(){for(var t=this,n=this.svg,s=this.scene;n.childNodes.length;)n.removeChild(n.childNodes[n.childNodes.length-1]);new i.Trail(s).eachTrailUnder(function(i){var n=i.lastNode();if(!n.isVisible())return!0;if((n._mouseArea||n._touchArea)&&i.isVisible()){var s=i.getTransform();n._mouseArea&&t.addShape(s.transformShape(n._mouseArea.isBounds?e.bounds(n._mouseArea):n._mouseArea),"rgba(0,0,255,0.8)",!0),n._touchArea&&t.addShape(s.transformShape(n._touchArea.isBounds?e.bounds(n._touchArea):n._touchArea),"rgba(255,0,0,0.8)",!1)}})}},n}),i("SCENERY/Scene",["require","PHET_CORE/inherit","DOT/Bounds2","DOT/Vector2","DOT/Matrix3","KITE/Shape","SCENERY/scenery","SCENERY/nodes/Node","SCENERY/util/Instance","SCENERY/util/Trail","SCENERY/util/RenderInterval","SCENERY/util/TrailPointer","SCENERY/input/Input","SCENERY/layers/LayerBuilder","SCENERY/layers/Renderer","SCENERY/overlays/PointerAreaOverlay","SCENERY/overlays/PointerOverlay","SCENERY/util/Util"],function(t){function e(t){for(var i=t.getNode(),n=i._children.length,s=0;n>s;s++)e(t.createChild(i._children[s],s))}function i(t,e){e.allowSceneOverflow||t.css("overflow","hidden"),t.css("-ms-touch-action","none"),e.allowCSSHacks&&function(){var e=["-webkit-","-moz-","-ms-","-o-",""],i={userSelect:"none",touchCallout:"none",touchAction:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"};_.each(e,function(e){_.each(i,function(i,n){t.css(e+n,i)})})}()}var n=t("PHET_CORE/inherit"),s=t("DOT/Bounds2"),r=t("DOT/Vector2"),o=t("DOT/Matrix3"),a=t("KITE/Shape"),h=t("SCENERY/scenery"),u=t("SCENERY/nodes/Node");t("SCENERY/util/Instance"),t("SCENERY/util/Trail"),t("SCENERY/util/RenderInterval"),t("SCENERY/util/TrailPointer"),t("SCENERY/input/Input"),t("SCENERY/layers/LayerBuilder"),t("SCENERY/layers/Renderer"),t("SCENERY/overlays/PointerAreaOverlay"),t("SCENERY/overlays/PointerOverlay");var l=t("SCENERY/util/Util"),c=window.has&&window.has("scenery.accessibility"),d=!0;h.Scene=function(t,e){this.$main=t,this.main=t[0],this.main.scene=this,this.scenery=h,e=_.extend({allowSceneOverflow:!1,allowCSSHacks:!0,allowDevicePixelRatioScaling:!1,enablePointerEvents:!0,preferredSceneLayerType:h.CanvasDefaultLayerType,width:t.width(),height:t.height(),webglMakeLostContextSimulatingCanvas:!1,webglContextLossIncremental:!1,allowWebGL:!0},e||{}),this.usingWebGL=e.allowWebGL&&l.isWebGLSupported,this.backingScale=e.allowDevicePixelRatioScaling?l.backingScale(document.createElement("canvas").getContext("2d")):1,this.enablePointerEvents=e.enablePointerEvents,u.call(this,e);var n=this;window.debugScene=n,this.layers=[],this.layerChangeIntervals=[],this.lastCursor=null,this.defaultCursor=t.css("cursor"),this.setSize(e.width,e.height),this.sceneBounds=new s(0,0,e.width,e.height),this.rootInstance=new h.Instance(new h.Trail(this),null,null),this.addInstance(this.rootInstance),this.preferredSceneLayerType=e.preferredSceneLayerType,i(t,e),this.webglMakeLostContextSimulatingCanvas=e.webglMakeLostContextSimulatingCanvas,this.webglContextLossIncremental=e.webglContextLossIncremental,c&&(this.activePeer=null,this.accessibilityLayer=document.createElement("div"),this.accessibilityLayer.className="accessibility-layer",this.accessibilityLayer.style.zIndex=-1,this.accessibilityLayer.style.position="relative",t[0].appendChild(this.accessibilityLayer),this.focusRingSVGContainer=document.createElementNS(h.svgns,"svg"),this.focusRingSVGContainer.style.position="absolute",this.focusRingSVGContainer.style.top=0,this.focusRingSVGContainer.style.left=0,this.focusRingSVGContainer.style["pointer-events"]="none",this.resizeFocusRingSVGContainer(e.width,e.height),this.focusRingPath=document.createElementNS(h.svgns,"path"),this.focusRingPath.setAttribute("style","fill: none; stroke: blue; stroke-width: 5;"),this.focusRingPath.setAttribute("id","p1"),this.focusRingSVGContainer.appendChild(this.focusRingPath),t[0].appendChild(this.focusRingSVGContainer),this.updateFocusRing=function(){n.focusRingPath.setAttribute("d",a.bounds(n.activePeer.getGlobalBounds()).getSVGPath())},this.liveRegionLayer=document.createElement("div"),this.liveRegionLayer.className="live-region-layer",this.liveRegionLayer.style.zIndex=-2,this.liveRegionLayer.style.position="relative",t[0].appendChild(this.liveRegionLayer))
};var m=h.Scene;return n(u,m,{updateScene:function(t){var e=this;if(this.input&&this.input.validatePointers(),this.validateBounds(),this.validatePaint(),this.layers.length){for(var i=this.layers.length;i--;)this.layers[i].render(e,t);this.updateCursor(),this.mouseTouchAreaOverlay&&this.mouseTouchAreaOverlay.update()}},renderScene:function(){this.updateScene()},addPeer:function(t){this.accessibilityLayer.appendChild(t.peerElement)},removePeer:function(t){this.accessibilityLayer.removeChild(t.peerElement)},addLiveRegion:function(t){this.liveRegionLayer.appendChild(t.element)},removeLiveRegion:function(t){this.liveRegionLayer.removeChild(t.element)},setActivePeer:function(t){this.activePeer!==t&&(this.activePeer&&this.activePeer.instance.node.removeEventListener("bounds",this.updateFocusRing),this.activePeer=t,t?(this.activePeer.instance.node.addEventListener("bounds",this.updateFocusRing),this.updateFocusRing()):this.focusRingPath.setAttribute("d","M 0 0"))},getActivePeer:function(){return this.activePeer},focusPeer:function(t){this.setActivePeer(t)},blurPeer:function(){this.setActivePeer(null)},markInterval:function(t){t.reindex();for(var e=t.previousPainted(),i=new h.TrailPointer(t.copy(),!1);i.hasTrail()&&(!i.isBefore||!i.trail.isPainted());)i.nestedForwards();var n=i.trail;this.addLayerChangeInterval(new h.RenderInterval(e,n))},addLayerChangeInterval:function(t){for(var e=0;e<this.layerChangeIntervals.length;e++){var i=this.layerChangeIntervals[e];i.reindex(),t.exclusiveUnionable(i)&&(t=t.union(i),this.layerChangeIntervals.splice(e--,1))}this.layerChangeIntervals.push(t)},createLayer:function(t,e,i,n){var s=t.createLayer(_.extend({startBoundary:i,endBoundary:n},e));return s.type=t,s},insertLayer:function(t){for(var e=0;e<this.layers.length;e++)if(t.endPaintedTrail.isBefore(this.layers[e].startPaintedTrail))return this.layers.splice(e,0,t),void 0;this.layers.push(t)},getBoundaries:function(){return[this.layers[0].startBoundary].concat(_.pluck(this.layers,"endBoundary"))},calculateBoundaries:function(t,e,i){var n=new h.LayerBuilder(this,t,e,i);return this.preferredSceneLayerType&&n.pushPreferredLayerType(this.preferredSceneLayerType),n.run(),n.boundaries},stitch:function(t){var e,i=this;if(this.layerChangeIntervals.length){var n={affectedInstances:[],newLayers:[]},s={$main:this.$main,scene:this,baseNode:this};for(e=this.layerChangeIntervals.length;e--;)this.layerChangeIntervals[e].reindex();for(this.layerChangeIntervals.sort(h.RenderInterval.compareDisjoint),e=0;e<this.layerChangeIntervals.length;e++){var r=this.layerChangeIntervals[e],o=r.start,a=r.end,u=o?o.getInstance():null,l=a?a.getInstance():null,c=u?u.layer:null,d=l?l.layer:null,m=this.calculateBoundaries(c?c.type:null,o,a);this.stitchInterval(n,s,o,a,c,d,m,t)}for(this.layerChangeIntervals.length=0,e=this.layers.length;e--;){var f=this.layers[e];f.startBoundary.reindex(),f.endBoundary.reindex(),0===f._instanceCount&&this.disposeLayer(f)}for(e=n.newLayers.length;e--;){var g=n.newLayers[e];g.startBoundary.reindex(),g.endBoundary.reindex(),i.insertLayer(g)}this.reindexLayers();var p=n.affectedInstances.length;for(e=0;p>e;e++)n.affectedInstances[e].updateLayer()}},stitchInterval:function(t,e,i,n,s,r,o,a){function u(){for(var e=T.length,i=0;e>i;i++){var n=T[i];n.changeLayer(b),t.affectedInstances.push(n)}T.length=0}function l(i,n){b=p.createLayer(C,e,i,n),t.newLayers.push(b)}function c(t,e){if(t&&t.setImmutable(),E&&E.equivalentPreviousTrail(S)&&((b||w)&&(b?b.setEndBoundary(E):R?(R.setStartBoundary(w),R.setEndBoundary(E),b=R):l(w,E),u()),b=null,C=E.nextLayerType,w=E,R=null,_++,E=o[_]),t&&!e&&T.push(t.getInstance()),a&&!e){var i=t.getInstance().layer;i.type!==C||d||(R=i)}S=t}function m(t){}function f(t){c(t,!1)}function g(e){if(c(e,!0),s!==r&&0===o.length){s.setEndBoundary(r.endBoundary),b=s,u();for(var i=r._layerTrails.length,a=0;i>a;a++){var d=r._layerTrails[a];d.reindex();var m=d.getInstance();m.changeLayer(s),t.affectedInstances.push(m)}}else s&&s===r&&o.length>0?(l(w,v),u(),b.endPaintedTrail.reindex(),h.Trail.eachPaintedTrailBetween(n,b.endPaintedTrail,function(e){var i=e.getInstance();i.changeLayer(b),t.affectedInstances.push(i)},!1,p)):(s||r||1!==o.length||o[0].hasNext()||o[0].hasPrevious())&&(b=r,b&&w&&b.setStartBoundary(w),u())}var p=this;i&&i.setImmutable(),n&&n.setImmutable();var v=r?r.endBoundary:null,y=i?new h.TrailPointer(i,!0):new h.TrailPointer(new h.Trail(this),!0),x=n?new h.TrailPointer(n,!0):new h.TrailPointer(new h.Trail(this),!1),_=0,E=o[_],T=[],S=i,b=s,C=s?s.type:null,w=null,R=null;m(i),y.eachTrailBetween(x,function(t){!t.isPainted()||i&&t.equals(i)||f(t.copy())}),g(n)},rebuildLayers:function(){this.markInterval(new h.Trail(this)),this.stitch(!0)},reindexLayers:function(){var t=1;c&&this.accessibiltyLayer&&(this.accessibilityLayer.style.zIndex=9999,t++);for(var e=this.layers.length,i=0;e>i;i++)t=this.layers[i].reindex(t);c&&this.focusRingSVGContainer&&(this.focusRingSVGContainer.style.zIndex=t++),this.mouseTouchAreaOverlay&&this.mouseTouchAreaOverlay.reindex(t++),this.pointerOverlay&&this.pointerOverlay.reindex(t++)},dispose:function(){this.disposeLayers(),this.input&&this.input.disposeListeners(),delete this.main.scene},disposeLayer:function(t){t.dispose(),this.layers.splice(_.indexOf(this.layers,t),1)},disposeLayers:function(){for(var t=this.layers.length;t--;)this.disposeLayer(this.layers[t])},affectedLayers:function(t){var e=this.layers.length;if(0===e)return[];for(var i,n=this.layers,s=-1,r=e;r-1>s;){i=r+s>>1;var o=n[i].endPaintedTrail,a=1!==h.TrailPointer.compareNested(t,!0,o,!0);a?r=i:s=i}var u=r;for(s=-1,r=e;r-1>s;){i=r+s>>1;var l=n[i].startPaintedTrail;l.reindex();var c=-1!==h.TrailPointer.compareNested(t,!1,l,!0);c?s=i:r=i}var d=s;return n.slice(u,d+1)},renderToCanvas:function(t,e,i){var n=0,s=!1,r={increment:function(){n++},decrement:function(){n--,0===n&&i&&s&&i()}};e.clearRect(0,0,t.width,t.height);for(var o=this.layers.length,a=0;o>a;a++)this.layers[a].renderToCanvas(t,e,r);0===n?i&&i():s=!0},canvasDataURL:function(t){this.canvasSnapshot(function(e){t(e.toDataURL())})},canvasSnapshot:function(t){var e=document.createElement("canvas");e.width=this.sceneBounds.getWidth(),e.height=this.sceneBounds.getHeight();var i=e.getContext("2d");this.renderToCanvas(e,i,function(){t(e,i.getImageData(0,0,e.width,e.height))})},setSize:function(t,e){this.$main.width(t),this.$main.height(e),this.$main.css("clip","rect(0px,"+t+"px,"+e+"px,0px)"),this.sceneBounds=new s(0,0,t,e)},resize:function(t,e){(this.sceneBounds.width!==t||this.sceneBounds.height!==e)&&(this.setSize(t,e),this.rebuildLayers(),c&&(this.resizeAccessibilityLayer(t,e),this.resizeFocusRingSVGContainer(t,e),this.updateFocusRing&&this.activePeer&&this.updateFocusRing()),this.input&&this.input.validatePointers(),this.fireEvent("resize",{width:t,height:e}))},resizeAccessibilityLayer:function(t,e){this.accessibilityLayer&&(this.accessibilityLayer.setAttribute("width",t),this.accessibilityLayer.setAttribute("height",e),this.accessibilityLayer.style.clip="rect(0px,"+t+"px,"+e+"px,0px)")},resizeFocusRingSVGContainer:function(t,e){this.focusRingSVGContainer&&(this.focusRingSVGContainer.setAttribute("width",t),this.focusRingSVGContainer.setAttribute("height",e),this.focusRingSVGContainer.style.clip="rect(0px,"+t+"px,"+e+"px,0px)")},getSceneWidth:function(){return this.sceneBounds.getWidth()},getSceneHeight:function(){return this.sceneBounds.getHeight()},markSceneForLayerRefresh:function(t){this.markInterval(t.trail)},markSceneForInsertion:function(t,i,n){var s=t.trail.copy().addDescendant(i),r=t.createChild(i,n);e(r),this.markInterval(s)},markSceneForRemoval:function(t,e,i){var n=t.trail.copy().addDescendant(e);this.markInterval(n);var s=[t.children[i]];for(t.removeInstance(i);s.length;){var r=s.pop();Array.prototype.push.apply(s,r.children),r.dispose()}},updateCursor:function(){if(this.input&&this.input.mouse&&this.input.mouse.point){if(this.input.mouse.cursor)return this.setSceneCursor(this.input.mouse.cursor);var t=this.trailUnderPoint(this.input.mouse.point,{isMouse:!0});if(t)for(var e=t.length-1;e>=0;e--){var i=t.nodes[e].getCursor();if(i)return this.setSceneCursor(i)}}this.setSceneCursor(this.defaultCursor)},setSceneCursor:function(t){if(t!==this.lastCursor){this.lastCursor=t;var e=m.customCursors[t];if(e)for(var i=e.length-1;i>=0;i--)this.main.style.cursor=e[i];else this.main.style.cursor=t}},updateOnRequestAnimationFrame:function(t){var e=this;!function i(){window.requestAnimationFrame(i,t),e.updateScene()}()},initializeStandaloneEvents:function(t){var e=this.$main[0];this.initializeEvents(_.extend({},{listenerTarget:e,pointFromEvent:function(t){var i=e.getBoundingClientRect();return r.createFromPool(t.clientX-i.left,t.clientY-i.top)}},t))},initializeFullscreenEvents:function(t){var e=this.$main[0];this.initializeEvents(_.extend({},{listenerTarget:document,pointFromEvent:function(t){var i=e.getBoundingClientRect();return r.createFromPool(t.clientX-i.left,t.clientY-i.top)}},t))},initializeWindowEvents:function(t){this.initializeEvents(_.extend({},{listenerTarget:window,pointFromEvent:function(t){return r.createFromPool(t.clientX,t.clientY)}},t))},initializeEvents:function(t){function e(t){return t.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_TOUCH?"touch":t.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_PEN?"pen":t.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_MOUSE?"mouse":t.pointerType}function i(t,e){for(var i=0;i<t.changedTouches.length;i++){var n=t.changedTouches.item(i);e(n.identifier,s(n))}}var n=this;if(n.input)throw new Error("Attempt to attach events twice to the scene");var s=t.pointFromEvent,r=t.listenerTarget,o=t.batchDOMEvents,a=new h.Input(n,r,!!o);n.input=a;var u=window.navigator&&window.navigator.pointerEnabled,l=window.navigator&&window.navigator.msPointerEnabled;this.enablePointerEvents&&u?(a.addListener("pointerdown",function(t){a.pointerDown(t.pointerId,t.pointerType,s(t),t)}),a.addListener("pointerup",function(t){a.pointerUp(t.pointerId,t.pointerType,s(t),t)}),a.addListener("pointermove",function(t){a.pointerMove(t.pointerId,t.pointerType,s(t),t)}),a.addListener("pointerover",function(t){a.pointerOver(t.pointerId,t.pointerType,s(t),t)}),a.addListener("pointerout",function(t){a.pointerOut(t.pointerId,t.pointerType,s(t),t)}),a.addListener("pointercancel",function(t){a.pointerCancel(t.pointerId,t.pointerType,s(t),t)}),a.addImmediateListener("pointerup",function(t){a.pointerUpImmediate(t.pointerId,t.pointerType,s(t),t)})):this.enablePointerEvents&&l?(a.addListener("MSPointerDown",function(t){a.pointerDown(t.pointerId,e(t),s(t),t)}),a.addListener("MSPointerUp",function(t){a.pointerUp(t.pointerId,e(t),s(t),t)}),a.addListener("MSPointerMove",function(t){a.pointerMove(t.pointerId,e(t),s(t),t)}),a.addListener("MSPointerOver",function(t){a.pointerOver(t.pointerId,e(t),s(t),t)}),a.addListener("MSPointerOut",function(t){a.pointerOut(t.pointerId,e(t),s(t),t)}),a.addListener("MSPointerCancel",function(t){a.pointerCancel(t.pointerId,e(t),s(t),t)}),a.addImmediateListener("MSPointerUp",function(t){a.pointerUpImmediate(t.pointerId,e(t),s(t),t)})):(a.addListener("mousedown",function(t){a.mouseDown(s(t),t)}),a.addListener("mouseup",function(t){a.mouseUp(s(t),t)}),a.addListener("mousemove",function(t){a.mouseMove(s(t),t)}),a.addListener("mouseover",function(t){a.mouseOver(s(t),t)}),a.addListener("mouseout",function(t){a.mouseOut(s(t),t)}),a.addImmediateListener("mouseup",function(t){a.mouseUpImmediate(s(t),t)}),a.addListener("touchstart",function(t){i(t,function(e,i){a.touchStart(e,i,t)})}),a.addListener("touchend",function(t){i(t,function(e,i){a.touchEnd(e,i,t)})}),a.addListener("touchmove",function(t){i(t,function(e,i){a.touchMove(e,i,t)})}),a.addListener("touchcancel",function(t){i(t,function(e,i){a.touchCancel(e,i,t)})}),a.addImmediateListener("touchend",function(t){i(t,function(e,i){a.touchEndImmediate(e,i,t)})})),a.addListener("keyup",function(t){a.keyUp(t)}),a.addListener("keydown",function(t){a.keyDown(t)}),a.addListener("keypress",function(t){a.keyPress(t)})},setPointerDisplayVisible:function(t){t&&!this.pointerOverlay?this.pointerOverlay=new h.PointerOverlay(this):!t&&this.pointerOverlay&&(this.pointerOverlay.dispose(),delete this.pointerOverlay)},setPointerAreaDisplayVisible:function(t){t&&!this.mouseTouchAreaOverlay?this.mouseTouchAreaOverlay=new h.PointerAreaOverlay(this):!t&&this.mouseTouchAreaOverlay&&(this.mouseTouchAreaOverlay.dispose(),delete this.mouseTouchAreaOverlay)},getTrailFromKeyboardFocus:function(){return new h.Trail(this)},fireBatchedEvents:function(){this.input.fireBatchedEvents()},clearBatchedEvents:function(){this.input.clearBatchedEvents()},resizeOnWindowResize:function(){var t=this,e=function(){t.resize(window.innerWidth,window.innerHeight)};$(window).resize(e),e()},layerAudit:function(){var t=this;this.calculateBoundaries(null,null,null);var e=0;new h.Trail(this).eachTrailUnder(function(t){t.isPainted()&&e++});var i=0;_.each(this.layers,function(t){i+=t.getLayerTrails().length,t.startPaintedTrail.reindex(),t.endPaintedTrail.reindex()});var n=0;_.each(this.layers,function(e){var i=0;h.Trail.eachPaintedTrailBetween(e.startPaintedTrail,e.endPaintedTrail,function(){i++},!1,t),n+=i}),_.each(this.layers,function(){});for(var s=1;s<this.layers.length;s++);return _.each(this.layers,function(e){var i=e.getLayerTrails(),n=[];h.Trail.eachPaintedTrailBetween(e.startPaintedTrail,e.endPaintedTrail,function(t){n.push(t.copy())},!1,t),_.each(i,function(){}),h.Trail.eachTrailBetween(e.startPaintedTrail,e.endPaintedTrail,function(t){t.lastNode()},!1,t)}),new h.Trail(this).eachTrailUnder(function(t){var e,i;if(t.lastNode().layerSplit){e=t.previousPainted(),i=t.lastNode().isPainted()?t:t.nextPainted();for(var n=new h.TrailPointer(t.copy(),!1);n&&n.isAfter;)n=n.nestedForwards();n&&(e=n.trail.previousPainted(),i=n.trail.lastNode().isPainted()?n.trail:n.trail.nextPainted())}}),!0},getDebugHTML:function(){function t(t){return t?t.toString():t}var e=new h.TrailPointer(new h.Trail(this),!0),i=new h.TrailPointer(new h.Trail(this),!1),n=0,s="",r={},a={};return _.each(this.layers,function(e){var i=e.startPaintedTrail.getUniqueId(),n=e.endPaintedTrail.getUniqueId();r[i]="",a[n]="",e.startPaintedTrail.reindex(),e.endPaintedTrail.reindex();var s=e.getId()+" <strong>"+e.type.name+"</strong>"+" trails: "+(e.startPaintedTrail?t(e.startPaintedTrail):e.startPaintedTrail)+","+(e.endPaintedTrail?t(e.endPaintedTrail):e.endPaintedTrail);s+='<span style="color: #008">',e.canUseDirtyRegions&&!e.canUseDirtyRegions()&&(s+=" dirtyRegionsDisabled"),e.cssTranslation&&(s+=" cssTranslation"),e.cssRotation&&(s+=" cssTranslation"),e.cssScale&&(s+=" cssTranslation"),e.cssTransform&&(s+=" cssTranslation"),e.dirtyBounds&&e.dirtyBounds.isFinite()&&(s+=" dirtyBounds:"+e.dirtyBounds.toString()),s+="</span>",r[i]+='<div style="color: #080">+Layer '+s+"</div>",a[n]+='<div style="color: #800">-Layer '+s+"</div>"}),e.depthFirstUntil(i,function(e){function i(t){h+=' <span style="color: #008">'+t+"</span>"}var h,u=e.trail.lastNode();if(e.isBefore&&r[e.trail.getUniqueId()]&&(s+=r[e.trail.getUniqueId()]),e.isBefore){h='<div style="margin-left: '+20*n+'px">',u.constructor.name&&(h+=" "+u.constructor.name),h+=' <span style="font-weight: '+(u.isPainted()?"bold":"normal")+'">'+e.trail.lastNode().getId()+"</span>",h+=' <span style="color: #888">'+t(e.trail)+"</span>",u._visible||i("invisible"),u._pickable===!0&&i("pickable"),u._pickable===!1&&i("unpickable"),e.trail.isPickable()&&i('<span style="color: #808">hits</span>'),u._clipArea&&i("clipArea"),u._mouseArea&&i("mouseArea"),u._touchArea&&i("touchArea"),u._inputListeners.length&&i("inputListeners"),u._renderer&&i("renderer:"+u._renderer.name),u._rendererOptions,u._layerSplit&&i("layerSplit"),u._opacity<1&&i("opacity:"+u._opacity);var l="";switch(u.transform.getMatrix().type){case o.Types.IDENTITY:l="";break;case o.Types.TRANSLATION_2D:l="translated";break;case o.Types.SCALING:l="scale";break;case o.Types.AFFINE:l="affine";break;case o.Types.OTHER:l="other"}l&&(h+=' <span style="color: #88f" title="'+u.transform.getMatrix().toString().replace("\n","&#10;")+'">'+l+"</span>"),h+="</div>",s+=h}e.isAfter&&a[e.trail.getUniqueId()]&&(s+=a[e.trail.getUniqueId()]),n+=e.isBefore?1:-1},!1),s},popupDebug:function(){var t='<!DOCTYPE html><html lang="en"><head><title>Scenery Debug Snapshot</title></head><body>'+this.getDebugHTML()+"</body>"+"</html>";window.open("data:text/html;charset=utf-8,"+encodeURIComponent(t))},getBasicConstructor:function(t){return"new scenery.Scene( $( '#main' ), {"+t+"} )"},toStringWithChildren:function(t){function e(t){return t===i?"scene":(t.constructor.name?t.constructor.name.toLowerCase():"(node)")+t.id}var i=this,n="",s=this.getTopologicallySortedNodes().slice(0).reverse();return _.each(s,function(s){if(n&&(n+="\n"),t&&s===i){var r=i.getPropString("  ",!1);n+="scene.mutate( {"+(r?"\n"+r+"\n":"")+"} )"}else n+="var "+e(s)+" = "+s.toString("",!1);_.each(s.children,function(t){n+="\n"+e(s)+".addChild( "+e(t)+" );"})}),n},simulateWebGLContextLoss:function(){for(var t=0;t<this.layers.length;t++)this.layers[t].simulateWebGLContextLoss&&this.layers[t].simulateWebGLContextLoss()}}),m.customCursors={"scenery-grab-pointer":["grab","-moz-grab","-webkit-grab","pointer"],"scenery-grabbing-pointer":["grabbing","-moz-grabbing","-webkit-grabbing","pointer"]},m}),i("main",["SCENERY/scenery","SCENERY/debug/DebugContext","SCENERY/display/BackboneBlock","SCENERY/display/Block","SCENERY/display/Display","SCENERY/display/DisplayInstance","SCENERY/display/RenderState","SCENERY/input/ButtonListener","SCENERY/input/DownUpListener","SCENERY/input/Event","SCENERY/input/Input","SCENERY/input/Key","SCENERY/input/Mouse","SCENERY/input/Pen","SCENERY/input/Pointer","SCENERY/input/SimpleDragHandler","SCENERY/input/Touch","SCENERY/layers/CanvasLayer","SCENERY/layers/DOMLayer","SCENERY/layers/Layer","SCENERY/layers/LayerBoundary","SCENERY/layers/LayerBuilder","SCENERY/layers/LayerStrategy","SCENERY/layers/LayerType","SCENERY/layers/Renderer","SCENERY/layers/SVGLayer","SCENERY/layers/WebGLLayer","SCENERY/nodes/CanvasNode","SCENERY/nodes/Circle","SCENERY/nodes/DOM","SCENERY/nodes/Fillable","SCENERY/nodes/HBox","SCENERY/nodes/HTMLText","SCENERY/nodes/Image","SCENERY/nodes/LayoutBox","SCENERY/nodes/LayoutNode","SCENERY/nodes/Line","SCENERY/nodes/Node","SCENERY/nodes/Path","SCENERY/nodes/Plane","SCENERY/nodes/Rectangle","SCENERY/nodes/Strokable","SCENERY/nodes/Text","SCENERY/nodes/VBox","SCENERY/nodes/drawables/ImageWebGLDrawable","SCENERY/nodes/drawables/RectangleWebGLDrawable","SCENERY/nodes/drawables/WebGLNodeDrawable","SCENERY/overlays/PointerOverlay","SCENERY/util/AccessibilityPeer","SCENERY/util/CanvasContextWrapper","SCENERY/util/Color","SCENERY/util/Features","SCENERY/util/FixedNodeEvents","SCENERY/util/Font","SCENERY/util/Gradient","SCENERY/util/LinearGradient","SCENERY/util/LiveRegion","SCENERY/util/Instance","SCENERY/util/Pattern","SCENERY/util/RadialGradient","SCENERY/util/RenderInterval","SCENERY/util/SceneImage","SCENERY/util/SceneryStyle","SCENERY/util/ShaderProgram","SCENERY/util/Trail","SCENERY/util/TrailPointer","SCENERY/util/Util","SCENERY/Scene"],function(t){return t}),i("KITE/main",["KITE/kite","KITE/Shape","KITE/segments/Arc","KITE/segments/Cubic","KITE/segments/EllipticalArc","KITE/segments/Line","KITE/segments/Quadratic","KITE/segments/Segment","KITE/util/LineStyles","KITE/util/Subpath","KITE/parser/svgPath"],function(t){return t}),i("DOT/Bounds3",["require","DOT/dot","DOT/Vector3"],function(t){var e=t("DOT/dot");t("DOT/Vector3"),e.Bounds3=function(t,e,i,n,s,r){this.minX=t,this.minY=e,this.minZ=i,this.maxX=n,this.maxY=s,this.maxZ=r};var i=e.Bounds3;return i.prototype={constructor:i,isBounds:!0,dimension:3,getWidth:function(){return this.maxX-this.minX},get width(){return this.getWidth()},getHeight:function(){return this.maxY-this.minY},get height(){return this.getHeight()},getDepth:function(){return this.maxZ-this.minZ},get depth(){return this.getDepth()},getX:function(){return this.minX},get x(){return this.getX()},getY:function(){return this.minY},get y(){return this.getY()},getZ:function(){return this.minZ},get z(){return this.getZ()},getMinX:function(){return this.minX},get left(){return this.minX},getMinY:function(){return this.minY},get top(){return this.minY},getMinZ:function(){return this.minZ},get back(){return this.minZ},getMaxX:function(){return this.maxX},get right(){return this.maxX},getMaxY:function(){return this.maxY},get bottom(){return this.maxY},getMaxZ:function(){return this.maxZ},get front(){return this.maxZ},getCenterX:function(){return(this.maxX+this.minX)/2},get centerX(){return this.getCenterX()},getCenterY:function(){return(this.maxY+this.minY)/2},get centerY(){return this.getCenterY()},getCenterZ:function(){return(this.maxZ+this.minZ)/2},get centerZ(){return this.getCenterZ()},getCenter:function(){return new e.Vector3(this.getCenterX(),this.getCenterY(),this.getCenterZ())},get center(){return this.getCenter()},isEmpty:function(){return this.getWidth()<0||this.getHeight()<0||this.getDepth()<0},isFinite:function(){return isFinite(this.minX)&&isFinite(this.minY)&&isFinite(this.minZ)&&isFinite(this.maxX)&&isFinite(this.maxY)&&isFinite(this.maxZ)},isValid:function(){return!this.isEmpty()&&this.isFinite()},containsCoordinates:function(t,e,i){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY&&this.minZ<=i&&i<=this.maxZ},containsPoint:function(t){return this.containsCoordinates(t.x,t.y,t.z)},containsBounds:function(t){return this.minX<=t.minX&&this.maxX>=t.maxX&&this.minY<=t.minY&&this.maxY>=t.maxY&&this.minZ<=t.minZ&&this.maxZ>=t.maxZ},intersectsBounds:function(t){return!this.intersection(t).isEmpty()},toString:function(){return"[x:("+this.minX+","+this.maxX+"),y:("+this.minY+","+this.maxY+"),z:("+this.minZ+","+this.maxZ+")]"},equals:function(t){return this.minX===t.minX&&this.minY===t.minY&&this.minZ===t.minZ&&this.maxX===t.maxX&&this.maxY===t.maxY&&this.maxZ===t.maxZ},equalsEpsilon:function(t,e){e=e||0;var i=this.isFinite(),n=t.isFinite();return i&&n?Math.abs(this.minX-t.minX)<e&&Math.abs(this.minY-t.minY)<e&&Math.abs(this.minZ-t.minZ)<e&&Math.abs(this.maxX-t.maxX)<e&&Math.abs(this.maxY-t.maxY)<e&&Math.abs(this.maxZ-t.maxZ)<e:i!==n?!1:this===t?!0:(isFinite(this.minX+t.minX)?Math.abs(this.minX-t.minX)<e:this.minX===t.minX)&&(isFinite(this.minY+t.minY)?Math.abs(this.minY-t.minY)<e:this.minY===t.minY)&&(isFinite(this.minZ+t.minZ)?Math.abs(this.minZ-t.minZ)<e:this.minZ===t.minZ)&&(isFinite(this.maxX+t.maxX)?Math.abs(this.maxX-t.maxX)<e:this.maxX===t.maxX)&&(isFinite(this.maxY+t.maxY)?Math.abs(this.maxY-t.maxY)<e:this.maxY===t.maxY)&&(isFinite(this.maxZ+t.maxZ)?Math.abs(this.maxZ-t.maxZ)<e:this.maxZ===t.maxZ)},copy:function(t){return t?t.set(this):new i(this.minX,this.minY,this.minZ,this.maxX,this.maxY,this.maxZ)},union:function(t){return new i(Math.min(this.minX,t.minX),Math.min(this.minY,t.minY),Math.min(this.minZ,t.minZ),Math.max(this.maxX,t.maxX),Math.max(this.maxY,t.maxY),Math.max(this.maxZ,t.maxZ))},intersection:function(t){return new i(Math.max(this.minX,t.minX),Math.max(this.minY,t.minY),Math.max(this.minZ,t.minZ),Math.min(this.maxX,t.maxX),Math.min(this.maxY,t.maxY),Math.min(this.maxZ,t.maxZ))},withCoordinates:function(t,e,n){return new i(Math.min(this.minX,t),Math.min(this.minY,e),Math.min(this.minZ,n),Math.max(this.maxX,t),Math.max(this.maxY,e),Math.max(this.maxZ,n))},withPoint:function(t){return this.withCoordinates(t.x,t.y,t.z)},withMinX:function(t){return new i(t,this.minY,this.minZ,this.maxX,this.maxY,this.maxZ)},withMinY:function(t){return new i(this.minX,t,this.minZ,this.maxX,this.maxY,this.maxZ)},withMinZ:function(t){return new i(this.minX,this.minY,t,this.maxX,this.maxY,this.maxZ)},withMaxX:function(t){return new i(this.minX,this.minY,this.minZ,t,this.maxY,this.maxZ)},withMaxY:function(t){return new i(this.minX,this.minY,this.minZ,this.maxX,t,this.maxZ)},withMaxZ:function(t){return new i(this.minX,this.minY,this.minZ,this.maxX,this.maxY,t)},roundedOut:function(){return new i(Math.floor(this.minX),Math.floor(this.minY),Math.floor(this.minZ),Math.ceil(this.maxX),Math.ceil(this.maxY),Math.ceil(this.maxZ))},roundedIn:function(){return new i(Math.ceil(this.minX),Math.ceil(this.minY),Math.ceil(this.minZ),Math.floor(this.maxX),Math.floor(this.maxY),Math.floor(this.maxZ))},transformed:function(t){return this.copy().transform(t)},dilated:function(t){return new i(this.minX-t,this.minY-t,this.minZ-t,this.maxX+t,this.maxY+t,this.maxZ+t)},dilatedX:function(t){return new i(this.minX-t,this.minY,this.minZ,this.maxX+t,this.maxY,this.maxZ)},dilatedY:function(t){return new i(this.minX,this.minY-t,this.minZ,this.maxX,this.maxY+t,this.maxZ)},dilatedZ:function(t){return new i(this.minX,this.minY,this.minZ-t,this.maxX,this.maxY,this.maxZ+t)},dilatedXYZ:function(t,e,n){return new i(this.minX-t,this.minY-e,this.minZ-n,this.maxX+t,this.maxY+e,this.maxZ+n)},eroded:function(t){return this.dilated(-t)},erodedX:function(t){return this.dilatedX(-t)},erodedY:function(t){return this.dilatedY(-t)},erodedZ:function(t){return this.dilatedZ(-t)},erodedXYZ:function(t,e,i){return this.dilatedXYZ(-t,-e,-i)},shiftedX:function(t){return new i(this.minX+t,this.minY,this.minZ,this.maxX+t,this.maxY,this.maxZ)},shiftedY:function(t){return new i(this.minX,this.minY+t,this.minZ,this.maxX,this.maxY+t,this.maxZ)},shiftedZ:function(t){return new i(this.minX,this.minY,this.minZ+t,this.maxX,this.maxY,this.maxZ+t)},shifted:function(t,e,n){return new i(this.minX+t,this.minY+e,this.minZ+n,this.maxX+t,this.maxY+e,this.maxZ+n)},setMinMax:function(t,e,i,n,s,r){return this.minX=t,this.minY=e,this.minZ=i,this.maxX=n,this.maxY=s,this.maxZ=r,this},setMinX:function(t){return this.minX=t,this},setMinY:function(t){return this.minY=t,this},setMinZ:function(t){return this.minZ=t,this},setMaxX:function(t){return this.maxX=t,this},setMaxY:function(t){return this.maxY=t,this},setMaxZ:function(t){return this.maxZ=t,this},set:function(t){return this.setMinMax(t.minX,t.minY,t.minZ,t.maxX,t.maxY,t.maxZ)},includeBounds:function(t){return this.setMinMax(Math.min(this.minX,t.minX),Math.min(this.minY,t.minY),Math.min(this.minZ,t.minZ),Math.max(this.maxX,t.maxX),Math.max(this.maxY,t.maxY),Math.max(this.maxZ,t.maxZ))},constrainBounds:function(t){return this.setMinMax(Math.max(this.minX,t.minX),Math.max(this.minY,t.minY),Math.max(this.minZ,t.minZ),Math.min(this.maxX,t.maxX),Math.min(this.maxY,t.maxY),Math.min(this.maxZ,t.maxZ))},addCoordinates:function(t,e,i){return this.setMinMax(Math.min(this.minX,t),Math.min(this.minY,e),Math.min(this.minZ,i),Math.max(this.maxX,t),Math.max(this.maxY,e),Math.max(this.maxZ,i))},addPoint:function(t){return this.addCoordinates(t.x,t.y,t.z)},roundOut:function(){return this.setMinMax(Math.floor(this.minX),Math.floor(this.minY),Math.floor(this.minZ),Math.ceil(this.maxX),Math.ceil(this.maxY),Math.ceil(this.maxZ))},roundIn:function(){return this.setMinMax(Math.ceil(this.minX),Math.ceil(this.minY),Math.ceil(this.minZ),Math.floor(this.maxX),Math.floor(this.maxY),Math.floor(this.maxZ))},transform:function(t){function i(t){n=Math.min(n,t.x),s=Math.min(s,t.y),r=Math.min(r,t.z),o=Math.max(o,t.x),a=Math.max(a,t.y),h=Math.max(h,t.z)}if(this.isEmpty())return this;if(t.isIdentity())return this;var n=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,a=Number.NEGATIVE_INFINITY,h=Number.NEGATIVE_INFINITY,u=new e.Vector3;return i(t.multiplyVector3(u.setXYZ(this.minX,this.minY,this.minZ))),i(t.multiplyVector3(u.setXYZ(this.minX,this.maxY,this.minZ))),i(t.multiplyVector3(u.setXYZ(this.maxX,this.minY,this.minZ))),i(t.multiplyVector3(u.setXYZ(this.maxX,this.maxY,this.minZ))),i(t.multiplyVector3(u.setXYZ(this.minX,this.minY,this.maxZ))),i(t.multiplyVector3(u.setXYZ(this.minX,this.maxY,this.maxZ))),i(t.multiplyVector3(u.setXYZ(this.maxX,this.minY,this.maxZ))),i(t.multiplyVector3(u.setXYZ(this.maxX,this.maxY,this.maxZ))),this.setMinMax(n,s,r,o,a,h)},dilate:function(t){return this.setMinMax(this.minX-t,this.minY-t,this.minZ-t,this.maxX+t,this.maxY+t,this.maxZ+t)},dilateX:function(t){return this.setMinMax(this.minX-t,this.minY,this.minZ,this.maxX+t,this.maxY,this.maxZ)},dilateY:function(t){return this.setMinMax(this.minX,this.minY-t,this.minZ,this.maxX,this.maxY+t,this.maxZ)},dilateZ:function(t){return this.setMinMax(this.minX,this.minY,this.minZ-t,this.maxX,this.maxY,this.maxZ+t)},dilateXYZ:function(t,e,i){return this.setMinMax(this.minX-t,this.minY-e,this.minZ-i,this.maxX+t,this.maxY+e,this.maxZ+i)},erode:function(t){return this.dilate(-t)},erodeX:function(t){return this.dilateX(-t)},erodeY:function(t){return this.dilateY(-t)},erodeZ:function(t){return this.dilateZ(-t)},erodeXYZ:function(t,e,i){return this.dilateXYZ(-t,-e,-i)},shiftX:function(t){return this.setMinMax(this.minX+t,this.minY,this.minZ,this.maxX+t,this.maxY,this.maxZ)},shiftY:function(t){return this.setMinMax(this.minX,this.minY+t,this.minZ,this.maxX,this.maxY+t,this.maxZ)},shiftZ:function(t){return this.setMinMax(this.minX,this.minY,this.minZ+t,this.maxX,this.maxY,this.maxZ+t)},shift:function(t,e,i){return this.setMinMax(this.minX+t,this.minY+e,this.minZ+i,this.maxX+t,this.maxY+e,this.maxZ+i)}},i.cuboid=function(t,e,n,s,r,o){return new i(t,e,n,t+s,e+r,n+o)},i.point=function(t,e,n){return new i(t,e,n,t,e,n)},i.EVERYTHING=new i(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i.NOTHING=new i(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),i}),i("DOT/Complex",["require","DOT/dot","PHET_CORE/inherit","DOT/Vector2"],function(t){var e=t("DOT/dot"),i=t("PHET_CORE/inherit"),n=t("DOT/Vector2");e.Complex=function(t,e){n.call(this,t,e),this.real=t,this.imaginary=e};var s=e.Complex;return s.real=function(t){return new s(t,0)},s.imaginary=function(t){return new s(0,t)},s.createPolar=function(t,e){return new s(t*Math.cos(e),t*Math.sin(e))},i(n.Immutable,s,{phase:n.prototype.angle,times:function(t){return new s(this.real*t.real-this.imaginary*t.imaginary,this.real*t.imaginary+this.imaginary*t.real)},dividedBy:function(t){var e=t.magnitudeSquared();return new s((this.real*t.real+this.imaginary*t.imaginary)/e,(this.imaginary*t.real-this.real*t.imaginary)/e)},sqrt:function(){var t=this.magnitude();return new s(Math.sqrt((t+this.real)/2),(this.imaginary>=0?1:-1)*Math.sqrt((t-this.real)/2))},conjugate:function(){return new s(this.real,-this.imaginary)},exponentiated:function(){return s.createPolar(Math.exp(this.real),this.imaginary)},toString:function(){return"Complex("+this.x+", "+this.y+")"}}),s.ZERO=new s(0,0),s.ONE=new s(1,0),s.I=new s(0,1),s}),i("DOT/ConvexHull2",["require","DOT/dot"],function(t){function e(t,e,i){return e.minus(t).crossScalar(i.minus(t))}var i=t("DOT/dot");return i.ConvexHull2={grahamScan:function(t,i){if(t.length<=2)return t;var n=Number.POSITIVE_INFINITY,s=null;_.each(t,function(t){t.y<=n&&(t.y===n&&s?t.x<s.x&&(s=t):(n=t.y,s=t))}),t=_.sortBy(t,function(t){return t.minus(s).angle()}),t.splice(_.indexOf(t,s),1);var r=[s];return _.each(t,function(t){function n(){if(r.length<2)return!1;var n=e(r[r.length-2],r[r.length-1],t);return i?0>n:0>=n}if(s.x!==t.x||s.y!==t.y){for(;n();)r.pop();r.push(t)}}),r}},i.ConvexHull2}),i("DOT/Dimension2",["require","DOT/dot","DOT/Bounds2"],function(t){var e=t("DOT/dot");t("DOT/Bounds2"),e.Dimension2=function(t,e){this.width=t,this.height=e};var i=e.Dimension2;return i.prototype={constructor:i,toString:function(){return"["+this.width+"w, "+this.height+"h]"},set:function(t){return this.width=t.width,this.height=t.height,this},setWidth:function(t){return this.width=t,this},setHeight:function(t){return this.width=t,this},copy:function(t){return t?t.set(this):new i(this.width,this.height)},toBounds:function(t,i){return t=t||0,i=i||0,new e.Bounds2(t,i,this.width+t,this.height+i)},equals:function(t){return this.width===t.width&&this.height===t.height
}},i}),i("DOT/EigenvalueDecomposition",["require","DOT/dot"],function(t){var e=t("DOT/dot"),i=window.Float32Array||Array;e.EigenvalueDecomposition=function(t){var e,n,s=t.entries;this.n=t.getColumnDimension();var r=this.n;for(this.V=new i(r*r),this.d=new i(r),this.e=new i(r),this.issymmetric=!0,n=0;r>n&&this.issymmetric;n++)for(e=0;r>e&&this.issymmetric;e++)this.issymmetric=s[e*this.n+n]===s[n*this.n+e];if(this.issymmetric){for(e=0;r>e;e++)for(n=0;r>n;n++)this.V[e*this.n+n]=s[e*this.n+n];this.tred2(),this.tql2()}else{for(this.H=new i(r*r),this.ort=new i(r),n=0;r>n;n++)for(e=0;r>e;e++)this.H[e*this.n+n]=s[e*this.n+n];this.orthes(),this.hqr2()}};var n=e.EigenvalueDecomposition;return n.prototype={constructor:n,getV:function(){return this.V.copy()},getRealEigenvalues:function(){return this.d},getImagEigenvalues:function(){return this.e},getD:function(){for(var t=this.n,i=this.d,n=this.e,s=new e.Matrix(t,t),r=s.entries,o=0;t>o;o++){for(var a=0;t>a;a++)r[o*this.n+a]=0;r[o*this.n+o]=i[o],n[o]>0?r[o*this.n+o+1]=n[o]:n[o]<0&&(r[o*this.n+o-1]=n[o])}return s},tred2:function(){var t,e,i,n,s,r,o=this.n,a=this.V,h=this.d,u=this.e;for(e=0;o>e;e++)h[e]=a[(o-1)*o+e];for(t=o-1;t>0;t--){var l=0;for(r=0,i=0;t>i;i++)l+=Math.abs(h[i]);if(0===l)for(u[t]=h[t-1],e=0;t>e;e++)h[e]=a[(t-1)*o+e],a[t*this.n+e]=0,a[e*this.n+t]=0;else{for(i=0;t>i;i++)h[i]/=l,r+=h[i]*h[i];for(n=h[t-1],s=Math.sqrt(r),n>0&&(s=-s),u[t]=l*s,r-=n*s,h[t-1]=n-s,e=0;t>e;e++)u[e]=0;for(e=0;t>e;e++){for(n=h[e],a[e*this.n+t]=n,s=u[e]+a[e*o+e]*n,i=e+1;t-1>=i;i++)s+=a[i*o+e]*h[i],u[i]+=a[i*o+e]*n;u[e]=s}for(n=0,e=0;t>e;e++)u[e]/=r,n+=u[e]*h[e];var c=n/(r+r);for(e=0;t>e;e++)u[e]-=c*h[e];for(e=0;t>e;e++){for(n=h[e],s=u[e],i=e;t-1>=i;i++)a[i*o+e]-=n*u[i]+s*h[i];h[e]=a[(t-1)*o+e],a[t*this.n+e]=0}}h[t]=r}for(t=0;o-1>t;t++){if(a[(o-1)*o+t]=a[t*o+t],a[t*o+t]=1,r=h[t+1],0!==r){for(i=0;t>=i;i++)h[i]=a[i*o+(t+1)]/r;for(e=0;t>=e;e++){for(s=0,i=0;t>=i;i++)s+=a[i*o+(t+1)]*a[i*o+e];for(i=0;t>=i;i++)a[i*o+e]-=s*h[i]}}for(i=0;t>=i;i++)a[i*o+(t+1)]=0}for(e=0;o>e;e++)h[e]=a[(o-1)*o+e],a[(o-1)*o+e]=0;a[(o-1)*o+(o-1)]=1,u[0]=0},tql2:function(){var t,i,n,s,r,o,a,h=this.n,u=this.V,l=this.d,c=this.e;for(t=1;h>t;t++)c[t-1]=c[t];c[h-1]=0;var d=0,m=0,f=Math.pow(2,-52);for(s=0;h>s;s++){m=Math.max(m,Math.abs(l[s])+Math.abs(c[s]));for(var g=s;h>g&&!(Math.abs(c[g])<=f*m);)g++;if(g>s){a=0;do{a+=1,r=l[s],o=(l[s+1]-r)/(2*c[s]);var p=e.Matrix.hypot(o,1);0>o&&(p=-p),l[s]=c[s]/(o+p),l[s+1]=c[s]*(o+p);var v=l[s+1],y=r-l[s];for(t=s+2;h>t;t++)l[t]-=y;d+=y,o=l[g];var x=1,_=x,E=x,T=c[s+1],S=0,b=0;for(t=g-1;t>=s;t--)for(E=_,_=x,b=S,r=x*c[t],y=x*o,p=e.Matrix.hypot(o,c[t]),c[t+1]=S*p,S=c[t]/p,x=o/p,o=x*l[t]-S*r,l[t+1]=y+S*(x*r+S*l[t]),n=0;h>n;n++)y=u[n*h+(t+1)],u[n*h+(t+1)]=S*u[n*h+t]+x*y,u[n*h+t]=x*u[n*h+t]-S*y;o=-S*b*E*T*c[s]/v,c[s]=S*o,l[s]=x*o}while(Math.abs(c[s])>f*m)}l[s]=l[s]+d,c[s]=0}for(t=0;h-1>t;t++){for(n=t,o=l[t],i=t+1;h>i;i++)l[i]<o&&(n=i,o=l[i]);if(n!==t)for(l[n]=l[t],l[t]=o,i=0;h>i;i++)o=u[i*this.n+t],u[i*this.n+t]=u[i*h+n],u[i*h+n]=o}},orthes:function(){var t,e,i,n,s,r=this.n,o=this.V,a=this.H,h=this.ort,u=0,l=r-1;for(i=u+1;l-1>=i;i++){var c=0;for(t=i;l>=t;t++)c+=Math.abs(a[t*r+(i-1)]);if(0!==c){var d=0;for(t=l;t>=i;t--)h[t]=a[t*r+(i-1)]/c,d+=h[t]*h[t];for(s=Math.sqrt(d),h[i]>0&&(s=-s),d-=h[i]*s,h[i]=h[i]-s,e=i;r>e;e++){for(n=0,t=l;t>=i;t--)n+=h[t]*a[t*this.n+e];for(n/=d,t=i;l>=t;t++)a[t*this.n+e]-=n*h[t]}for(t=0;l>=t;t++){for(n=0,e=l;e>=i;e--)n+=h[e]*a[t*this.n+e];for(n/=d,e=i;l>=e;e++)a[t*this.n+e]-=n*h[e]}h[i]=c*h[i],a[i*r+(i-1)]=c*s}}for(t=0;r>t;t++)for(e=0;r>e;e++)o[t*this.n+e]=t===e?1:0;for(i=l-1;i>=u+1;i--)if(0!==a[i*r+(i-1)]){for(t=i+1;l>=t;t++)h[t]=a[t*r+(i-1)];for(e=i;l>=e;e++){for(s=0,t=i;l>=t;t++)s+=h[t]*o[t*this.n+e];for(s=s/h[i]/a[i*r+(i-1)],t=i;l>=t;t++)o[t*this.n+e]+=s*h[t]}}},cdiv:function(t,e,i,n){var s,r;Math.abs(i)>Math.abs(n)?(s=n/i,r=i+s*n,this.cdivr=(t+s*e)/r,this.cdivi=(e-s*t)/r):(s=i/n,r=n+s*i,this.cdivr=(s*t+e)/r,this.cdivi=(s*e-t)/r)},hqr2:function(){var t,e,i,n,s,r,o,a=this.V,h=this.d,u=this.e,l=this.H,c=this.n;t=c-1;var d,m,f,g,p=0,v=c-1,y=Math.pow(2,-52),x=0,_=0,E=0,T=0,S=0,b=0,C=0;for(e=0;c>e;e++)for((p>e||e>v)&&(h[e]=l[e*t+e],u[e]=0),i=Math.max(e-1,0);c>i;i++)C+=Math.abs(l[e*this.n+i]);for(o=0;t>=p;){for(s=t;s>p&&(S=Math.abs(l[(s-1)*t+(s-1)])+Math.abs(l[s*t+s]),0===S&&(S=C),!(Math.abs(l[s*t+(s-1)])<y*S));)s--;if(s===t)l[t*t+t]=l[t*t+t]+x,h[t]=l[t*t+t],u[t]=0,t--,o=0;else if(s===t-1){if(m=l[t*t+t-1]*l[(t-1)*t+t],_=(l[(t-1)*t+(t-1)]-l[t*t+t])/2,E=_*_+m,b=Math.sqrt(Math.abs(E)),l[t*t+t]=l[t*t+t]+x,l[(t-1)*t+(t-1)]=l[(t-1)*t+(t-1)]+x,f=l[t*t+t],E>=0){for(b=_>=0?_+b:_-b,h[t-1]=f+b,h[t]=h[t-1],0!==b&&(h[t]=f-m/b),u[t-1]=0,u[t]=0,f=l[t*t+t-1],S=Math.abs(f)+Math.abs(b),_=f/S,E=b/S,T=Math.sqrt(_*_+E*E),_/=T,E/=T,i=t-1;c>i;i++)b=l[(t-1)*t+i],l[(t-1)*t+i]=E*b+_*l[t*t+i],l[t*t+i]=E*l[t*t+i]-_*b;for(e=0;t>=e;e++)b=l[e*t+t-1],l[e*t+t-1]=E*b+_*l[e*t+t],l[e*t+t]=E*l[e*t+t]-_*b;for(e=p;v>=e;e++)b=a[e*t+t-1],a[e*t+t-1]=E*b+_*a[e*t+t],a[e*t+t]=E*a[e*t+t]-_*b}else h[t-1]=f+_,h[t]=f+_,u[t-1]=b,u[t]=-b;t-=2,o=0}else{if(f=l[t*t+t],g=0,m=0,t>s&&(g=l[(t-1)*t+(t-1)],m=l[t*t+t-1]*l[(t-1)*t+t]),10===o){for(x+=f,e=p;t>=e;e++)l[e*t+e]-=f;S=Math.abs(l[t*t+t-1])+Math.abs(l[(t-1)*t+t-2]),f=g=.75*S,m=-.4375*S*S}if(30===o&&(S=(g-f)/2,S=S*S+m,S>0)){for(S=Math.sqrt(S),f>g&&(S=-S),S=f-m/((g-f)/2+S),e=p;t>=e;e++)l[e*t+e]-=S;x+=S,f=g=m=.964}for(o+=1,r=t-2;r>=s&&(b=l[r*t+r],T=f-b,S=g-b,_=(T*S-m)/l[(r+1)*t+r]+l[r*t+r+1],E=l[(r+1)*t+r+1]-b-T-S,T=l[(r+2)*t+r+1],S=Math.abs(_)+Math.abs(E)+Math.abs(T),_/=S,E/=S,T/=S,r!==s)&&!(Math.abs(l[r*t+(r-1)])*(Math.abs(E)+Math.abs(T))<y*Math.abs(_)*(Math.abs(l[(r-1)*t+r-1])+Math.abs(b)+Math.abs(l[(r+1)*t+r+1])));)r--;for(e=r+2;t>=e;e++)l[e*t+e-2]=0,e>r+2&&(l[e*t+e-3]=0);for(n=r;t-1>=n;n++){var w=n!==t-1;if(n!==r&&(_=l[n*t+n-1],E=l[(n+1)*t+n-1],T=w?l[(n+2)*t+n-1]:0,f=Math.abs(_)+Math.abs(E)+Math.abs(T),0!==f&&(_/=f,E/=f,T/=f)),0===f)break;if(S=Math.sqrt(_*_+E*E+T*T),0>_&&(S=-S),0!==S){for(n!==r?l[n*t+n-1]=-S*f:s!==r&&(l[n*t+n-1]=-l[n*t+n-1]),_+=S,f=_/S,g=E/S,b=T/S,E/=_,T/=_,i=n;c>i;i++)_=l[n*t+i]+E*l[(n+1)*t+i],w&&(_+=T*l[(n+2)*t+i],l[(n+2)*t+i]=l[(n+2)*t+i]-_*b),l[n*t+i]=l[n*t+i]-_*f,l[(n+1)*t+i]=l[(n+1)*t+i]-_*g;for(e=0;e<=Math.min(t,n+3);e++)_=f*l[e*t+n]+g*l[e*t+n+1],w&&(_+=b*l[e*t+n+2],l[e*t+n+2]=l[e*t+n+2]-_*T),l[e*t+n]=l[e*t+n]-_,l[e*t+n+1]=l[e*t+n+1]-_*E;for(e=p;v>=e;e++)_=f*a[e*t+n]+g*a[e*t+n+1],w&&(_+=b*a[e*t+n+2],a[e*t+n+2]=a[e*t+n+2]-_*T),a[e*t+n]=a[e*t+n]-_,a[e*t+n+1]=a[e*t+n+1]-_*E}}}}if(0!==C){for(t=c-1;t>=0;t--)if(_=h[t],E=u[t],0===E)for(s=t,l[t*t+t]=1,e=t-1;e>=0;e--){for(m=l[e*t+e]-_,T=0,i=s;t>=i;i++)T+=l[e*this.n+i]*l[i*t+t];if(u[e]<0)b=m,S=T;else if(s=e,0===u[e]?l[e*t+t]=0!==m?-T/m:-T/(y*C):(f=l[e*t+e+1],g=l[(e+1)*t+e],E=(h[e]-_)*(h[e]-_)+u[e]*u[e],d=(f*S-b*T)/E,l[e*t+t]=d,l[(e+1)*t+t]=Math.abs(f)>Math.abs(b)?(-T-m*d)/f:(-S-g*d)/b),d=Math.abs(l[e*t+t]),y*d*d>1)for(i=e;t>=i;i++)l[i*t+t]=l[i*t+t]/d}else if(0>E)for(s=t-1,Math.abs(l[t*t+t-1])>Math.abs(l[(t-1)*t+t])?(l[(t-1)*t+(t-1)]=E/l[t*t+t-1],l[(t-1)*t+t]=-(l[t*t+t]-_)/l[t*t+t-1]):(this.cdiv(0,-l[(t-1)*t+t],l[(t-1)*t+(t-1)]-_,E),l[(t-1)*t+(t-1)]=this.cdivr,l[(t-1)*t+t]=this.cdivi),l[t*t+t-1]=0,l[t*t+t]=1,e=t-2;e>=0;e--){var R,P,A,M;for(R=0,P=0,i=s;t>=i;i++)R+=l[e*this.n+i]*l[i*t+t-1],P+=l[e*this.n+i]*l[i*t+t];if(m=l[e*t+e]-_,u[e]<0)b=m,T=R,S=P;else if(s=e,0===u[e]?(this.cdiv(-R,-P,m,E),l[e*t+t-1]=this.cdivr,l[e*t+t]=this.cdivi):(f=l[e*t+e+1],g=l[(e+1)*t+e],A=(h[e]-_)*(h[e]-_)+u[e]*u[e]-E*E,M=2*(h[e]-_)*E,0===A&&0===M&&(A=y*C*(Math.abs(m)+Math.abs(E)+Math.abs(f)+Math.abs(g)+Math.abs(b))),this.cdiv(f*T-b*R+E*P,f*S-b*P-E*R,A,M),l[e*t+t-1]=this.cdivr,l[e*t+t]=this.cdivi,Math.abs(f)>Math.abs(b)+Math.abs(E)?(l[(e+1)*t+t-1]=(-R-m*l[e*t+t-1]+E*l[e*t+t])/f,l[(e+1)*t+t]=(-P-m*l[e*t+t]-E*l[e*t+t-1])/f):(this.cdiv(-T-g*l[e*t+t-1],-S-g*l[e*t+t],b,E),l[(e+1)*t+t-1]=this.cdivr,l[(e+1)*t+t]=this.cdivi)),d=Math.max(Math.abs(l[e*t+t-1]),Math.abs(l[e*t+t])),y*d*d>1)for(i=e;t>=i;i++)l[i*t+t-1]=l[i*t+t-1]/d,l[i*t+t]=l[i*t+t]/d}for(e=0;c>e;e++)if(p>e||e>v)for(i=e;c>i;i++)a[e*this.n+i]=l[e*this.n+i];for(i=c-1;i>=p;i--)for(e=p;v>=e;e++){for(b=0,n=p;n<=Math.min(i,v);n++)b+=a[e*t+n]*l[n*t+i];a[e*this.n+i]=b}}}},n}),i("DOT/LinearFunction",["require","DOT/dot","DOT/Util"],function(t){var e=t("DOT/dot");return t("DOT/Util"),e.LinearFunction=function(t,i,n,s,r){r=_.isUndefined(r)?!1:r;var o=function(t,i,n,s,r,o){var a=e.Util.linear(t,i,n,s,r);if(o){var h=Math.max(n,s),u=Math.min(n,s);a=e.Util.clamp(a,u,h)}return a},a=function(e){return o(t,i,n,s,e,r)};return a.inverse=function(e){return o(n,s,t,i,e,r)},a},e.LinearFunction}),i("DOT/LUDecomposition",["require","DOT/dot"],function(t){var e=t("DOT/dot"),i=window.Float32Array||Array;e.LUDecomposition=function(t){var e,n,s;this.matrix=t,this.LU=t.getArrayCopy();var r=this.LU;this.m=t.getRowDimension();var o=this.m;this.n=t.getColumnDimension();var a=this.n;for(this.piv=new Uint32Array(o),e=0;o>e;e++)this.piv[e]=e;this.pivsign=1;var h=new i(o);for(n=0;a>n;n++){for(e=0;o>e;e++)h[e]=r[t.index(e,n)];for(e=0;o>e;e++){var u=Math.min(e,n),l=0;for(s=0;u>s;s++){var c=t.index(e,s);l+=r[c]*h[s]}h[e]-=l,r[t.index(e,n)]=h[e]}var d=n;for(e=n+1;o>e;e++)Math.abs(h[e])>Math.abs(h[d])&&(d=e);if(d!==n){for(s=0;a>s;s++){var m=t.index(d,s),f=t.index(n,s),g=r[m];r[m]=r[f],r[f]=g}s=this.piv[d],this.piv[d]=this.piv[n],this.piv[n]=s,this.pivsign=-this.pivsign}if(o>n&&0!==r[this.matrix.index(n,n)])for(e=n+1;o>e;e++)r[t.index(e,n)]/=r[t.index(n,n)]}};var n=e.LUDecomposition;return n.prototype={constructor:n,isNonsingular:function(){for(var t=0;t<this.n;t++){var e=this.matrix.index(t,t);if(0===this.LU[e])return!1}return!0},getL:function(){for(var t=new e.Matrix(this.m,this.n),i=0;i<this.m;i++)for(var n=0;n<this.n;n++)t.entries[t.index(i,n)]=i>n?this.LU[this.matrix.index(i,n)]:i===n?1:0;return t},getU:function(){for(var t=new e.Matrix(this.n,this.n),i=0;i<this.n;i++)for(var n=0;n<this.n;n++)t.entries[t.index(i,n)]=n>=i?this.LU[this.matrix.index(i,n)]:0;return t},getPivot:function(){for(var t=new Uint32Array(this.m),e=0;e<this.m;e++)t[e]=this.piv[e];return t},getDoublePivot:function(){for(var t=new i(this.m),e=0;e<this.m;e++)t[e]=this.piv[e];return t},det:function(){if(this.m!==this.n)throw new Error("Matrix must be square.");for(var t=this.pivsign,e=0;e<this.n;e++)t*=this.LU[this.matrix.index(e,e)];return t},solve:function(t){var e,i,n;if(t.getRowDimension()!==this.m)throw new Error("Matrix row dimensions must agree.");if(!this.isNonsingular())throw new Error("Matrix is singular.");var s=t.getColumnDimension(),r=t.getArrayRowMatrix(this.piv,0,s-1);for(n=0;n<this.n;n++)for(e=n+1;e<this.n;e++)for(i=0;s>i;i++)r.entries[r.index(e,i)]-=r.entries[r.index(n,i)]*this.LU[this.matrix.index(e,n)];for(n=this.n-1;n>=0;n--){for(i=0;s>i;i++)r.entries[r.index(n,i)]/=this.LU[this.matrix.index(n,n)];for(e=0;n>e;e++)for(i=0;s>i;i++)r.entries[r.index(e,i)]-=r.entries[r.index(n,i)]*this.LU[this.matrix.index(e,n)]}return r}},n}),i("PHET_CORE/isArray",["require","PHET_CORE/core"],function(t){var e=t("PHET_CORE/core");return e.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},e.isArray}),i("DOT/SingularValueDecomposition",["require","DOT/dot"],function(t){var e=t("DOT/dot"),i=window.Float32Array||Array;e.SingularValueDecomposition=function(t){this.matrix=t;var n=t,s=n.getArrayCopy();this.m=n.getRowDimension(),this.n=n.getColumnDimension();var r=this.m,o=this.n,a=Math.min,h=Math.max,u=Math.pow,l=Math.abs,c=a(r,o);this.s=new i(a(r+1,o));var d=this.s;this.U=new i(r*c);var m=this.U;this.V=new i(o*o);var f,g,p,v,y,x,_,E=this.V,T=new i(o),S=new i(r),b=!0,C=!0,w=e.Matrix.hypot,R=a(r-1,o),P=h(0,a(o-2,r));for(p=0;p<h(R,P);p++){if(R>p){for(d[p]=0,f=p;r>f;f++)d[p]=w(d[p],s[f*o+p]);if(0!==d[p]){for(s[p*o+p]<0&&(d[p]=-d[p]),f=p;r>f;f++)s[f*o+p]/=d[p];s[p*o+p]+=1}d[p]=-d[p]}for(g=p+1;o>g;g++){if(R>p&&0!==d[p]){for(v=0,f=p;r>f;f++)v+=s[f*o+p]*s[f*o+g];for(v=-v/s[p*o+p],f=p;r>f;f++)s[f*o+g]+=v*s[f*o+p]}T[g]=s[p*o+g]}if(b&&R>p)for(f=p;r>f;f++)m[f*c+p]=s[f*o+p];if(P>p){for(T[p]=0,f=p+1;o>f;f++)T[p]=w(T[p],T[f]);if(0!==T[p]){for(T[p+1]<0&&(T[p]=-T[p]),f=p+1;o>f;f++)T[f]/=T[p];T[p+1]+=1}if(T[p]=-T[p],r>p+1&&0!==T[p]){for(f=p+1;r>f;f++)S[f]=0;for(g=p+1;o>g;g++)for(f=p+1;r>f;f++)S[f]+=T[g]*s[f*o+g];for(g=p+1;o>g;g++)for(v=-T[g]/T[p+1],f=p+1;r>f;f++)s[f*o+g]+=v*S[f]}if(C)for(f=p+1;o>f;f++)E[f*o+p]=T[f]}}var A=a(o,r+1);if(o>R&&(d[R]=s[R*o+R]),A>r&&(d[A-1]=0),A>P+1&&(T[P]=s[P*o+A-1]),T[A-1]=0,b){for(g=R;c>g;g++){for(f=0;r>f;f++)m[f*c+g]=0;m[g*c+g]=1}for(p=R-1;p>=0;p--)if(0!==d[p]){for(g=p+1;c>g;g++){for(v=0,f=p;r>f;f++)v+=m[f*c+p]*m[f*c+g];for(v=-v/m[p*c+p],f=p;r>f;f++)m[f*c+g]+=v*m[f*c+p]}for(f=p;r>f;f++)m[f*c+p]=-m[f*c+p];for(m[p*c+p]=1+m[p*c+p],f=0;p-1>f;f++)m[f*c+p]=0}else{for(f=0;r>f;f++)m[f*c+p]=0;m[p*c+p]=1}}if(C)for(p=o-1;p>=0;p--){if(P>p&&0!==T[p])for(g=p+1;c>g;g++){for(v=0,f=p+1;o>f;f++)v+=E[f*o+p]*E[f*o+g];for(v=-v/E[(p+1)*o+p],f=p+1;o>f;f++)E[f*o+g]+=v*E[f*o+p]}for(f=0;o>f;f++)E[f*o+p]=0;E[p*o+p]=1}for(var M=A-1,N=0,I=u(2,-52),D=u(2,-966);A>0;){var Y;if(N>500)break;for(p=A-2;p>=-1&&-1!==p;p--)if(l(T[p])<=D+I*(l(d[p])+l(d[p+1]))){T[p]=0;break}if(p===A-2)Y=4;else{var L;for(L=A-1;L>=p&&L!==p;L--)if(v=(L!==A?l(T[L]):0)+(L!==p+1?l(T[L-1]):0),l(d[L])<=D+I*v){d[L]=0;break}L===p?Y=3:L===A-1?Y=1:(Y=2,p=L)}switch(p++,Y){case 1:for(y=T[A-2],T[A-2]=0,g=A-2;g>=p;g--)if(v=w(d[g],y),x=d[g]/v,_=y/v,d[g]=v,g!==p&&(y=-_*T[g-1],T[g-1]=x*T[g-1]),C)for(f=0;o>f;f++)v=x*E[f*o+g]+_*E[f*o+A-1],E[f*o+A-1]=-_*E[f*o+g]+x*E[f*o+A-1],E[f*o+g]=v;break;case 2:for(y=T[p-1],T[p-1]=0,g=p;A>g;g++)if(v=w(d[g],y),x=d[g]/v,_=y/v,d[g]=v,y=-_*T[g],T[g]=x*T[g],b)for(f=0;r>f;f++)v=x*m[f*c+g]+_*m[f*c+p-1],m[f*c+p-1]=-_*m[f*c+g]+x*m[f*c+p-1],m[f*c+g]=v;break;case 3:var O=h(h(h(h(l(d[A-1]),l(d[A-2])),l(T[A-2])),l(d[p])),l(T[p])),B=d[A-1]/O,k=d[A-2]/O,V=T[A-2]/O,F=d[p]/O,X=T[p]/O,G=((k+B)*(k-B)+V*V)/2,H=B*V*B*V,z=0;(0!==G||0!==H)&&(z=Math.sqrt(G*G+H),0>G&&(z=-z),z=H/(G+z)),y=(F+B)*(F-B)+z;var q=F*X;for(g=p;A-1>g;g++){if(v=w(y,q),x=y/v,_=q/v,g!==p&&(T[g-1]=v),y=x*d[g]+_*T[g],T[g]=x*T[g]-_*d[g],q=_*d[g+1],d[g+1]=x*d[g+1],C)for(f=0;o>f;f++)v=x*E[f*o+g]+_*E[f*o+g+1],E[f*o+g+1]=-_*E[f*o+g]+x*E[f*o+g+1],E[f*o+g]=v;if(v=w(y,q),x=y/v,_=q/v,d[g]=v,y=x*T[g]+_*d[g+1],d[g+1]=-_*T[g]+x*d[g+1],q=_*T[g+1],T[g+1]=x*T[g+1],b&&r-1>g)for(f=0;r>f;f++)v=x*m[f*c+g]+_*m[f*c+g+1],m[f*c+g+1]=-_*m[f*c+g]+x*m[f*c+g+1],m[f*c+g]=v}T[A-2]=y,N+=1;break;case 4:if(d[p]<=0&&(d[p]=d[p]<0?-d[p]:0,C))for(f=0;M>=f;f++)E[f*o+p]=-E[f*o+p];for(;M>p&&!(d[p]>=d[p+1]);){if(v=d[p],d[p]=d[p+1],d[p+1]=v,C&&o-1>p)for(f=0;o>f;f++)v=E[f*o+p+1],E[f*o+p+1]=E[f*o+p],E[f*o+p]=v;if(b&&r-1>p)for(f=0;r>f;f++)v=m[f*c+p+1],m[f*c+p+1]=m[f*c+p],m[f*c+p]=v;p++}N=0,A--}}};var n=e.SingularValueDecomposition;return n.prototype={constructor:n,getU:function(){return new e.Matrix(this.m,Math.min(this.m+1,this.n),this.U,!0)},getV:function(){return new e.Matrix(this.n,this.n,this.V,!0)},getSingularValues:function(){return this.s},getS:function(){for(var t=new e.Matrix(this.n,this.n),i=0;i<this.n;i++){for(var n=0;n<this.n;n++)t.entries[t.index(i,n)]=0;t.entries[t.index(i,i)]=this.s[i]}return t},norm2:function(){return this.s[0]},cond:function(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]},rank:function(){for(var t=Math.pow(2,-23),e=Math.max(this.m,this.n)*this.s[0]*t,i=0,n=0;n<this.s.length;n++)this.s[n]>e&&i++;return i}},n}),i("DOT/QRDecomposition",["require","DOT/dot"],function(t){var e=t("DOT/dot"),i=window.Float32Array||Array;e.QRDecomposition=function(t){this.matrix=t,this.QR=t.getArrayCopy();var n=this.QR;this.m=t.getRowDimension();var s=this.m;this.n=t.getColumnDimension();var r=this.n;this.Rdiag=new i(r);var o,a,h;for(h=0;r>h;h++){var u=0;for(o=h;s>o;o++)u=e.Matrix.hypot(u,n[this.matrix.index(o,h)]);if(0!==u){for(n[this.matrix.index(h,h)]<0&&(u=-u),o=h;s>o;o++)n[this.matrix.index(o,h)]/=u;for(n[this.matrix.index(h,h)]+=1,a=h+1;r>a;a++){var l=0;for(o=h;s>o;o++)l+=n[this.matrix.index(o,h)]*n[this.matrix.index(o,a)];for(l=-l/n[this.matrix.index(h,h)],o=h;s>o;o++)n[this.matrix.index(o,a)]+=l*n[this.matrix.index(o,h)]}}this.Rdiag[h]=-u}};var n=e.QRDecomposition;return n.prototype={constructor:n,isFullRank:function(){for(var t=0;t<this.n;t++)if(0===this.Rdiag[t])return!1;return!0},getH:function(){for(var t=new e.Matrix(this.m,this.n),i=0;i<this.m;i++)for(var n=0;n<this.n;n++)t.entries[t.index(i,n)]=i>=n?this.QR[this.matrix.index(i,n)]:0;return t},getR:function(){for(var t=new e.Matrix(this.n,this.n),i=0;i<this.n;i++)for(var n=0;n<this.n;n++)t.entries[t.index(i,n)]=n>i?this.QR[this.matrix.index(i,n)]:i===n?this.Rdiag[i]:0;return t},getQ:function(){var t,i,n,s=new e.Matrix(this.m,this.n);for(n=this.n-1;n>=0;n--){for(t=0;t<this.m;t++)s.entries[s.index(t,n)]=0;for(s.entries[s.index(n,n)]=1,i=n;i<this.n;i++)if(0!==this.QR[this.matrix.index(n,n)]){var r=0;for(t=n;t<this.m;t++)r+=this.QR[this.matrix.index(t,n)]*s.entries[s.index(t,i)];for(r=-r/this.QR[this.matrix.index(n,n)],t=n;t<this.m;t++)s.entries[s.index(t,i)]+=r*this.QR[this.matrix.index(t,n)]}}return s},solve:function(t){if(t.getRowDimension()!==this.m)throw new Error("Matrix row dimensions must agree.");if(!this.isFullRank())throw new Error("Matrix is rank deficient.");var i,n,s,r=t.getColumnDimension(),o=t.getArrayCopy();for(s=0;s<this.n;s++)for(n=0;r>n;n++){var a=0;for(i=s;i<this.m;i++)a+=this.QR[this.matrix.index(i,s)]*o[t.index(i,n)];for(a=-a/this.QR[this.matrix.index(s,s)],i=s;i<this.m;i++)o[t.index(i,n)]+=a*this.QR[this.matrix.index(i,s)]}for(s=this.n-1;s>=0;s--){for(n=0;r>n;n++)o[t.index(s,n)]/=this.Rdiag[s];for(i=0;s>i;i++)for(n=0;r>n;n++)o[t.index(i,n)]-=o[t.index(s,n)]*this.QR[this.matrix.index(i,s)]}return new e.Matrix(o,this.n,r).getMatrix(0,this.n-1,0,r-1)}},n}),i("DOT/Matrix",["require","DOT/dot","PHET_CORE/isArray","DOT/SingularValueDecomposition","DOT/LUDecomposition","DOT/QRDecomposition","DOT/EigenvalueDecomposition","DOT/Vector2","DOT/Vector3","DOT/Vector4"],function(t){var e=t("DOT/dot"),i=window.Float32Array||Array,n=t("PHET_CORE/isArray");t("DOT/SingularValueDecomposition"),t("DOT/LUDecomposition"),t("DOT/QRDecomposition"),t("DOT/EigenvalueDecomposition"),t("DOT/Vector2"),t("DOT/Vector3"),t("DOT/Vector4"),e.Matrix=function(t,e,s,r){this.m=t,this.n=e;var o=t*e;this.size=o;var a;if(r)this.entries=s;else if(s||(s=0),this.entries=new i(o),n(s))for(a=0;o>a;a++)this.entries[a]=s[a];else for(a=0;o>a;a++)this.entries[a]=s};var s=e.Matrix;return s.hypot=function(t,e){var i;return Math.abs(t)>Math.abs(e)?(i=e/t,i=Math.abs(t)*Math.sqrt(1+i*i)):0!==e?(i=t/e,i=Math.abs(e)*Math.sqrt(1+i*i)):i=0,i},s.prototype={constructor:s,copy:function(){for(var t=new s(this.m,this.n),e=0;e<this.size;e++)t.entries[e]=this.entries[e];return t},getArray:function(){return this.entries},getArrayCopy:function(){return new i(this.entries)},getRowDimension:function(){return this.m},getColumnDimension:function(){return this.n},index:function(t,e){return t*this.n+e},get:function(t,e){return this.entries[this.index(t,e)]},set:function(t,e,i){this.entries[this.index(t,e)]=i},getMatrix:function(t,e,i,n){for(var r=new s(e-t+1,n-i+1),o=t;e>=o;o++)for(var a=i;n>=a;a++)r.entries[r.index(o-t,a-i)]=this.entries[this.index(o,a)];return r},getArrayRowMatrix:function(t,e,i){for(var n=new s(t.length,i-e+1),r=0;r<t.length;r++)for(var o=e;i>=o;o++)n.entries[n.index(r,o-e)]=this.entries[this.index(t[r],o)];return n},transpose:function(t){t=t||new s(this.n,this.m);for(var e=0;e<this.m;e++)for(var i=0;i<this.n;i++)t.entries[t.index(i,e)]=this.entries[this.index(e,i)];return t},norm1:function(){for(var t=0,e=0;e<this.n;e++){for(var i=0,n=0;n<this.m;n++)i+=Math.abs(this.entries[this.index(n,e)]);t=Math.max(t,i)}return t},norm2:function(){return new e.SingularValueDecomposition(this).norm2()},normInf:function(){for(var t=0,e=0;e<this.m;e++){for(var i=0,n=0;n<this.n;n++)i+=Math.abs(this.entries[this.index(e,n)]);t=Math.max(t,i)}return t},normF:function(){for(var t=0,e=0;e<this.m;e++)for(var i=0;i<this.n;i++)t=s.hypot(t,this.entries[this.index(e,i)]);return t},uminus:function(){for(var t=new s(this.m,this.n),e=0;e<this.m;e++)for(var i=0;i<this.n;i++)t.entries[t.index(e,i)]=-this.entries[this.index(e,i)];return t},plus:function(t){this.checkMatrixDimensions(t);for(var e=new s(this.m,this.n),i=0;i<this.m;i++)for(var n=0;n<this.n;n++){var r=e.index(i,n);e.entries[r]=this.entries[r]+t.entries[r]}return e},plusEquals:function(t){this.checkMatrixDimensions(t);for(var e=new s(this.m,this.n),i=0;i<this.m;i++)for(var n=0;n<this.n;n++){var r=e.index(i,n);this.entries[r]=this.entries[r]+t.entries[r]}return this},minus:function(t){this.checkMatrixDimensions(t);for(var e=new s(this.m,this.n),i=0;i<this.m;i++)for(var n=0;n<this.n;n++){var r=this.index(i,n);e.entries[r]=this.entries[r]-t.entries[r]}return e},minusEquals:function(t){this.checkMatrixDimensions(t);for(var e=0;e<this.m;e++)for(var i=0;i<this.n;i++){var n=this.index(e,i);this.entries[n]=this.entries[n]-t.entries[n]}return this},arrayTimes:function(t){this.checkMatrixDimensions(t);for(var e=new s(this.m,this.n),i=0;i<this.m;i++)for(var n=0;n<this.n;n++){var r=e.index(i,n);e.entries[r]=this.entries[r]*t.entries[r]}return e},arrayTimesEquals:function(t){this.checkMatrixDimensions(t);for(var e=0;e<this.m;e++)for(var i=0;i<this.n;i++){var n=this.index(e,i);this.entries[n]=this.entries[n]*t.entries[n]}return this},arrayRightDivide:function(t){this.checkMatrixDimensions(t);for(var e=new s(this.m,this.n),i=0;i<this.m;i++)for(var n=0;n<this.n;n++){var r=this.index(i,n);e.entries[r]=this.entries[r]/t.entries[r]}return e},arrayRightDivideEquals:function(t){this.checkMatrixDimensions(t);for(var e=0;e<this.m;e++)for(var i=0;i<this.n;i++){var n=this.index(e,i);this.entries[n]=this.entries[n]/t.entries[n]}return this},arrayLeftDivide:function(t){this.checkMatrixDimensions(t);for(var e=new s(this.m,this.n),i=0;i<this.m;i++)for(var n=0;n<this.n;n++){var r=this.index(i,n);e.entries[r]=t.entries[r]/this.entries[r]}return e},arrayLeftDivideEquals:function(t){this.checkMatrixDimensions(t);for(var e=0;e<this.m;e++)for(var i=0;i<this.n;i++){var n=this.index(e,i);this.entries[n]=t.entries[n]/this.entries[n]}return this},times:function(t){var e,n,r,o,a,h;if(t.isMatrix){if(h=t,h.m!==this.n)throw new Error("Matrix inner dimensions must agree.");e=new s(this.m,h.n);var u=new i(this.n);for(r=0;r<h.n;r++){for(o=0;o<this.n;o++)u[o]=h.entries[h.index(o,r)];for(n=0;n<this.m;n++){for(a=0,o=0;o<this.n;o++)a+=this.entries[this.index(n,o)]*u[o];e.entries[e.index(n,r)]=a}}return e}for(a=t,e=new s(this.m,this.n),n=0;n<this.m;n++)for(r=0;r<this.n;r++)e.entries[e.index(n,r)]=a*this.entries[this.index(n,r)];return e},timesEquals:function(t){for(var e=0;e<this.m;e++)for(var i=0;i<this.n;i++){var n=this.index(e,i);this.entries[n]=t*this.entries[n]}return this},solve:function(t){return this.m===this.n?new e.LUDecomposition(this).solve(t):new e.QRDecomposition(this).solve(t)},solveTranspose:function(t){return this.transpose().solve(t.transpose())},inverse:function(){return this.solve(s.identity(this.m,this.m))},det:function(){return new e.LUDecomposition(this).det()},rank:function(){return new e.SingularValueDecomposition(this).rank()},cond:function(){return new e.SingularValueDecomposition(this).cond()},trace:function(){for(var t=0,e=0;e<Math.min(this.m,this.n);e++)t+=this.entries[this.index(e,e)];return t},checkMatrixDimensions:function(t){if(t.m!==this.m||t.n!==this.n)throw new Error("Matrix dimensions must agree.")},toString:function(){var t="";t+="dim: "+this.getRowDimension()+"x"+this.getColumnDimension()+"\n";for(var e=0;e<this.getRowDimension();e++){for(var i=0;i<this.getColumnDimension();i++)t+=this.get(e,i)+" ";t+="\n"}return t},extractVector2:function(t){return new e.Vector2(this.get(0,t),this.get(1,t))},extractVector3:function(t){return new e.Vector3(this.get(0,t),this.get(1,t),this.get(2,t))},extractVector4:function(t){return new e.Vector4(this.get(0,t),this.get(1,t),this.get(2,t),this.get(3,t))},setVectors3:function(t){for(var e=t.length,i=0;e>i;i++){var n=t[i];this.entries[i]=n.x,this.entries[i+e]=n.y,this.entries[i+2*e]=n.z}return this},isMatrix:!0},s.identity=function(t,e){for(var i=new s(t,e),n=0;t>n;n++)for(var r=0;e>r;r++)i.entries[i.index(n,r)]=n===r?1:0;return i},s.rowVector2=function(t){return new s(1,2,[t.x,t.y])},s.rowVector3=function(t){return new s(1,3,[t.x,t.y,t.z])},s.rowVector4=function(t){return new s(1,4,[t.x,t.y,t.z,t.w])},s.rowVector=function(t){if(t.isVector2)return s.rowVector2(t);if(t.isVector3)return s.rowVector3(t);if(t.isVector4)return s.rowVector4(t);throw new Error("undetected type of vector: "+t.toString())},s.columnVector2=function(t){return new s(2,1,[t.x,t.y])},s.columnVector3=function(t){return new s(3,1,[t.x,t.y,t.z])},s.columnVector4=function(t){return new s(4,1,[t.x,t.y,t.z,t.w])},s.columnVector=function(t){if(t.isVector2)return s.columnVector2(t);if(t.isVector3)return s.columnVector3(t);if(t.isVector4)return s.columnVector4(t);throw new Error("undetected type of vector: "+t.toString())},s.fromVectors2=function(t){for(var e=2,n=t.length,r=new i(e*n),o=0;n>o;o++){var a=t[o];r[o]=a.x,r[o+n]=a.y}return new s(e,n,r,!0)},s.fromVectors3=function(t){for(var e=3,n=t.length,r=new i(e*n),o=0;n>o;o++){var a=t[o];r[o]=a.x,r[o+n]=a.y,r[o+2*n]=a.z}return new s(e,n,r,!0)},s.fromVectors4=function(t){for(var e=4,n=t.length,r=new i(e*n),o=0;n>o;o++){var a=t[o];r[o]=a.x,r[o+n]=a.y,r[o+2*n]=a.z,r[o+3*n]=a.w}return new s(e,n,r,!0)},s}),i("AXON/axon",["require"],function(){var t={};return t}),i("AXON/Multilink",["require","AXON/axon","PHET_CORE/inherit"],function(t){var e=t("AXON/axon"),i=t("PHET_CORE/inherit");return e.Multilink=function(t,e,i){this.dependencies=t,this.dependencyValues=t.map(function(t){return t.get()});var n=this;this.dependencyListeners=[];for(var s=0;s<t.length;s++){var r=t[s];!function(t,i){var s=function(t){n.dependencyValues[i]=t,e.apply(null,n.dependencyValues)};n.dependencyListeners.push(s),t.lazyLink(s)}(r,s)}i||e.apply(null,this.dependencyValues)},i(Object,e.Multilink,{detach:function(){for(var t=0;t<this.dependencies.length;t++){var e=this.dependencies[t];e.unlink(this.dependencyListeners[t])}}})}),i("AXON/Property",["require","AXON/axon","AXON/Multilink"],function(t){var e=t("AXON/axon");return t("AXON/Multilink"),e.Property=function(t){this.storeValue(t),this.storeInitialValue(t),this._observers=[]},e.Property.prototype={get:function(){return this._value},set:function(t){return this.equalsValue(t)||this._setAndNotifyObservers(t),this},equalsValue:function(t){return t===this._value},storeValue:function(t){this._value=t},storeInitialValue:function(t){this._initialValue=t},get initialValue(){return this._initialValue},_setAndNotifyObservers:function(t){var e=this.get();this.storeValue(t),this._notifyObservers(e)},_notifyObservers:function(t){for(var e=this.get(),i=this._observers.slice(),n=0;n<i.length;n++)i[n](e,t)},notifyObserversStatic:function(){for(var t=this.get(),e=0;e<this._observers.length;e++)this._observers[e](t)},reset:function(){this.set(this._initialValue)},_set:function(t){return this.set.bind(this,t)},get value(){return this.get()},set value(t){this.set(t)},link:function(t){-1===this._observers.indexOf(t)&&(this._observers.push(t),t(this.get(),null))},unlink:function(t){var e=this._observers.indexOf(t);-1!==e&&this._observers.splice(e,1)},lazyLink:function(t){-1===this._observers.indexOf(t)&&this._observers.push(t)},toString:function(){return"Property{"+this.get()+"}"},valueOf:function(){return this.toString()},once:function(t){var e=this,i=function(n,s){e.unlink(i),t(n,s)};return this.lazyLink(i),i},linkAttribute:function(t,e){var i=function(i){t[e]=i};return this.link(i),i},valueEquals:function(t){return new e.DerivedProperty([this],function(e){return e===t})},and:function(t){return new e.DerivedProperty([this,t],function(t,e){return t&&e})},or:function(t){return new e.DerivedProperty([this,t],function(t,e){return t||e})},times:function(t){return new e.DerivedProperty([this],function(e){return e*t})},derivedNot:function(){return new e.DerivedProperty([this],function(t){return!t})},not:function(){var t=this,i=new e.Property(!this.value),n=function(t){i.set(!t)};t.link(n);var s=function(e){t.set(!e)};return i.link(s),i.detach=function(){t.unlink(n),i.unlink(s)},i},debug:function(t){var e=function(e){console.log(t,e)};return this.link(e),e},mapValues:function(t){return new e.DerivedProperty([this],function(e){return t[e]})},map:function(t){return new e.DerivedProperty([this],function(e){return t(e)})},get toggleFunction(){return this.toggle.bind(this)},toggle:function(){this.value=!this.value},onValue:function(t,e){var i=function(i){i===t&&e()};return this.link(i),i}},e.Property.multilink=function(t,i){return new e.Multilink(t,i,!1)},e.Property.lazyMultilink=function(t,i){return new e.Multilink(t,i,!0)},e.Property}),i("DOT/ObservableBounds2",["require","DOT/dot","PHET_CORE/inherit","PHET_CORE/extend","PHET_CORE/Poolable","AXON/Property","DOT/Bounds2"],function(t){var e=t("DOT/dot"),i=t("PHET_CORE/inherit"),n=t("PHET_CORE/extend"),s=t("PHET_CORE/Poolable"),r=t("AXON/Property");t("DOT/Bounds2"),e.ObservableBounds2=function(t,i,n,s){e.Bounds2.call(this,t,i,n,s),this._oldValue=this.copy(),r.call(this,this)};var o=e.ObservableBounds2;return i(e.Bounds2,o,n({},r.prototype,{get:function(){return this},setMinMax:function(t,e,i,n){return(this.minX!==t||this.minY!==e||this.maxX!==i||this.maxY!==n)&&(this._oldValue.minX=this.minX,this._oldValue.minY=this.minY,this._oldValue.maxX=this.maxX,this._oldValue.maxY=this.maxY,this.minX=t,this.minY=e,this.maxX=i,this.maxY=n,this._notifyObservers(this._oldValue)),this},setMinX:function(t){return this.minX!==t&&(this._oldValue.minX=this.minX,this.minX=t,this._notifyObservers(this._oldValue)),this},setMinY:function(t){return this.minY!==t&&(this._oldValue.minY=this.minY,this.minY=t,this._notifyObservers(this._oldValue)),this},setMaxX:function(t){return this.maxX!==t&&(this._oldValue.maxX=this.maxX,this.maxX=t,this._notifyObservers(this._oldValue)),this},setMaxY:function(t){return this.maxY!==t&&(this._oldValue.maxY=this.maxY,this.maxY=t,this._notifyObservers(this._oldValue)),this},set:e.Bounds2.prototype.set,equalsValue:function(t){return this.equals(t)},storeValue:function(){},storeInitialValue:function(t){this._initialMinX=t.minX,this._initialMinY=t.minY,this._initialMaxX=t.maxX,this._initialMaxY=t.maxY},reset:function(){this.setMinMax(this._initialMinX,this._initialMinY,this._initialMaxX,this._initialMaxY)},toString:function(){return"ObservableBounds2("+this.minX+", "+this.minY+", "+this.maxX+", "+this.maxY+")"}})),s(o,{defaultFactory:function(){return new o},constructorDuplicateFactory:function(t){return function(e,i,n,s){return t.length?t.pop().setMinMax(e,i,n,s):new o(e,i,n,s)}}}),o}),i("DOT/ObservableMatrix3",["require","DOT/dot","PHET_CORE/inherit","PHET_CORE/extend","PHET_CORE/Poolable","AXON/Property","DOT/Matrix3"],function(t){var e=t("DOT/dot"),i=t("PHET_CORE/inherit"),n=t("PHET_CORE/extend"),s=t("PHET_CORE/Poolable"),r=t("AXON/Property");t("DOT/Matrix3"),e.ObservableMatrix3=function(t,i,n,s,o,a,h,u,l,c){e.Matrix3.call(this,t,i,n,s,o,a,h,u,l,c),this._oldValue=this.copy(),this._skipChecks=!1,r.call(this,this)};var o=e.ObservableMatrix3;return i(e.Matrix3,o,n({},r.prototype,{get:function(){return this},rowMajor:function(t,i,n,s,r,o,a,h,u,l){var c=this._skipChecks,d=c||t!==this.entries[0]||s!==this.entries[1]||a!==this.entries[2]||i!==this.entries[3]||r!==this.entries[4]||h!==this.entries[5]||n!==this.entries[6]||o!==this.entries[7]||u!==this.entries[8]||l!==this.type;return d&&(!c&&this._oldValue&&(this._oldValue.entries[0]=this.entries[0],this._oldValue.entries[1]=this.entries[1],this._oldValue.entries[2]=this.entries[2],this._oldValue.entries[3]=this.entries[3],this._oldValue.entries[4]=this.entries[4],this._oldValue.entries[5]=this.entries[5],this._oldValue.entries[6]=this.entries[6],this._oldValue.entries[7]=this.entries[7],this._oldValue.entries[8]=this.entries[8],this._oldValue.type=this.type),this.entries[0]=t,this.entries[1]=s,this.entries[2]=a,this.entries[3]=i,this.entries[4]=r,this.entries[5]=h,this.entries[6]=n,this.entries[7]=o,this.entries[8]=u,this.type=void 0===l?0===a&&0===h&&1===u?e.Matrix3.Types.AFFINE:e.Matrix3.Types.OTHER:l,this._observers&&this._notifyObservers(c?null:this._oldValue)),this
},set:e.Matrix3.prototype.set,equalsValue:function(t){return this.equals(t)},storeValue:function(){},storeInitialValue:function(t){this._initial00=t.m00(),this._initial01=t.m01(),this._initial02=t.m02(),this._initial10=t.m10(),this._initial11=t.m11(),this._initial12=t.m12(),this._initial20=t.m20(),this._initial21=t.m21(),this._initial22=t.m22(),this._initialType=t.type},reset:function(){this.rowMajor(this._initial00,this._initial01,this._initial02,this._initial10,this._initial11,this._initial12,this._initial20,this._initial21,this._initial22,this._initialType)},toString:e.Matrix3.prototype.toString})),s(o,{defaultFactory:function(){return new o},constructorDuplicateFactory:function(t){return function(e,i,n,s,r,a,h,u,l,c){return t.length?t.pop().rowMajor(e,i,n,s,r,a,h,u,l,c):new o(e,i,n,s,r,a,h,u,l,c)}}}),o}),i("DOT/ObservableVector2",["require","DOT/dot","PHET_CORE/inherit","PHET_CORE/extend","PHET_CORE/Poolable","AXON/Property","DOT/Vector2"],function(t){var e=t("DOT/dot"),i=t("PHET_CORE/inherit"),n=t("PHET_CORE/extend"),s=t("PHET_CORE/Poolable"),r=t("AXON/Property");t("DOT/Vector2"),e.ObservableVector2=function(t,i){e.Vector2.call(this,t,i),this._oldValue=this.copy(),r.call(this,this)};var o=e.ObservableVector2;return i(e.Vector2,o,n({},r.prototype,{get:function(){return this},setXY:function(t,e){return(this.x!==t||this.y!==e)&&(this._oldValue.x=this.x,this._oldValue.y=this.y,this.x=t,this.y=e,this._notifyObservers(this._oldValue)),this},setX:function(t){return this.x!==t&&(this._oldValue.x=this.x,this.x=t,this._notifyObservers(this._oldValue)),this},setY:function(t){return this.y!==t&&(this._oldValue.y=this.y,this.y=t,this._notifyObservers(this._oldValue)),this},set:e.Vector2.prototype.set,equalsValue:function(t){return this.equals(t)},storeValue:function(){},storeInitialValue:function(t){this._initialX=t.x,this._initialY=t.y},reset:function(){this.setXY(this._initialX,this._initialY)},toString:function(){return"ObservableVector2("+this.x+", "+this.y+")"}})),s(o,{defaultFactory:function(){return new o},constructorDuplicateFactory:function(t){return function(e,i){return t.length?t.pop().setXY(e,i):new o(e,i)}}}),o}),i("DOT/Permutation",["require","DOT/dot","PHET_CORE/isArray","DOT/Util"],function(t){function e(t,i,n){if(0===t.length)n.call(void 0,i);else for(var s=0;s<t.length;s++){var r=t[s],o=t.slice(0);o.splice(s,1);var a=i.slice(0);a.push(r),e(o,a,n)}}var i=t("DOT/dot"),n=t("PHET_CORE/isArray");t("DOT/Util");var s=i.Permutation=function(t){this.indices=t};return s.identity=function(t){for(var e=new Array(t),i=0;t>i;i++)e[i]=i;return new s(e)},s.permutations=function(t){var e=[];return s.forEachPermutation(i.rangeInclusive(0,t-1),function(t){e.push(new s(t))}),e},s.forEachPermutation=function(t,i){e(t,[],i)},s.prototype={constructor:s,size:function(){return this.indices.length},apply:function(t){if(n(t)){if(t.length!==this.size())throw new Error("Permutation length "+this.size()+" not equal to list length "+t.length);for(var e=new Array(t.length),i=0;i<t.length;i++)e[i]=t[this.indices[i]];return e}return this.indices[t]},inverted:function(){for(var t=new Array(this.size()),e=0;e<this.size();e++)t[this.indices[e]]=e;return new s(t)},withIndicesPermuted:function(t){var e=[],i=this;return s.forEachPermutation(t,function(n){for(var r=i.indices,o=r.slice(0),a=0;a<t.length;a++)o[t[a]]=r[n[a]];e.push(new s(o))}),e},toString:function(){return"P["+this.indices.join(", ")+"]"}},s.testMe=function(t){var e=new s([1,4,3,2,0]);t.log(e.toString());var i=e.inverted();t.log(i.toString()),t.log(i.withIndicesPermuted([0,3,4]).toString()),t.log(s.permutations(4).toString())},s}),i("DOT/Plane3",["require","DOT/dot","DOT/Vector3"],function(t){var e=t("DOT/dot"),i=t("DOT/Vector3");e.Plane3=function(t,e){this.normal=t,this.distance=e};var n=e.Plane3;return n.prototype={constructor:n,intersectWithRay:function(t){return t.pointAtDistance(t.distanceToPlane(this))}},n.XY=new n(new i(0,0,1),0),n.XZ=new n(new i(0,1,0),0),n.YZ=new n(new i(1,0,0),0),n.fromTriangle=function(t,e,i){var s=i.minus(t).cross(e.minus(t));return 0===s.magnitude()?null:(s.normalize(),new n(s,s.dot(t)))},n}),i("DOT/Quaternion",["require","DOT/dot","PHET_CORE/Poolable","DOT/Vector3","DOT/Matrix3","DOT/Util"],function(t){var e=t("DOT/dot"),i=t("PHET_CORE/Poolable");t("DOT/Vector3"),t("DOT/Matrix3"),t("DOT/Util"),e.Quaternion=function(t,e,i,n){this.setXYZW(t,e,i,n)};var n=e.Quaternion;return n.prototype={constructor:n,isQuaternion:!0,setXYZW:function(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==n?n:1},plus:function(t){return new n(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},timesScalar:function(t){return new n(this.x*t,this.y*t,this.z*t,this.w*t)},timesQuaternion:function(t){return new n(this.x*t.w-this.z*t.y+this.y*t.z+this.w*t.x,-this.x*t.z+this.y*t.w+this.z*t.x+this.w*t.y,this.x*t.y-this.y*t.x+this.z*t.w+this.w*t.z,-this.x*t.x-this.y*t.y-this.z*t.z+this.w*t.w)},timesVector3:function(t){return 0===t.magnitude()?new e.Vector3:new e.Vector3(this.w*this.w*t.x+2*this.y*this.w*t.z-2*this.z*this.w*t.y+this.x*this.x*t.x+2*this.y*this.x*t.y+2*this.z*this.x*t.z-this.z*this.z*t.x-this.y*this.y*t.x,2*this.x*this.y*t.x+this.y*this.y*t.y+2*this.z*this.y*t.z+2*this.w*this.z*t.x-this.z*this.z*t.y+this.w*this.w*t.y-2*this.x*this.w*t.z-this.x*this.x*t.y,2*this.x*this.z*t.x+2*this.y*this.z*t.y+this.z*this.z*t.z-2*this.w*this.y*t.x-this.y*this.y*t.z+2*this.w*this.x*t.y-this.x*this.x*t.z+this.w*this.w*t.z)},magnitude:function(){return Math.sqrt(this.magnitudeSquared())},magnitudeSquared:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},normalized:function(){var t=this.magnitude();return this.timesScalar(1/t)},negated:function(){return new n(-this.x,-this.y,-this.z,-this.w)},toRotationMatrix:function(){var t=this.magnitudeSquared(),i=1===t?2:t>0?2/t:0,n=this.x*this.x*i,s=this.x*this.y*i,r=this.x*this.z*i,o=this.w*this.x*i,a=this.y*this.y*i,h=this.y*this.z*i,u=this.w*this.y*i,l=this.z*this.z*i,c=this.w*this.z*i;return e.Matrix3.dirtyFromPool().columnMajor(1-(a+l),s+c,r-u,s-c,1-(n+l),h+o,r+u,h-o,1-(n+a))}},n.fromEulerAngles=function(t,e,i){var s=Math.sin(.5*i),r=Math.cos(.5*i),o=Math.sin(.5*e),a=Math.cos(.5*e),h=Math.sin(.5*t),u=Math.cos(.5*t),l=a*r,c=o*s,d=a*s,m=o*r;return new n(l*h+c*u,m*u+d*h,d*u-m*h,l*u-c*h)},n.fromRotationMatrix=function(t){var e,i=t.m00(),s=t.m01(),r=t.m02(),o=t.m10(),a=t.m11(),h=t.m12(),u=t.m20(),l=t.m21(),c=t.m22(),d=i+a+c;return d>=0?(e=Math.sqrt(d+1),new n(.5*(l-h)/e,.5*(r-u)/e,.5*(o-s)/e,.5*e)):i>a&&i>c?(e=Math.sqrt(1+i-a-c),new n(.5*e,.5*(o+s)/e,.5*(r+u)/e,.5*(l-h)/e)):a>c?(e=Math.sqrt(1+a-i-c),new n(.5*(o+s)/e,.5*e,.5*(l+h)/e,.5*(r-u)/e)):(e=Math.sqrt(1+c-i-a),new n(.5*(r+u)/e,.5*(l+h)/e,.5*e,.5*(o-s)/e))},n.getRotationQuaternion=function(t,i){return n.fromRotationMatrix(e.Matrix3.rotateAToB(t,i))},n.slerp=function(t,e,i){if(t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w)return t;var s=t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w;0>s&&(e=e.negated(),s=-s);var r=1-i,o=i;if(1-s>.1){var a=Math.acos(s),h=1/Math.sin(a);r=Math.sin((1-i)*a)*h,o=Math.sin(i*a)*h}return new n(r*t.x+o*e.x,r*t.y+o*e.y,r*t.z+o*e.z,r*t.w+o*e.w)},i(n,{defaultFactory:function(){return new n},constructorDuplicateFactory:function(t){return function(e,i,s,r){return t.length?t.pop().set(e,i,s,r):new n(e,i,s,r)}}}),n}),i("DOT/Ray3",["require","DOT/dot"],function(t){var e=t("DOT/dot");e.Ray3=function(t,e){this.pos=t,this.dir=e};var i=e.Ray3;return i.prototype={constructor:i,shifted:function(t){return new i(this.pointAtDistance(t),this.dir)},pointAtDistance:function(t){return this.pos.plus(this.dir.timesScalar(t))},distanceToPlane:function(t){return(t.distance-this.pos.dot(t.normal))/this.dir.dot(t.normal)},toString:function(){return this.pos.toString()+" => "+this.dir.toString()}},i}),i("DOT/Rectangle",["require","DOT/dot","PHET_CORE/inherit","DOT/Bounds2"],function(t){var e=t("DOT/dot"),i=t("PHET_CORE/inherit"),n=t("DOT/Bounds2");e.Rectangle=function(t,e,i,s){n.call(this,t,e,t+i,e+s)};var s=e.Rectangle;return i(n,s),s}),i("DOT/Sphere3",["require","DOT/dot"],function(t){var e=t("DOT/dot");e.Sphere3=function(t,e){this.center=t,this.radius=e};var i=e.Sphere3;return i.prototype={constructor:i,intersect:function(t,e){var i=t.dir,n=t.pos,s=n.minus(this.center),r=i.dot(s),o=s.magnitudeSquared(),a=4*r*r-4*(o-this.radius*this.radius);if(e>a)return null;var h=i.dot(this.center)-i.dot(n),u=Math.sqrt(a)/2,l=h-u,c=h+u;if(e>c)return null;var d=t.pointAtDistance(c),m=d.minus(this.center).normalized();if(e>l)return{distance:c,hitPoint:d,normal:m.negated(),fromOutside:!1};var f=t.pointAtDistance(l),g=f.minus(this.center).normalized();return{distance:l,hitPoint:f,normal:g,fromOutside:!0}},intersections:function(t,e){var i=t.dir,n=t.pos,s=n.minus(this.center),r=i.dot(s),o=s.magnitudeSquared(),a=4*r*r-4*(o-this.radius*this.radius);if(e>a)return[];var h=i.dot(this.center)-i.dot(n),u=Math.sqrt(a)/2,l=h-u,c=h+u;if(e>c)return[];var d=t.pointAtDistance(c),m=d.minus(this.center).normalized(),f=t.pointAtDistance(l),g=f.minus(this.center).normalized(),p={distance:c,hitPoint:d,normal:m.negated(),fromOutside:!1},v={distance:l,hitPoint:f,normal:g,fromOutside:!0};return e>l?[p,v]:[v,p]}},i}),i("DOT/Transform4",["require","DOT/dot","DOT/Matrix4","DOT/Vector3","DOT/Ray3"],function(t){var e=t("DOT/dot");t("DOT/Matrix4"),t("DOT/Vector3"),t("DOT/Ray3"),e.Transform4=function(t){this.setMatrix(void 0===t?e.Matrix4.IDENTITY:t)};var i=e.Transform4;return i.prototype={constructor:i,setMatrix:function(t){this.matrix=t,this.inverse=null,this.matrixTransposed=null,this.inverseTransposed=null},getMatrix:function(){return this.matrix},getInverse:function(){return null===this.inverse&&(this.inverse=this.matrix.inverted()),this.inverse},getMatrixTransposed:function(){return null===this.matrixTransposed&&(this.matrixTransposed=this.matrix.transposed()),this.matrixTransposed},getInverseTransposed:function(){return null===this.inverseTransposed&&(this.inverseTransposed=this.getInverse().transposed()),this.inverseTransposed},prepend:function(t){this.setMatrix(t.timesMatrix(this.matrix))},append:function(t){this.setMatrix(this.matrix.timesMatrix(t))},prependTransform:function(t){this.prepend(t.matrix)},appendTransform:function(t){this.append(t.matrix)},isIdentity:function(){return this.matrix.type===e.Matrix4.Types.IDENTITY},applyToCanvasContext:function(t){t.setTransform(this.matrix.m00(),this.matrix.m10(),this.matrix.m01(),this.matrix.m11(),this.matrix.m03(),this.matrix.m13())},transformPosition3:function(t){return this.matrix.timesVector3(t)},transformDelta3:function(t){return this.matrix.timesRelativeVector3(t)},transformNormal3:function(t){return this.getInverse().timesTransposeVector3(t)},transformDeltaX:function(t){return this.transformDelta3(new e.Vector3(t,0,0)).x},transformDeltaY:function(t){return this.transformDelta3(new e.Vector3(0,t,0)).y},transformDeltaZ:function(t){return this.transformDelta3(new e.Vector3(0,0,t)).z},transformRay:function(t){return new e.Ray3(this.transformPosition3(t.pos),this.transformPosition3(t.pos.plus(t.dir)).minus(this.transformPosition3(t.pos)))},inversePosition3:function(t){return this.getInverse().timesVector3(t)},inverseDelta3:function(t){return this.inversePosition3(t).minus(this.inversePosition3(e.Vector3.ZERO))},inverseNormal3:function(t){return this.matrix.timesTransposeVector3(t)},inverseDeltaX:function(t){return this.inverseDelta3(new e.Vector3(t,0,0)).x},inverseDeltaY:function(t){return this.inverseDelta3(new e.Vector3(0,t,0)).y},inverseDeltaZ:function(t){return this.inverseDelta3(new e.Vector3(0,0,t)).z},inverseRay:function(t){return new e.Ray3(this.inversePosition3(t.pos),this.inversePosition3(t.pos.plus(t.dir)).minus(this.inversePosition3(t.pos)))}},i}),i("DOT/main",["DOT/dot","DOT/Bounds2","DOT/Bounds3","DOT/Complex","DOT/ConvexHull2","DOT/Dimension2","DOT/EigenvalueDecomposition","DOT/LinearFunction","DOT/LUDecomposition","DOT/Matrix","DOT/Matrix3","DOT/Matrix4","DOT/ObservableBounds2","DOT/ObservableMatrix3","DOT/ObservableVector2","DOT/Permutation","DOT/Plane3","DOT/QRDecomposition","DOT/Quaternion","DOT/Ray2","DOT/Ray3","DOT/Rectangle","DOT/SingularValueDecomposition","DOT/Sphere3","DOT/Transform3","DOT/Transform4","DOT/Util","DOT/Vector2","DOT/Vector3","DOT/Vector4"],function(t){return t}),i("PHET_CORE/arrayRemove",["require","PHET_CORE/core"],function(t){var e=t("PHET_CORE/core");return e.arrayRemove=function(t,e){var i=_.indexOf(t,e);t.splice(i,1)},e.arrayRemove}),i("PHET_CORE/cleanArray",["require","PHET_CORE/core"],function(t){var e=t("PHET_CORE/core");return e.cleanArray=function(t){if(t){for(;t.length;)t.pop();return t}return[]},e.cleanArray}),i("PHET_CORE/collect",["require","PHET_CORE/core"],function(t){var e=t("PHET_CORE/core");return e.collect=function(t){var e=[];return t(function(t){e.push(t)}),e},e.collect}),i("PHET_CORE/detectPrefix",["require","PHET_CORE/core"],function(t){var e=t("PHET_CORE/core");return e.detectPrefix=function(t,e){return void 0!==t[e]?e:(e=e.charAt(0).toUpperCase()+e.slice(1),void 0!==t["moz"+e]?"moz"+e:void 0!==t["Moz"+e]?"Moz"+e:void 0!==t["webkit"+e]?"webkit"+e:void 0!==t["ms"+e]?"ms"+e:void 0!==t["o"+e]?"o"+e:void 0)},e.detectPrefix}),i("PHET_CORE/detectPrefixEvent",["require","PHET_CORE/core"],function(t){var e=t("PHET_CORE/core");return e.detectPrefixEvent=function(t,e){return void 0!==t["on"+e]?e:void 0!==t["onmoz"+e]?"moz"+e:void 0!==t["onMoz"+e]?"Moz"+e:void 0!==t["onwebkit"+e]?"webkit"+e:void 0!==t["onms"+e]?"ms"+e:void 0!==t["ono"+e]?"o"+e:void 0},e.detectPrefixEvent}),i("PHET_CORE/EventTimer",["require","PHET_CORE/core","PHET_CORE/inherit"],function(t){var e=t("PHET_CORE/core"),i=t("PHET_CORE/inherit");return e.EventTimer=function(t,e){this.eventModel=t,this.eventCallback=e,this.timeBeforeNextEvent=this.eventModel.getPeriodBeforeNextEvent()},i(Object,e.EventTimer,{step:function(t){for(;t>=this.timeBeforeNextEvent;)t-=this.timeBeforeNextEvent,this.timeBeforeNextEvent=this.eventModel.getPeriodBeforeNextEvent(),this.eventCallback(t);this.timeBeforeNextEvent-=t}}),e.EventTimer.ConstantEventModel=i(Object,function(t){this.rate=t},{getPeriodBeforeNextEvent:function(){return 1/this.rate}}),e.EventTimer.UniformEventModel=i(Object,function(t,e){this.rate=t,this.pseudoRandomNumberSource=e},{getPeriodBeforeNextEvent:function(){var t=this.pseudoRandomNumberSource();return 2*t/this.rate}}),e.EventTimer.PoissonEventModel=i(Object,function(t,e){this.rate=t,this.pseudoRandomNumberSource=e},{getPeriodBeforeNextEvent:function(){var t=this.pseudoRandomNumberSource();return-Math.log(t)/this.rate}}),e.EventTimer}),i("PHET_CORE/loadScript",["require","PHET_CORE/core"],function(t){var e=t("PHET_CORE/core");return e.loadScript=function(t){"string"==typeof t&&(t={src:t});var e=t.src,i=t.callback,n=void 0===t.async?!0:t.async,s=void 0===t.cacheBuster?!1:t.cacheBuster,r=!1,o=document.createElement("script");o.type="text/javascript",o.async=n,o.onload=o.onreadystatechange=function(){var t=this.readyState;t&&"complete"!==t&&"loaded"!==t||r||(r=!0,i&&i())},o.src=e+(s?"?random="+Math.random().toFixed(10):"");var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(o,a)},e.loadScript}),i("PHET_CORE/pairs",["require","PHET_CORE/core"],function(t){var e=t("PHET_CORE/core");return e.pairs=function(t){var e=[],i=t.length;if(i>1)for(var n=0;i-1>n;n++)for(var s=t[n],r=n+1;i>r;r++)e.push([s,t[r]]);return e},e.pairs}),i("PHET_CORE/partition",["require","PHET_CORE/core"],function(t){var e=t("PHET_CORE/core");return e.partition=function(t,e){for(var i=[],n=[],s=t.length,r=0;s>r;r++)e(t[r])?i.push(t[r]):n.push(t[r]);return[i,n]},e.partition}),i("PHET_CORE/profiler",["require","PHET_CORE/core"],function(t){var e=t("PHET_CORE/core"),i=[],n={},s=0,r=[];return e.profiler={displayCount:1e3,start:function(t){var e=Date.now();i.push({name:t,time:e})},addListener:function(t){r.push(t)},stop:function(){var t=Date.now(),e=i.pop(),o=t-e.time;if(n[e.name]||(n[e.name]=[]),n[e.name].push(o),s++,0===s%this.displayCount){var a=JSON.stringify(this.toJSON());console.log(a);for(var h=0;h<r.length;h++)r[h](a);n={}}},toJSON:function(){var t,e={};for(var i in n){t=0;for(var s=0;s<n[i].length;s++){var r=n[i][s];t+=r}var o=t/n[i].length;e[i]={average:o,count:n[i].length}}return e},testSelf:function(){var t,e,i=this;this.displayCount=1e7;for(var n=0;10>n;n++){i.start("physics");for(var s=0;1e4>s;s++){i.start("mloop");for(var r=0;1e4>r;r++)t=2e4;i.stop(),i.start("xloop");for(var o=0;2e4>o;o++)e=2e4;i.stop()}i.stop()}console.log("results: ",t,e),console.log(JSON.stringify(this.toJSON()))}},e.profiler}),i("PHET_CORE/main",["PHET_CORE/core","PHET_CORE/arrayRemove","PHET_CORE/cleanArray","PHET_CORE/collect","PHET_CORE/detectPrefix","PHET_CORE/detectPrefixEvent","PHET_CORE/escapeHTML","PHET_CORE/EventTimer","PHET_CORE/extend","PHET_CORE/inherit","PHET_CORE/isArray","PHET_CORE/loadScript","PHET_CORE/pairs","PHET_CORE/partition","PHET_CORE/phetAllocation","PHET_CORE/platform","PHET_CORE/Poolable","PHET_CORE/profiler"],function(t){return t}),e.config({deps:["main","KITE/main","DOT/main","PHET_CORE/main"],paths:{underscore:"../../sherpa/lodash-2.4.1",jquery:"../../sherpa/jquery-2.1.0",SCENERY:".",KITE:"../../kite/js",DOT:"../../dot/js",PHET_CORE:"../../phet-core/js",AXON:"../../axon/js"},urlArgs:(new Date).getTime()}),i("production-config",function(){}),window.scenery=e("main"),window.kite=e("KITE/main"),window.dot=e("DOT/main"),window.core=e("PHET_CORE/main"),scenery.Util.polyfillRequestAnimationFrame()}();
//# sourceMappingURL=scenery.min.js.map