!function(){if(!window.hasOwnProperty("_"))throw new Error("Underscore/Lodash not found: _");if(!window.hasOwnProperty("$"))throw new Error("jQuery not found: $");!function(){window.assertions=window.assertions||{},window.assertions.assertFunction=window.assertions.assertFunction||function(t,e){var i="function"==typeof t?t():t;if(!i){if(window.navigator&&"Microsoft Internet Explorer"===window.navigator.appName)try{throw new Error}catch(n){e=e+", stack=\n"+n.stack}throw new Error("Assertion failed: "+e)}},window.assert=window.assert||null,window.assertSlow=window.assertSlow||null,window.assertions.enableAssert=function(){window.assert=window.assertions.assertFunction,window.console&&window.console.log&&window.console.log("enabling assert")},window.assertions.disableAssert=function(){window.assert=null,window.console&&window.console.log&&window.console.log("disabling assert")},window.assertions.enableAssertSlow=function(){window.assertSlow=window.assertions.assertFunction,window.console&&window.console.log&&window.console.log("enabling assertSlow")},window.assertions.disableAssertSlow=function(){window.assertSlow=null,window.console&&window.console.log&&window.console.log("disabling assertSlow")}}();var t,e,i;!function(n){function r(t,e){return E.call(t,e)}function s(t,e){var i,n,r,s,a,o,h,l,u,c,d,f=e&&e.split("/"),m=b.map,p=m&&m["*"]||{};if(t&&"."===t.charAt(0))if(e){for(f=f.slice(0,f.length-1),t=t.split("/"),a=t.length-1,b.nodeIdCompat&&_.test(t[a])&&(t[a]=t[a].replace(_,"")),t=f.concat(t),u=0;u<t.length;u+=1)if(d=t[u],"."===d)t.splice(u,1),u-=1;else if(".."===d){if(1===u&&(".."===t[2]||".."===t[0]))break;u>0&&(t.splice(u-1,2),u-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((f||p)&&m){for(i=t.split("/"),u=i.length;u>0;u-=1){if(n=i.slice(0,u).join("/"),f)for(c=f.length;c>0;c-=1)if(r=m[f.slice(0,c).join("/")],r&&(r=r[n])){s=r,o=u;break}if(s)break;!h&&p&&p[n]&&(h=p[n],l=u)}!s&&h&&(s=h,o=l),s&&(i.splice(0,o,s),t=i.join("/"))}return t}function a(t,e){return function(){return f.apply(n,x.call(arguments,0).concat([t,e]))}}function o(t){return function(e){return s(e,t)}}function h(t){return function(e){g[t]=e}}function l(t){if(r(v,t)){var e=v[t];delete v[t],y[t]=!0,d.apply(n,e)}if(!r(g,t)&&!r(y,t))throw new Error("No "+t);return g[t]}function u(t){var e,i=t?t.indexOf("!"):-1;return i>-1&&(e=t.substring(0,i),t=t.substring(i+1,t.length)),[e,t]}function c(t){return function(){return b&&b.config&&b.config[t]||{}}}var d,f,m,p,g={},v={},b={},y={},E=Object.prototype.hasOwnProperty,x=[].slice,_=/\.js$/;m=function(t,e){var i,n=u(t),r=n[0];return t=n[1],r&&(r=s(r,e),i=l(r)),r?t=i&&i.normalize?i.normalize(t,o(e)):s(t,e):(t=s(t,e),n=u(t),r=n[0],t=n[1],r&&(i=l(r))),{f:r?r+"!"+t:t,n:t,pr:r,p:i}},p={require:function(t){return a(t)},exports:function(t){var e=g[t];return"undefined"!=typeof e?e:g[t]={}},module:function(t){return{id:t,uri:"",exports:g[t],config:c(t)}}},d=function(t,e,i,s){var o,u,c,d,f,b,E=[],x=typeof i;if(s=s||t,"undefined"===x||"function"===x){for(e=!e.length&&i.length?["require","exports","module"]:e,f=0;f<e.length;f+=1)if(d=m(e[f],s),u=d.f,"require"===u)E[f]=p.require(t);else if("exports"===u)E[f]=p.exports(t),b=!0;else if("module"===u)o=E[f]=p.module(t);else if(r(g,u)||r(v,u)||r(y,u))E[f]=l(u);else{if(!d.p)throw new Error(t+" missing "+u);d.p.load(d.n,a(s,!0),h(u),{}),E[f]=g[u]}c=i?i.apply(g[t],E):void 0,t&&(o&&o.exports!==n&&o.exports!==g[t]?g[t]=o.exports:c===n&&b||(g[t]=c))}else t&&(g[t]=i)},t=e=f=function(t,e,i,r,s){if("string"==typeof t)return p[t]?p[t](e):l(m(t,e).f);if(!t.splice){if(b=t,b.deps&&f(b.deps,b.callback),!e)return;e.splice?(t=e,e=i,i=null):t=n}return e=e||function(){},"function"==typeof i&&(i=r,r=s),r?d(n,t,e,i):setTimeout(function(){d(n,t,e,i)},4),f},f.config=function(t){return f(t)},t._defined=g,i=function(t,e,i){e.splice||(i=e,e=[]),r(g,t)||r(v,t)||(v[t]=[t,e,i])},i.amd={jQuery:!0}}(),i("almond",function(){}),i("PHET_CORE/core",["require"],function(){return{}}),i("PHET_CORE/phetAllocation",["require","PHET_CORE/core"],function(t){var e=t("PHET_CORE/core");return e.phetAllocation=function(t){if(window.alloc){var e;try{throw new Error}catch(i){e=i.stack}window.alloc[t]||(window.alloc[t]={count:0,stacks:{}});var n=window.alloc[t];n.count++,n.stacks[e]?n.stacks[e]+=1:n.stacks[e]=1,n.report=function(){var t=Object.keys(n.stacks);t=_.sortBy(t,function(t){return n.stacks[t]}),_.each(t,function(t){console.log(n.stacks[t]+": "+t)})}}},e.phetAllocation}),i("SCENERY/scenery",["require","PHET_CORE/phetAllocation"],function(t){window.sceneryLog=null,window.sceneryEventLog=null,window.sceneryAccessibilityLog=null,window.phetAllocation=t("PHET_CORE/phetAllocation");var e=document.createElement("canvas"),i=e.getContext("2d"),n="",r={assert:null,scratchCanvas:e,scratchContext:i,svgns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",logString:"",logFunction:function(){window.console&&window.console.log&&window.console.log.apply(window.console,Array.prototype.slice.call(arguments,0))},consoleLogFunction:function(){window.console&&window.console.log&&window.console.log.apply(window.console,Array.prototype.slice.call(arguments,0))},switchLogToConsole:function(){r.logFunction=r.consoleLogFunction},stringLogFunction:function(t){r.logString+=t.replace(/%c/g,"")+"\n"},switchLogToString:function(){window.console&&window.console.log("switching to string log"),r.logFunction=r.stringLogFunction},logProperties:{dirty:{name:"dirty",style:"color: #aaa;"},bounds:{name:"bounds",style:"color: #aaa;"},hitTest:{name:"hitTest",style:"color: #aaa;"},PerfCritical:{name:"Perf",style:"color: #f00;"},PerfMajor:{name:"Perf",style:"color: #aa0;"},PerfMinor:{name:"Perf",style:"color: #088;"},PerfVerbose:{name:"Perf",style:"color: #888;"},Cursor:{name:"Cursor",style:"color: #000;"},Stitch:{name:"Stitch",style:"color: #000;"},StitchDrawables:{name:"Stitch",style:"color: #000;"},GreedyStitcher:{name:"Greedy",style:"color: #088;"},GreedyVerbose:{name:"Greedy",style:"color: #888;"},RelativeTransform:{name:"transform",style:"color: #606;"},BackboneDrawable:{name:"Backbone",style:"color: #a00;"},CanvasBlock:{name:"Canvas",style:"color: #000;"},WebGLBlock:{name:"WebGL",style:"color: #000;"},Display:{name:"Display",style:"color: #000;"},DOMBlock:{name:"DOM",style:"color: #000;"},Drawable:{name:"",style:"color: #000;"},FittedBlock:{name:"FittedBlock",style:"color: #000;"},Input:{name:"Input",style:"color: #000;"},Instance:{name:"Instance",style:"color: #000;"},InstanceTree:{name:"InstanceTree",style:"color: #000;"},ChangeInterval:{name:"ChangeInterval",style:"color: #0a0;"},SVGBlock:{name:"SVG",style:"color: #000;"},SVGGroup:{name:"SVGGroup",style:"color: #000;"},Paints:{name:"Paints",style:"color: #000;"}},enableIndividualLog:function(t){return"stitch"===t?(this.enableIndividualLog("Stitch"),this.enableIndividualLog("StitchDrawables"),this.enableIndividualLog("GreedyStitcher"),void this.enableIndividualLog("GreedyVerbose")):"perf"===t?(this.enableIndividualLog("PerfCritical"),this.enableIndividualLog("PerfMajor"),this.enableIndividualLog("PerfMinor"),void this.enableIndividualLog("PerfVerbose")):void(t&&(window.sceneryLog[t]=window.sceneryLog[t]||function(e,i){var s=r.logProperties[t],a=s.name?"["+s.name+"] ":"",o="color: #ddd;";r.logFunction("%c"+n+"%c"+a+e,o,i?i:s.style)}))},disableIndividualLog:function(t){t&&delete window.sceneryLog[t]},enableLogging:function(t){t||(t=["stitch"]),window.sceneryLog=function(t){r.logFunction(t)},window.sceneryLog.push=function(){n+="| "},window.sceneryLog.pop=function(){n=n.slice(0,-2)};for(var e=0;e<t.length;e++)this.enableIndividualLog(t[e])},disableLogging:function(){window.sceneryLog=null},isLoggingPerformance:function(){return window.sceneryLog.PerfCritical||window.sceneryLog.PerfMajor||window.sceneryLog.PerfMinor||window.sceneryLog.PerfVerbose},enableEventLogging:function(){window.sceneryEventLog=function(t){r.logFunction(t)}},disableEventLogging:function(){window.sceneryEventLog=null},enableAccessibilityLogging:function(){window.sceneryAccessibilityLog=function(t){r.logFunction(t)}},disableAccessibilityLogging:function(){window.sceneryAccessibilityLog=null},bitmaskAll:268435455,bitmaskNodeDefault:1023,bitmaskPaintedDefault:512,bitmaskRendererArea:255,bitmaskSupportsCanvas:1,bitmaskSupportsSVG:2,bitmaskSupportsDOM:4,bitmaskSupportsWebGL:8,bitmaskSupportsPixi:16,bitmaskNotPainted:256,bitmaskBoundsValid:512};return r}),i("PHET_CORE/extend",["require","PHET_CORE/core"],function(t){var e=t("PHET_CORE/core");return e.extend=function(t){return _.each(Array.prototype.slice.call(arguments,1),function(e){if(e)for(var i in e)Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))}),t},e.extend}),i("PHET_CORE/inherit",["require","PHET_CORE/core","PHET_CORE/extend"],function(t){var e=t("PHET_CORE/core"),i=t("PHET_CORE/extend");return e.inherit=function(t,e,n,r){function s(){}return s.prototype=t.prototype,e.prototype=i(new s,{constructor:e},n),i(e,r),e},e.inherit}),i("AXON/axon",["require"],function(){var t={};return t}),i("AXON/Events",["require","AXON/axon"],function(t){var e=t("AXON/axon");return e.Events=function(){this._eventListeners={},this._staticEventListeners={}},e.Events.prototype={on:function(t,e){this._eventListeners[t]=this._eventListeners[t]||[],this._eventListeners[t].push(e)},onStatic:function(t,e){this._staticEventListeners[t]=this._staticEventListeners[t]||[],this._staticEventListeners[t].push(e)},once:function(t,e){var i=this,n=function(){i.off(t,n),0===arguments.length?e():e.apply(this,Array.prototype.slice.call(arguments,0))};return this.on(t,n),n},off:function(t,e){var i=-1;return this._eventListeners[t]&&(i=this._eventListeners[t].indexOf(e),-1!==i&&this._eventListeners[t].splice(i,1)),i},offStatic:function(t,e){var i=-1;return this._staticEventListeners[t]&&(i=this._staticEventListeners[t].indexOf(e),-1!==i&&this._staticEventListeners[t].splice(i,1)),i},hasListener:function(t,e){var i=this._eventListeners[t];return!!i&&i.indexOf(e)>=0},hasStaticListener:function(t,e){var i=this._staticEventListeners[t];return!!i&&i.indexOf(e)>=0},trigger:function(t){var e,i=this._eventListeners[t],n=this._staticEventListeners[t],r=i?i.length:0,s=n?n.length:0,a=1===arguments.length;!a&&(r>0||s>0)&&(e=Array.prototype.slice.call(arguments,1)),r>0&&(i=i.slice());var o;for(o=0;r>o;o++){var h=i[o];a?h(arguments):h.apply(this,e)}for(o=0;s>o;o++){var l=n[o];a?l(arguments):l.apply(this,e)}},trigger0:function(t){var e=this._eventListeners[t],i=this._staticEventListeners[t],n=e?e.length:0,r=i?i.length:0;n>0&&(e=e.slice());var s;for(s=0;n>s;s++)e[s]();for(s=0;r>s;s++)i[s]()},trigger1:function(t,e){var i=this._eventListeners[t],n=this._staticEventListeners[t],r=i?i.length:0,s=n?n.length:0;r>0&&(i=i.slice());var a;for(a=0;r>a;a++)i[a](e);for(a=0;s>a;a++)n[a](e)},trigger2:function(t,e,i){var n=this._eventListeners[t],r=this._staticEventListeners[t],s=n?n.length:0,a=r?r.length:0;s>0&&(n=n.slice());var o;for(o=0;s>o;o++)n[o](e,i);for(o=0;a>o;o++)r[o](e,i)}},e.Events}),i("DOT/dot",["require","PHET_CORE/phetAllocation"],function(t){window.phetAllocation=t("PHET_CORE/phetAllocation");var e=function i(){switch(arguments.length){case 2:return new i.Vector2(arguments[0],arguments[1]);case 3:return new i.Vector3(arguments[0],arguments[1],arguments[2]);case 4:return new i.Vector4(arguments[0],arguments[1],arguments[2],arguments[3]);default:throw new Error("dot takes 2-4 arguments")}};return e.FastArray=window.Float64Array?window.Float64Array:window.Array,e}),i("PHET_CORE/PoolableMixin",["require","PHET_CORE/core","PHET_CORE/extend"],function(t){var e=t("PHET_CORE/core"),i=t("PHET_CORE/extend");return e.PoolableMixin=function(t,e){var n=t.prototype;e=i({maxPoolSize:50,initialSize:0},e);var r=t.pool=[];e.defaultFactory&&(t.dirtyFromPool=function(){return r.length?r.pop():e.defaultFactory()},t.fillPool=function(t){for(;r.length<t;)r.push(e.defaultFactory())},t.fillPool(e.initialSize)),e.constructorDuplicateFactory&&(t.createFromPool=e.constructorDuplicateFactory(r)),n.freeToPool=function(){r.length<e.maxPoolSize&&r.push(this)}},e.PoolableMixin}),i("DOT/Util",["require","DOT/dot"],function(t){var e=t("DOT/dot");e.Util={testAssert:function(){return"assert.dot: false"},clamp:function(t,e,i){return e>t?e:t>i?i:t},moduloBetweenDown:function(t,e,i){var n=i-e,r=(t-e)%n;return 0>r&&(r+=n),r+e},moduloBetweenUp:function(t,e,n){return-i.moduloBetweenDown(-t,-n,-e)},rangeInclusive:function(t,e){if(t>e)return[];for(var i=new Array(e-t+1),n=t;e>=n;n++)i[n-t]=n;return i},rangeExclusive:function(t,e){return i.rangeInclusive(t+1,e-1)},toRadians:function(t){return Math.PI*t/180},toDegrees:function(t){return 180*t/Math.PI},gcd:function(t,e){return 0===e?t:this.gcd(e,t%e)},lineLineIntersection:function(t,i,n,r){var s=t.x-i.x,a=n.x-r.x,o=t.y-i.y,h=n.y-r.y,l=s*h-o*a,u=t.x*i.y-t.y*i.x,c=n.x*r.y-n.y*r.x;return new e.Vector2((u*a-s*c)/l,(u*h-o*c)/l)},sphereRayIntersection:function(t,i,n){n=void 0===n?1e-5:n;var r=new e.Vector3,s=i.dir,a=i.pos,o=a.minus(r),h=s.dot(o),l=o.magnitudeSquared(),u=4*h*h-4*(l-t*t);if(n>u)return null;var c=s.dot(r)-s.dot(a),d=Math.sqrt(u)/2,f=c-d,m=c+d;if(n>m)return null;var p=i.pointAtDistance(m),g=p.minus(r).normalized();if(n>f)return{distance:m,hitPoint:p,normal:g.negated(),fromOutside:!1};var v=i.pointAtDistance(f),b=v.minus(r).normalized();return{distance:f,hitPoint:v,normal:b,fromOutside:!0}},solveQuadraticRootsReal:function(t,e,i){var n=1e7;if(0===t||Math.abs(e/t)>n||Math.abs(i/t)>n)return[-i/e];var r=e*e-4*t*i;if(0>r)return[];var s=Math.sqrt(r);return[(-e-s)/(2*t),(-e+s)/(2*t)]},solveCubicRootsReal:function(t,e,n,r){var s=1e7;if(0===t||Math.abs(e/t)>s||Math.abs(n/t)>s||Math.abs(r/t)>s)return i.solveQuadraticRootsReal(e,n,r);if(0===r||Math.abs(t/r)>s||Math.abs(e/r)>s||Math.abs(n/r)>s)return i.solveQuadraticRootsReal(t,e,n);e/=t,n/=t,r/=t;var a=(3*n-e*e)/9,o=(-(27*r)+e*(9*n-2*e*e))/54,h=a*a*a+o*o,l=e/3;if(h>0){var u=Math.sqrt(h);return[i.cubeRoot(o+u)+i.cubeRoot(o-u)-l]}if(0===h){var c=i.cubeRoot(o),d=l-c;return[-l+2*c,d,d]}var f=-a*a*a;f=Math.acos(o/Math.sqrt(f));var m=2*Math.sqrt(-a);return[-l+m*Math.cos(f/3),-l+m*Math.cos((f+2*Math.PI)/3),-l+m*Math.cos((f+4*Math.PI)/3)]},cubeRoot:function(t){return t>=0?Math.pow(t,1/3):-Math.pow(-t,1/3)},linear:function(t,e,i,n,r){return(n-i)/(e-t)*(r-t)+i},toFixed:function(t,e){var i=Math.pow(10,e),n=Math.round(t*i)/i;return n.toFixed(e)},toFixedNumber:function(t,e){return parseFloat(i.toFixed(t,e))},isInteger:function(t){return"number"==typeof t&&t%1===0},lineSegmentIntersection:function(t,i,n,r,s,a,o,h){var l=(o-s)*(i-a)-(h-a)*(t-s),u=(n-t)*(i-a)-(r-i)*(t-s),c=(h-a)*(n-t)-(o-s)*(r-i);if(0===c)return null;var d=l/c,f=u/c;if(d>=0&&1>=d&&f>=0&&1>=f){var m=t+d*(n-t),p=i+d*(r-i);return new e.Vector2(m,p)}return null},distToSegmentSquared:function(t,i,n){var r=i.distanceSquared(n);if(0===r)return t.distanceSquared(i);var s=((t.x-i.x)*(n.x-i.x)+(t.y-i.y)*(n.y-i.y))/r;return t.distanceSquared(0>s?i:s>1?n:new e.Vector2(i.x+s*(n.x-i.x),i.y+s*(n.y-i.y)))},distToSegment:function(t,e,i){return Math.sqrt(this.distToSegmentSquared(t,e,i))},arePointsCollinear:function(t,e,n,r){return void 0===r&&(r=0),i.triangleArea(t,e,n)<=r},triangleArea:function(t,e,n){return Math.abs(i.triangleAreaSigned(t,e,n))},triangleAreaSigned:function(t,e,i){return t.x*(e.y-i.y)+e.x*(i.y-t.y)+i.x*(t.y-e.y)},log10:function(t){return Math.log(t)/Math.LN10}};var i=e.Util;return e.testAssert=i.testAssert,e.clamp=i.clamp,e.moduloBetweenDown=i.moduloBetweenDown,e.moduloBetweenUp=i.moduloBetweenUp,e.rangeInclusive=i.rangeInclusive,e.rangeExclusive=i.rangeExclusive,e.toRadians=i.toRadians,e.toDegrees=i.toDegrees,e.lineLineIntersection=i.lineLineIntersection,e.sphereRayIntersection=i.sphereRayIntersection,e.solveQuadraticRootsReal=i.solveQuadraticRootsReal,e.solveCubicRootsReal=i.solveCubicRootsReal,e.cubeRoot=i.cubeRoot,e.linear=i.linear,i}),i("DOT/Vector2",["require","DOT/dot","PHET_CORE/inherit","PHET_CORE/PoolableMixin","DOT/Util"],function(t){var e=t("DOT/dot"),i=t("PHET_CORE/inherit"),n=t("PHET_CORE/PoolableMixin");t("DOT/Util"),e.Vector2=function(t,e){this.x=t||0,this.y=e||0};var r=e.Vector2;r.createPolar=function(t,e){return(new r).setPolar(t,e)},r.prototype={constructor:r,isVector2:!0,dimension:2,magnitude:function(){return Math.sqrt(this.magnitudeSquared())},magnitudeSquared:function(){return this.x*this.x+this.y*this.y},distance:function(t){return Math.sqrt(this.distanceSquared(t))},distanceXY:function(t,e){var i=this.x-t,n=this.y-e;return Math.sqrt(i*i+n*n)},distanceSquared:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i},distanceSquaredXY:function(t,e){var i=this.x-t,n=this.y-e;return i*i+n*n},dot:function(t){return this.x*t.x+this.y*t.y},dotXY:function(t,e){return this.x*t+this.y*e},equals:function(t){return this.x===t.x&&this.y===t.y},equalsEpsilon:function(t,e){return e||(e=0),Math.max(Math.abs(this.x-t.x),Math.abs(this.y-t.y))<=e},isFinite:function(){return isFinite(this.x)&&isFinite(this.y)},copy:function(t){return t?t.set(this):new r(this.x,this.y)},crossScalar:function(t){return this.x*t.y-this.y*t.x},normalized:function(){var t=this.magnitude();if(0===t)throw new Error("Cannot normalize a zero-magnitude vector");return new r(this.x/t,this.y/t)},withMagnitude:function(t){return this.copy().setMagnitude(t)},timesScalar:function(t){return new r(this.x*t,this.y*t)},times:function(t){return this.timesScalar(t)},componentTimes:function(t){return new r(this.x*t.x,this.y*t.y)},plus:function(t){return new r(this.x+t.x,this.y+t.y)},plusXY:function(t,e){return new r(this.x+t,this.y+e)},plusScalar:function(t){return new r(this.x+t,this.y+t)},minus:function(t){return new r(this.x-t.x,this.y-t.y)},minusXY:function(t,e){return new r(this.x-t,this.y-e)},minusScalar:function(t){return new r(this.x-t,this.y-t)},dividedScalar:function(t){return new r(this.x/t,this.y/t)},negated:function(){return new r(-this.x,-this.y)},angle:function(){return Math.atan2(this.y,this.x)},perpendicular:function(){return new r(this.y,-this.x)},angleBetween:function(t){var i=this.magnitude(),n=t.magnitude();return Math.acos(e.clamp((this.x*t.x+this.y*t.y)/(i*n),-1,1))},rotated:function(t){var e=this.angle()+t,i=this.magnitude();return new r(i*Math.cos(e),i*Math.sin(e))},blend:function(t,e){return new r(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)},average:function(t){return this.blend(t,.5)},toString:function(){return"Vector2("+this.x+", "+this.y+")"},toVector3:function(){return new e.Vector3(this.x,this.y)},setXY:function(t,e){return this.x=t,this.y=e,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},set:function(t){return this.setXY(t.x,t.y)},setMagnitude:function(t){var e=t/this.magnitude();return this.multiplyScalar(e)},add:function(t){return this.setXY(this.x+t.x,this.y+t.y)},addXY:function(t,e){return this.setXY(this.x+t,this.y+e)},addScalar:function(t){return this.setXY(this.x+t,this.y+t)},subtract:function(t){return this.setXY(this.x-t.x,this.y-t.y)},subtractScalar:function(t){return this.setXY(this.x-t,this.y-t)},multiplyScalar:function(t){return this.setXY(this.x*t,this.y*t)},multiply:function(t){return this.multiplyScalar(t)},componentMultiply:function(t){return this.setXY(this.x*t.x,this.y*t.y)},divideScalar:function(t){return this.setXY(this.x/t,this.y/t)},negate:function(){return this.setXY(-this.x,-this.y)},normalize:function(){var t=this.magnitude();if(0===t)throw new Error("Cannot normalize a zero-magnitude vector");return this.divideScalar(t)},rotate:function(t){var e=this.angle()+t,i=this.magnitude();return this.setXY(i*Math.cos(e),i*Math.sin(e))},setPolar:function(t,e){return this.setXY(t*Math.cos(e),t*Math.sin(e))}},n(r,{defaultFactory:function(){return new r},constructorDuplicateFactory:function(t){return function(e,i){return t.length?t.pop().setXY(e,i):new r(e,i)}}}),r.Immutable=function(t,e){r.call(this,t,e)};var s=r.Immutable;return i(r,s),s.mutableOverrideHelper=function(t){s.prototype[t]=function(){throw new Error("Cannot call mutable method '"+t+"' on immutable Vector2")}},s.mutableOverrideHelper("setXY"),s.mutableOverrideHelper("setX"),s.mutableOverrideHelper("setY"),r.ZERO=new s(0,0),r.X_UNIT=new s(1,0),r.Y_UNIT=new s(0,1),r}),i("DOT/Bounds2",["require","DOT/dot","PHET_CORE/PoolableMixin","DOT/Vector2"],function(t){var e=t("DOT/dot"),i=t("PHET_CORE/PoolableMixin");t("DOT/Vector2");var n=new e.Vector2;e.Bounds2=function(t,e,i,n){this.minX=t,this.minY=e,this.maxX=i,this.maxY=n};var r=e.Bounds2;return r.prototype={constructor:r,isBounds:!0,dimension:2,getWidth:function(){return this.maxX-this.minX},get width(){return this.getWidth()},getHeight:function(){return this.maxY-this.minY},get height(){return this.getHeight()},getX:function(){return this.minX},get x(){return this.getX()},getY:function(){return this.minY},get y(){return this.getY()},getMinX:function(){return this.minX},get left(){return this.minX},getMinY:function(){return this.minY},get top(){return this.minY},getMaxX:function(){return this.maxX},get right(){return this.maxX},getMaxY:function(){return this.maxY},get bottom(){return this.maxY},getCenterX:function(){return(this.maxX+this.minX)/2},get centerX(){return this.getCenterX()},getCenterY:function(){return(this.maxY+this.minY)/2},get centerY(){return this.getCenterY()},getLeftTop:function(){return new e.Vector2(this.minX,this.minY)},get leftTop(){return this.getLeftTop()},getCenterTop:function(){return new e.Vector2(this.getCenterX(),this.minY)},get centerTop(){return this.getCenterTop()},getRightTop:function(){return new e.Vector2(this.maxX,this.minY)},get rightTop(){return this.getRightTop()},getLeftCenter:function(){return new e.Vector2(this.minX,this.getCenterY())},get leftCenter(){return this.getLeftCenter()},getCenter:function(){return new e.Vector2(this.getCenterX(),this.getCenterY())},get center(){return this.getCenter()},getRightCenter:function(){return new e.Vector2(this.maxX,this.getCenterY())},get rightCenter(){return this.getRightCenter()},getLeftBottom:function(){return new e.Vector2(this.minX,this.maxY)},get leftBottom(){return this.getLeftBottom()},getCenterBottom:function(){return new e.Vector2(this.getCenterX(),this.maxY)},get centerBottom(){return this.getCenterBottom()},getRightBottom:function(){return new e.Vector2(this.maxX,this.maxY)},get rightBottom(){return this.getRightBottom()},isEmpty:function(){return this.getWidth()<0||this.getHeight()<0},isFinite:function(){return isFinite(this.minX)&&isFinite(this.minY)&&isFinite(this.maxX)&&isFinite(this.maxY)},hasNonzeroArea:function(){return this.getWidth()>0&&this.getHeight()>0},isValid:function(){return!this.isEmpty()&&this.isFinite()},containsCoordinates:function(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY},containsPoint:function(t){return this.containsCoordinates(t.x,t.y)},containsBounds:function(t){return this.minX<=t.minX&&this.maxX>=t.maxX&&this.minY<=t.minY&&this.maxY>=t.maxY},intersectsBounds:function(t){return!this.intersection(t).isEmpty()},minimumDistanceToPointSquared:function(t){var e,i=t.x<this.minX?this.minX:t.x>this.maxX?this.maxX:null,n=t.y<this.minY?this.minY:t.y>this.maxY?this.maxY:null;if(null===i&&null===n)return 0;if(null===i)return e=n-t.y,e*e;if(null===n)return e=i-t.x,e*e;var r=i-t.x,s=n-t.y;return r*r+s*s},maximumDistanceToPointSquared:function(t){var e=t.x>this.getCenterX()?this.minX:this.maxX,i=t.y>this.getCenterY()?this.minY:this.maxY;return e-=t.x,i-=t.y,e*e+i*i},toString:function(){return"[x:("+this.minX+","+this.maxX+"),y:("+this.minY+","+this.maxY+")]"},equals:function(t){return this.minX===t.minX&&this.minY===t.minY&&this.maxX===t.maxX&&this.maxY===t.maxY},equalsEpsilon:function(t,e){e=e||0;var i=this.isFinite(),n=t.isFinite();return i&&n?Math.abs(this.minX-t.minX)<e&&Math.abs(this.minY-t.minY)<e&&Math.abs(this.maxX-t.maxX)<e&&Math.abs(this.maxY-t.maxY)<e:i!==n?!1:this===t?!0:(isFinite(this.minX+t.minX)?Math.abs(this.minX-t.minX)<e:this.minX===t.minX)&&(isFinite(this.minY+t.minY)?Math.abs(this.minY-t.minY)<e:this.minY===t.minY)&&(isFinite(this.maxX+t.maxX)?Math.abs(this.maxX-t.maxX)<e:this.maxX===t.maxX)&&(isFinite(this.maxY+t.maxY)?Math.abs(this.maxY-t.maxY)<e:this.maxY===t.maxY)},copy:function(t){return t?t.set(this):new r(this.minX,this.minY,this.maxX,this.maxY)},union:function(t){return new r(Math.min(this.minX,t.minX),Math.min(this.minY,t.minY),Math.max(this.maxX,t.maxX),Math.max(this.maxY,t.maxY))},intersection:function(t){return new r(Math.max(this.minX,t.minX),Math.max(this.minY,t.minY),Math.min(this.maxX,t.maxX),Math.min(this.maxY,t.maxY))},withCoordinates:function(t,e){return new r(Math.min(this.minX,t),Math.min(this.minY,e),Math.max(this.maxX,t),Math.max(this.maxY,e))},withPoint:function(t){return this.withCoordinates(t.x,t.y)},withMinX:function(t){return new r(t,this.minY,this.maxX,this.maxY)},withMinY:function(t){return new r(this.minX,t,this.maxX,this.maxY)},withMaxX:function(t){return new r(this.minX,this.minY,t,this.maxY)},withMaxY:function(t){return new r(this.minX,this.minY,this.maxX,t)},roundedOut:function(){return new r(Math.floor(this.minX),Math.floor(this.minY),Math.ceil(this.maxX),Math.ceil(this.maxY))},roundedIn:function(){return new r(Math.ceil(this.minX),Math.ceil(this.minY),Math.floor(this.maxX),Math.floor(this.maxY))},transformed:function(t){return this.copy().transform(t)},dilated:function(t){return new r(this.minX-t,this.minY-t,this.maxX+t,this.maxY+t)},dilatedX:function(t){return new r(this.minX-t,this.minY,this.maxX+t,this.maxY)},dilatedY:function(t){return new r(this.minX,this.minY-t,this.maxX,this.maxY+t)},dilatedXY:function(t,e){return new r(this.minX-t,this.minY-e,this.maxX+t,this.maxY+e)},eroded:function(t){return this.dilated(-t)},erodedX:function(t){return this.dilatedX(-t)},erodedY:function(t){return this.dilatedY(-t)},erodedXY:function(t,e){return this.dilatedXY(-t,-e)},shiftedX:function(t){return new r(this.minX+t,this.minY,this.maxX+t,this.maxY)},shiftedY:function(t){return new r(this.minX,this.minY+t,this.maxX,this.maxY+t)},shifted:function(t,e){return new r(this.minX+t,this.minY+e,this.maxX+t,this.maxY+e)},setMinMax:function(t,e,i,n){return this.minX=t,this.minY=e,this.maxX=i,this.maxY=n,this},setMinX:function(t){return this.minX=t,this},setMinY:function(t){return this.minY=t,this},setMaxX:function(t){return this.maxX=t,this},setMaxY:function(t){return this.maxY=t,this},set:function(t){return this.setMinMax(t.minX,t.minY,t.maxX,t.maxY)},includeBounds:function(t){return this.setMinMax(Math.min(this.minX,t.minX),Math.min(this.minY,t.minY),Math.max(this.maxX,t.maxX),Math.max(this.maxY,t.maxY))},constrainBounds:function(t){return this.setMinMax(Math.max(this.minX,t.minX),Math.max(this.minY,t.minY),Math.min(this.maxX,t.maxX),Math.min(this.maxY,t.maxY))},addCoordinates:function(t,e){return this.setMinMax(Math.min(this.minX,t),Math.min(this.minY,e),Math.max(this.maxX,t),Math.max(this.maxY,e))},addPoint:function(t){return this.addCoordinates(t.x,t.y)},roundOut:function(){return this.setMinMax(Math.floor(this.minX),Math.floor(this.minY),Math.ceil(this.maxX),Math.ceil(this.maxY))},roundIn:function(){return this.setMinMax(Math.ceil(this.minX),Math.ceil(this.minY),Math.floor(this.maxX),Math.floor(this.maxY))},transform:function(t){if(this.isEmpty())return this;if(t.isIdentity())return this;var i=this.minX,r=this.minY,s=this.maxX,a=this.maxY;return this.set(e.Bounds2.NOTHING),this.addPoint(t.multiplyVector2(n.setXY(i,r))),this.addPoint(t.multiplyVector2(n.setXY(i,a))),this.addPoint(t.multiplyVector2(n.setXY(s,r))),this.addPoint(t.multiplyVector2(n.setXY(s,a))),this},dilate:function(t){return this.setMinMax(this.minX-t,this.minY-t,this.maxX+t,this.maxY+t)},dilateX:function(t){return this.setMinMax(this.minX-t,this.minY,this.maxX+t,this.maxY)},dilateY:function(t){return this.setMinMax(this.minX,this.minY-t,this.maxX,this.maxY+t)},dilateXY:function(t,e){return this.setMinMax(this.minX-t,this.minY-e,this.maxX+t,this.maxY+e)},erode:function(t){return this.dilate(-t)},erodeX:function(t){return this.dilateX(-t)},erodeY:function(t){return this.dilateY(-t)},erodeXY:function(t,e){return this.dilateXY(-t,-e)},shiftX:function(t){return this.setMinMax(this.minX+t,this.minY,this.maxX+t,this.maxY)},shiftY:function(t){return this.setMinMax(this.minX,this.minY+t,this.maxX,this.maxY+t)},shift:function(t,e){return this.setMinMax(this.minX+t,this.minY+e,this.maxX+t,this.maxY+e)},getClosestPoint:function(t,i,n){return n?n.setXY(t,i):n=new e.Vector2(t,i),n.x<this.minX&&(n.x=this.minX),n.x>this.maxX&&(n.x=this.maxX),n.y<this.minY&&(n.y=this.minY),n.y>this.maxY&&(n.y=this.maxY),n}},r.rect=function(t,e,i,n){return new r(t,e,t+i,e+n)},r.point=function(t,i){if(t instanceof e.Vector2){var n=t;return new r(n.x,n.y,n.x,n.y)}return new r(t,i,t,i)},i(r,{defaultFactory:function(){return r.NOTHING.copy()},constructorDuplicateFactory:function(t){return function(e,i,n,s){return t.length?t.pop().setMinMax(e,i,n,s):new r(e,i,n,s)}}}),r.EVERYTHING=new r(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),r.NOTHING=new r(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),r}),i("DOT/Vector4",["require","DOT/dot","DOT/Util"],function(t){var e=t("DOT/dot");t("DOT/Util"),e.Vector4=function(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==n?n:1};var i=e.Vector4;i.prototype={constructor:i,isVector4:!0,dimension:4,magnitude:function(){return Math.sqrt(this.magnitudeSquared())},magnitudeSquared:function(){this.dot(this)},distance:function(t){return this.minus(t).magnitude()},distanceSquared:function(t){return this.minus(t).magnitudeSquared()},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},isFinite:function(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.z)&&isFinite(this.w)},equals:function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},equalsEpsilon:function(t,e){return e||(e=0),Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)+Math.abs(this.w-t.w)<=e},copy:function(t){return t?t.set(this):new i(this.x,this.y,this.z,this.w)},normalized:function(){var t=this.magnitude();if(0===t)throw new Error("Cannot normalize a zero-magnitude vector");return new i(this.x/t,this.y/t,this.z/t,this.w/t)},timesScalar:function(t){return new i(this.x*t,this.y*t,this.z*t,this.w*t)},times:function(t){return this.timesScalar(t)},componentTimes:function(t){return new i(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)},plus:function(t){return new i(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},plusScalar:function(t){return new i(this.x+t,this.y+t,this.z+t,this.w+t)},minus:function(t){return new i(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},minusScalar:function(t){return new i(this.x-t,this.y-t,this.z-t,this.w-t)},dividedScalar:function(t){return new i(this.x/t,this.y/t,this.z/t,this.w/t)},negated:function(){return new i(-this.x,-this.y,-this.z,-this.w)},angleBetween:function(t){return Math.acos(e.clamp(this.normalized().dot(t.normalized()),-1,1))},blend:function(t,e){return this.plus(t.minus(this).times(e))},average:function(t){return this.blend(t,.5)},toString:function(){return"Vector4("+this.x+", "+this.y+", "+this.z+", "+this.w+")"},toVector3:function(){return new e.Vector3(this.x,this.y,this.z)},setXYZW:function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},set:function(t){return this.setXYZW(t.x,t.y,t.z,t.w)},add:function(t){return this.setXYZW(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},addScalar:function(t){return this.setXYZW(this.x+t,this.y+t,this.z+t,this.w+t)},subtract:function(t){return this.setXYZW(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},subtractScalar:function(t){return this.setXYZW(this.x-t,this.y-t,this.z-t,this.w-t)},multiplyScalar:function(t){return this.setXYZW(this.x*t,this.y*t,this.z*t,this.w*t)},multiply:function(t){return this.multiplyScalar(t)},componentMultiply:function(t){return this.setXYZW(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)
},divideScalar:function(t){return this.setXYZW(this.x/t,this.y/t,this.z/t,this.w/t)},negate:function(){return this.setXYZW(-this.x,-this.y,-this.z,-this.w)},normalize:function(){var t=this.magnitude();if(0===t)throw new Error("Cannot normalize a zero-magnitude vector");return this.divideScalar(t)}},i.Immutable=function(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==n?n:1};var n=i.Immutable;return n.prototype=new i,n.prototype.constructor=n,n.mutableOverrideHelper=function(t){n.prototype[t]=function(){throw new Error("Cannot call mutable method '"+t+"' on immutable Vector4")}},n.mutableOverrideHelper("setXYZW"),n.mutableOverrideHelper("setX"),n.mutableOverrideHelper("setY"),n.mutableOverrideHelper("setZ"),n.mutableOverrideHelper("setW"),i.ZERO=new n(0,0,0,0),i.X_UNIT=new n(1,0,0,0),i.Y_UNIT=new n(0,1,0,0),i.Z_UNIT=new n(0,0,1,0),i.W_UNIT=new n(0,0,0,1),i}),i("DOT/Vector3",["require","DOT/dot","DOT/Util","DOT/Vector2","DOT/Vector4"],function(t){var e=t("DOT/dot");t("DOT/Util"),t("DOT/Vector2"),t("DOT/Vector4"),e.Vector3=function(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0};var i=e.Vector3;i.prototype={constructor:i,isVector3:!0,dimension:3,magnitude:function(){return Math.sqrt(this.magnitudeSquared())},magnitudeSquared:function(){return this.dot(this)},distance:function(t){return Math.sqrt(this.distanceSquared(t))},distanceSquared:function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},isFinite:function(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.z)},equals:function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z},equalsEpsilon:function(t,e){return e||(e=0),Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)<=e},copy:function(t){return t?t.set(this):new i(this.x,this.y,this.z)},cross:function(t){return new i(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},normalized:function(){var t=this.magnitude();if(0===t)throw new Error("Cannot normalize a zero-magnitude vector");return new i(this.x/t,this.y/t,this.z/t)},withMagnitude:function(t){return this.copy().setMagnitude(t)},timesScalar:function(t){return new i(this.x*t,this.y*t,this.z*t)},times:function(t){return this.timesScalar(t)},componentTimes:function(t){return new i(this.x*t.x,this.y*t.y,this.z*t.z)},plus:function(t){return new i(this.x+t.x,this.y+t.y,this.z+t.z)},plusScalar:function(t){return new i(this.x+t,this.y+t,this.z+t)},minus:function(t){return new i(this.x-t.x,this.y-t.y,this.z-t.z)},minusScalar:function(t){return new i(this.x-t,this.y-t,this.z-t)},dividedScalar:function(t){return new i(this.x/t,this.y/t,this.z/t)},negated:function(){return new i(-this.x,-this.y,-this.z)},angleBetween:function(t){return Math.acos(e.clamp(this.normalized().dot(t.normalized()),-1,1))},blend:function(t,e){return this.plus(t.minus(this).times(e))},average:function(t){return this.blend(t,.5)},toString:function(){return"Vector3("+this.x+", "+this.y+", "+this.z+")"},toVector2:function(){return new e.Vector2(this.x,this.y)},toVector4:function(){return new e.Vector4(this.x,this.y,this.z)},setXYZ:function(t,e,i){return this.x=t,this.y=e,this.z=i,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},set:function(t){return this.setXYZ(t.x,t.y,t.z)},setMagnitude:function(t){var e=t/this.magnitude();return this.multiplyScalar(e)},add:function(t){return this.setXYZ(this.x+t.x,this.y+t.y,this.z+t.z)},addScalar:function(t){return this.setXYZ(this.x+t,this.y+t,this.z+t)},subtract:function(t){return this.setXYZ(this.x-t.x,this.y-t.y,this.z-t.z)},subtractScalar:function(t){return this.setXYZ(this.x-t,this.y-t,this.z-t)},multiplyScalar:function(t){return this.setXYZ(this.x*t,this.y*t,this.z*t)},multiply:function(t){return this.multiplyScalar(t)},componentMultiply:function(t){return this.setXYZ(this.x*t.x,this.y*t.y,this.z*t.z)},divideScalar:function(t){return this.setXYZ(this.x/t,this.y/t,this.z/t)},negate:function(){return this.setXYZ(-this.x,-this.y,-this.z)},normalize:function(){var t=this.magnitude();if(0===t)throw new Error("Cannot normalize a zero-magnitude vector");return this.divideScalar(t)}},i.slerp=function(t,i,n){return e.Quaternion.slerp(new e.Quaternion,e.Quaternion.getRotationQuaternion(t,i),n).timesVector3(t)},i.Immutable=function(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0};var n=i.Immutable;return n.prototype=new i,n.prototype.constructor=n,n.mutableOverrideHelper=function(t){n.prototype[t]=function(){throw new Error("Cannot call mutable method '"+t+"' on immutable Vector3")}},n.mutableOverrideHelper("setXYZ"),n.mutableOverrideHelper("setX"),n.mutableOverrideHelper("setY"),n.mutableOverrideHelper("setZ"),i.ZERO=new n(0,0,0),i.X_UNIT=new n(1,0,0),i.Y_UNIT=new n(0,1,0),i.Z_UNIT=new n(0,0,1),i}),i("DOT/Matrix4",["require","DOT/dot","DOT/Vector3","DOT/Vector4"],function(t){var e=t("DOT/dot");t("DOT/Vector3"),t("DOT/Vector4");var i=window.Float32Array||Array;e.Matrix4=function(t,e,n,r,s,a,o,h,l,u,c,d,f,m,p,g,v){this.entries=new i(16),this.rowMajor(void 0===t?1:t,e||0,n||0,r||0,s||0,void 0===a?1:a,o||0,h||0,l||0,u||0,void 0===c?1:c,d||0,f||0,m||0,p||0,void 0===g?1:g,v)};var n=e.Matrix4;n.Types={OTHER:0,IDENTITY:1,TRANSLATION_3D:2,SCALING:3,AFFINE:4};var r=n.Types;return n.identity=function(){return new n(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,r.IDENTITY)},n.translation=function(t,e,i){return new n(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1,r.TRANSLATION_3D)},n.translationFromVector=function(t){return n.translation(t.x,t.y,t.z)},n.scaling=function(t,e,i){return e=void 0===e?t:e,i=void 0===i?t:i,new n(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1,r.SCALING)},n.rotationAxisAngle=function(t,e){var i=Math.cos(e),s=Math.sin(e),a=1-i;return new n(t.x*t.x*a+i,t.x*t.y*a-t.z*s,t.x*t.z*a+t.y*s,0,t.y*t.x*a+t.z*s,t.y*t.y*a+i,t.y*t.z*a-t.x*s,0,t.z*t.x*a-t.y*s,t.z*t.y*a+t.x*s,t.z*t.z*a+i,0,0,0,0,1,r.AFFINE)},n.rotationX=function(t){var e=Math.cos(t),i=Math.sin(t);return new n(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1,r.AFFINE)},n.rotationY=function(t){var e=Math.cos(t),i=Math.sin(t);return new n(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1,r.AFFINE)},n.rotationZ=function(t){var e=Math.cos(t),i=Math.sin(t);return new n(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1,r.AFFINE)},n.gluPerspective=function(t,e,i,r){var s=Math.cos(t)/Math.sin(t);return new n(s/e,0,0,0,0,s,0,0,0,0,(r+i)/(i-r),2*r*i/(i-r),0,0,-1,0)},n.prototype={constructor:n,rowMajor:function(t,e,i,n,s,a,o,h,l,u,c,d,f,m,p,g,v){return this.entries[0]=t,this.entries[1]=s,this.entries[2]=l,this.entries[3]=f,this.entries[4]=e,this.entries[5]=a,this.entries[6]=u,this.entries[7]=m,this.entries[8]=i,this.entries[9]=o,this.entries[10]=c,this.entries[11]=p,this.entries[12]=n,this.entries[13]=h,this.entries[14]=d,this.entries[15]=g,this.type=void 0===v?0===f&&0===m&&0===p&&1===g?r.AFFINE:r.OTHER:v,this},columnMajor:function(t,e,i,n,r,s,a,o,h,l,u,c,d,f,m,p,g){return this.rowMajor(t,r,h,d,e,s,l,f,i,a,u,m,n,o,c,p,g)},set:function(t){return this.rowMajor(t.m00(),t.m01(),t.m02(),t.m03(),t.m10(),t.m11(),t.m12(),t.m13(),t.m20(),t.m21(),t.m22(),t.m23(),t.m30(),t.m31(),t.m32(),t.m33(),t.type)},m00:function(){return this.entries[0]},m01:function(){return this.entries[4]},m02:function(){return this.entries[8]},m03:function(){return this.entries[12]},m10:function(){return this.entries[1]},m11:function(){return this.entries[5]},m12:function(){return this.entries[9]},m13:function(){return this.entries[13]},m20:function(){return this.entries[2]},m21:function(){return this.entries[6]},m22:function(){return this.entries[10]},m23:function(){return this.entries[14]},m30:function(){return this.entries[3]},m31:function(){return this.entries[7]},m32:function(){return this.entries[11]},m33:function(){return this.entries[15]},isFinite:function(){return isFinite(this.m00())&&isFinite(this.m01())&&isFinite(this.m02())&&isFinite(this.m03())&&isFinite(this.m10())&&isFinite(this.m11())&&isFinite(this.m12())&&isFinite(this.m13())&&isFinite(this.m20())&&isFinite(this.m21())&&isFinite(this.m22())&&isFinite(this.m23())&&isFinite(this.m30())&&isFinite(this.m31())&&isFinite(this.m32())&&isFinite(this.m33())},getTranslation:function(){return new e.Vector3(this.m03(),this.m13(),this.m23())},get translation(){return this.getTranslation()},getScaleVector:function(){var t=this.m00()+this.m03(),i=this.m10()+this.m13(),n=this.m20()+this.m23(),r=this.m30()+this.m33(),s=this.m01()+this.m03(),a=this.m11()+this.m13(),o=this.m21()+this.m23(),h=this.m31()+this.m33(),l=this.m02()+this.m03(),u=this.m12()+this.m13(),c=this.m22()+this.m23(),d=this.m32()+this.m33();return new e.Vector3(Math.sqrt(t*t+i*i+n*n+r*r),Math.sqrt(s*s+a*a+o*o+h*h),Math.sqrt(l*l+u*u+c*c+d*d))},get scaleVector(){return this.getScaleVector()},getCSSTransform:function(){return"matrix3d("+this.entries[0].toFixed(20)+","+this.entries[1].toFixed(20)+","+this.entries[2].toFixed(20)+","+this.entries[3].toFixed(20)+","+this.entries[4].toFixed(20)+","+this.entries[5].toFixed(20)+","+this.entries[6].toFixed(20)+","+this.entries[7].toFixed(20)+","+this.entries[8].toFixed(20)+","+this.entries[9].toFixed(20)+","+this.entries[10].toFixed(20)+","+this.entries[11].toFixed(20)+","+this.entries[12].toFixed(20)+","+this.entries[13].toFixed(20)+","+this.entries[14].toFixed(20)+","+this.entries[15].toFixed(20)+")"},get cssTransform(){return this.getCSSTransform()},equals:function(t){return this.m00()===t.m00()&&this.m01()===t.m01()&&this.m02()===t.m02()&&this.m03()===t.m03()&&this.m10()===t.m10()&&this.m11()===t.m11()&&this.m12()===t.m12()&&this.m13()===t.m13()&&this.m20()===t.m20()&&this.m21()===t.m21()&&this.m22()===t.m22()&&this.m23()===t.m23()&&this.m30()===t.m30()&&this.m31()===t.m31()&&this.m32()===t.m32()&&this.m33()===t.m33()},equalsEpsilon:function(t,e){return Math.abs(this.m00()-t.m00())<e&&Math.abs(this.m01()-t.m01())<e&&Math.abs(this.m02()-t.m02())<e&&Math.abs(this.m03()-t.m03())<e&&Math.abs(this.m10()-t.m10())<e&&Math.abs(this.m11()-t.m11())<e&&Math.abs(this.m12()-t.m12())<e&&Math.abs(this.m13()-t.m13())<e&&Math.abs(this.m20()-t.m20())<e&&Math.abs(this.m21()-t.m21())<e&&Math.abs(this.m22()-t.m22())<e&&Math.abs(this.m23()-t.m23())<e&&Math.abs(this.m30()-t.m30())<e&&Math.abs(this.m31()-t.m31())<e&&Math.abs(this.m32()-t.m32())<e&&Math.abs(this.m33()-t.m33())<e},copy:function(){return new n(this.m00(),this.m01(),this.m02(),this.m03(),this.m10(),this.m11(),this.m12(),this.m13(),this.m20(),this.m21(),this.m22(),this.m23(),this.m30(),this.m31(),this.m32(),this.m33(),this.type)},plus:function(t){return new n(this.m00()+t.m00(),this.m01()+t.m01(),this.m02()+t.m02(),this.m03()+t.m03(),this.m10()+t.m10(),this.m11()+t.m11(),this.m12()+t.m12(),this.m13()+t.m13(),this.m20()+t.m20(),this.m21()+t.m21(),this.m22()+t.m22(),this.m23()+t.m23(),this.m30()+t.m30(),this.m31()+t.m31(),this.m32()+t.m32(),this.m33()+t.m33())},minus:function(t){return new n(this.m00()-t.m00(),this.m01()-t.m01(),this.m02()-t.m02(),this.m03()-t.m03(),this.m10()-t.m10(),this.m11()-t.m11(),this.m12()-t.m12(),this.m13()-t.m13(),this.m20()-t.m20(),this.m21()-t.m21(),this.m22()-t.m22(),this.m23()-t.m23(),this.m30()-t.m30(),this.m31()-t.m31(),this.m32()-t.m32(),this.m33()-t.m33())},transposed:function(){return new n(this.m00(),this.m10(),this.m20(),this.m30(),this.m01(),this.m11(),this.m21(),this.m31(),this.m02(),this.m12(),this.m22(),this.m32(),this.m03(),this.m13(),this.m23(),this.m33())},negated:function(){return new n(-this.m00(),-this.m01(),-this.m02(),-this.m03(),-this.m10(),-this.m11(),-this.m12(),-this.m13(),-this.m20(),-this.m21(),-this.m22(),-this.m23(),-this.m30(),-this.m31(),-this.m32(),-this.m33())},inverted:function(){switch(this.type){case r.IDENTITY:return this;case r.TRANSLATION_3D:return new n(1,0,0,-this.m03(),0,1,0,-this.m13(),0,0,1,-this.m23(),0,0,0,1,r.TRANSLATION_3D);case r.SCALING:return new n(1/this.m00(),0,0,0,0,1/this.m11(),0,0,0,0,1/this.m22(),0,0,0,0,1/this.m33(),r.SCALING);case r.AFFINE:case r.OTHER:var t=this.getDeterminant();if(0!==t)return new n((-this.m31()*this.m22()*this.m13()+this.m21()*this.m32()*this.m13()+this.m31()*this.m12()*this.m23()-this.m11()*this.m32()*this.m23()-this.m21()*this.m12()*this.m33()+this.m11()*this.m22()*this.m33())/t,(this.m31()*this.m22()*this.m03()-this.m21()*this.m32()*this.m03()-this.m31()*this.m02()*this.m23()+this.m01()*this.m32()*this.m23()+this.m21()*this.m02()*this.m33()-this.m01()*this.m22()*this.m33())/t,(-this.m31()*this.m12()*this.m03()+this.m11()*this.m32()*this.m03()+this.m31()*this.m02()*this.m13()-this.m01()*this.m32()*this.m13()-this.m11()*this.m02()*this.m33()+this.m01()*this.m12()*this.m33())/t,(this.m21()*this.m12()*this.m03()-this.m11()*this.m22()*this.m03()-this.m21()*this.m02()*this.m13()+this.m01()*this.m22()*this.m13()+this.m11()*this.m02()*this.m23()-this.m01()*this.m12()*this.m23())/t,(this.m30()*this.m22()*this.m13()-this.m20()*this.m32()*this.m13()-this.m30()*this.m12()*this.m23()+this.m10()*this.m32()*this.m23()+this.m20()*this.m12()*this.m33()-this.m10()*this.m22()*this.m33())/t,(-this.m30()*this.m22()*this.m03()+this.m20()*this.m32()*this.m03()+this.m30()*this.m02()*this.m23()-this.m00()*this.m32()*this.m23()-this.m20()*this.m02()*this.m33()+this.m00()*this.m22()*this.m33())/t,(this.m30()*this.m12()*this.m03()-this.m10()*this.m32()*this.m03()-this.m30()*this.m02()*this.m13()+this.m00()*this.m32()*this.m13()+this.m10()*this.m02()*this.m33()-this.m00()*this.m12()*this.m33())/t,(-this.m20()*this.m12()*this.m03()+this.m10()*this.m22()*this.m03()+this.m20()*this.m02()*this.m13()-this.m00()*this.m22()*this.m13()-this.m10()*this.m02()*this.m23()+this.m00()*this.m12()*this.m23())/t,(-this.m30()*this.m21()*this.m13()+this.m20()*this.m31()*this.m13()+this.m30()*this.m11()*this.m23()-this.m10()*this.m31()*this.m23()-this.m20()*this.m11()*this.m33()+this.m10()*this.m21()*this.m33())/t,(this.m30()*this.m21()*this.m03()-this.m20()*this.m31()*this.m03()-this.m30()*this.m01()*this.m23()+this.m00()*this.m31()*this.m23()+this.m20()*this.m01()*this.m33()-this.m00()*this.m21()*this.m33())/t,(-this.m30()*this.m11()*this.m03()+this.m10()*this.m31()*this.m03()+this.m30()*this.m01()*this.m13()-this.m00()*this.m31()*this.m13()-this.m10()*this.m01()*this.m33()+this.m00()*this.m11()*this.m33())/t,(this.m20()*this.m11()*this.m03()-this.m10()*this.m21()*this.m03()-this.m20()*this.m01()*this.m13()+this.m00()*this.m21()*this.m13()+this.m10()*this.m01()*this.m23()-this.m00()*this.m11()*this.m23())/t,(this.m30()*this.m21()*this.m12()-this.m20()*this.m31()*this.m12()-this.m30()*this.m11()*this.m22()+this.m10()*this.m31()*this.m22()+this.m20()*this.m11()*this.m32()-this.m10()*this.m21()*this.m32())/t,(-this.m30()*this.m21()*this.m02()+this.m20()*this.m31()*this.m02()+this.m30()*this.m01()*this.m22()-this.m00()*this.m31()*this.m22()-this.m20()*this.m01()*this.m32()+this.m00()*this.m21()*this.m32())/t,(this.m30()*this.m11()*this.m02()-this.m10()*this.m31()*this.m02()-this.m30()*this.m01()*this.m12()+this.m00()*this.m31()*this.m12()+this.m10()*this.m01()*this.m32()-this.m00()*this.m11()*this.m32())/t,(-this.m20()*this.m11()*this.m02()+this.m10()*this.m21()*this.m02()+this.m20()*this.m01()*this.m12()-this.m00()*this.m21()*this.m12()-this.m10()*this.m01()*this.m22()+this.m00()*this.m11()*this.m22())/t);throw new Error("Matrix could not be inverted, determinant === 0");default:throw new Error("Matrix3.inverted with unknown type: "+this.type)}},timesMatrix:function(t){if(this.type===r.IDENTITY||t.type===r.IDENTITY)return this.type===r.IDENTITY?t:this;if(this.type===t.type){if(this.type===r.TRANSLATION_3D)return new n(1,0,0,this.m03()+t.m02(),0,1,0,this.m13()+t.m12(),0,0,1,this.m23()+t.m23(),0,0,0,1,r.TRANSLATION_3D);if(this.type===r.SCALING)return new n(this.m00()*t.m00(),0,0,0,0,this.m11()*t.m11(),0,0,0,0,this.m22()*t.m22(),0,0,0,0,1,r.SCALING)}return this.type!==r.OTHER&&t.type!==r.OTHER?new n(this.m00()*t.m00()+this.m01()*t.m10()+this.m02()*t.m20(),this.m00()*t.m01()+this.m01()*t.m11()+this.m02()*t.m21(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02()*t.m22(),this.m00()*t.m03()+this.m01()*t.m13()+this.m02()*t.m23()+this.m03(),this.m10()*t.m00()+this.m11()*t.m10()+this.m12()*t.m20(),this.m10()*t.m01()+this.m11()*t.m11()+this.m12()*t.m21(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12()*t.m22(),this.m10()*t.m03()+this.m11()*t.m13()+this.m12()*t.m23()+this.m13(),this.m20()*t.m00()+this.m21()*t.m10()+this.m22()*t.m20(),this.m20()*t.m01()+this.m21()*t.m11()+this.m22()*t.m21(),this.m20()*t.m02()+this.m21()*t.m12()+this.m22()*t.m22(),this.m20()*t.m03()+this.m21()*t.m13()+this.m22()*t.m23()+this.m23(),0,0,0,1,r.AFFINE):new n(this.m00()*t.m00()+this.m01()*t.m10()+this.m02()*t.m20()+this.m03()*t.m30(),this.m00()*t.m01()+this.m01()*t.m11()+this.m02()*t.m21()+this.m03()*t.m31(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02()*t.m22()+this.m03()*t.m32(),this.m00()*t.m03()+this.m01()*t.m13()+this.m02()*t.m23()+this.m03()*t.m33(),this.m10()*t.m00()+this.m11()*t.m10()+this.m12()*t.m20()+this.m13()*t.m30(),this.m10()*t.m01()+this.m11()*t.m11()+this.m12()*t.m21()+this.m13()*t.m31(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12()*t.m22()+this.m13()*t.m32(),this.m10()*t.m03()+this.m11()*t.m13()+this.m12()*t.m23()+this.m13()*t.m33(),this.m20()*t.m00()+this.m21()*t.m10()+this.m22()*t.m20()+this.m23()*t.m30(),this.m20()*t.m01()+this.m21()*t.m11()+this.m22()*t.m21()+this.m23()*t.m31(),this.m20()*t.m02()+this.m21()*t.m12()+this.m22()*t.m22()+this.m23()*t.m32(),this.m20()*t.m03()+this.m21()*t.m13()+this.m22()*t.m23()+this.m23()*t.m33(),this.m30()*t.m00()+this.m31()*t.m10()+this.m32()*t.m20()+this.m33()*t.m30(),this.m30()*t.m01()+this.m31()*t.m11()+this.m32()*t.m21()+this.m33()*t.m31(),this.m30()*t.m02()+this.m31()*t.m12()+this.m32()*t.m22()+this.m33()*t.m32(),this.m30()*t.m03()+this.m31()*t.m13()+this.m32()*t.m23()+this.m33()*t.m33())},timesVector4:function(t){var i=this.m00()*t.x+this.m01()*t.y+this.m02()*t.z+this.m03()*t.w,n=this.m10()*t.x+this.m11()*t.y+this.m12()*t.z+this.m13()*t.w,r=this.m20()*t.x+this.m21()*t.y+this.m22()*t.z+this.m23()*t.w,s=this.m30()*t.x+this.m31()*t.y+this.m32()*t.z+this.m33()*t.w;return new e.Vector4(i,n,r,s)},timesVector3:function(t){return this.timesVector4(t.toVector4()).toVector3()},timesTransposeVector4:function(t){var i=this.m00()*t.x+this.m10()*t.y+this.m20()*t.z+this.m30()*t.w,n=this.m01()*t.x+this.m11()*t.y+this.m21()*t.z+this.m31()*t.w,r=this.m02()*t.x+this.m12()*t.y+this.m22()*t.z+this.m32()*t.w,s=this.m03()*t.x+this.m13()*t.y+this.m23()*t.z+this.m33()*t.w;return new e.Vector4(i,n,r,s)},timesTransposeVector3:function(t){return this.timesTransposeVector4(t.toVector4()).toVector3()},timesRelativeVector3:function(t){var i=this.m00()*t.x+this.m10()*t.y+this.m20()*t.z,n=this.m01()*t.y+this.m11()*t.y+this.m21()*t.z,r=this.m02()*t.z+this.m12()*t.y+this.m22()*t.z;return new e.Vector3(i,n,r)},getDeterminant:function(){return this.m03()*this.m12()*this.m21()*this.m30()-this.m02()*this.m13()*this.m21()*this.m30()-this.m03()*this.m11()*this.m22()*this.m30()+this.m01()*this.m13()*this.m22()*this.m30()+this.m02()*this.m11()*this.m23()*this.m30()-this.m01()*this.m12()*this.m23()*this.m30()-this.m03()*this.m12()*this.m20()*this.m31()+this.m02()*this.m13()*this.m20()*this.m31()+this.m03()*this.m10()*this.m22()*this.m31()-this.m00()*this.m13()*this.m22()*this.m31()-this.m02()*this.m10()*this.m23()*this.m31()+this.m00()*this.m12()*this.m23()*this.m31()+this.m03()*this.m11()*this.m20()*this.m32()-this.m01()*this.m13()*this.m20()*this.m32()-this.m03()*this.m10()*this.m21()*this.m32()+this.m00()*this.m13()*this.m21()*this.m32()+this.m01()*this.m10()*this.m23()*this.m32()-this.m00()*this.m11()*this.m23()*this.m32()-this.m02()*this.m11()*this.m20()*this.m33()+this.m01()*this.m12()*this.m20()*this.m33()+this.m02()*this.m10()*this.m21()*this.m33()-this.m00()*this.m12()*this.m21()*this.m33()-this.m01()*this.m10()*this.m22()*this.m33()+this.m00()*this.m11()*this.m22()*this.m33()},get determinant(){return this.getDeterminant()},toString:function(){return this.m00()+" "+this.m01()+" "+this.m02()+" "+this.m03()+"\n"+this.m10()+" "+this.m11()+" "+this.m12()+" "+this.m13()+"\n"+this.m20()+" "+this.m21()+" "+this.m22()+" "+this.m23()+"\n"+this.m30()+" "+this.m31()+" "+this.m32()+" "+this.m33()},makeImmutable:function(){this.rowMajor=function(){throw new Error("Cannot modify immutable matrix")}}},n.IDENTITY=new n,n.IDENTITY.makeImmutable(),n}),i("DOT/Matrix3",["require","DOT/dot","PHET_CORE/PoolableMixin","DOT/Vector2","DOT/Vector3","DOT/Matrix4"],function(t){var e=t("DOT/dot"),i=t("PHET_CORE/PoolableMixin"),n=e.FastArray;t("DOT/Vector2"),t("DOT/Vector3"),t("DOT/Matrix4");var r=new n(9);r[0]=1,r[4]=1,r[8]=1;var s=n===Array?function(){return[1,0,0,0,1,0,0,0,1]}:function(){return new n(r)};e.Matrix3=function(){this.entries=s(),this.type=o.IDENTITY};var a=e.Matrix3;a.Types={OTHER:0,IDENTITY:1,TRANSLATION_2D:2,SCALING:3,AFFINE:4};var o=a.Types;return a.identity=function(){return a.dirtyFromPool().setToIdentity()},a.translation=function(t,e){return a.dirtyFromPool().setToTranslation(t,e)},a.translationFromVector=function(t){return a.translation(t.x,t.y)},a.scaling=function(t,e){return a.dirtyFromPool().setToScale(t,e)},a.scale=a.scaling,a.affine=function(t,e,i,n,r,s){return a.dirtyFromPool().setToAffine(t,i,r,e,n,s)},a.rowMajor=function(t,e,i,n,r,s,o,h,l,u){return a.dirtyFromPool().rowMajor(t,e,i,n,r,s,o,h,l,u)},a.rotationAxisAngle=function(t,e){return a.dirtyFromPool().setToRotationAxisAngle(t,e)},a.rotationX=function(t){return a.dirtyFromPool().setToRotationX(t)},a.rotationY=function(t){return a.dirtyFromPool().setToRotationY(t)},a.rotationZ=function(t){return a.dirtyFromPool().setToRotationZ(t)},a.rotation2=a.rotationZ,a.rotationAround=function(t,e,i){return a.translation(e,i).timesMatrix(a.rotation2(t)).timesMatrix(a.translation(-e,-i))},a.rotationAroundPoint=function(t,e){return a.rotationAround(t,e.x,e.y)},a.fromSVGMatrix=function(t){return a.dirtyFromPool().setToSVGMatrix(t)},a.rotateAToB=function(t,e){return a.dirtyFromPool().setRotationAToB(t,e)},a.prototype={constructor:a,m00:function(){return this.entries[0]},m01:function(){return this.entries[3]},m02:function(){return this.entries[6]},m10:function(){return this.entries[1]},m11:function(){return this.entries[4]},m12:function(){return this.entries[7]},m20:function(){return this.entries[2]},m21:function(){return this.entries[5]},m22:function(){return this.entries[8]},isIdentity:function(){return this.type===o.IDENTITY||this.equals(a.IDENTITY)},isAffine:function(){return this.type===o.AFFINE||0===this.m20()&&0===this.m21()&&1===this.m22()},isAligned:function(){return this.isAffine()&&0===this.m01()&&0===this.m10()},isAxisAligned:function(){return this.isAffine()&&(0===this.m01()&&0===this.m10()||0===this.m00()&&0===this.m11())},isFinite:function(){return isFinite(this.m00())&&isFinite(this.m01())&&isFinite(this.m02())&&isFinite(this.m10())&&isFinite(this.m11())&&isFinite(this.m12())&&isFinite(this.m20())&&isFinite(this.m21())&&isFinite(this.m22())},getDeterminant:function(){return this.m00()*this.m11()*this.m22()+this.m01()*this.m12()*this.m20()+this.m02()*this.m10()*this.m21()-this.m02()*this.m11()*this.m20()-this.m01()*this.m10()*this.m22()-this.m00()*this.m12()*this.m21()},get determinant(){return this.getDeterminant()},getTranslation:function(){return new e.Vector2(this.m02(),this.m12())},get translation(){return this.getTranslation()},getScaleVector:function(){return new e.Vector2(Math.sqrt(this.m00()*this.m00()+this.m10()*this.m10()),Math.sqrt(this.m01()*this.m01()+this.m11()*this.m11()))},get scaleVector(){return this.getScaleVector()},getRotation:function(){var t=this.timesVector2(e.Vector2.X_UNIT).minus(this.timesVector2(e.Vector2.ZERO));return Math.atan2(t.y,t.x)},get rotation(){return this.getRotation()},toMatrix4:function(){return new e.Matrix4(this.m00(),this.m01(),this.m02(),0,this.m10(),this.m11(),this.m12(),0,this.m20(),this.m21(),this.m22(),0,0,0,0,1)},toAffineMatrix4:function(){return new e.Matrix4(this.m00(),this.m01(),0,this.m02(),this.m10(),this.m11(),0,this.m12(),0,0,1,0,0,0,0,1)},toString:function(){return this.m00()+" "+this.m01()+" "+this.m02()+"\n"+this.m10()+" "+this.m11()+" "+this.m12()+"\n"+this.m20()+" "+this.m21()+" "+this.m22()},toSVGMatrix:function(){var t=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix();return t.a=this.m00(),t.b=this.m10(),t.c=this.m01(),t.d=this.m11(),t.e=this.m02(),t.f=this.m12(),t},getCSSTransform:function(){return"matrix("+this.entries[0].toFixed(20)+","+this.entries[1].toFixed(20)+","+this.entries[3].toFixed(20)+","+this.entries[4].toFixed(20)+","+this.entries[6].toFixed(20)+","+this.entries[7].toFixed(20)+")"},get cssTransform(){return this.getCSSTransform()},getSVGTransform:function(){function t(t){return t.toFixed(20)}switch(this.type){case o.IDENTITY:return"";case o.TRANSLATION_2D:return"translate("+t(this.entries[6])+","+t(this.entries[7])+")";case o.SCALING:return"scale("+t(this.entries[0])+(this.entries[0]===this.entries[4]?"":","+t(this.entries[4]))+")";default:return"matrix("+t(this.entries[0])+","+t(this.entries[1])+","+t(this.entries[3])+","+t(this.entries[4])+","+t(this.entries[6])+","+t(this.entries[7])+")"}},get svgTransform(){return this.getSVGTransform()},getCSSTransformStyles:function(){var t=this.getCSSTransform();return{"-webkit-perspective":1e3,"-webkit-backface-visibility":"hidden","-webkit-transform":t+" translateZ(0)","-moz-transform":t+" translateZ(0)","-ms-transform":t,"-o-transform":t,transform:t,"transform-origin":"top left","-ms-transform-origin":"top left"}},get cssTransformStyles(){return this.getCSSTransformStyles()},equals:function(t){return this.m00()===t.m00()&&this.m01()===t.m01()&&this.m02()===t.m02()&&this.m10()===t.m10()&&this.m11()===t.m11()&&this.m12()===t.m12()&&this.m20()===t.m20()&&this.m21()===t.m21()&&this.m22()===t.m22()},equalsEpsilon:function(t,e){return Math.abs(this.m00()-t.m00())<e&&Math.abs(this.m01()-t.m01())<e&&Math.abs(this.m02()-t.m02())<e&&Math.abs(this.m10()-t.m10())<e&&Math.abs(this.m11()-t.m11())<e&&Math.abs(this.m12()-t.m12())<e&&Math.abs(this.m20()-t.m20())<e&&Math.abs(this.m21()-t.m21())<e&&Math.abs(this.m22()-t.m22())<e},copy:function(){return a.createFromPool(this.m00(),this.m01(),this.m02(),this.m10(),this.m11(),this.m12(),this.m20(),this.m21(),this.m22(),this.type)},plus:function(t){return a.createFromPool(this.m00()+t.m00(),this.m01()+t.m01(),this.m02()+t.m02(),this.m10()+t.m10(),this.m11()+t.m11(),this.m12()+t.m12(),this.m20()+t.m20(),this.m21()+t.m21(),this.m22()+t.m22())},minus:function(t){return a.createFromPool(this.m00()-t.m00(),this.m01()-t.m01(),this.m02()-t.m02(),this.m10()-t.m10(),this.m11()-t.m11(),this.m12()-t.m12(),this.m20()-t.m20(),this.m21()-t.m21(),this.m22()-t.m22())},transposed:function(){return a.createFromPool(this.m00(),this.m10(),this.m20(),this.m01(),this.m11(),this.m21(),this.m02(),this.m12(),this.m22(),this.type===o.IDENTITY||this.type===o.SCALING?this.type:void 0)},negated:function(){return a.createFromPool(-this.m00(),-this.m01(),-this.m02(),-this.m10(),-this.m11(),-this.m12(),-this.m20(),-this.m21(),-this.m22())},inverted:function(){var t;switch(this.type){case o.IDENTITY:return this;case o.TRANSLATION_2D:return a.createFromPool(1,0,-this.m02(),0,1,-this.m12(),0,0,1,o.TRANSLATION_2D);case o.SCALING:return a.createFromPool(1/this.m00(),0,0,0,1/this.m11(),0,0,0,1/this.m22(),o.SCALING);case o.AFFINE:if(t=this.getDeterminant(),0!==t)return a.createFromPool((-this.m12()*this.m21()+this.m11()*this.m22())/t,(this.m02()*this.m21()-this.m01()*this.m22())/t,(-this.m02()*this.m11()+this.m01()*this.m12())/t,(this.m12()*this.m20()-this.m10()*this.m22())/t,(-this.m02()*this.m20()+this.m00()*this.m22())/t,(this.m02()*this.m10()-this.m00()*this.m12())/t,0,0,1,o.AFFINE);throw new Error("Matrix could not be inverted, determinant === 0");case o.OTHER:if(t=this.getDeterminant(),0!==t)return a.createFromPool((-this.m12()*this.m21()+this.m11()*this.m22())/t,(this.m02()*this.m21()-this.m01()*this.m22())/t,(-this.m02()*this.m11()+this.m01()*this.m12())/t,(this.m12()*this.m20()-this.m10()*this.m22())/t,(-this.m02()*this.m20()+this.m00()*this.m22())/t,(this.m02()*this.m10()-this.m00()*this.m12())/t,(-this.m11()*this.m20()+this.m10()*this.m21())/t,(this.m01()*this.m20()-this.m00()*this.m21())/t,(-this.m01()*this.m10()+this.m00()*this.m11())/t,o.OTHER);throw new Error("Matrix could not be inverted, determinant === 0");default:throw new Error("Matrix3.inverted with unknown type: "+this.type)}},timesMatrix:function(t){if(this.type===o.IDENTITY||t.type===o.IDENTITY)return this.type===o.IDENTITY?t:this;if(this.type===t.type){if(this.type===o.TRANSLATION_2D)return a.createFromPool(1,0,this.m02()+t.m02(),0,1,this.m12()+t.m12(),0,0,1,o.TRANSLATION_2D);if(this.type===o.SCALING)return a.createFromPool(this.m00()*t.m00(),0,0,0,this.m11()*t.m11(),0,0,0,1,o.SCALING)}return this.type!==o.OTHER&&t.type!==o.OTHER?a.createFromPool(this.m00()*t.m00()+this.m01()*t.m10(),this.m00()*t.m01()+this.m01()*t.m11(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02(),this.m10()*t.m00()+this.m11()*t.m10(),this.m10()*t.m01()+this.m11()*t.m11(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12(),0,0,1,o.AFFINE):a.createFromPool(this.m00()*t.m00()+this.m01()*t.m10()+this.m02()*t.m20(),this.m00()*t.m01()+this.m01()*t.m11()+this.m02()*t.m21(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02()*t.m22(),this.m10()*t.m00()+this.m11()*t.m10()+this.m12()*t.m20(),this.m10()*t.m01()+this.m11()*t.m11()+this.m12()*t.m21(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12()*t.m22(),this.m20()*t.m00()+this.m21()*t.m10()+this.m22()*t.m20(),this.m20()*t.m01()+this.m21()*t.m11()+this.m22()*t.m21(),this.m20()*t.m02()+this.m21()*t.m12()+this.m22()*t.m22())},timesVector2:function(t){var i=this.m00()*t.x+this.m01()*t.y+this.m02(),n=this.m10()*t.x+this.m11()*t.y+this.m12();return new e.Vector2(i,n)},timesVector3:function(t){var i=this.m00()*t.x+this.m01()*t.y+this.m02()*t.z,n=this.m10()*t.x+this.m11()*t.y+this.m12()*t.z,r=this.m20()*t.x+this.m21()*t.y+this.m22()*t.z;return new e.Vector3(i,n,r)},timesTransposeVector2:function(t){var i=this.m00()*t.x+this.m10()*t.y,n=this.m01()*t.x+this.m11()*t.y;return new e.Vector2(i,n)},timesRelativeVector2:function(t){var i=this.m00()*t.x+this.m01()*t.y,n=this.m10()*t.y+this.m11()*t.y;return new e.Vector2(i,n)},rowMajor:function(t,e,i,n,r,s,a,h,l,u){return this.entries[0]=t,this.entries[1]=n,this.entries[2]=a,this.entries[3]=e,this.entries[4]=r,this.entries[5]=h,this.entries[6]=i,this.entries[7]=s,this.entries[8]=l,this.type=void 0===u?0===a&&0===h&&1===l?o.AFFINE:o.OTHER:u,this},set:function(t){return this.rowMajor(t.m00(),t.m01(),t.m02(),t.m10(),t.m11(),t.m12(),t.m20(),t.m21(),t.m22(),t.type)},makeImmutable:function(){return this.rowMajor=function(){throw new Error("Cannot modify immutable matrix")},this},columnMajor:function(t,e,i,n,r,s,a,o,h,l){return this.rowMajor(t,n,a,e,r,o,i,s,h,l)},add:function(t){return this.rowMajor(this.m00()+t.m00(),this.m01()+t.m01(),this.m02()+t.m02(),this.m10()+t.m10(),this.m11()+t.m11(),this.m12()+t.m12(),this.m20()+t.m20(),this.m21()+t.m21(),this.m22()+t.m22())},subtract:function(t){return this.rowMajor(this.m00()-t.m00(),this.m01()-t.m01(),this.m02()-t.m02(),this.m10()-t.m10(),this.m11()-t.m11(),this.m12()-t.m12(),this.m20()-t.m20(),this.m21()-t.m21(),this.m22()-t.m22())},transpose:function(){return this.rowMajor(this.m00(),this.m10(),this.m20(),this.m01(),this.m11(),this.m21(),this.m02(),this.m12(),this.m22(),this.type===o.IDENTITY||this.type===o.SCALING?this.type:void 0)},negate:function(){return this.rowMajor(-this.m00(),-this.m01(),-this.m02(),-this.m10(),-this.m11(),-this.m12(),-this.m20(),-this.m21(),-this.m22())},invert:function(){var t;switch(this.type){case o.IDENTITY:return this;case o.TRANSLATION_2D:return this.rowMajor(1,0,-this.m02(),0,1,-this.m12(),0,0,1,o.TRANSLATION_2D);case o.SCALING:return this.rowMajor(1/this.m00(),0,0,0,1/this.m11(),0,0,0,1/this.m22(),o.SCALING);case o.AFFINE:if(t=this.getDeterminant(),0!==t)return this.rowMajor((-this.m12()*this.m21()+this.m11()*this.m22())/t,(this.m02()*this.m21()-this.m01()*this.m22())/t,(-this.m02()*this.m11()+this.m01()*this.m12())/t,(this.m12()*this.m20()-this.m10()*this.m22())/t,(-this.m02()*this.m20()+this.m00()*this.m22())/t,(this.m02()*this.m10()-this.m00()*this.m12())/t,0,0,1,o.AFFINE);
throw new Error("Matrix could not be inverted, determinant === 0");case o.OTHER:if(t=this.getDeterminant(),0!==t)return this.rowMajor((-this.m12()*this.m21()+this.m11()*this.m22())/t,(this.m02()*this.m21()-this.m01()*this.m22())/t,(-this.m02()*this.m11()+this.m01()*this.m12())/t,(this.m12()*this.m20()-this.m10()*this.m22())/t,(-this.m02()*this.m20()+this.m00()*this.m22())/t,(this.m02()*this.m10()-this.m00()*this.m12())/t,(-this.m11()*this.m20()+this.m10()*this.m21())/t,(this.m01()*this.m20()-this.m00()*this.m21())/t,(-this.m01()*this.m10()+this.m00()*this.m11())/t,o.OTHER);throw new Error("Matrix could not be inverted, determinant === 0");default:throw new Error("Matrix3.inverted with unknown type: "+this.type)}},multiplyMatrix:function(t){if(t.type===o.IDENTITY)return this;if(this.type===o.IDENTITY)return this.set(t);if(this.type===t.type){if(this.type===o.TRANSLATION_2D)return this.rowMajor(1,0,this.m02()+t.m02(),0,1,this.m12()+t.m12(),0,0,1,o.TRANSLATION_2D);if(this.type===o.SCALING)return this.rowMajor(this.m00()*t.m00(),0,0,0,this.m11()*t.m11(),0,0,0,1,o.SCALING)}return this.type!==o.OTHER&&t.type!==o.OTHER?this.rowMajor(this.m00()*t.m00()+this.m01()*t.m10(),this.m00()*t.m01()+this.m01()*t.m11(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02(),this.m10()*t.m00()+this.m11()*t.m10(),this.m10()*t.m01()+this.m11()*t.m11(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12(),0,0,1,o.AFFINE):this.rowMajor(this.m00()*t.m00()+this.m01()*t.m10()+this.m02()*t.m20(),this.m00()*t.m01()+this.m01()*t.m11()+this.m02()*t.m21(),this.m00()*t.m02()+this.m01()*t.m12()+this.m02()*t.m22(),this.m10()*t.m00()+this.m11()*t.m10()+this.m12()*t.m20(),this.m10()*t.m01()+this.m11()*t.m11()+this.m12()*t.m21(),this.m10()*t.m02()+this.m11()*t.m12()+this.m12()*t.m22(),this.m20()*t.m00()+this.m21()*t.m10()+this.m22()*t.m20(),this.m20()*t.m01()+this.m21()*t.m11()+this.m22()*t.m21(),this.m20()*t.m02()+this.m21()*t.m12()+this.m22()*t.m22())},setToIdentity:function(){return this.rowMajor(1,0,0,0,1,0,0,0,1,o.IDENTITY)},setToTranslation:function(t,e){return this.rowMajor(1,0,t,0,1,e,0,0,1,o.TRANSLATION_2D)},setToScale:function(t,e){return e=void 0===e?t:e,this.rowMajor(t,0,0,0,e,0,0,0,1,o.SCALING)},setToAffine:function(t,e,i,n,r,s){return this.rowMajor(t,e,i,n,r,s,0,0,1,o.AFFINE)},setToRotationAxisAngle:function(t,e){var i=Math.cos(e),n=Math.sin(e),r=1-i;return this.rowMajor(t.x*t.x*r+i,t.x*t.y*r-t.z*n,t.x*t.z*r+t.y*n,t.y*t.x*r+t.z*n,t.y*t.y*r+i,t.y*t.z*r-t.x*n,t.z*t.x*r-t.y*n,t.z*t.y*r+t.x*n,t.z*t.z*r+i,o.OTHER)},setToRotationX:function(t){var e=Math.cos(t),i=Math.sin(t);return this.rowMajor(1,0,0,0,e,-i,0,i,e,o.OTHER)},setToRotationY:function(t){var e=Math.cos(t),i=Math.sin(t);return this.rowMajor(e,0,i,0,1,0,-i,0,e,o.OTHER)},setToRotationZ:function(t){var e=Math.cos(t),i=Math.sin(t);return this.rowMajor(e,-i,0,i,e,0,0,0,1,o.AFFINE)},setToSVGMatrix:function(t){return this.rowMajor(t.a,t.c,t.e,t.b,t.d,t.f,0,0,1,o.AFFINE)},setRotationAToB:function(t,i){var n,r,s,a=t,o=i,h=1e-4,l=a.cross(o);if(n=a.dot(o),s=0>n?-n:n,s>1-h){var u,c,d,f=new e.Vector3(a.x>0?a.x:-a.x,a.y>0?a.y:-a.y,a.z>0?a.z:-a.z);f=f.x<f.y?f.x<f.z?e.Vector3.X_UNIT:e.Vector3.Z_UNIT:f.y<f.z?e.Vector3.Y_UNIT:e.Vector3.Z_UNIT;var m=f.minus(a);return l=f.minus(o),u=2/m.dot(m),c=2/l.dot(l),d=u*c*m.dot(l),this.rowMajor(-u*m.x*m.x-c*l.x*l.x+d*l.x*m.x+1,-u*m.x*m.y-c*l.x*l.y+d*l.x*m.y,-u*m.x*m.z-c*l.x*l.z+d*l.x*m.z,-u*m.y*m.x-c*l.y*l.x+d*l.y*m.x,-u*m.y*m.y-c*l.y*l.y+d*l.y*m.y+1,-u*m.y*m.z-c*l.y*l.z+d*l.y*m.z,-u*m.z*m.x-c*l.z*l.x+d*l.z*m.x,-u*m.z*m.y-c*l.z*l.y+d*l.z*m.y,-u*m.z*m.z-c*l.z*l.z+d*l.z*m.z+1)}var p,g,v,b,y;return r=1/(1+n),p=r*l.x,g=r*l.z,v=p*l.y,b=p*l.z,y=g*l.y,this.rowMajor(n+p*l.x,v-l.z,b+l.y,v+l.z,n+r*l.y*l.y,y-l.x,b-l.y,y+l.x,n+g*l.z)},multiplyVector2:function(t){return t.setXY(this.m00()*t.x+this.m01()*t.y+this.m02(),this.m10()*t.x+this.m11()*t.y+this.m12())},multiplyVector3:function(t){return t.setXYZ(this.m00()*t.x+this.m01()*t.y+this.m02()*t.z,this.m10()*t.x+this.m11()*t.y+this.m12()*t.z,this.m20()*t.x+this.m21()*t.y+this.m22()*t.z)},multiplyTransposeVector2:function(t){return t.setXY(this.m00()*t.x+this.m10()*t.y,this.m01()*t.x+this.m11()*t.y)},multiplyRelativeVector2:function(t){return t.setXY(this.m00()*t.x+this.m01()*t.y,this.m10()*t.y+this.m11()*t.y)},canvasSetTransform:function(t){t.setTransform(this.entries[0],this.entries[1],this.entries[3],this.entries[4],this.entries[6],this.entries[7])},canvasAppendTransform:function(t){this.type!==o.IDENTITY&&t.transform(this.entries[0],this.entries[1],this.entries[3],this.entries[4],this.entries[6],this.entries[7])}},i(a,{defaultFactory:function(){return new a},constructorDuplicateFactory:function(t){return function(e,i,n,r,s,o,h,l,u,c){var d=t.length?t.pop():new a;return d.rowMajor(e,i,n,r,s,o,h,l,u,c)}}}),a.IDENTITY=a.identity(),a.IDENTITY.makeImmutable(),a.X_REFLECTION=a.createFromPool(-1,0,0,0,1,0,0,0,1,o.AFFINE),a.X_REFLECTION.makeImmutable(),a.Y_REFLECTION=a.createFromPool(1,0,0,0,-1,0,0,0,1,o.AFFINE),a.Y_REFLECTION.makeImmutable(),a.translationTimesMatrix=function(t,e,i){var n;return i.type===o.IDENTITY||i.type===o.TRANSLATION_2D?a.createFromPool(1,0,i.m02()+t,0,1,i.m12()+e,0,0,1,o.TRANSLATION_2D):(n=i.type===o.OTHER?o.OTHER:o.AFFINE,a.createFromPool(i.m00(),i.m01(),i.m02()+t,i.m10(),i.m11(),i.m12()+e,i.m20(),i.m21(),i.m22(),n))},a.printer={print:function(t){console.log(t.toString())}},a}),i("DOT/Ray2",["require","DOT/dot"],function(t){var e=t("DOT/dot");e.Ray2=function(t,e){this.pos=t,this.dir=e};var i=e.Ray2;return i.prototype={constructor:i,shifted:function(t){return new i(this.pointAtDistance(t),this.dir)},pointAtDistance:function(t){return this.pos.plus(this.dir.timesScalar(t))},toString:function(){return this.pos.toString()+" => "+this.dir.toString()}},i}),i("DOT/Transform3",["require","DOT/dot","DOT/Matrix3","DOT/Vector2","DOT/Ray2"],function(t){var e=t("DOT/dot");t("DOT/Matrix3"),t("DOT/Vector2"),t("DOT/Ray2"),e.Transform3=function(t){this.listeners=[],this.setMatrix(void 0===t?e.Matrix3.IDENTITY:t)};var i=e.Transform3;return i.prototype={constructor:i,setMatrix:function(t){if(t.isFinite()){var e,i=this.matrix,n=this.listeners.length;for(e=0;n>e;e++)this.listeners[e].before(t,i);for(this.matrix=t,this.inverse=null,this.matrixTransposed=null,this.inverseTransposed=null,e=0;n>e;e++)this.listeners[e].after(t,i)}},prepend:function(t){this.setMatrix(t.timesMatrix(this.matrix))},prependTranslation:function(t,i){this.setMatrix(e.Matrix3.translationTimesMatrix(t,i,this.matrix))},append:function(t){this.setMatrix(this.matrix.timesMatrix(t))},prependTransform:function(t){this.prepend(t.matrix)},appendTransform:function(t){this.append(t.matrix)},applyToCanvasContext:function(t){t.setTransform(this.matrix.m00(),this.matrix.m10(),this.matrix.m01(),this.matrix.m11(),this.matrix.m02(),this.matrix.m12())},copy:function(){var t=new i(this.matrix);t.inverse=this.inverse,t.matrixTransposed=this.matrixTransposed,t.inverseTransposed=this.inverseTransposed},deepCopy:function(){var t=new i(this.matrix.copy());t.inverse=this.inverse?this.inverse.copy():null,t.matrixTransposed=this.matrixTransposed?this.matrixTransposed.copy():null,t.inverseTransposed=this.inverseTransposed?this.inverseTransposed.copy():null},getMatrix:function(){return this.matrix},getInverse:function(){return null===this.inverse&&(this.inverse=this.matrix.inverted()),this.inverse},getMatrixTransposed:function(){return null===this.matrixTransposed&&(this.matrixTransposed=this.matrix.transposed()),this.matrixTransposed},getInverseTransposed:function(){return null===this.inverseTransposed&&(this.inverseTransposed=this.getInverse().transposed()),this.inverseTransposed},isIdentity:function(){return this.matrix.type===e.Matrix3.Types.IDENTITY},isFinite:function(){return this.matrix.isFinite()},transformPosition2:function(t){return this.matrix.timesVector2(t)},transformDelta2:function(t){var i=this.getMatrix();return new e.Vector2(i.m00()*t.x+i.m01()*t.y,i.m10()*t.x+i.m11()*t.y)},transformNormal2:function(t){return this.getInverse().timesTransposeVector2(t)},transformX:function(t){var e=this.getMatrix();return e.m00()*t+e.m02()},transformY:function(t){var e=this.getMatrix();return e.m11()*t+e.m12()},transformDeltaX:function(t){var e=this.getMatrix();return e.m00()*t},transformDeltaY:function(t){var e=this.getMatrix();return e.m11()*t},transformBounds2:function(t){return t.transformed(this.matrix)},transformShape:function(t){return t.transformed(this.matrix)},transformRay2:function(t){return new e.Ray2(this.transformPosition2(t.pos),this.transformDelta2(t.dir).normalized())},inversePosition2:function(t){return this.getInverse().timesVector2(t)},inverseDelta2:function(t){var i=this.getInverse();return new e.Vector2(i.m00()*t.x+i.m01()*t.y,i.m10()*t.x+i.m11()*t.y)},inverseNormal2:function(t){return this.matrix.timesTransposeVector2(t)},inverseX:function(t){var e=this.getInverse();return e.m00()*t+e.m02()},inverseY:function(t){var e=this.getInverse();return e.m11()*t+e.m12()},inverseDeltaX:function(t){var e=this.getInverse();return e.m00()*t},inverseDeltaY:function(t){var e=this.getInverse();return e.m11()*t},inverseBounds2:function(t){return t.transformed(this.getInverse())},inverseShape:function(t){return t.transformed(this.getInverse())},inverseRay2:function(t){return new e.Ray2(this.inversePosition2(t.pos),this.inverseDelta2(t.dir).normalized())},addTransformListener:function(t){this.listeners.push(t)},prependTransformListener:function(t){this.listeners.unshift(t)},removeTransformListener:function(t){this.listeners.splice(_.indexOf(this.listeners,t),1)}},i}),i("KITE/kite",["require","PHET_CORE/phetAllocation"],function(t){window.phetAllocation=t("PHET_CORE/phetAllocation");var e={svgNumber:function(t){return t.toFixed(20)}};return e}),i("KITE/segments/Segment",["require","KITE/kite","DOT/Util","DOT/Bounds2"],function(t){var e=t("KITE/kite"),i=t("DOT/Util"),n=t("DOT/Bounds2");e.Segment=function(){};var r=e.Segment,s=function(t){return t};return r.prototype={constructor:r,getBoundsWithTransform:function(t){var e=this.transformed(t);return e.getBounds()},subdivisions:function(t){for(var e=this,n=[],r=0;r<t.length;r++){var s=t[r],a=e.subdivided(s);n.push(a[0]),e=a[1];for(var o=r+1;o<t.length;o++)t[o]=i.linear(s,1,0,1,t[o])}return n.push(e),n},subdividedIntoMonotone:function(){return this.subdivisions(this.getInteriorExtremaTs())},toPiecewiseLinearSegments:function(t,e,n,a,o,h){e=void 0===e?t.minLevels:e,n=void 0===n?t.maxLevels:n,a=a||[];var l=t.pointMap||s;o=o||l(this.start),h=h||l(this.end);var u=l(this.positionAt(.5)),c=0===n;if(!c&&0>=e&&(c=(null===t.curveEpsilon||i.distToSegmentSquared(u,o,h)/o.distanceSquared(h)<t.curveEpsilon)&&(null===t.distanceEpsilon||i.distToSegmentSquared(u,o,h)<t.distanceEpsilon)),c)a.push(new r.Line(o,h));else{var d=this.subdivided(.5);d[0].toPiecewiseLinearSegments(t,e-1,n-1,a,o,u),d[1].toPiecewiseLinearSegments(t,e-1,n-1,a,u,h)}return a}},r.closestToPoint=function(t,e,i){var r=i*i,s=[],a=[],o=Number.POSITIVE_INFINITY,h=!1;for(_.each(t,function(t){if(t.explicitClosestToPoint){var i=t.explicitClosestToPoint(e);_.each(i,function(t){t.distanceSquared<o?(a=[t],o=t.distanceSquared):t.distanceSquared===o&&a.push(t)})}else for(var r=[0].concat(t.getInteriorExtremaTs()).concat([1]),h=0;h<r.length-1;h++){var l=r[h],u=r[h+1],c=t.positionAt(l),d=t.positionAt(u),f=n.point(c).addPoint(d),m=f.minimumDistanceToPointSquared(e);if(o>=m){var p=f.maximumDistanceToPointSquared(e);o>p&&(o=p,a=[]),s.push({ta:l,tb:u,pa:c,pb:d,segment:t,bounds:f,min:m,max:p})}}});s.length&&!h;){var l=s;s=[],h=!0,_.each(l,function(t){if(!(t.minDistanceSquared>o)){h&&t.pa.distanceSquared(t.pb)>r&&(h=!1);var i=(t.ta+t.tb)/2,l=t.segment.positionAt(i),u=n.point(t.pa).addPoint(l),c=n.point(t.pb).addPoint(l),d=u.minimumDistanceToPointSquared(e),f=c.minimumDistanceToPointSquared(e);if(o>=d){var m=u.maximumDistanceToPointSquared(e);o>m&&(o=m,a=[]),s.push({ta:t.ta,tb:i,pa:t.pa,pb:l,segment:t.segment,bounds:u,min:d,max:m})}if(o>=f){var p=c.maximumDistanceToPointSquared(e);o>p&&(o=p,a=[]),s.push({ta:i,tb:t.tb,pa:l,pb:t.pb,segment:t.segment,bounds:c,min:f,max:p})}}})}return _.each(s,function(t){var i=(t.ta+t.tb)/2,n=t.segment.positionAt(i);a.push({segment:t.segment,t:i,closestPoint:n,distanceSquared:e.distanceSquared(n)})}),a},r}),i("KITE/segments/Line",["require","PHET_CORE/inherit","DOT/Bounds2","DOT/Vector2","DOT/Util","KITE/kite","KITE/segments/Segment"],function(t){var e=t("PHET_CORE/inherit"),i=t("DOT/Bounds2"),n=t("DOT/Vector2"),r=t("DOT/Util"),s=t("KITE/kite"),a=t("KITE/segments/Segment"),o=new n;return a.Line=function(t,e){this._start=t,this._end=e,this._tangent=void 0,this._bounds=void 0},e(a,a.Line,{getStart:function(){return this._start},get start(){return this._start},getEnd:function(){return this._end},get end(){return this._end},getStartTangent:function(){return void 0===this._tangent&&(this._tangent=this._end.minus(this._start).normalized()),this._tangent},get startTangent(){return this.getStartTangent()},getEndTangent:function(){return this.getStartTangent()},get endTangent(){return this.getEndTangent()},getBounds:function(){return void 0===this._bounds&&(this._bounds=i.NOTHING.copy().addPoint(this._start).addPoint(this._end)),this._bounds},get bounds(){return this.getBounds()},getBoundsWithTransform:function(t){var e=i.NOTHING.copy();return e.addPoint(t.multiplyVector2(o.set(this._start))),e.addPoint(t.multiplyVector2(o.set(this._end))),e},getNondegenerateSegments:function(){return this._start.equals(this._end)?[]:[this]},positionAt:function(t){return this._start.plus(this._end.minus(this._start).times(t))},tangentAt:function(){return this.getStartTangent()},curvatureAt:function(){return 0},getSVGPathFragment:function(){return"L "+s.svgNumber(this._end.x)+" "+s.svgNumber(this._end.y)},strokeLeft:function(t){var e=this.getEndTangent().perpendicular().negated().times(t/2);return[new a.Line(this._start.plus(e),this._end.plus(e))]},strokeRight:function(t){var e=this.getStartTangent().perpendicular().times(t/2);return[new a.Line(this._end.plus(e),this._start.plus(e))]},getInteriorExtremaTs:function(){return[]},subdivided:function(t){var e=this.positionAt(t);return[new a.Line(this._start,e),new a.Line(e,this._end)]},intersectsBounds:function(){throw new Error("Segment.Line.intersectsBounds unimplemented")},intersection:function(t){var e=[],i=this._start,n=this._end,r=n.minus(i);if(0===r.magnitudeSquared())return e;var s=t.dir.y*r.x-t.dir.x*r.y;if(0===s)return e;var a=(t.dir.x*(i.y-t.pos.y)-t.dir.y*(i.x-t.pos.x))/s;if(0>a||a>=1)return e;var o=(r.x*(i.y-t.pos.y)-r.y*(i.x-t.pos.x))/s;if(1e-6>o)return e;var h=r.perpendicular();return e.push({distance:o,point:i.plus(r.times(a)),normal:h.dot(t.dir)>0?h.negated():h,wind:t.dir.perpendicular().dot(r)<0?1:-1,segment:this}),e},windingIntersection:function(t){var e=this.intersection(t);return e.length?e[0].wind:0},writeToContext:function(t){t.lineTo(this._end.x,this._end.y)},transformed:function(t){return new a.Line(t.timesVector2(this._start),t.timesVector2(this._end))},explicitClosestToPoint:function(t){var e=this._end.minus(this._start),i=t.minus(this._start).dot(e)/e.magnitudeSquared();i=r.clamp(i,0,1);var n=this.positionAt(i);return[{segment:this,t:i,closestPoint:n,distanceSquared:t.distanceSquared(n)}]},reparameterized:function(t,e){return new a.Line(this.positionAt(e),this.positionAt(t+e))},polarToCartesian:function(t){return this._start.x===this._end.x?[new a.Line(n.createPolar(this._start.y,this._start.x),n.createPolar(this._end.y,this._end.x))]:this._start.y===this._end.y?[new a.Arc(n.ZERO,this._start.y,this._start.x,this._end.x,this._start.x>this._end.x)]:this.toPiecewiseLinearSegments(t)}}),a.Line}),i("KITE/segments/Arc",["require","PHET_CORE/inherit","DOT/Vector2","DOT/Bounds2","DOT/Util","KITE/kite","KITE/segments/Segment"],function(t){var e=t("PHET_CORE/inherit"),i=t("DOT/Vector2"),n=t("DOT/Bounds2"),r=t("DOT/Util"),s=t("KITE/kite"),a=t("KITE/segments/Segment");return a.Arc=function(t,e,i,n,r){0>e&&(e=-e,i+=Math.PI,n+=Math.PI),this._center=t,this._radius=e,this._startAngle=i,this._endAngle=n,this._anticlockwise=r,this._start=void 0,this._end=void 0,this._startTangent=void 0,this._endTangent=void 0,this._actualEndAngle=void 0,this._isFullPerimeter=void 0,this._angleDifference=void 0},e(a,a.Arc,{getCenter:function(){return this._center},get center(){return this.getCenter()},getRadius:function(){return this._radius},get radius(){return this.getRadius()},getStartAngle:function(){return this._startAngle},get startAngle(){return this.getStartAngle()},getEndAngle:function(){return this._endAngle},get endAngle(){return this.getEndAngle()},getAnticlockwise:function(){return this._anticlockwise},get anticlockwise(){return this.getAnticlockwise()},getStart:function(){return void 0===this._start&&(this._start=this.positionAtAngle(this._startAngle)),this._start},get start(){return this.getStart()},getEnd:function(){return void 0===this._end&&(this._end=this.positionAtAngle(this._endAngle)),this._end},get end(){return this.getEnd()},getStartTangent:function(){return void 0===this._startTangent&&(this._startTangent=this.tangentAtAngle(this._startAngle)),this._startTangent},get startTangent(){return this.getStartTangent()},getEndTangent:function(){return void 0===this._endTangent&&(this._endTangent=this.tangentAtAngle(this._endAngle)),this._endTangent},get endTangent(){return this.getEndTangent()},getActualEndAngle:function(){return void 0===this._actualEndAngle&&(this._actualEndAngle=this._anticlockwise?this._startAngle>this._endAngle?this._endAngle:this._startAngle<this._endAngle?this._endAngle-2*Math.PI:this._startAngle:this._startAngle<this._endAngle?this._endAngle:this._startAngle>this._endAngle?this._endAngle+2*Math.PI:this._startAngle),this._actualEndAngle},get actualEndAngle(){return this.getActualEndAngle()},getIsFullPerimeter:function(){return void 0===this._isFullPerimeter&&(this._isFullPerimeter=!this._anticlockwise&&this._endAngle-this._startAngle>=2*Math.PI||this._anticlockwise&&this._startAngle-this._endAngle>=2*Math.PI),this._isFullPerimeter},get isFullPerimeter(){return this.getIsFullPerimeter()},getAngleDifference:function(){return void 0===this._angleDifference&&(this._angleDifference=this._anticlockwise?this._startAngle-this._endAngle:this._endAngle-this._startAngle,this._angleDifference<0&&(this._angleDifference+=2*Math.PI)),this._angleDifference},get angleDifference(){return this.getAngleDifference()},getBounds:function(){return void 0===this._bounds&&(this._bounds=n.NOTHING.copy().withPoint(this.getStart()).withPoint(this.getEnd()),this._startAngle!==this._endAngle&&(this.includeBoundsAtAngle(0),this.includeBoundsAtAngle(Math.PI/2),this.includeBoundsAtAngle(Math.PI),this.includeBoundsAtAngle(3*Math.PI/2))),this._bounds},get bounds(){return this.getBounds()},getNondegenerateSegments:function(){return this._radius<=0||this._startAngle===this._endAngle?[]:[this]},includeBoundsAtAngle:function(t){this.containsAngle(t)&&(this._bounds=this._bounds.withPoint(this._center.plus(i.createPolar(this._radius,t))))},mapAngle:function(t){return this._startAngle>this.getActualEndAngle()?r.moduloBetweenUp(t,this._startAngle-2*Math.PI,this._startAngle):r.moduloBetweenDown(t,this._startAngle,this._startAngle+2*Math.PI)},tAtAngle:function(t){return(this.mapAngle(t)-this._startAngle)/(this.getActualEndAngle()-this._startAngle)},angleAt:function(t){return this._startAngle+(this.getActualEndAngle()-this._startAngle)*t},positionAt:function(t){return this.positionAtAngle(this.angleAt(t))},tangentAt:function(t){return this.tangentAtAngle(this.angleAt(t))},curvatureAt:function(){return(this._anticlockwise?-1:1)/this._radius},positionAtAngle:function(t){return this._center.plus(i.createPolar(this._radius,t))},tangentAtAngle:function(t){var e=i.createPolar(1,t);return this._anticlockwise?e.perpendicular():e.perpendicular().negated()},containsAngle:function(t){var e=this._anticlockwise?t-this._endAngle:t-this._startAngle,i=r.moduloBetweenDown(e,0,2*Math.PI);return i<=this.angleDifference},getSVGPathFragment:function(){var t,e=.01,n=this._anticlockwise?"0":"1";if(this.angleDifference<2*Math.PI-e)return t=this.angleDifference<Math.PI?"0":"1","A "+s.svgNumber(this._radius)+" "+s.svgNumber(this._radius)+" 0 "+t+" "+n+" "+s.svgNumber(this.end.x)+" "+s.svgNumber(this.end.y);var r=(this._startAngle+this._endAngle)/2,a=this._center.plus(i.createPolar(this._radius,r));t="0";var o="A "+s.svgNumber(this._radius)+" "+s.svgNumber(this._radius)+" 0 "+t+" "+n+" "+s.svgNumber(a.x)+" "+s.svgNumber(a.y),h="A "+s.svgNumber(this._radius)+" "+s.svgNumber(this._radius)+" 0 "+t+" "+n+" "+s.svgNumber(this.end.x)+" "+s.svgNumber(this.end.y);return o+" "+h},strokeLeft:function(t){return[new a.Arc(this._center,this._radius+(this._anticlockwise?1:-1)*t/2,this._startAngle,this._endAngle,this._anticlockwise)]},strokeRight:function(t){return[new a.Arc(this._center,this._radius+(this._anticlockwise?-1:1)*t/2,this._endAngle,this._startAngle,!this._anticlockwise)]},getInteriorExtremaTs:function(){var t=this,e=[];return _.each([0,Math.PI/2,Math.PI,3*Math.PI/2],function(i){if(t.containsAngle(i)){var n=t.tAtAngle(i),r=1e-10;n>r&&1-r>n&&e.push(n)}}),e.sort()},subdivided:function(t){var e=this.angleAt(0),i=this.angleAt(t),n=this.angleAt(1);return[new a.Arc(this._center,this._radius,e,i,this._anticlockwise),new a.Arc(this._center,this._radius,i,n,this._anticlockwise)]},intersectsBounds:function(){throw new Error("Segment.intersectsBounds unimplemented!")},intersection:function(t){var e=[],i=0,n=t.pos.minus(this._center),r=t.dir.dot(n),s=n.magnitudeSquared(),a=4*r*r-4*(s-this._radius*this._radius);if(i>a)return e;var o=t.dir.dot(this._center)-t.dir.dot(t.pos),h=Math.sqrt(a)/2,l=o-h,u=o+h;if(i>u)return e;var c=t.pointAtDistance(u),d=c.minus(this._center).normalized();if(i>l)this.containsAngle(d.angle())&&e.push({distance:u,point:c,normal:d.negated(),wind:this._anticlockwise?-1:1});else{var f=t.pointAtDistance(l),m=f.minus(this._center).normalized();this.containsAngle(m.angle())&&e.push({distance:l,point:f,normal:m,wind:this._anticlockwise?1:-1}),this.containsAngle(d.angle())&&e.push({distance:u,point:c,normal:d.negated(),wind:this._anticlockwise?-1:1})}return e},windingIntersection:function(t){var e=0,i=this.intersection(t);return _.each(i,function(t){e+=t.wind}),e},writeToContext:function(t){t.arc(this._center.x,this._center.y,this._radius,this._startAngle,this._endAngle,this._anticlockwise)},transformed:function(t){var e=t.timesVector2(i.createPolar(1,this._startAngle)).minus(t.timesVector2(i.ZERO)).angle(),n=t.timesVector2(i.createPolar(1,this._endAngle)).minus(t.timesVector2(i.ZERO)).angle(),r=t.getDeterminant()>=0?this._anticlockwise:!this._anticlockwise;Math.abs(this._endAngle-this._startAngle)===2*Math.PI&&(n=r?e-2*Math.PI:e+2*Math.PI);var s=t.getScaleVector();if(s.x!==s.y){var o=s.x*this._radius,h=s.y*this._radius;return new a.EllipticalArc(t.timesVector2(this._center),o,h,0,e,n,r)}var l=s.x*this._radius;return new a.Arc(t.timesVector2(this._center),l,e,n,r)}}),a.Arc}),i("KITE/util/Subpath",["require","DOT/Bounds2","KITE/kite","KITE/segments/Line","KITE/segments/Arc"],function(t){var e=t("DOT/Bounds2"),i=t("KITE/kite");t("KITE/segments/Line"),t("KITE/segments/Arc"),i.Subpath=function(t,i,n){this.segments=t||[],this.points=i||(t&&t.length?_.map(t,function(t){return t.start}).concat(t[t.length-1].end):[]),this.closed=!!n,this._strokedSubpaths=null,this._strokedSubpathsComputed=!1,this._strokedStyles=null;var r=this.bounds=e.NOTHING.copy();_.each(this.segments,function(t){r.includeBounds(t.bounds)})};var n=i.Subpath;return n.prototype={copy:function(){return new n(this.segments.slice(0),this.points.slice(0),this.closed)},invalidate:function(){this._strokedSubpathsComputed=!1},addPoint:function(t){return this.points.push(t),this},addSegmentDirectly:function(t){return this.segments.push(t),this.invalidate(),this.bounds.includeBounds(t.getBounds()),this},addSegment:function(t){var e=this;return _.each(t.getNondegenerateSegments(),function(t){e.addSegmentDirectly(t)}),this},addClosingSegment:function(){if(this.hasClosingSegment()){var t=this.getClosingSegment();this.addSegmentDirectly(t),this.addPoint(this.getFirstPoint()),this.closed=!0}},close:function(){this.closed=!0},getLength:function(){return this.points.length},getFirstPoint:function(){return _.first(this.points)},getLastPoint:function(){return _.last(this.points)},getFirstSegment:function(){return _.first(this.segments)},getLastSegment:function(){return _.last(this.segments)},isDrawable:function(){return this.segments.length>0},isClosed:function(){return this.closed},hasClosingSegment:function(){return!this.getFirstPoint().equalsEpsilon(this.getLastPoint(),1e-9)},getClosingSegment:function(){return new i.Segment.Line(this.getLastPoint(),this.getFirstPoint())},writeToContext:function(t){if(this.isDrawable()){var e=this.getFirstSegment().start;t.moveTo(e.x,e.y);for(var i=this.segments.length,n=0;i>n;n++)this.segments[n].writeToContext(t);this.closed&&t.closePath()}},toPiecewiseLinear:function(t){return new n(_.flatten(_.map(this.segments,function(e){return e.toPiecewiseLinearSegments(t)})),null,this.closed)},transformed:function(t){return new n(_.map(this.segments,function(e){return e.transformed(t)}),_.map(this.points,function(e){return t.timesVector2(e)}),this.closed)},nonlinearTransformed:function(t){return this.closed&&this.hasClosingSegment()&&this.addClosingSegment(),new n(_.flatten(_.map(this.segments,function(e){return t.methodName&&e[t.methodName]?e[t.methodName](t):e.toPiecewiseLinearSegments(t)})),null,this.closed)},getBoundsWithTransform:function(t){for(var i=e.NOTHING.copy(),n=this.segments.length,r=0;n>r;r++)i.includeBounds(this.segments[r].getBoundsWithTransform(t));return i},offset:function(t){if(!this.isDrawable())return new n([],null,this.closed);if(0===t)return new n(this.segments.slice(),null,this.closed);var e,r=this.segments.slice();this.closed&&this.hasClosingSegment()&&r.push(this.getClosingSegment());var s=[];for(e=0;e<r.length;e++)s.push(r[e].strokeLeft(2*t));var a=[];for(e=0;e<r.length;e++){if(this.closed||e>0){var o=(e>0?e:r.length)-1,h=r[e].start,l=r[o].endTangent,u=r[e].startTangent,c=l.perpendicular().negated().times(t).angle(),d=u.perpendicular().negated().times(t).angle(),f=l.perpendicular().dot(u)>0;a.push(new i.Segment.Arc(h,Math.abs(t),c,d,f))}a=a.concat(s[e])}return new n(a,null,this.closed)},stroked:function(t){function e(t){o=o.concat(t)}function r(t){h=h.concat(t)}if(!this.isDrawable())return[];if(void 0===t&&(t=new i.LineStyles),this._strokedSubpathsComputed&&this._strokedStyles.equals(t))return this._strokedSubpaths;var s,a=t.lineWidth,o=[],h=[],l=this.getFirstSegment(),u=this.getLastSegment(),c=u.end.equals(l.start),d=c?null:new i.Segment.Line(this.segments[this.segments.length-1].end,this.segments[0].start);for(s=0;s<this.segments.length;s++)s>0&&e(t.leftJoin(this.segments[s].start,this.segments[s-1].endTangent,this.segments[s].startTangent)),e(this.segments[s].strokeLeft(a));for(s=this.segments.length-1;s>=0;s--)s<this.segments.length-1&&r(t.rightJoin(this.segments[s].end,this.segments[s].endTangent,this.segments[s+1].startTangent)),r(this.segments[s].strokeRight(a));var f;return this.closed?(c?(e(t.leftJoin(u.end,u.endTangent,l.startTangent)),r(t.rightJoin(u.end,u.endTangent,l.startTangent))):(e(t.leftJoin(d.start,u.endTangent,d.startTangent)),e(d.strokeLeft(a)),e(t.leftJoin(d.end,d.endTangent,l.startTangent)),r(t.rightJoin(d.end,d.endTangent,l.startTangent)),r(d.strokeRight(a)),r(t.rightJoin(d.start,u.endTangent,d.startTangent))),f=[new n(o,null,!0),new n(h,null,!0)]):f=[new n(o.concat(t.cap(u.end,u.endTangent)).concat(h).concat(t.cap(l.start,l.startTangent.negated())),null,!0)],this._strokedSubpaths=f,this._strokedSubpathsComputed=!0,this._strokedStyles=new i.LineStyles(t),f}},i.Subpath}),i("KITE/parser/svgPath",["require","KITE/kite"],function(t){function e(t){return'"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var i=t("KITE/kite");i.svgPath={parse:function(t,i){function n(t){Q>Z||(Z>Q&&(Q=Z,J=[]),J.push(t))}function r(){var t,e,i,n,r,a;for(r=Z,a=Z,t=[],e=z();null!==e;)t.push(e),e=z();if(null!==t)if(e=s(),e=null!==e?e:"",null!==e){for(i=[],n=z();null!==n;)i.push(n),n=z();null!==i?t=[t,e,i]:(t=null,Z=a)}else t=null,Z=a;else t=null,Z=a;return null!==t&&(t=function(t,e){return e?e:[]}(r,t[1])),null===t&&(Z=r),t}function s(){var t,e,i,n,r;if(n=Z,r=Z,t=a(),null!==t){for(e=[],i=z();null!==i;)e.push(i),i=z();null!==e?(i=s(),null!==i?t=[t,e,i]:(t=null,Z=r)):(t=null,Z=r)}else t=null,Z=r;return null!==t&&(t=function(t,e,i){return e.concat(i)}(n,t[0],t[2])),null===t&&(Z=n),null===t&&(n=Z,t=a(),null!==t&&(t=function(t,e){return e}(n,t)),null===t&&(Z=n)),t}function a(){var t,e,i,n,r;if(n=Z,r=Z,t=l(),null!==t){for(e=[],i=z();null!==i;)e.push(i),i=z();null!==e?(i=o(),i=null!==i?i:"",null!==i?t=[t,e,i]:(t=null,Z=r)):(t=null,Z=r)}else t=null,Z=r;return null!==t&&(t=function(t,e,i){return i.length?e.concat(i):e}(n,t[0],t[2])),null===t&&(Z=n),t}function o(){var t,e,i,n,r;if(n=Z,r=Z,t=h(),null!==t){for(e=[],i=z();null!==i;)e.push(i),i=z();null!==e?(i=o(),null!==i?t=[t,e,i]:(t=null,Z=r)):(t=null,Z=r)}else t=null,Z=r;return null!==t&&(t=function(t,e,i){return e.concat(i)}(n,t[0],t[2])),null===t&&(Z=n),null===t&&(n=Z,t=h(),null!==t&&(t=function(t,e){return e}(n,t)),null===t&&(Z=n)),t}function h(){var t;return t=c(),null===t&&(t=d(),null===t&&(t=m(),null===t&&(t=g(),null===t&&(t=b(),null===t&&(t=x(),null===t&&(t=C(),null===t&&(t=D(),null===t&&(t=P())))))))),t}function l(){var e,i,r,s,a;if(s=Z,a=Z,77===t.charCodeAt(Z)?(e="M",Z++):(e=null,0===K&&n('"M"')),null!==e){for(i=[],r=z();null!==r;)i.push(r),r=z();null!==i?(r=u(),null!==r?e=[e,i,r]:(e=null,Z=a)):(e=null,Z=a)}else e=null,Z=a;if(null!==e&&(e=function(t,e){return q(e,!1)}(s,e[2])),null===e&&(Z=s),null===e){if(s=Z,a=Z,109===t.charCodeAt(Z)?(e="m",Z++):(e=null,0===K&&n('"m"')),null!==e){for(i=[],r=z();null!==r;)i.push(r),r=z();null!==i?(r=u(),null!==r?e=[e,i,r]:(e=null,Z=a)):(e=null,Z=a)}else e=null,Z=a;null!==e&&(e=function(t,e){return q(e,!0)}(s,e[2])),null===e&&(Z=s)}return e}function u(){var t,e,i,n,r;return n=Z,r=Z,t=k(),null!==t?(e=I(),e=null!==e?e:"",null!==e?(i=f(),null!==i?t=[t,e,i]:(t=null,Z=r)):(t=null,Z=r)):(t=null,Z=r),null!==t&&(t=function(t,e,i){return[e].concat(i)}(n,t[0],t[2])),null===t&&(Z=n),null===t&&(n=Z,t=k(),null!==t&&(t=function(t,e){return[e]}(n,t)),null===t&&(Z=n)),t}function c(){var e,i;return i=Z,90===t.charCodeAt(Z)?(e="Z",Z++):(e=null,0===K&&n('"Z"')),null===e&&(122===t.charCodeAt(Z)?(e="z",Z++):(e=null,0===K&&n('"z"'))),null!==e&&(e=function(){return{cmd:"close"}}(i,e)),null===e&&(Z=i),e}function d(){var e,i,r,s,a;if(s=Z,a=Z,76===t.charCodeAt(Z)?(e="L",Z++):(e=null,0===K&&n('"L"')),null!==e){for(i=[],r=z();null!==r;)i.push(r),r=z();null!==i?(r=f(),null!==r?e=[e,i,r]:(e=null,Z=a)):(e=null,Z=a)}else e=null,Z=a;if(null!==e&&(e=function(t,e){return e.map(function(t){return{cmd:"lineTo",args:[t.x,t.y]}})}(s,e[2])),null===e&&(Z=s),null===e){if(s=Z,a=Z,108===t.charCodeAt(Z)?(e="l",Z++):(e=null,0===K&&n('"l"')),null!==e){for(i=[],r=z();null!==r;)i.push(r),r=z();null!==i?(r=f(),null!==r?e=[e,i,r]:(e=null,Z=a)):(e=null,Z=a)}else e=null,Z=a;null!==e&&(e=function(t,e){return e.map(function(t){return{cmd:"lineToRelative",args:[t.x,t.y]}})}(s,e[2])),null===e&&(Z=s)}return e}function f(){var t,e,i,n,r;return n=Z,r=Z,t=k(),null!==t?(e=I(),e=null!==e?e:"",null!==e?(i=f(),null!==i?t=[t,e,i]:(t=null,Z=r)):(t=null,Z=r)):(t=null,Z=r),null!==t&&(t=function(t,e,i){return[e].concat(i)}(n,t[0],t[2])),null===t&&(Z=n),null===t&&(n=Z,t=k(),null!==t&&(t=function(t,e){return[e]}(n,t)),null===t&&(Z=n)),t}function m(){var e,i,r,s,a;if(s=Z,a=Z,72===t.charCodeAt(Z)?(e="H",Z++):(e=null,0===K&&n('"H"')),null!==e){for(i=[],r=z();null!==r;)i.push(r),r=z();null!==i?(r=p(),null!==r?e=[e,i,r]:(e=null,Z=a)):(e=null,Z=a)
}else e=null,Z=a;if(null!==e&&(e=function(t,e){return e.map(function(t){return{cmd:"horizontalLineTo",args:[t]}})}(s,e[2])),null===e&&(Z=s),null===e){if(s=Z,a=Z,104===t.charCodeAt(Z)?(e="h",Z++):(e=null,0===K&&n('"h"')),null!==e){for(i=[],r=z();null!==r;)i.push(r),r=z();null!==i?(r=p(),null!==r?e=[e,i,r]:(e=null,Z=a)):(e=null,Z=a)}else e=null,Z=a;null!==e&&(e=function(t,e){return e.map(function(t){return{cmd:"horizontalLineToRelative",args:[t]}})}(s,e[2])),null===e&&(Z=s)}return e}function p(){var t,e,i,n,r;return n=Z,r=Z,t=Y(),null!==t?(e=I(),e=null!==e?e:"",null!==e?(i=p(),null!==i?t=[t,e,i]:(t=null,Z=r)):(t=null,Z=r)):(t=null,Z=r),null!==t&&(t=function(t,e,i){return[e].concat(i)}(n,t[0],t[2])),null===t&&(Z=n),null===t&&(n=Z,t=Y(),null!==t&&(t=function(t,e){return[e]}(n,t)),null===t&&(Z=n)),t}function g(){var e,i,r,s,a;if(s=Z,a=Z,86===t.charCodeAt(Z)?(e="V",Z++):(e=null,0===K&&n('"V"')),null!==e){for(i=[],r=z();null!==r;)i.push(r),r=z();null!==i?(r=v(),null!==r?e=[e,i,r]:(e=null,Z=a)):(e=null,Z=a)}else e=null,Z=a;if(null!==e&&(e=function(t,e){return e.map(function(t){return{cmd:"verticalLineTo",args:[t]}})}(s,e[2])),null===e&&(Z=s),null===e){if(s=Z,a=Z,118===t.charCodeAt(Z)?(e="v",Z++):(e=null,0===K&&n('"v"')),null!==e){for(i=[],r=z();null!==r;)i.push(r),r=z();null!==i?(r=v(),null!==r?e=[e,i,r]:(e=null,Z=a)):(e=null,Z=a)}else e=null,Z=a;null!==e&&(e=function(t,e){return e.map(function(t){return{cmd:"verticalLineToRelative",args:[t]}})}(s,e[2])),null===e&&(Z=s)}return e}function v(){var t,e,i,n,r;return n=Z,r=Z,t=Y(),null!==t?(e=I(),e=null!==e?e:"",null!==e?(i=v(),null!==i?t=[t,e,i]:(t=null,Z=r)):(t=null,Z=r)):(t=null,Z=r),null!==t&&(t=function(t,e,i){return[e].concat(i)}(n,t[0],t[2])),null===t&&(Z=n),null===t&&(n=Z,t=Y(),null!==t&&(t=function(t,e){return[e]}(n,t)),null===t&&(Z=n)),t}function b(){var e,i,r,s,a;if(s=Z,a=Z,67===t.charCodeAt(Z)?(e="C",Z++):(e=null,0===K&&n('"C"')),null!==e){for(i=[],r=z();null!==r;)i.push(r),r=z();null!==i?(r=y(),null!==r?e=[e,i,r]:(e=null,Z=a)):(e=null,Z=a)}else e=null,Z=a;if(null!==e&&(e=function(t,e){return e.map(function(t){return{cmd:"cubicCurveTo",args:t}})}(s,e[2])),null===e&&(Z=s),null===e){if(s=Z,a=Z,99===t.charCodeAt(Z)?(e="c",Z++):(e=null,0===K&&n('"c"')),null!==e){for(i=[],r=z();null!==r;)i.push(r),r=z();null!==i?(r=y(),null!==r?e=[e,i,r]:(e=null,Z=a)):(e=null,Z=a)}else e=null,Z=a;null!==e&&(e=function(t,e){return e.map(function(t){return{cmd:"cubicCurveToRelative",args:t}})}(s,e[2])),null===e&&(Z=s)}return e}function y(){var t,e,i,n,r;return n=Z,r=Z,t=E(),null!==t?(e=I(),e=null!==e?e:"",null!==e?(i=y(),null!==i?t=[t,e,i]:(t=null,Z=r)):(t=null,Z=r)):(t=null,Z=r),null!==t&&(t=function(t,e,i){return[e].concat(i)}(n,t[0],t[2])),null===t&&(Z=n),null===t&&(n=Z,t=E(),null!==t&&(t=function(t,e){return[e]}(n,t)),null===t&&(Z=n)),t}function E(){var t,e,i,n,r,s,a;return s=Z,a=Z,t=k(),null!==t?(e=I(),e=null!==e?e:"",null!==e?(i=k(),null!==i?(n=I(),n=null!==n?n:"",null!==n?(r=k(),null!==r?t=[t,e,i,n,r]:(t=null,Z=a)):(t=null,Z=a)):(t=null,Z=a)):(t=null,Z=a)):(t=null,Z=a),null!==t&&(t=function(t,e,i,n){return[e.x,e.y,i.x,i.y,n.x,n.y]}(s,t[0],t[2],t[4])),null===t&&(Z=s),t}function x(){var e,i,r,s,a;if(s=Z,a=Z,83===t.charCodeAt(Z)?(e="S",Z++):(e=null,0===K&&n('"S"')),null!==e){for(i=[],r=z();null!==r;)i.push(r),r=z();null!==i?(r=_(),null!==r?e=[e,i,r]:(e=null,Z=a)):(e=null,Z=a)}else e=null,Z=a;if(null!==e&&(e=function(t,e){return e.map(function(t){return{cmd:"smoothCubicCurveTo",args:t}})}(s,e[2])),null===e&&(Z=s),null===e){if(s=Z,a=Z,115===t.charCodeAt(Z)?(e="s",Z++):(e=null,0===K&&n('"s"')),null!==e){for(i=[],r=z();null!==r;)i.push(r),r=z();null!==i?(r=_(),null!==r?e=[e,i,r]:(e=null,Z=a)):(e=null,Z=a)}else e=null,Z=a;null!==e&&(e=function(t,e){return e.map(function(t){return{cmd:"smoothCubicCurveToRelative",args:t}})}(s,e[2])),null===e&&(Z=s)}return e}function _(){var t,e,i,n,r;return n=Z,r=Z,t=S(),null!==t?(e=I(),e=null!==e?e:"",null!==e?(i=_(),null!==i?t=[t,e,i]:(t=null,Z=r)):(t=null,Z=r)):(t=null,Z=r),null!==t&&(t=function(t,e,i){return[e].concat(i)}(n,t[0],t[2])),null===t&&(Z=n),null===t&&(n=Z,t=S(),null!==t&&(t=function(t,e){return[e]}(n,t)),null===t&&(Z=n)),t}function S(){var t,e,i,n,r;return n=Z,r=Z,t=k(),null!==t?(e=I(),e=null!==e?e:"",null!==e?(i=k(),null!==i?t=[t,e,i]:(t=null,Z=r)):(t=null,Z=r)):(t=null,Z=r),null!==t&&(t=function(t,e,i){return[e.x,e.y,i.x,i.y]}(n,t[0],t[2])),null===t&&(Z=n),t}function C(){var e,i,r,s,a;if(s=Z,a=Z,81===t.charCodeAt(Z)?(e="Q",Z++):(e=null,0===K&&n('"Q"')),null!==e){for(i=[],r=z();null!==r;)i.push(r),r=z();null!==i?(r=w(),null!==r?e=[e,i,r]:(e=null,Z=a)):(e=null,Z=a)}else e=null,Z=a;if(null!==e&&(e=function(t,e){return e.map(function(t){return{cmd:"quadraticCurveTo",args:t}})}(s,e[2])),null===e&&(Z=s),null===e){if(s=Z,a=Z,113===t.charCodeAt(Z)?(e="q",Z++):(e=null,0===K&&n('"q"')),null!==e){for(i=[],r=z();null!==r;)i.push(r),r=z();null!==i?(r=w(),null!==r?e=[e,i,r]:(e=null,Z=a)):(e=null,Z=a)}else e=null,Z=a;null!==e&&(e=function(t,e){return e.map(function(t){return{cmd:"quadraticCurveToRelative",args:t}})}(s,e[2])),null===e&&(Z=s)}return e}function w(){var t,e,i,n,r;return n=Z,r=Z,t=T(),null!==t?(e=I(),e=null!==e?e:"",null!==e?(i=w(),null!==i?t=[t,e,i]:(t=null,Z=r)):(t=null,Z=r)):(t=null,Z=r),null!==t&&(t=function(t,e,i){return[e].concat(i)}(n,t[0],t[2])),null===t&&(Z=n),null===t&&(n=Z,t=T(),null!==t&&(t=function(t,e){return[e]}(n,t)),null===t&&(Z=n)),t}function T(){var t,e,i,n,r;return n=Z,r=Z,t=k(),null!==t?(e=I(),e=null!==e?e:"",null!==e?(i=k(),null!==i?t=[t,e,i]:(t=null,Z=r)):(t=null,Z=r)):(t=null,Z=r),null!==t&&(t=function(t,e,i){return[e.x,e.y,i.x,i.y]}(n,t[0],t[2])),null===t&&(Z=n),t}function D(){var e,i,r,s,a;if(s=Z,a=Z,84===t.charCodeAt(Z)?(e="T",Z++):(e=null,0===K&&n('"T"')),null!==e){for(i=[],r=z();null!==r;)i.push(r),r=z();null!==i?(r=R(),null!==r?e=[e,i,r]:(e=null,Z=a)):(e=null,Z=a)}else e=null,Z=a;if(null!==e&&(e=function(t,e){return e.map(function(t){return{cmd:"smoothQuadraticCurveTo",args:[t.x,t.y]}})}(s,e[2])),null===e&&(Z=s),null===e){if(s=Z,a=Z,116===t.charCodeAt(Z)?(e="t",Z++):(e=null,0===K&&n('"t"')),null!==e){for(i=[],r=z();null!==r;)i.push(r),r=z();null!==i?(r=R(),null!==r?e=[e,i,r]:(e=null,Z=a)):(e=null,Z=a)}else e=null,Z=a;null!==e&&(e=function(t,e){return e.map(function(t){return{cmd:"smoothQuadraticCurveToRelative",args:[t.x,t.y]}})}(s,e[2])),null===e&&(Z=s)}return e}function R(){var t,e,i,n,r;return n=Z,r=Z,t=k(),null!==t?(e=I(),e=null!==e?e:"",null!==e?(i=R(),null!==i?t=[t,e,i]:(t=null,Z=r)):(t=null,Z=r)):(t=null,Z=r),null!==t&&(t=function(t,e,i){return[e].concat(i)}(n,t[0],t[2])),null===t&&(Z=n),null===t&&(n=Z,t=k(),null!==t&&(t=function(t,e){return[e]}(n,t)),null===t&&(Z=n)),t}function P(){var e,i,r,s,a;if(s=Z,a=Z,65===t.charCodeAt(Z)?(e="A",Z++):(e=null,0===K&&n('"A"')),null!==e){for(i=[],r=z();null!==r;)i.push(r),r=z();null!==i?(r=A(),null!==r?e=[e,i,r]:(e=null,Z=a)):(e=null,Z=a)}else e=null,Z=a;if(null!==e&&(e=function(t,e){return e.map(function(t){return{cmd:"ellipticalArcTo",args:t}})}(s,e[2])),null===e&&(Z=s),null===e){if(s=Z,a=Z,97===t.charCodeAt(Z)?(e="a",Z++):(e=null,0===K&&n('"a"')),null!==e){for(i=[],r=z();null!==r;)i.push(r),r=z();null!==i?(r=A(),null!==r?e=[e,i,r]:(e=null,Z=a)):(e=null,Z=a)}else e=null,Z=a;null!==e&&(e=function(t,e){return e.map(function(t){return{cmd:"ellipticalArcToRelative",args:t}})}(s,e[2])),null===e&&(Z=s)}return e}function A(){var t,e,i,n,r;return n=Z,r=Z,t=O(),null!==t?(e=I(),e=null!==e?e:"",null!==e?(i=A(),null!==i?t=[t,e,i]:(t=null,Z=r)):(t=null,Z=r)):(t=null,Z=r),null!==t&&(t=function(t,e,i){return[e].concat(i)}(n,t[0],t[2])),null===t&&(Z=n),null===t&&(n=Z,t=O(),null!==t&&(t=function(t,e){return[e]}(n,t)),null===t&&(Z=n)),t}function O(){var t,e,i,n,r,s,a,o,h,l,u,c,d;return c=Z,d=Z,t=N(),null!==t?(e=I(),e=null!==e?e:"",null!==e?(i=N(),null!==i?(n=I(),n=null!==n?n:"",null!==n?(r=Y(),null!==r?(s=I(),null!==s?(a=M(),null!==a?(o=I(),o=null!==o?o:"",null!==o?(h=M(),null!==h?(l=I(),l=null!==l?l:"",null!==l?(u=k(),null!==u?t=[t,e,i,n,r,s,a,o,h,l,u]:(t=null,Z=d)):(t=null,Z=d)):(t=null,Z=d)):(t=null,Z=d)):(t=null,Z=d)):(t=null,Z=d)):(t=null,Z=d)):(t=null,Z=d)):(t=null,Z=d)):(t=null,Z=d)):(t=null,Z=d),null!==t&&(t=function(t,e,i,n,r,s,a){return[e,i,n,r,s,a.x,a.y]}(c,t[0],t[2],t[4],t[6],t[8],t[10])),null===t&&(Z=c),t}function k(){var t,e,i,n,r;return n=Z,r=Z,t=Y(),null!==t?(e=I(),e=null!==e?e:"",null!==e?(i=Y(),null!==i?t=[t,e,i]:(t=null,Z=r)):(t=null,Z=r)):(t=null,Z=r),null!==t&&(t=function(t,e,i){return{x:e,y:i}}(n,t[0],t[2])),null===t&&(Z=n),t}function N(){var t,e;return e=Z,t=L(),null!==t&&(t=function(t,e){return parseFloat(e,10)}(e,t)),null===t&&(Z=e),null===t&&(e=Z,t=V(),null!==t&&(t=function(t,e){return parseInt(e,10)}(e,t)),null===t&&(Z=e)),t}function Y(){var t,e,i,n;return i=Z,n=Z,t=X(),t=null!==t?t:"",null!==t?(e=L(),null!==e?t=[t,e]:(t=null,Z=n)):(t=null,Z=n),null!==t&&(t=function(t,e,i){return parseFloat(e+i,10)}(i,t[0],t[1])),null===t&&(Z=i),null===t&&(i=Z,n=Z,t=X(),t=null!==t?t:"",null!==t?(e=V(),null!==e?t=[t,e]:(t=null,Z=n)):(t=null,Z=n),null!==t&&(t=function(t,e,i){return parseInt(e+i,10)}(i,t[0],t[1])),null===t&&(Z=i)),t}function M(){var e,i;return i=Z,48===t.charCodeAt(Z)?(e="0",Z++):(e=null,0===K&&n('"0"')),null!==e&&(e=function(){return!1}(i)),null===e&&(Z=i),null===e&&(i=Z,49===t.charCodeAt(Z)?(e="1",Z++):(e=null,0===K&&n('"1"')),null!==e&&(e=function(){return!0}(i)),null===e&&(Z=i)),e}function I(){var t,e,i,n,r;if(r=Z,e=z(),null!==e)for(t=[];null!==e;)t.push(e),e=z();else t=null;if(null!==t)if(e=B(),e=null!==e?e:"",null!==e){for(i=[],n=z();null!==n;)i.push(n),n=z();null!==i?t=[t,e,i]:(t=null,Z=r)}else t=null,Z=r;else t=null,Z=r;if(null===t)if(r=Z,t=B(),null!==t){for(e=[],i=z();null!==i;)e.push(i),i=z();null!==e?t=[t,e]:(t=null,Z=r)}else t=null,Z=r;return t}function B(){var e;return 44===t.charCodeAt(Z)?(e=",",Z++):(e=null,0===K&&n('","')),e}function L(){var t,e,i,n;return i=Z,n=Z,t=F(),null!==t?(e=j(),e=null!==e?e:"",null!==e?t=[t,e]:(t=null,Z=n)):(t=null,Z=n),null!==t&&(t=function(t,e,i){return e+i}(i,t[0],t[1])),null===t&&(Z=i),null===t&&(i=Z,n=Z,t=V(),null!==t?(e=j(),null!==e?t=[t,e]:(t=null,Z=n)):(t=null,Z=n),null!==t&&(t=function(t,e,i){return e+i}(i,t[0],t[1])),null===t&&(Z=i)),t}function F(){var e,i,r,s,a;return s=Z,a=Z,e=V(),e=null!==e?e:"",null!==e?(46===t.charCodeAt(Z)?(i=".",Z++):(i=null,0===K&&n('"."')),null!==i?(r=V(),null!==r?e=[e,i,r]:(e=null,Z=a)):(e=null,Z=a)):(e=null,Z=a),null!==e&&(e=function(t,e,i){return e+"."+i}(s,e[0],e[2])),null===e&&(Z=s),null===e&&(s=Z,a=Z,e=V(),null!==e?(46===t.charCodeAt(Z)?(i=".",Z++):(i=null,0===K&&n('"."')),null!==i?e=[e,i]:(e=null,Z=a)):(e=null,Z=a),null!==e&&(e=function(t,e){return e}(s,e[0])),null===e&&(Z=s)),e}function j(){var e,i,r,s,a;return s=Z,a=Z,101===t.charCodeAt(Z)?(e="e",Z++):(e=null,0===K&&n('"e"')),null===e&&(69===t.charCodeAt(Z)?(e="E",Z++):(e=null,0===K&&n('"E"'))),null!==e?(i=X(),i=null!==i?i:"",null!==i?(r=V(),null!==r?e=[e,i,r]:(e=null,Z=a)):(e=null,Z=a)):(e=null,Z=a),null!==e&&(e=function(t,e,i,n){return e+i+n}(s,e[0],e[1],e[2])),null===e&&(Z=s),e}function X(){var e;return 43===t.charCodeAt(Z)?(e="+",Z++):(e=null,0===K&&n('"+"')),null===e&&(45===t.charCodeAt(Z)?(e="-",Z++):(e=null,0===K&&n('"-"'))),e}function V(){var t,e,i,n;return i=Z,n=Z,t=H(),null!==t?(e=V(),null!==e?t=[t,e]:(t=null,Z=n)):(t=null,Z=n),null!==t&&(t=function(t,e,i){return e+i}(i,t[0],t[1])),null===t&&(Z=i),null===t&&(t=H()),t}function H(){var e;return/^[0-9]/.test(t.charAt(Z))?(e=t.charAt(Z),Z++):(e=null,0===K&&n("[0-9]")),e}function z(){var e;return 32===t.charCodeAt(Z)?(e=" ",Z++):(e=null,0===K&&n('" "')),null===e&&(9===t.charCodeAt(Z)?(e="	",Z++):(e=null,0===K&&n('"\\t"')),null===e&&(13===t.charCodeAt(Z)?(e="\r",Z++):(e=null,0===K&&n('"\\r"')),null===e&&(10===t.charCodeAt(Z)?(e="\n",Z++):(e=null,0===K&&n('"\\n"'))))),e}function G(t){t.sort();for(var e=null,i=[],n=0;n<t.length;n++)t[n]!==e&&(i.push(t[n]),e=t[n]);return i}function W(){for(var e=1,i=1,n=!1,r=0;r<Math.max(Z,Q);r++){var s=t.charAt(r);"\n"===s?(n||e++,i=1,n=!1):"\r"===s||"\u2028"===s||"\u2029"===s?(e++,i=1,n=!0):(i++,n=!1)}return{line:e,column:i}}function q(t,e){var i=[{cmd:e?"moveToRelative":"moveTo",args:[t[0].x,t[0].y]}];if(t.length>1)for(var n=1;n<t.length;n++)i.push({cmd:e?"lineToRelative":"lineTo",args:[t[n].x,t[n].y]});return i}var U={svgPath:r,movetoDrawtoCommandGroups:s,movetoDrawtoCommandGroup:a,drawtoCommands:o,drawtoCommand:h,moveto:l,movetoArgumentSequence:u,closepath:c,lineto:d,linetoArgumentSequence:f,horizontalLineto:m,horizontalLinetoArgumentSequence:p,verticalLineto:g,verticalLinetoArgumentSequence:v,curveto:b,curvetoArgumentSequence:y,curvetoArgument:E,smoothCurveto:x,smoothCurvetoArgumentSequence:_,smoothCurvetoArgument:S,quadraticBezierCurveto:C,quadraticBezierCurvetoArgumentSequence:w,quadraticBezierCurvetoArgument:T,smoothQuadraticBezierCurveto:D,smoothQuadraticBezierCurvetoArgumentSequence:R,ellipticalArc:P,ellipticalArcArgumentSequence:A,ellipticalArcArgument:O,coordinatePair:k,nonnegativeNumber:N,number:Y,flag:M,commaWsp:I,comma:B,floatingPointConstant:L,fractionalConstant:F,exponent:j,sign:X,digitSequence:V,digit:H,wsp:z};if(void 0!==i){if(void 0===U[i])throw new Error("Invalid rule name: "+e(i)+".")}else i="svgPath";var Z=0,K=0,Q=0,J=[],$=U[i]();if(null===$||Z!==t.length){var te=Math.max(Z,Q),ee=te<t.length?t.charAt(te):null,ie=W();throw new this.SyntaxError(G(J),ee,te,ie.line,ie.column)}return $},toSource:function(){return this._source}};var n=i.svgPath;return n.SyntaxError=function(t,i,n,r,s){function a(t,i){var n,r;switch(t.length){case 0:n="end of input";break;case 1:n=t[0];break;default:n=t.slice(0,t.length-1).join(", ")+" or "+t[t.length-1]}return r=i?e(i):"end of input","Expected "+n+" but "+r+" found."}this.name="SyntaxError",this.expected=t,this.found=i,this.message=a(t,i),this.offset=n,this.line=r,this.column=s},n.SyntaxError.prototype=Error.prototype,n}),i("KITE/util/LineStyles",["require","KITE/kite","DOT/Util"],function(t){var e=t("KITE/kite"),i=t("DOT/Util").lineLineIntersection;e.LineStyles=function(t){void 0===t&&(t={}),this.lineWidth=void 0!==t.lineWidth?t.lineWidth:1,this.lineCap=void 0!==t.lineCap?t.lineCap:"butt",this.lineJoin=void 0!==t.lineJoin?t.lineJoin:"miter",this.lineDash=t.lineDash?t.lineDash:[],this.lineDashOffset=void 0!==t.lineDashOffset?t.lineDashOffset:0,this.miterLimit=void 0!==t.miterLimit?t.miterLimit:10};var n=e.LineStyles;return n.prototype={constructor:n,equals:function(t){var e=this.lineWidth===t.lineWidth&&this.lineCap===t.lineCap&&this.lineJoin===t.lineJoin&&this.miterLimit===t.miterLimit&&this.lineDashOffset===t.lineDashOffset;if(!e)return!1;if(this.lineDash.length!==t.lineDash.length)return!1;for(var i=0;i<this.lineDash.length;i++)if(this.lineDash[i]!==t.lineDash[i])return!1;return!0},leftJoin:function(t,n,r){var s=t.plus(n.perpendicular().negated().times(this.lineWidth/2)),a=t.plus(r.perpendicular().negated().times(this.lineWidth/2)),o=s.equals(a)?[]:[new e.Segment.Line(s,a)];if(!(n.perpendicular().dot(r)>0))return o;switch(this.lineJoin){case"round":var h=n.angle()+Math.PI/2,l=r.angle()+Math.PI/2;return[new e.Segment.Arc(t,this.lineWidth/2,h,l,!0)];case"miter":var u=n.angleBetween(r.negated());if(1/Math.sin(u/2)<=this.miterLimit&&u<Math.PI-1e-5){var c=i(s,s.plus(n),a,a.plus(r));return[new e.Segment.Line(s,c),new e.Segment.Line(c,a)]}return o;case"bevel":return o}},rightJoin:function(t,e,i){return this.leftJoin(t,i.negated(),e.negated())},cap:function(t,i){var n=t.plus(i.perpendicular().times(-this.lineWidth/2)),r=t.plus(i.perpendicular().times(this.lineWidth/2));switch(this.lineCap){case"butt":return[new e.Segment.Line(n,r)];case"round":var s=i.angle();return[new e.Segment.Arc(t,this.lineWidth/2,s+Math.PI/2,s-Math.PI/2,!0)];case"square":var a=i.perpendicular().negated().times(this.lineWidth/2),o=i.perpendicular().times(this.lineWidth/2),h=i.times(this.lineWidth/2),l=t.plus(a).plus(h),u=t.plus(o).plus(h);return[new e.Segment.Line(n,l),new e.Segment.Line(l,u),new e.Segment.Line(u,r)]}}},e.LineStyles}),i("KITE/segments/Quadratic",["require","PHET_CORE/inherit","DOT/Bounds2","DOT/Matrix3","DOT/Util","DOT/Util","KITE/kite","KITE/segments/Segment"],function(t){var e=t("PHET_CORE/inherit"),i=t("DOT/Bounds2"),n=t("DOT/Matrix3"),r=t("DOT/Util").solveQuadraticRootsReal,s=t("DOT/Util").arePointsCollinear,a=t("KITE/kite"),o=t("KITE/segments/Segment");return o.Quadratic=function(t,e,i){this._start=t,this._control=e,this._end=i,this._startTangent=void 0,this._endTangent=void 0,this._tCriticalX=void 0,this._tCriticalY=void 0,this._bounds=void 0},e(o,o.Quadratic,{degree:2,getStart:function(){return this._start},get start(){return this._start},getControl:function(){return this._control},get control(){return this._control},getEnd:function(){return this._end},get end(){return this._end},getStartTangent:function(){if(void 0===this._startTangent){var t=this._start.equals(this._control);this._startTangent=t?this._end.minus(this._start).normalized():this._control.minus(this._start).normalized()}return this._startTangent},get startTangent(){return this.getStartTangent()},getEndTangent:function(){if(void 0===this._endTangent){var t=this._end.equals(this._control);this._endTangent=t?this._end.minus(this._start).normalized():this._end.minus(this._control).normalized()}return this._endTangent},get endTangent(){return this.getEndTangent()},getTCriticalX:function(){return void 0===this._tCriticalX&&(this._tCriticalX=o.Quadratic.extremaT(this._start.x,this._control.x,this._end.x)),this._tCriticalX},get tCriticalX(){return this.getTCriticalX()},getTCriticalY:function(){return void 0===this._tCriticalY&&(this._tCriticalY=o.Quadratic.extremaT(this._start.y,this._control.y,this._end.y)),this._tCriticalY},get tCriticalY(){return this.getTCriticalY()},getNondegenerateSegments:function(){var t=this._start,e=this._control,i=this._end,n=t.equals(i),r=t.equals(e),a=t.equals(e);if(n&&r)return[];if(n){var h=this.positionAt(.5);return[new o.Line(t,h),new o.Line(h,i)]}if(s(t,e,i)){if(r||a)return[new o.Line(t,i)];var l=i.minus(t),u=e.minus(t).dot(l.normalized)/l.magnitude(),c=o.Quadratic.extremaT(0,u,1);if(null!==c&&c>0&&1>c){var d=this.positionAt(c);return _.flatten([new o.Line(t,d).getNondegenerateSegments(),new o.Line(d,i).getNondegenerateSegments()])}return[new o.Line(t,i)]}return[this]},getBounds:function(){if(void 0===this._bounds){this._bounds=new i(Math.min(this._start.x,this._end.x),Math.min(this._start.y,this._end.y),Math.max(this._start.x,this._end.x),Math.max(this._start.y,this._end.y));var t=this.getTCriticalX(),e=this.getTCriticalY();null!==t&&t>0&&1>t&&(this._bounds=this._bounds.withPoint(this.positionAt(t))),null!==e&&e>0&&1>e&&(this._bounds=this._bounds.withPoint(this.positionAt(e)))}return this._bounds},get bounds(){return this.getBounds()},positionAt:function(t){var e=1-t;return this._start.times(e*e).plus(this._control.times(2*e*t)).plus(this._end.times(t*t))},tangentAt:function(t){return this._control.minus(this._start).times(2*(1-t)).plus(this._end.minus(this._control).times(2*t))},curvatureAt:function(t){var e=1e-7;if(Math.abs(t-.5)>.5-e){var i=.5>t,n=i?this._start:this._end,r=this._control,s=i?this._end:this._start,a=r.minus(n),o=a.magnitude(),h=(i?-1:1)*a.perpendicular().normalized().dot(s.minus(r));return h*(this.degree-1)/(this.degree*o*o)}return this.subdivided(t,!0)[0].curvatureAt(1)},offsetTo:function(t,e){for(var i=[this],n=5,r=0;n>r;r++)i=_.flatten(_.map(i,function(t){return t.subdivided(.5,!0)}));var s=_.map(i,function(e){return e.approximateOffset(t)});return e&&(s.reverse(),s=_.map(s,function(t){return t.reversed(!0)})),s},subdivided:function(t){var e=this._start.blend(this._control,t),i=this._control.blend(this._end,t),n=e.blend(i,t);return[new o.Quadratic(this._start,e,n),new o.Quadratic(n,i,this._end)]},degreeElevated:function(){return new o.Cubic(this._start,this._start.plus(this._control.timesScalar(2)).dividedScalar(3),this._end.plus(this._control.timesScalar(2)).dividedScalar(3),this._end)},reversed:function(){return new o.Quadratic(this._end,this._control,this._start)},approximateOffset:function(t){return new o.Quadratic(this._start.plus((this._start.equals(this._control)?this._end.minus(this._start):this._control.minus(this._start)).perpendicular().normalized().times(t)),this._control.plus(this._end.minus(this._start).perpendicular().normalized().times(t)),this._end.plus(this._end.minus(this._end.equals(this._control)?this._start:this._control).perpendicular().normalized().times(t)))},getSVGPathFragment:function(){return"Q "+a.svgNumber(this._control.x)+" "+a.svgNumber(this._control.y)+" "+a.svgNumber(this._end.x)+" "+a.svgNumber(this._end.y)},strokeLeft:function(t){return this.offsetTo(-t/2,!1)},strokeRight:function(t){return this.offsetTo(t/2,!0)},getInteriorExtremaTs:function(){var t=[],e=1e-10;return void 0!==this.tCriticalX&&this.tCriticalX>e&&this.tCriticalX<1-e&&t.push(this.tCriticalX),void 0!==this.tCriticalY&&this.tCriticalY>e&&this.tCriticalY<1-e&&t.push(this.tCriticalY),t.sort()},intersectsBounds:function(){throw new Error("Segment.Quadratic.intersectsBounds unimplemented")},intersection:function(t){var e=this,i=[],s=n.rotation2(-t.dir.angle()).timesMatrix(n.translation(-t.pos.x,-t.pos.y)),a=s.timesVector2(this._start),o=s.timesVector2(this._control),h=s.timesVector2(this._end),l=a.y-2*o.y+h.y,u=-2*a.y+2*o.y,c=a.y,d=r(l,u,c);return _.each(d,function(n){if(n>=0&&1>=n){var r=e.positionAt(n),s=e.tangentAt(n).normalized(),a=s.perpendicular(),o=r.minus(t.pos);o.dot(t.dir)>0&&i.push({distance:o.magnitude(),point:r,normal:a.dot(t.dir)>0?a.negated():a,wind:t.dir.perpendicular().dot(s)<0?1:-1})}}),i},windingIntersection:function(t){var e=0,i=this.intersection(t);return _.each(i,function(t){e+=t.wind}),e},writeToContext:function(t){t.quadraticCurveTo(this._control.x,this._control.y,this._end.x,this._end.y)},transformed:function(t){return new o.Quadratic(t.timesVector2(this._start),t.timesVector2(this._control),t.timesVector2(this._end))},reparameterized:function(t,e){var i=this._start.plus(this._end.plus(this._control.timesScalar(-2))),n=this._control.minus(this._start).timesScalar(2),r=this._start,s=i.timesScalar(t*t),a=i.timesScalar(t*e).timesScalar(2).plus(n.timesScalar(t)),h=i.timesScalar(e*e).plus(n.timesScalar(e)).plus(r);return new o.Quadratic(h,a.timesScalar(.5).plus(h),s.plus(a).plus(h))}}),o.Quadratic.extremaT=function(t,e,i){var n=2*(i-2*e+t);return 0!==n?-2*(e-t)/n:null},o.Quadratic}),i("KITE/segments/Cubic",["require","PHET_CORE/inherit","DOT/Bounds2","DOT/Vector2","DOT/Matrix3","DOT/Util","DOT/Util","DOT/Util","KITE/kite","KITE/segments/Segment","KITE/segments/Quadratic"],function(t){var e=t("PHET_CORE/inherit"),i=t("DOT/Bounds2"),n=t("DOT/Vector2"),r=t("DOT/Matrix3"),s=t("DOT/Util").solveQuadraticRootsReal,a=t("DOT/Util").solveCubicRootsReal,o=t("DOT/Util").arePointsCollinear,h=t("KITE/kite"),l=t("KITE/segments/Segment");return t("KITE/segments/Quadratic"),l.Cubic=function(t,e,i,n){this._start=t,this._control1=e,this._control2=i,this._end=n,this._startTangent=void 0,this._endTangent=void 0,this._r=void 0,this._s=void 0,this._tCusp=void 0,this._tDeterminant=void 0,this._tInflection1=void 0,this._tInflection2=void 0,this._startQuadratic=void 0,this._endQuadratic=void 0,this._xExtremaT=void 0,this._yExtremaT=void 0,this._bounds=void 0},e(l,l.Cubic,{degree:3,getStart:function(){return this._start},get start(){return this._start},getControl1:function(){return this._control1},get control1(){return this._control1},getControl2:function(){return this._control2},get control2(){return this._control2},getEnd:function(){return this._end},get end(){return this._end},getStartTangent:function(){return void 0===this._startTangent&&(this._startTangent=this.tangentAt(0).normalized()),this._startTangent},get startTangent(){return this.getStartTangent()},getEndTangent:function(){return void 0===this._endTangent&&(this._endTangent=this.tangentAt(1).normalized()),this._endTangent},get endTangent(){return this.getEndTangent()},getR:function(){return void 0===this._r&&(this._r=this._control1.minus(this._start).normalized()),this._r},get r(){return this.getR()},getS:function(){return void 0===this._s&&(this._s=this.getR().perpendicular()),this._s},get s(){return this.getS()},getTCusp:function(){return void 0===this._tCusp&&this.computeCuspInfo(),this._tCusp},get tCusp(){return this.getTCusp()},getTDeterminant:function(){return void 0===this._tDeterminant&&this.computeCuspInfo(),this._tDeterminant},get tDeterminant(){return this.getTDeterminant()},getTInflection1:function(){return void 0===this._tInflection1&&this.computeCuspInfo(),this._tInflection1},get tInflection1(){return this.getTInflection1()},getTInflection2:function(){return void 0===this._tInflection2&&this.computeCuspInfo(),this._tInflection2},get tInflection2(){return this.getTInflection2()},getStartQuadratic:function(){return void 0===this._startQuadratic&&this.computeCuspSegments(),this._startQuadratic},get startQuadratic(){return this.getStartQuadratic()},getEndQuadratic:function(){return void 0===this._endQuadratic&&this.computeCuspSegments(),this._endQuadratic},get endQuadratic(){return this.getEndQuadratic()},getXExtremaT:function(){return void 0===this._xExtremaT&&(this._xExtremaT=l.Cubic.extremaT(this._start.x,this._control1.x,this._control2.x,this._end.x)),this._xExtremaT},get xExtremaT(){return this.getXExtremaT()},getYExtremaT:function(){return void 0===this._yExtremaT&&(this._yExtremaT=l.Cubic.extremaT(this._start.y,this._control1.y,this._control2.y,this._end.y)),this._yExtremaT},get yExtremaT(){return this.getYExtremaT()},getBounds:function(){if(void 0===this._bounds){this._bounds=i.NOTHING,this._bounds=this._bounds.withPoint(this._start),this._bounds=this._bounds.withPoint(this._end);var t=this;_.each(this.getXExtremaT(),function(e){e>=0&&1>=e&&(t._bounds=t._bounds.withPoint(t.positionAt(e)))}),_.each(this.getYExtremaT(),function(e){e>=0&&1>=e&&(t._bounds=t._bounds.withPoint(t.positionAt(e)))}),this.hasCusp()&&(this._bounds=this._bounds.withPoint(this.positionAt(this.getTCusp())))}return this._bounds},get bounds(){return this.getBounds()},computeCuspInfo:function(){var t=this._start.times(-1).plus(this._control1.times(3)).plus(this._control2.times(-3)).plus(this._end),e=this._start.times(3).plus(this._control1.times(-6)).plus(this._control2.times(3)),i=this._start.times(-3).plus(this._control1.times(3)),n=t.perpendicular(),r=e.perpendicular(),s=n.dot(e);if(this._tCusp=-.5*(n.dot(i)/s),this._tDeterminant=this._tCusp*this._tCusp-1/3*(r.dot(i)/s),this._tDeterminant>=0){var a=Math.sqrt(this._tDeterminant);this._tInflection1=this._tCusp-a,this._tInflection2=this._tCusp+a}else this._tInflection1=null,this._tInflection2=null},computeCuspSegments:function(){if(this.hasCusp()){var t=this.subdivided(this.getTCusp);this._startQuadratic=new l.Quadratic(t[0].start,t[0].control1,t[0].end,!1),this._endQuadratic=new l.Quadratic(t[1].start,t[1].control2,t[1].end,!1)}else this._startQuadratic=null,this._endQuadratic=null},getNondegenerateSegments:function(){var t=this._start,e=this._control1,i=this._control2,n=this._end,r=this.degreeReduced(1e-9);if(t.equals(n)&&t.equals(e)&&t.equals(i))return[];if(this.hasCusp())return _.flatten([this._startQuadratic.getNondegenerateSegments(),this._endQuadratic.getNondegenerateSegments()]);if(r)return r.getNondegenerateSegments();if(o(t,e,n)&&o(t,i,n))throw new Error("TODO, use extrema T funcs");return[this]},hasCusp:function(){var t=this.getTCusp(),e=1e-7;return this.tangentAt(t).magnitude()<e&&t>=0&&1>=t},positionAt:function(t){var e=1-t;return this._start.times(e*e*e).plus(this._control1.times(3*e*e*t)).plus(this._control2.times(3*e*t*t)).plus(this._end.times(t*t*t))},tangentAt:function(t){var e=1-t;return this._start.times(-3*e*e).plus(this._control1.times(3*e*e-6*e*t)).plus(this._control2.times(6*e*t-3*t*t)).plus(this._end.times(3*t*t))},curvatureAt:function(t){var e=1e-7;if(Math.abs(t-.5)>.5-e){var i=.5>t,n=i?this._start:this._end,r=i?this._control1:this._control2,s=i?this._control2:this._control1,a=r.minus(n),o=a.magnitude(),h=(i?-1:1)*a.perpendicular().normalized().dot(s.minus(r));return h*(this.degree-1)/(this.degree*o*o)}return this.subdivided(t)[0].curvatureAt(1)},toRS:function(t){var e=t.minus(this._start);return new n(e.dot(this.getR()),e.dot(this.getS()))},subdivided:function(t){var e=this._start.blend(this._control1,t),i=this._control2.blend(this._end,t),n=this._control1.blend(this._control2,t),r=e.blend(n,t),s=n.blend(i,t),a=r.blend(s,t);return[new l.Cubic(this._start,e,r,a),new l.Cubic(a,s,i,this._end)]},offsetTo:function(t,e){for(var i=32,n=[],r=[],s=0;i>s;s++){var a=s/(i-1);e&&(a=1-a),n.push(this.positionAt(a).plus(this.tangentAt(a).perpendicular().normalized().times(t))),s>0&&r.push(new l.Line(n[s-1],n[s]))}return r},getSVGPathFragment:function(){return"C "+h.svgNumber(this._control1.x)+" "+h.svgNumber(this._control1.y)+" "+h.svgNumber(this._control2.x)+" "+h.svgNumber(this._control2.y)+" "+h.svgNumber(this._end.x)+" "+h.svgNumber(this._end.y)},strokeLeft:function(t){return this.offsetTo(-t/2,!1)},strokeRight:function(t){return this.offsetTo(t/2,!0)},getInteriorExtremaTs:function(){var t=this.getXExtremaT().concat(this.getYExtremaT()),e=[];return _.each(t,function(t){var i=1e-10;t>i&&1-i>t&&_.every(e,function(e){return Math.abs(t-e)>i})&&e.push(t)}),e.sort()},intersectsBounds:function(){throw new Error("Segment.Cubic.intersectsBounds unimplemented")},intersection:function(t){var e=this,i=[],n=r.rotation2(-t.dir.angle()).timesMatrix(r.translation(-t.pos.x,-t.pos.y)),s=n.timesVector2(this._start),o=n.timesVector2(this._control1),h=n.timesVector2(this._control2),l=n.timesVector2(this._end),u=-s.y+3*o.y-3*h.y+l.y,c=3*s.y-6*o.y+3*h.y,d=-3*s.y+3*o.y,f=s.y,m=a(u,c,d,f);return _.each(m,function(n){if(n>=0&&1>=n){var r=e.positionAt(n),s=e.tangentAt(n).normalized(),a=s.perpendicular(),o=r.minus(t.pos);o.dot(t.dir)>0&&i.push({distance:o.magnitude(),point:r,normal:a.dot(t.dir)>0?a.negated():a,wind:t.dir.perpendicular().dot(s)<0?1:-1})}}),i},windingIntersection:function(t){var e=0,i=this.intersection(t);return _.each(i,function(t){e+=t.wind}),e},writeToContext:function(t){t.bezierCurveTo(this._control1.x,this._control1.y,this._control2.x,this._control2.y,this._end.x,this._end.y)},transformed:function(t){return new l.Cubic(t.timesVector2(this._start),t.timesVector2(this._control1),t.timesVector2(this._control2),t.timesVector2(this._end))},degreeReduced:function(t){t=t||0;var e=this._control1.timesScalar(3).minus(this._start).dividedScalar(2),i=this._control2.timesScalar(3).minus(this._end).dividedScalar(2);return e.minus(i).magnitude()<=t?new l.Quadratic(this._start,e.average(i),this._end):null}}),l.Cubic.extremaT=function(t,e,i,n){var r=-3*t+9*e-9*i+3*n,a=6*t-12*e+6*i,o=-3*t+3*e;return s(r,a,o)},l.Cubic}),i("KITE/segments/EllipticalArc",["require","PHET_CORE/inherit","DOT/Vector2","DOT/Bounds2","DOT/Matrix3","DOT/Transform3","DOT/Util","DOT/Util","KITE/kite","KITE/segments/Segment","KITE/util/Subpath"],function(t){var e=t("PHET_CORE/inherit"),i=t("DOT/Vector2"),n=t("DOT/Bounds2"),r=t("DOT/Matrix3"),s=t("DOT/Transform3"),a=t("DOT/Util").toDegrees,o=t("DOT/Util"),h=t("KITE/kite"),l=t("KITE/segments/Segment");return t("KITE/util/Subpath"),l.EllipticalArc=function(t,e,i,n,r,s,a){if(0>e&&(e=-e,r=Math.PI-r,s=Math.PI-s,a=!a),0>i&&(i=-i,r=-r,s=-s,a=!a),i>e){n+=Math.PI/2,r-=Math.PI/2,s-=Math.PI/2;var o=e;e=i,i=o}if(this._center=t,this._radiusX=e,this._radiusY=i,this._rotation=n,this._startAngle=r,this._endAngle=s,this._anticlockwise=a,this._unitTransform=void 0,this._start=void 0,this._end=void 0,this._startTangent=void 0,this._endTangent=void 0,this._actualEndAngle=void 0,this._isFullPerimeter=void 0,this._angleDifference=void 0,this._unitArcSegment=void 0,i>e)throw new Error("Not verified to work if radiusX < radiusY")},e(l,l.EllipticalArc,{getCenter:function(){return this._center},get center(){return this.getCenter()},getRadiusX:function(){return this._radiusX},get radiusX(){return this.getRadiusX()
},getRadiusY:function(){return this._radiusY},get radiusY(){return this.getRadiusY()},getRotation:function(){return this._rotation},get rotation(){return this.getRotation()},getStartAngle:function(){return this._startAngle},get startAngle(){return this.getStartAngle()},getEndAngle:function(){return this._endAngle},get endAngle(){return this.getEndAngle()},getAnticlockwise:function(){return this._anticlockwise},get anticlockwise(){return this.getAnticlockwise()},getUnitTransform:function(){return void 0===this._unitTransform&&(this._unitTransform=l.EllipticalArc.computeUnitTransform(this._center,this._radiusX,this._radiusY,this._rotation)),this._unitTransform},get unitTransform(){return this.getUnitTransform()},getStart:function(){return void 0===this._start&&(this._start=this.positionAtAngle(this._startAngle)),this._start},get start(){return this.getStart()},getEnd:function(){return void 0===this._end&&(this._end=this.positionAtAngle(this._endAngle)),this._end},get end(){return this.getEnd()},getStartTangent:function(){return void 0===this._startTangent&&(this._startTangent=this.tangentAtAngle(this._startAngle)),this._startTangent},get startTangent(){return this.getStartTangent()},getEndTangent:function(){return void 0===this._endTangent&&(this._endTangent=this.tangentAtAngle(this._endAngle)),this._endTangent},get endTangent(){return this.getEndTangent()},getActualEndAngle:function(){return void 0===this._actualEndAngle&&(this._actualEndAngle=this._anticlockwise?this._startAngle>this._endAngle?this._endAngle:this._startAngle<this._endAngle?this._endAngle-2*Math.PI:this._startAngle:this._startAngle<this._endAngle?this._endAngle:this._startAngle>this._endAngle?this._endAngle+2*Math.PI:this._startAngle),this._actualEndAngle},get actualEndAngle(){return this.getActualEndAngle()},getIsFullPerimeter:function(){return void 0===this._isFullPerimeter&&(this._isFullPerimeter=!this._anticlockwise&&this._endAngle-this._startAngle>=2*Math.PI||this._anticlockwise&&this._startAngle-this._endAngle>=2*Math.PI),this._isFullPerimeter},get isFullPerimeter(){return this.getIsFullPerimeter()},getAngleDifference:function(){return void 0===this._angleDifference&&(this._angleDifference=this._anticlockwise?this._startAngle-this._endAngle:this._endAngle-this._startAngle,this._angleDifference<0&&(this._angleDifference+=2*Math.PI)),this._angleDifference},get angleDifference(){return this.getAngleDifference()},getUnitArcSegment:function(){return void 0===this._unitArcSegment&&(this._unitArcSegment=new l.Arc(i.ZERO,1,this._startAngle,this._endAngle,this._anticlockwise)),this._unitArcSegment},getBounds:function(){if(void 0===this._bounds&&(this._bounds=n.NOTHING.withPoint(this.getStart()).withPoint(this.getEnd()),this._startAngle!==this._endAngle)){var t=Math.atan(-(this._radiusY/this._radiusX)*Math.tan(this._rotation)),e=Math.atan(this._radiusY/this._radiusX/Math.tan(this._rotation));this.possibleExtremaAngles=[t,t+Math.PI,e,e+Math.PI],_.each(this.possibleExtremaAngles,this.includeBoundsAtAngle.bind(this))}return this._bounds},get bounds(){return this.getBounds()},getNondegenerateSegments:function(){if(this._radiusX<=0||this._radiusY<=0||this._startAngle===this._endAngle)return[];if(this._radiusX===this._radiusY){var t=this._startAngle-this._rotation,e=this._endAngle-this._rotation;return Math.abs(this._endAngle-this._startAngle)===2*Math.PI&&(e=this._anticlockwise?t-2*Math.PI:t+2*Math.PI),[new l.Arc(this._center,this._radiusX,t,e,this._anticlockwise)]}return[this]},includeBoundsAtAngle:function(t){this.containsAngle(t)&&(this._bounds=this._bounds.withPoint(this.positionAtAngle(t)))},mapAngle:function(t){return this._startAngle>this.getActualEndAngle()?o.moduloBetweenUp(t,this._startAngle-2*Math.PI,this._startAngle):o.moduloBetweenDown(t,this._startAngle,this._startAngle+2*Math.PI)},tAtAngle:function(t){return(this.mapAngle(t)-this._startAngle)/(this.getActualEndAngle()-this._startAngle)},angleAt:function(t){return this._startAngle+(this.getActualEndAngle()-this._startAngle)*t},positionAt:function(t){return this.positionAtAngle(this.angleAt(t))},tangentAt:function(t){return this.tangentAtAngle(this.angleAt(t))},curvatureAt:function(t){var e=this.angleAt(t),i=this._radiusX*Math.sin(e),n=this._radiusY*Math.cos(e),r=Math.pow(n*n+i*i,1.5);return(this._anticlockwise?-1:1)*this._radiusX*this._radiusY/r},positionAtAngle:function(t){return this.getUnitTransform().transformPosition2(i.createPolar(1,t))},tangentAtAngle:function(t){var e=this.getUnitTransform().transformNormal2(i.createPolar(1,t));return this._anticlockwise?e.perpendicular():e.perpendicular().negated()},containsAngle:function(t){var e=this._anticlockwise?t-this._endAngle:t-this._startAngle,i=e%(2*Math.PI);return 0>i&&(i+=2*Math.PI),i<=this.getAngleDifference()},offsetTo:function(t,e){for(var i=32,n=[],r=[],s=0;i>s;s++){var a=s/(i-1);e&&(a=1-a);var o=this.angleAt(a);n.push(this.positionAtAngle(o).plus(this.tangentAtAngle(o).perpendicular().normalized().times(t))),s>0&&r.push(new l.Line(n[s-1],n[s]))}return r},getSVGPathFragment:function(){var t,e=.01,i=this._anticlockwise?"0":"1",n=a(this._rotation);if(this.getAngleDifference()<2*Math.PI-e)return t=this.getAngleDifference()<Math.PI?"0":"1","A "+h.svgNumber(this._radiusX)+" "+h.svgNumber(this._radiusY)+" "+n+" "+t+" "+i+" "+h.svgNumber(this.getEnd().x)+" "+h.svgNumber(this.getEnd().y);var r=(this._startAngle+this._endAngle)/2,s=this.positionAtAngle(r);t="0";var o="A "+h.svgNumber(this._radiusX)+" "+h.svgNumber(this._radiusY)+" "+n+" "+t+" "+i+" "+h.svgNumber(s.x)+" "+h.svgNumber(s.y),l="A "+h.svgNumber(this._radiusX)+" "+h.svgNumber(this._radiusY)+" "+n+" "+t+" "+i+" "+h.svgNumber(this.getEnd().x)+" "+h.svgNumber(this.getEnd().y);return o+" "+l},strokeLeft:function(t){return this.offsetTo(-t/2,!1)},strokeRight:function(t){return this.offsetTo(t/2,!0)},getInteriorExtremaTs:function(){var t=this,e=[];return _.each(this.possibleExtremaAngles,function(i){if(t.containsAngle(i)){var n=t.tAtAngle(i),r=1e-10;n>r&&1-r>n&&e.push(n)}}),e.sort()},subdivided:function(t){var e=this.angleAt(0),i=this.angleAt(t),n=this.angleAt(1);return[new l.EllipticalArc(this._center,this._radiusX,this._radiusY,this._rotation,e,i,this._anticlockwise),new l.EllipticalArc(this._center,this._radiusX,this._radiusY,this._rotation,i,n,this._anticlockwise)]},intersectsBounds:function(){throw new Error("Segment.EllipticalArc.intersectsBounds unimplemented")},intersection:function(t){var e=this.getUnitTransform(),i=e.inverseRay2(t),n=this.getUnitArcSegment().intersection(i);return _.map(n,function(i){var n=e.transformPosition2(i.point);return{distance:t.pos.distance(n),point:n,normal:e.inverseNormal2(i.normal),wind:i.wind}})},windingIntersection:function(t){var e=this.getUnitTransform().inverseRay2(t);return this.getUnitArcSegment().windingIntersection(e)},writeToContext:function(t){t.ellipse?t.ellipse(this._center.x,this._center.y,this._radiusX,this._radiusY,this._rotation,this._startAngle,this._endAngle,this._anticlockwise):(this.getUnitTransform().getMatrix().canvasAppendTransform(t),t.arc(0,0,1,this._startAngle,this._endAngle,this._anticlockwise),this.getUnitTransform().getInverse().canvasAppendTransform(t))},transformed:function(t){var e=t.timesVector2(i.createPolar(this._radiusX,this._rotation)).minus(t.timesVector2(i.ZERO)),n=t.timesVector2(i.createPolar(this._radiusY,this._rotation+Math.PI/2)).minus(t.timesVector2(i.ZERO)),r=e.angle(),s=e.magnitude(),a=n.magnitude(),o=t.getDeterminant()<0,h=o?!this._anticlockwise:this._anticlockwise,u=o?-this._startAngle:this._startAngle,c=o?-this._endAngle:this._endAngle;return Math.abs(this._endAngle-this._startAngle)===2*Math.PI&&(c=h?u-2*Math.PI:u+2*Math.PI),new l.EllipticalArc(t.timesVector2(this._center),s,a,r,u,c,h)}}),l.EllipticalArc.computeUnitTransform=function(t,e,i,n){return new s(r.translation(t.x,t.y).timesMatrix(r.rotation2(n)).timesMatrix(r.scaling(e,i)))},l.EllipticalArc}),i("KITE/Shape",["require","KITE/kite","DOT/Vector2","DOT/Bounds2","DOT/Ray2","KITE/util/Subpath","KITE/parser/svgPath","KITE/util/LineStyles","KITE/segments/Arc","KITE/segments/Cubic","KITE/segments/EllipticalArc","KITE/segments/Line","KITE/segments/Quadratic"],function(t){function e(t,e){return new r(t,e)}function i(t,e){return new r(t,e)}var n=t("KITE/kite"),r=t("DOT/Vector2"),s=t("DOT/Bounds2"),a=t("DOT/Ray2"),o=t("KITE/util/Subpath"),h=t("KITE/parser/svgPath");t("KITE/util/LineStyles"),t("KITE/segments/Arc"),t("KITE/segments/Cubic"),t("KITE/segments/EllipticalArc"),t("KITE/segments/Line"),t("KITE/segments/Quadratic"),n.Shape=function(t,e){this.subpaths="object"==typeof t?t:[],this.bounds=(e||s.NOTHING).copy();var i=this;t&&"object"!=typeof t&&_.each(h.parse(t),function(t){i[t.cmd].apply(i,t.args)}),this.resetControlPoints()};var l=n.Shape;return l.prototype={constructor:l,resetControlPoints:function(){this.lastQuadraticControlPoint=null,this.lastCubicControlPoint=null},setQuadraticControlPoint:function(t){this.lastQuadraticControlPoint=t,this.lastCubicControlPoint=null},setCubicControlPoint:function(t){this.lastQuadraticControlPoint=null,this.lastCubicControlPoint=t},moveTo:function(t,e){return this.moveToPoint(i(t,e))},moveToRelative:function(t,e){return this.moveToPointRelative(i(t,e))},moveToPointRelative:function(t){return this.moveToPoint(this.getRelativePoint().plus(t))},moveToPoint:function(t){return this.addSubpath((new n.Subpath).addPoint(t)),this.resetControlPoints(),this},lineTo:function(t,e){return this.lineToPoint(i(t,e))},lineToRelative:function(t,e){return this.lineToPointRelative(i(t,e))},lineToPointRelative:function(t){return this.lineToPoint(this.getRelativePoint().plus(t))},lineToPoint:function(t){if(this.hasSubpaths()){var e=this.getLastSubpath().getLastPoint(),i=t,r=new n.Segment.Line(e,i);this.getLastSubpath().addPoint(i),this.addSegmentAndBounds(r)}else this.ensure(t);return this.resetControlPoints(),this},horizontalLineTo:function(t){return this.lineTo(t,this.getRelativePoint().y)},horizontalLineToRelative:function(t){return this.lineToRelative(t,0)},verticalLineTo:function(t){return this.lineTo(this.getRelativePoint().x,t)},verticalLineToRelative:function(t){return this.lineToRelative(0,t)},quadraticCurveTo:function(t,e,n,r){return this.quadraticCurveToPoint(i(t,e),i(n,r))},quadraticCurveToRelative:function(t,e,n,r){return this.quadraticCurveToPointRelative(i(t,e),i(n,r))},quadraticCurveToPointRelative:function(t,e){var i=this.getRelativePoint();return this.quadraticCurveToPoint(i.plus(t),i.plus(e))},smoothQuadraticCurveTo:function(t,e){return this.quadraticCurveToPoint(this.getSmoothQuadraticControlPoint(),i(t,e))},smoothQuadraticCurveToRelative:function(t,e){return this.quadraticCurveToPoint(this.getSmoothQuadraticControlPoint(),i(t,e).plus(this.getRelativePoint()))},quadraticCurveToPoint:function(t,e){var i=this;this.ensure(t);var r=this.getLastSubpath().getLastPoint(),s=new n.Segment.Quadratic(r,t,e);this.getLastSubpath().addPoint(e);var a=s.getNondegenerateSegments();return _.each(a,function(t){i.addSegmentAndBounds(t)}),this.setQuadraticControlPoint(t),this},cubicCurveTo:function(t,e,n,r,s,a){return this.cubicCurveToPoint(i(t,e),i(n,r),i(s,a))},cubicCurveToRelative:function(t,e,n,r,s,a){return this.cubicCurveToPointRelative(i(t,e),i(n,r),i(s,a))},cubicCurveToPointRelative:function(t,e,i){var n=this.getRelativePoint();return this.cubicCurveToPoint(n.plus(t),n.plus(e),n.plus(i))},smoothCubicCurveTo:function(t,e,n,r){return this.cubicCurveToPoint(this.getSmoothCubicControlPoint(),i(t,e),i(n,r))},smoothCubicCurveToRelative:function(t,e,n,r){return this.cubicCurveToPoint(this.getSmoothCubicControlPoint(),i(t,e).plus(this.getRelativePoint()),i(n,r).plus(this.getRelativePoint()))},cubicCurveToPoint:function(t,e,i){var r=this;this.ensure(t);var s=this.getLastSubpath().getLastPoint(),a=new n.Segment.Cubic(s,t,e,i),o=a.getNondegenerateSegments();return _.each(o,function(t){r.addSegmentAndBounds(t)}),this.getLastSubpath().addPoint(i),this.setCubicControlPoint(e),this},arc:function(t,e,n,r,s,a){return this.arcPoint(i(t,e),n,r,s,a)},arcPoint:function(t,e,i,r,s){var a=new n.Segment.Arc(t,e,i,r,s),o=a.getStart(),h=a.getEnd();return this.hasSubpaths()&&this.getLastSubpath().getLength()>0&&!o.equals(this.getLastSubpath().getLastPoint(),0)&&this.addSegmentAndBounds(new n.Segment.Line(this.getLastSubpath().getLastPoint(),o)),this.hasSubpaths()||this.addSubpath(new n.Subpath),this.getLastSubpath().addPoint(o),this.getLastSubpath().addPoint(h),this.addSegmentAndBounds(a),this.resetControlPoints(),this},ellipticalArc:function(t,e,n,r,s,a,o,h){return this.ellipticalArcPoint(i(t,e),n,r,s,a,o,h)},ellipticalArcPoint:function(t,e,i,r,s,a,o){var h=new n.Segment.EllipticalArc(t,e,i,r,s,a,o),l=h.start,u=h.end;return this.hasSubpaths()&&this.getLastSubpath().getLength()>0&&!l.equals(this.getLastSubpath().getLastPoint(),0)&&this.addSegmentAndBounds(new n.Segment.Line(this.getLastSubpath().getLastPoint(),l)),this.hasSubpaths()||this.addSubpath(new n.Subpath),this.getLastSubpath().addPoint(l),this.getLastSubpath().addPoint(u),this.addSegmentAndBounds(h),this.resetControlPoints(),this},close:function(){if(this.hasSubpaths()){var t=this.getLastSubpath(),e=new n.Subpath;t.close(),this.addSubpath(e),e.addPoint(t.getFirstPoint())}return this.resetControlPoints(),this},ellipticalArcToRelative:function(t,e,i,n,r,s,a){var o=this.getRelativePoint();return this.ellipticalArcTo(t,e,i,n,r,s+o.x,a+o.y)},ellipticalArcTo:function(){throw new Error("ellipticalArcTo unimplemented")},circle:function(t,i,n){if("object"==typeof t){var r=t;return n=i,this.arcPoint(r,n,0,2*Math.PI,!1)}return this.arcPoint(e(t,i),n,0,2*Math.PI,!1)},ellipse:function(t,e,n,r,s){if("object"==typeof t){var a=t;return s=r,r=n,n=e,this.ellipticalArcPoint(a,n,r,s||0,0,2*Math.PI,!1)}return this.ellipticalArcPoint(i(t,e),n,r,s||0,0,2*Math.PI,!1)},rect:function(t,e,r,s){var a=new n.Subpath;return this.addSubpath(a),a.addPoint(i(t,e)),a.addPoint(i(t+r,e)),a.addPoint(i(t+r,e+s)),a.addPoint(i(t,e+s)),this.addSegmentAndBounds(new n.Segment.Line(a.points[0],a.points[1])),this.addSegmentAndBounds(new n.Segment.Line(a.points[1],a.points[2])),this.addSegmentAndBounds(new n.Segment.Line(a.points[2],a.points[3])),a.close(),this.addSubpath(new n.Subpath),this.getLastSubpath().addPoint(i(t,e)),this.resetControlPoints(),this},roundRect:function(t,e,i,n,r,s){var a=t+r,o=t+i-r,h=e+s,l=e+n-s;return r===s?this.arc(o,h,r,-Math.PI/2,0,!1).arc(o,l,r,0,Math.PI/2,!1).arc(a,l,r,Math.PI/2,Math.PI,!1).arc(a,h,r,Math.PI,3*Math.PI/2,!1).close():this.ellipticalArc(o,h,r,s,0,-Math.PI/2,0,!1).ellipticalArc(o,l,r,s,0,0,Math.PI/2,!1).ellipticalArc(a,l,r,s,0,Math.PI/2,Math.PI,!1).ellipticalArc(a,h,r,s,0,Math.PI,3*Math.PI/2,!1).close(),this},polygon:function(t){var e=t.length;if(e>0){this.moveToPoint(t[0]);for(var i=1;e>i;i++)this.lineToPoint(t[i])}return this.close()},copy:function(){return new l(_.map(this.subpaths,function(t){return t.copy()}),this.bounds)},writeToContext:function(t){for(var e=this.subpaths.length,i=0;e>i;i++)this.subpaths[i].writeToContext(t)},getSVGPath:function(){for(var t=[],e=this.subpaths.length,i=0;e>i;i++){var r=this.subpaths[i];if(r.isDrawable()){var s=r.getFirstSegment().start,a="M "+n.svgNumber(s.x)+" "+n.svgNumber(s.y)+" ";a+=_.map(r.segments,function(t){return t.getSVGPathFragment()}).join(" "),r.isClosed()&&(a+=" Z"),t.push(a)}}return t.join(" ")},transformed:function(t){var e=_.map(this.subpaths,function(e){return e.transformed(t)}),i=_.reduce(e,function(t,e){return t.union(e.bounds)},s.NOTHING);return new l(e,i)},nonlinearTransformed:function(t){t=_.extend({minLevels:0,maxLevels:7,distanceEpsilon:.16,curveEpsilon:t&&t.includeCurvature?.002:null},t);var e=_.map(this.subpaths,function(e){return e.nonlinearTransformed(t)}),i=_.reduce(e,function(t,e){return t.union(e.bounds)},s.NOTHING);return new l(e,i)},polarToCartesian:function(t){return this.nonlinearTransformed(_.extend({pointMap:function(t){return r.createPolar(t.y,t.x)},methodName:"polarToCartesian"},t))},toPiecewiseLinear:function(t){return this.nonlinearTransformed(t)},computeBounds:function(t){return t?this.bounds.union(this.getStrokedShape(t).bounds):this.bounds},getBoundsWithTransform:function(t,e){if(t.isAxisAligned())return this.computeBounds(e);for(var i=s.NOTHING.copy(),n=this.subpaths.length,r=0;n>r;r++){var a=this.subpaths[r];i.includeBounds(a.getBoundsWithTransform(t))}return e&&i.includeBounds(this.getStrokedShape(e).getBoundsWithTransform(t)),i},containsPoint:function(t){var e=new a(t,r.X_UNIT);return 0!==this.windingIntersection(e)},intersection:function(t){for(var e=[],i=this.subpaths.length,n=0;i>n;n++){var r=this.subpaths[n];if(r.isDrawable()){for(var s=r.segments.length,a=0;s>a;a++){var o=r.segments[a];e=e.concat(o.intersection(t))}r.hasClosingSegment()&&(e=e.concat(r.getClosingSegment().intersection(t)))}}return _.sortBy(e,function(t){return t.distance})},windingIntersection:function(t){for(var e=0,i=this.subpaths.length,n=0;i>n;n++){var r=this.subpaths[n];if(r.isDrawable()){for(var s=r.segments.length,a=0;s>a;a++)e+=r.segments[a].windingIntersection(t);r.hasClosingSegment()&&(e+=r.getClosingSegment().windingIntersection(t))}}return e},intersectsBounds:function(t){for(var e=this.subpaths.length,i=0;e>i;i++){var n=this.subpaths[i];if(n.isDrawable()){for(var r=n.segments.length,s=0;r>s;s++)if(n.segments[s].intersectsBounds(t))return!0;if(n.hasClosingSegment()&&n.getClosingSegment().intersectsBounds(t))return!0}}return!1},getStrokedShape:function(t){for(var e=[],i=s.NOTHING.copy(),n=this.subpaths.length,r=0;n>r;r++){var a=this.subpaths[r],o=a.stroked(t);e=e.concat(o)}for(n=e.length,r=0;n>r;r++)i.includeBounds(e[r].bounds);return new l(e,i)},getOffsetShape:function(t){for(var e=[],i=s.NOTHING.copy(),n=this.subpaths.length,r=0;n>r;r++)e.push(this.subpaths[r].offset(t));for(n=e.length,r=0;n>r;r++)i.includeBounds(e[r].bounds);return new l(e,i)},toString:function(){return"new kite.Shape( '"+this.getSVGPath()+"' )"},addSegmentAndBounds:function(t){this.getLastSubpath().addSegment(t),this.bounds=this.bounds.includeBounds(this.getLastSubpath().bounds)},ensure:function(t){this.hasSubpaths()||(this.addSubpath(new o),this.getLastSubpath().addPoint(t))},addSubpath:function(t){return this.subpaths.push(t),this},hasSubpaths:function(){return this.subpaths.length>0},getLastSubpath:function(){return _.last(this.subpaths)},getLastPoint:function(){return this.hasSubpaths()?this.getLastSubpath().getLastPoint():null},getLastSegment:function(){if(!this.hasSubpaths())return null;var t=this.getLastSubpath();return t.isDrawable()?t.getLastSegment():null},getSmoothQuadraticControlPoint:function(){var t=this.getLastPoint();return this.lastQuadraticControlPoint?t.plus(t.minus(this.lastQuadraticControlPoint)):t},getSmoothCubicControlPoint:function(){var t=this.getLastPoint();return this.lastCubicControlPoint?t.plus(t.minus(this.lastCubicControlPoint)):t},getRelativePoint:function(){var t=this.getLastPoint();return t?t:r.ZERO}},l.rectangle=function(t,e,i,n){return(new l).rect(t,e,i,n)},l.rect=l.rectangle,l.roundRect=function(t,e,i,n,r,s){return(new l).roundRect(t,e,i,n,r,s)},l.roundRectangle=l.roundRect,l.polygon=function(t){return(new l).polygon(t)},l.bounds=function(t){return(new l).rect(t.minX,t.minY,t.maxX-t.minX,t.maxY-t.minY)},l.lineSegment=function(t,e,i,n){return"number"==typeof t?(new l).moveTo(t,e).lineTo(i,n):(new l).moveToPoint(t).lineToPoint(e)},l.regularPolygon=function(t,e){var i=new l;return _.each(_.range(t),function(n){var s=r.createPolar(e,2*Math.PI*n/t);0===n?i.moveToPoint(s):i.lineToPoint(s)}),i.close()},l.circle=function(t,e,i){return void 0===e?(new l).circle(0,0,t):(new l).circle(t,e,i).close()},l.ellipse=function(t,e,i,n,r){return void 0===n?(new l).ellipse(0,0,t,e,i):(new l).ellipse(t,e,i,n,r).close()},l.arc=function(t,e,i,n,r,s){return(new l).arc(t,e,i,n,r,s)},l}),i("SCENERY/util/RendererSummary",["require","PHET_CORE/inherit","SCENERY/scenery"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=[i.bitmaskSupportsCanvas,i.bitmaskSupportsSVG,i.bitmaskSupportsDOM,i.bitmaskSupportsWebGL,i.bitmaskSupportsPixi,i.bitmaskNotPainted,i.bitmaskBoundsValid],r=n.length;i.RendererSummary=function(t){this.node=t;for(var e=0;r>e;e++){var s=n[e];this[s]=0===(i.bitmaskNodeDefault&s)?1:0}this.bitmask=this.computeBitmask()};var s=i.RendererSummary;return e(Object,s,{computeBitmask:function(){for(var t=0,e=0;r>e;e++){var i=n[e];this[i]||(t|=i)}return t},bitIncrement:function(t){var e=++this[t];1===e&&this.notifyBitUnset(t)},bitDecrement:function(t){var e=--this[t];0===e&&this.notifyBitSet(t)},notifyBitSet:function(t){this.bitmask=this.computeBitmask(),this.node.trigger0("rendererSummary");for(var e=this.node._parents.length,i=0;e>i;i++)this.node._parents[i]._rendererSummary.bitDecrement(t)},notifyBitUnset:function(t){this.bitmask=this.computeBitmask(),this.node.trigger0("rendererSummary");for(var e=this.node._parents.length,i=0;e>i;i++)this.node._parents[i]._rendererSummary.bitIncrement(t)},bitmaskChange:function(t,e){for(var i=t^e,s=0;r>s;s++){var a=n[s];if(0!==(a&i)){var o=a&e;0!==o?this.bitDecrement(a):this.bitIncrement(a)}}}}),s}),i("SCENERY/util/CanvasContextWrapper",["require","PHET_CORE/inherit","SCENERY/scenery"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery");i.CanvasContextWrapper=function(t,e){this.canvas=t,this.context=e,this.resetStyles()};var n=i.CanvasContextWrapper;return e(Object,n,{resetStyles:function(){this.fillStyle=void 0,this.strokeStyle=void 0,this.lineWidth=void 0,this.lineCap=void 0,this.lineJoin=void 0,this.lineDash=void 0,this.lineDashOffset=void 0,this.miterLimit=void 0,this.font=void 0,this.direction=void 0},setDimensions:function(t,e){this.canvas.width=t,this.canvas.height=e,this.resetStyles()},setFillStyle:function(t){this.fillStyle!==t&&(this.fillStyle=t,this.context.fillStyle=t&&t.getCanvasStyle?t.getCanvasStyle():t)},setStrokeStyle:function(t){this.strokeStyle!==t&&(this.strokeStyle=t,this.context.strokeStyle=t&&t.getCanvasStyle?t.getCanvasStyle():t)},setLineWidth:function(t){this.lineWidth!==t&&(this.lineWidth=t,this.context.lineWidth=t)},setLineCap:function(t){this.lineCap!==t&&(this.lineCap=t,this.context.lineCap=t)},setLineJoin:function(t){this.lineJoin!==t&&(this.lineJoin=t,this.context.lineJoin=t)},setMiterLimit:function(t){this.miterLimit!==t&&(this.miterLimit=t,this.context.miterLimit=t)},setLineDash:function(t){this.lineDash!==t&&(this.lineDash=t,this.context.setLineDash?this.context.setLineDash(null===t?[]:t):void 0!==this.context.mozDash?this.context.mozDash=t:void 0!==this.context.webkitLineDash&&(this.context.webkitLineDash=t?t:[]))},setLineDashOffset:function(t){this.lineDashOffset!==t&&(this.lineDashOffset=t,void 0!==this.context.lineDashOffset?this.context.lineDashOffset=t:void 0!==this.context.webkitLineDashOffset&&(this.context.webkitLineDashOffset=t))},setFont:function(t){this.font!==t&&(this.font=t,this.context.font=t)},setDirection:function(t){this.direction!==t&&(this.direction=t,this.context.direction=t)}}),n}),i("SCENERY/nodes/Node",["require","PHET_CORE/inherit","PHET_CORE/extend","AXON/Events","DOT/Bounds2","DOT/Transform3","DOT/Matrix3","DOT/Vector2","DOT/Util","KITE/Shape","SCENERY/scenery","SCENERY/util/RendererSummary","SCENERY/util/CanvasContextWrapper"],function(t){function e(t,e,i){m.prototype[t]=function(){return this.getBounds()[t]()},m.prototype[e]=function(e){return this.translate(e.minus(this[t]()),!0),this},Object.defineProperty(m.prototype,i,{set:m.prototype[e],get:m.prototype[t]})}var i=t("PHET_CORE/inherit"),n=t("PHET_CORE/extend"),r=t("AXON/Events"),s=t("DOT/Bounds2"),a=t("DOT/Transform3"),o=t("DOT/Matrix3"),h=t("DOT/Vector2"),l=t("DOT/Util").clamp,u=(t("KITE/Shape"),t("SCENERY/scenery"));t("SCENERY/util/RendererSummary"),t("SCENERY/util/CanvasContextWrapper");var c=1,d={childBounds:!0,localBounds:!0,bounds:!0},f={};u.Node=function(t){var e=this;r.call(this),this._id=c++,this._instances=[],this._drawables=[],this._visible=!0,this._opacity=1,this._pickable=null,this._clipArea=null,this._mouseArea=null,this._touchArea=null,this._cursor=null,this._children=[],this._parents=[],this._peers=[],this._liveRegions=[],this._transformBounds=!1,this._transform=new a,this._transformListener={before:function(){e.beforeTransformChange()},after:function(){e.afterTransformChange()}},this._transform.addTransformListener(this._transformListener),this._inputListeners=[],this._bounds=s.NOTHING,this._localBounds=s.NOTHING,this._selfBounds=s.NOTHING,this._childBounds=s.NOTHING,this._localBoundsOverridden=!1,this._boundsDirty=!0,this._localBoundsDirty=!0,this._childBoundsDirty=!0,this._mouseBounds=s.NOTHING.copy(),this._touchBounds=s.NOTHING.copy(),this._mouseBoundsDirty=!0,this._touchBoundsDirty=!0,this._mouseBoundsHadListener=!1,this._touchBoundsHadListener=!1,this._hints={renderer:0,usesOpacity:!1,layerSplit:!1,cssTransform:!1,fullResolution:!1},this._subtreePickableCount=0,this._rendererBitmask=u.bitmaskNodeDefault,this._rendererSummary=new u.RendererSummary(this),this._boundsEventCount=0,this._boundsEventSelfCount=0,t&&this.mutate(t)};var m=u.Node;return i(Object,m,n({insertChild:function(t,e){this.changePickableCount(e._subtreePickableCount),this.changeBoundsEventCount(e._boundsEventCount>0?1:0),this._rendererSummary.bitmaskChange(u.bitmaskAll,e._rendererSummary.bitmask),e._parents.push(this),this._children.splice(t,0,e),e.invalidateBounds(),this._boundsDirty=!0,this.trigger2("childInserted",e,t)},addChild:function(t){this.insertChild(this._children.length,t)},removeChild:function(t){var e=_.indexOf(this._children,t);this.removeChildWithIndex(t,e)},removeChildAt:function(t){var e=this._children[t];this.removeChildWithIndex(e,t)},removeChildWithIndex:function(t,e){this.changePickableCount(-t._subtreePickableCount),this.changeBoundsEventCount(t._boundsEventCount>0?-1:0),this._rendererSummary.bitmaskChange(t._rendererSummary.bitmask,u.bitmaskAll);var i=_.indexOf(t._parents,this);t._parents.splice(i,1),this._children.splice(e,1),this.invalidateBounds(),this._childBoundsDirty=!0,this.trigger2("childRemoved",t,e)},removeAllChildren:function(){this.setChildren([])},setChildren:function(t){if(this._children!==t){for(;this._children.length;)this.removeChild(this._children[this._children.length-1]);for(var e=t.length,i=0;e>i;i++)this.addChild(t[i])}},getChildren:function(){return this._children.slice(0)},getChildrenCount:function(){return this._children.length},getParents:function(){return this._parents.slice(0)},getParent:function(){return this._parents.length?this._parents[0]:null},getChildAt:function(t){return this._children[t]},indexOfParent:function(t){return _.indexOf(this._parents,t)},indexOfChild:function(t){return _.indexOf(this._children,t)},moveToFront:function(){var t=this;_.each(this._parents.slice(0),function(e){e.moveChildToFront(t)})},moveChildToFront:function(t){this.indexOfChild(t)!==this._children.length-1&&(this.removeChild(t),this.addChild(t))},moveToBack:function(){var t=this;_.each(this._parents.slice(0),function(e){e.moveChildToBack(t)})},moveChildToBack:function(t){0!==this.indexOfChild(t)&&(this.removeChild(t),this.insertChild(0,t))},detach:function(){var t=this;_.each(this._parents.slice(0),function(e){e.removeChild(t)})},changePickableCount:function(t){this._subtreePickableCount+=t;for(var e=this._parents.length,i=0;e>i;i++)this._parents[i].changePickableCount(t);this.invalidateMouseTouchBounds()},changeBoundsEventCount:function(t){if(0!==t){var e=0===this._boundsEventCount;this._boundsEventCount+=t;var i=0===this._boundsEventCount;if(e!==i)for(var n=e?1:-1,r=this._parents.length,s=0;r>s;s++)this._parents[s].changeBoundsEventCount(n)}},addPeer:function(t,e){this._peers.push({element:t,options:e})},addLiveRegion:function(t,e){this._liveRegions.push({property:t,options:e})},validateBounds:function(){var t,e=!1;if(this._childBoundsDirty){for(e=!0,t=this._children.length;t--;)this._children[t].validateBounds();var i=this._childBounds;for(this._childBounds=s.NOTHING.copy(),t=this._children.length;t--;)this._childBounds.includeBounds(this._children[t]._bounds);this._childBoundsDirty=!1,this._childBounds.equals(i)||this.trigger0("childBounds")}if(this._localBoundsDirty&&!this._localBoundsOverridden){e=!0,this._localBoundsDirty=!1;var n=this._localBounds;this._localBounds=this._selfBounds.union(this._childBounds),this.hasClipArea()&&this._localBounds.constrainBounds(this._clipArea.bounds),this._localBounds.equals(n)||(this.trigger0("localBounds"),this._boundsDirty=!0)}if(this._boundsDirty){e=!0,this._boundsDirty=!1;var r,a=this._bounds;if(this._transformBounds&&!this._transform.getMatrix().isAxisAligned()){var o=this._transform.getMatrix().copy();r=s.NOTHING.copy(),this._includeTransformedSubtreeBounds(o,r),this.hasClipArea()&&r.constrainBounds(this._clipArea.getBoundsWithTransform(o))}else r=this.localToParentBounds(this._localBounds);var h=!r.equals(a);if(h){for(this._bounds=r,t=this._parents.length;t--;)this._parents[t].invalidateBounds();this.trigger0("bounds")}}return(this._childBoundsDirty||this._boundsDirty)&&this.validateBounds(),e},_includeTransformedSubtreeBounds:function(t,e){this._selfBounds.isEmpty()||e.includeBounds(this.getTransformedSelfBounds(t));for(var i=this._children.length,n=0;i>n;n++){var r=this._children[n];t.multiplyMatrix(r._transform.getMatrix()),r._includeTransformedSubtreeBounds(t,e),t.multiplyMatrix(r._transform.getInverse())}return e},validateWatchedBounds:function(){for(;this.watchedBoundsScan(););},watchedBoundsScan:function(){if(0!==this._boundsEventSelfCount)return this.validateBounds();if(this._boundsEventCount>0&&this._childBoundsDirty){for(var t=!1,e=this._children.length,i=0;e>i;i++)t=this._children[i].watchedBoundsScan()||t;return t}return!1},validateMouseBounds:function(t){var e=this;if(t=t||this.hasInputListenerEquivalent(),this._mouseBoundsDirty||this._mouseBoundsHadListener!==t){if(this.isSubtreePickablePruned(t))this._mouseBounds.set(s.NOTHING);else{this._mouseBounds.set(this._selfBounds);for(var i=this._children.length;i--;){var n=this._children[i];n.validateMouseBounds(t),e._mouseBounds.includeBounds(n._mouseBounds)}this._mouseArea&&this._mouseBounds.includeBounds(this._mouseArea.isBounds?this._mouseArea:this._mouseArea.bounds),this.hasClipArea()&&this._mouseBounds.constrainBounds(this._clipArea.bounds),this.transformBoundsFromLocalToParent(this._mouseBounds)}this._mouseBoundsDirty=!1,this._mouseBoundsHadListener=t}},validateTouchBounds:function(t){var e=this;if(t=t||this.hasInputListenerEquivalent(),this._touchBoundsDirty||this._touchBoundsHadListener!==t){if(this.isSubtreePickablePruned(t))this._touchBounds.set(s.NOTHING);else{this._touchBounds.set(this._selfBounds);for(var i=this._children.length;i--;){var n=this._children[i];n.validateTouchBounds(t),e._touchBounds.includeBounds(n._touchBounds)}this._touchArea&&this._touchBounds.includeBounds(this._touchArea.isBounds?this._touchArea:this._touchArea.bounds),this.hasClipArea()&&this._touchBounds.constrainBounds(this._clipArea.bounds),this.transformBoundsFromLocalToParent(this._touchBounds)}this._touchBoundsDirty=!1,this._touchBoundsHadListener=t}},invalidateBounds:function(){this._boundsDirty=!0,this._localBoundsDirty=!0,this._mouseBoundsDirty=!0,this._touchBoundsDirty=!0;for(var t=this._parents.length;t--;)this._parents[t].invalidateChildBounds()},invalidateChildBounds:function(){if(!this._childBoundsDirty||!this._mouseBoundsDirty||!this._touchBoundsDirty){this._childBoundsDirty=!0,this._localBoundsDirty=!0,this._mouseBoundsDirty=!0,this._touchBoundsDirty=!0;for(var t=this._parents.length;t--;)this._parents[t].invalidateChildBounds()}},invalidateMouseTouchBounds:function(){if(!this._mouseBoundsDirty||!this._touchBoundsDirty){this._mouseBoundsDirty=!0,this._touchBoundsDirty=!0;for(var t=this._parents.length;t--;)this._parents[t].invalidateMouseTouchBounds()}},invalidateSelf:function(t){this._selfBounds.equals(t)||(this._localBoundsDirty=!0,this.invalidateBounds(),this._selfBounds=t,this.trigger0("selfBounds"))},isChild:function(t){{var e=_.contains(this._children,t);
_.contains(t._parents,this)}return e},getSelfBounds:function(){return this._selfBounds},getSafeSelfBounds:function(){return this._selfBounds},getChildBounds:function(){return this.validateBounds(),this._childBounds},getLocalBounds:function(){return this.validateBounds(),this._localBounds},setLocalBounds:function(t){if(null===t)this._localBoundsOverridden&&(this._localBoundsOverridden=!1,this.trigger1("localBoundsOverride",!1),this.invalidateBounds());else{var e=t!==this._localBounds||!this._localBoundsOverridden;e&&(this._localBounds=t),this._localBoundsOverridden||(this._localBoundsOverridden=!0,this.trigger1("localBoundsOverride",!0)),e&&this.invalidateBounds()}return this},getTransformedSelfBounds:function(t){return this._selfBounds.transformed(t)},setTransformBounds:function(t){this._transformBounds!==t&&(this._transformBounds=t,this.invalidateBounds())},getTransformBounds:function(){return this._transformBounds},getBounds:function(){return this.validateBounds(),this._bounds},getVisibleBounds:function(){for(var t=this._selfBounds.copy(),e=this._children.length;e--;){var i=this._children[e];i.isVisible()&&t.includeBounds(i.getVisibleBounds())}return this.localToParentBounds(t)},hasInputListenerEquivalent:function(){return this._inputListeners.length>0||this._pickable===!0},isSubtreePickablePruned:function(t){return!this.isVisible()||this._pickable===!1||this._pickable!==!0&&!t&&0===this._subtreePickableCount},trailUnderPointer:function(t){var e=f;return e.isMouse=!!t.isMouse,e.isTouch=!!t.isTouch,e.isPen=!!t.isPen,this.trailUnderPoint(t.point,e)},trailUnderPoint:function(t,e,i,n){if(n=n||this.hasInputListenerEquivalent(),this.isSubtreePickablePruned(n))return null;var r,s=e&&e.isMouse,a=e&&(e.isTouch||e.isPen);if(s?(!i&&this.validateMouseBounds(!1),r=this._mouseBounds):a?(!i&&this.validateTouchBounds(!1),r=this._touchBounds):(!i&&this.validateBounds(),r=this._bounds),!r.containsPoint(t))return null;var o=null,l=this._transform.getInverse().multiplyVector2(h.createFromPool(t.x,t.y));if(this.hasClipArea()&&!this._clipArea.containsPoint(l))return null;for(var c=this._children.length-1;c>=0;c--){var d=this._children[c],f=d.trailUnderPoint(l,e,!0,n);if(f)return f.addAncestor(this,c),l.freeToPool(),f}return s&&this._mouseArea?(o=this._mouseArea.containsPoint(l)?new u.Trail(this):null,l.freeToPool(),o):a&&this._touchArea?(o=this._touchArea.containsPoint(l)?new u.Trail(this):null,l.freeToPool(),o):this._selfBounds.containsPoint(l)&&this.containsPointSelf(l)?(l.freeToPool(),new u.Trail(this)):(l.freeToPool(),null)},containsPoint:function(t){return null!==this.trailUnderPoint(t)},containsPointSelf:function(t){return this._selfBounds.containsPoint(t)},intersectsBoundsSelf:function(t){return this._selfBounds.intersectsBounds(t)},isPainted:function(){return!1},hasParent:function(){return 0!==this._parents.length},hasChildren:function(){return this._children.length>0},walkDepthFirst:function(t){t(this);for(var e=this._children.length,i=0;e>i;i++)this._children[i].walkDepthFirst(t)},getChildrenWithinBounds:function(t){for(var e=[],i=this._children.length,n=0;i>n;n++){var r=this._children[n];r._bounds.intersection(t).isEmpty()||e.push(r)}return e},addInputListener:function(t){return-1===_.indexOf(this._inputListeners,t)&&(this._inputListeners.push(t),this.changePickableCount(1)),this},removeInputListener:function(t){return this._inputListeners.splice(_.indexOf(this._inputListeners,t),1),this.changePickableCount(-1),this},getInputListeners:function(){return this._inputListeners.slice(0)},translate:function(t,e,i){if("number"==typeof t){if(!t&&!e)return;i?this.prependTranslation(t,e):this.appendMatrix(o.translation(t,e))}else{var n=t;if(!n.x&&!n.y)return;this.translate(n.x,n.y,e)}},scale:function(t,e,i){if("number"==typeof t)if(void 0===e){if(1===t)return;this.appendMatrix(o.scaling(t,t))}else{if(1===t&&1===e)return;i?this.prependMatrix(o.scaling(t,e)):this.appendMatrix(o.scaling(t,e))}else{var n=t;this.scale(n.x,n.y,e)}},rotate:function(t,e){t%(2*Math.PI)!==0&&(e?this.prependMatrix(o.rotation2(t)):this.appendMatrix(o.rotation2(t)))},rotateAround:function(t,e){var i=o.translation(-t.x,-t.y);i=o.rotation2(e).timesMatrix(i),i=o.translation(t.x,t.y).timesMatrix(i),this.prependMatrix(i)},getX:function(){return this._transform.getMatrix().m02()},setX:function(t){return this.translate(t-this.getX(),0,!0),this},getY:function(){return this._transform.getMatrix().m12()},setY:function(t){return this.translate(0,t-this.getY(),!0),this},getScaleVector:function(){return this._transform.getMatrix().getScaleVector()},setScaleMagnitude:function(t,e){var i=this.getScaleVector();return"number"==typeof t?(void 0===e&&(e=t),this.appendMatrix(o.scaling(t/i.x,e/i.y))):this.appendMatrix(o.scaling(t.x/i.x,t.y/i.y)),this},getRotation:function(){return this._transform.getMatrix().getRotation()},setRotation:function(t){return this.appendMatrix(o.rotation2(t-this.getRotation())),this},setTranslation:function(t,e){var i,n,r=this._transform.getMatrix(),s=r.m02(),a=r.m12();return"number"==typeof t?(i=t-s,n=e-a):(i=t.x-s,n=t.y-a),this.translate(i,n,!0),this},getTranslation:function(){var t=this._transform.getMatrix();return new h(t.m02(),t.m12())},appendMatrix:function(t){this._transform.append(t)},prependMatrix:function(t){this._transform.prepend(t)},prependTranslation:function(t,e){this._transform.prependTranslation(t,e)},setMatrix:function(t){this._transform.setMatrix(t)},getMatrix:function(){return this._transform.getMatrix()},setTransform:function(t){this._transform!==t&&(this.beforeTransformChange(),this._transform.removeTransformListener(this._transformListener),this._transform=t,this._transform.prependTransformListener(this._transformListener),this.afterTransformChange())},getTransform:function(){return this._transform},resetTransform:function(){this.setMatrix(o.IDENTITY)},beforeTransformChange:function(){},afterTransformChange:function(){this.invalidateBounds(),this.trigger0("transform")},getLeft:function(){return this.getBounds().minX},setLeft:function(t){return this.translate(t-this.getLeft(),0,!0),this},getRight:function(){return this.getBounds().maxX},setRight:function(t){return this.translate(t-this.getRight(),0,!0),this},getCenterX:function(){return this.getBounds().getCenterX()},setCenterX:function(t){return this.translate(t-this.getCenterX(),0,!0),this},getCenterY:function(){return this.getBounds().getCenterY()},setCenterY:function(t){return this.translate(0,t-this.getCenterY(),!0),this},getTop:function(){return this.getBounds().minY},setTop:function(t){return this.translate(0,t-this.getTop(),!0),this},getBottom:function(){return this.getBounds().maxY},setBottom:function(t){return this.translate(0,t-this.getBottom(),!0),this},getWidth:function(){return this.getBounds().getWidth()},getHeight:function(){return this.getBounds().getHeight()},getId:function(){return this._id},isVisible:function(){return this._visible},setVisible:function(t){return t!==this._visible&&(this.invalidateMouseTouchBounds(),this._visible=t,this.trigger0("visibility")),this},getOpacity:function(){return this._opacity},setOpacity:function(t){var e=l(t,0,1);e!==this._opacity&&(this._opacity=e,this.trigger0("opacity"))},isPickable:function(){return this._pickable},setPickable:function(t){if(this._pickable!==t){var e=this._pickable===!0?-1:0;this._pickable=t,e+=this._pickable===!0?1:0,e&&this.changePickableCount(e)}},setCursor:function(t){this._cursor="auto"===t?null:t},getCursor:function(){return this._cursor},setMouseArea:function(t){this._mouseArea!==t&&(this._mouseArea=t,this.invalidateMouseTouchBounds())},getMouseArea:function(){return this._mouseArea},setTouchArea:function(t){this._touchArea!==t&&(this._touchArea=t,this.invalidateMouseTouchBounds())},getTouchArea:function(){return this._touchArea},setClipArea:function(t){this._clipArea!==t&&(this._clipArea=t,this.trigger0("clip"),this.invalidateBounds())},getClipArea:function(){return this._clipArea},hasClipArea:function(){return null!==this._clipArea},supportsCanvas:function(){return 0!==(this._rendererBitmask&u.bitmaskSupportsCanvas)},supportsSVG:function(){return 0!==(this._rendererBitmask&u.bitmaskSupportsSVG)},supportsDOM:function(){return 0!==(this._rendererBitmask&u.bitmaskSupportsDOM)},supportsWebGL:function(){return 0!==(this._rendererBitmask&u.bitmaskSupportsWebGL)},supportsPixi:function(){return 0!==(this._rendererBitmask&u.bitmaskSupportsPixi)},supportsRenderer:function(t){return 0!==(this._rendererBitmask&t.bitmask)},pickARenderer:function(){return this.supportsCanvas()?u.Renderer.Canvas:this.supportsSVG()?u.Renderer.SVG:this.supportsDOM()?u.Renderer.DOM:void 0},setRendererBitmask:function(t){t!==this._rendererBitmask&&(this._rendererSummary.bitmaskChange(this._rendererBitmask,t),this._rendererBitmask=t,this.trigger0("rendererBitmask"))},invalidateSupportedRenderers:function(){},setRenderer:function(t){var e=0;"canvas"===t?e=u.Renderer.bitmaskCanvas:"svg"===t?e=u.Renderer.bitmaskSVG:"dom"===t?e=u.Renderer.bitmaskDOM:"webgl"===t?e=u.Renderer.bitmaskWebGL:"pixi"===t&&(e=u.Renderer.bitmaskPixi),this._hints.renderer!==e&&(this._hints.renderer=e,this.trigger1("hint","renderer"))},getRenderer:function(){return 0===this._hints.renderer?null:this._hints.renderer===u.Renderer.bitmaskCanvas?"canvas":this._hints.renderer===u.Renderer.bitmaskSVG?"svg":this._hints.renderer===u.Renderer.bitmaskDOM?"dom":this._hints.renderer===u.Renderer.bitmaskWebGL?"webgl":this._hints.renderer===u.Renderer.bitmaskPixi?"pixi":this._hints.renderer},hasRenderer:function(){return!!this._hints.renderer},setRendererOptions:function(t){_.extend(this._hints,t),this.trigger0("hint")},getRendererOptions:function(){return this._hints},hasRendererOptions:function(){return!(!this._hints.cssTransform&&!this._hints.fullResolution)},setLayerSplit:function(t){t!==this._hints.layerSplit&&(this._hints.layerSplit=t,this.trigger1("hint","layerSplit"))},isLayerSplit:function(){return this._hints.layerSplit},setUsesOpacity:function(t){t!==this._hints.usesOpacity&&(this._hints.usesOpacity=t,this.trigger1("hint","usesOpacity"))},getUsesOpacity:function(){return this._hints.usesOpacity},getUniqueTrail:function(){for(var t=new u.Trail,e=this;e;)t.addAncestor(e),e=e._parents[0];return t},getConnectedNodes:function(){for(var t=[],e=this._children.concat(this._parents).concat(this);e.length;){var i=e.pop();_.contains(t,i)||(t.push(i),e=e.concat(i._children,i._parents))}return t},getTopologicallySortedNodes:function(){function t(t){delete i[e.id][t.id],_.every(i,function(e){return!e[t.id]})&&n.push(t)}var e,i={},n=[],r=[];for(_.each(this.getConnectedNodes(),function(t){i[t.id]={},_.each(t.children,function(e){i[t.id][e.id]=!0}),t.parents.length||n.push(t)});n.length;)e=n.pop(),r.push(e),_.each(e.children,t);return r},canAddChild:function(t){function e(t){delete n[i.id][t.id],_.every(n,function(e){return!e[t.id]})&&r.push(t)}if(this===t||_.contains(this.children,t))return!1;var i,n={},r=[],s=[];for(_.each(this.getConnectedNodes().concat(t.getConnectedNodes()),function(e){n[e.id]={},_.each(e.children,function(t){n[e.id][t.id]=!0}),e.parents.length||e===t||r.push(e)}),n[this.id][t.id]=!0;r.length;)i=r.pop(),s.push(i),_.each(i.children,e),i===this&&e(t);return _.every(n,function(t){return _.every(t,function(){return!1})})},canvasPaintSelf:function(){},renderToCanvasSelf:function(t){this.isPainted()&&this._rendererBitmask&u.Renderer.bitmaskCanvas&&this.canvasPaintSelf(t)},renderToCanvasSubtree:function(t,e){e=e||o.identity(),t.resetStyles(),this.renderToCanvasSelf(t);for(var i=0;i<this._children.length;i++){var n=this._children[i];if(n.isVisible()){var r=1!==n._opacity||n._clipArea;if(t.context.save(),e.multiplyMatrix(n._transform.getMatrix()),e.canvasSetTransform(t.context),r){var s=document.createElement("canvas");s.width=t.canvas.width,s.height=t.canvas.height;var a=s.getContext("2d"),h=new u.CanvasContextWrapper(s,a);e.canvasSetTransform(a),n.renderToCanvasSubtree(h,e),t.context.save(),n._clipArea&&(t.context.beginPath(),n._clipArea.writeToContext(t.context),t.context.clip()),t.context.setTransform(1,0,0,1,0,0),t.context.globalAlpha=n._opacity,t.context.drawImage(s,0,0),t.context.restore()}else n.renderToCanvasSubtree(t,e);e.multiplyMatrix(n._transform.getInverse()),t.context.restore()}}},renderToCanvas:function(t,e,i,n){t.width=t.width,n&&(e.fillStyle=n,e.fillRect(0,0,t.width,t.height));var r=new u.CanvasContextWrapper(t,e);this.renderToCanvasSubtree(r,o.identity()),i&&i()},toCanvas:function(t,e,i,n,r){var s=2,a=this.getBounds().union(this.localToParentBounds(this.getSafeSelfBounds()));e=void 0!==e?e:Math.ceil(s-a.minX),i=void 0!==i?i:Math.ceil(s-a.minY),n=void 0!==n?n:Math.ceil(a.getWidth()+2*s),r=void 0!==r?r:Math.ceil(a.getHeight()+2*s);var h=document.createElement("canvas");h.width=n,h.height=r;var l=h.getContext("2d");l.translate(e,i),this._transform.getMatrix().canvasAppendTransform(l);var c=new u.CanvasContextWrapper(h,l);this.renderToCanvasSubtree(c,o.translation(e,i).timesMatrix(this._transform.getMatrix())),t(h,e,i)},toDataURL:function(t,e,i,n,r){this.toCanvas(function(e,i,n){t(e.toDataURL(),i,n)},e,i,n,r)},toImage:function(t,e,i,n,r){this.toDataURL(function(e,i,n){var r=document.createElement("img");r.onload=function(){t(r,i,n);try{delete r.onload}catch(e){}},r.src=e},e,i,n,r)},toImageNodeAsynchronous:function(t,e,i,n,r){this.toImage(function(e,i,n){t(new u.Node({children:[new u.Image(e,{x:-i,y:-n})]}))},e,i,n,r)},toCanvasNodeSynchronous:function(t,e,i,n){var r;return this.toCanvas(function(t,e,i){r=new u.Node({children:[new u.Image(t,{x:-e,y:-i})]})},t,e,i,n),r},toDataURLNodeSynchronous:function(t,e,i,n){var r;return this.toDataURL(function(t,e,i){r=new u.Node({children:[new u.Image(t,{x:-e,y:-i})]})},t,e,i,n),r},getInstances:function(){return this._instances},addInstance:function(t){this._instances.push(t),1===this._instances.length&&this.firstInstanceAdded()},removeInstance:function(t){var e=_.indexOf(this._instances,t);this._instances.splice(e,1),0===this._instances.length&&this.lastInstanceRemoved()},firstInstanceAdded:function(){},lastInstanceRemoved:function(){},localToParentPoint:function(t){return this._transform.transformPosition2(t)},localToParentBounds:function(t){return this._transform.transformBounds2(t)},parentToLocalPoint:function(t){return this._transform.inversePosition2(t)},parentToLocalBounds:function(t){return this._transform.inverseBounds2(t)},transformBoundsFromLocalToParent:function(t){return t.transform(this._transform.getMatrix())},transformBoundsFromParentToLocal:function(t){return t.transform(this._transform.getInverse())},getLocalToGlobalMatrix:function(){for(var t=this,e=[];t;)e.push(t._transform.getMatrix()),t=t._parents[0];for(var i=o.identity(),n=e.length-1;n>=0;n--)i.multiplyMatrix(e[n]);return i},getUniqueTransform:function(){return new a(this.getLocalToGlobalMatrix())},getGlobalToLocalMatrix:function(){return this.getLocalToGlobalMatrix().invert()},localToGlobalPoint:function(t){for(var e=this,i=t.copy();e;)e._transform.getMatrix().multiplyVector2(i),e=e._parents[0];return i},globalToLocalPoint:function(t){for(var e=this,i=[];e;)i.push(e._transform),e=e._parents[0];for(var n=t.copy(),r=i.length-1;r>=0;r--)i[r].getInverse().multiplyVector2(n);return n},localToGlobalBounds:function(t){return t.transformed(this.getLocalToGlobalMatrix())},globalToLocalBounds:function(t){return t.transformed(this.getGlobalToLocalMatrix())},parentToGlobalPoint:function(t){return this.parents.length?this.parents[0].localToGlobalPoint(t):t},parentToGlobalBounds:function(t){return this.parents.length?this.parents[0].localToGlobalBounds(t):t},globalToParentPoint:function(t){return this.parents.length?this.parents[0].globalToLocalPoint(t):t},globalToParentBounds:function(t){return this.parents.length?this.parents[0].globalToLocalBounds(t):t},getGlobalBounds:function(){return this.parentToGlobalBounds(this.getBounds())},boundsOf:function(t){return this.globalToLocalBounds(t.getGlobalBounds())},boundsTo:function(t){return t.globalToLocalBounds(this.getGlobalBounds())},attachDrawable:function(t){return this._drawables.push(t),t.onAttach(this),this},detachDrawable:function(t){t.onDetach(this);var e=_.indexOf(this._drawables,t);return this._drawables.splice(e,1),this},requiresSafeBounds:!1,set layerSplit(t){this.setLayerSplit(t)},get layerSplit(){return this.isLayerSplit()},set renderer(t){this.setRenderer(t)},get renderer(){return this.getRenderer()},set rendererOptions(t){this.setRendererOptions(t)},get rendererOptions(){return this.getRendererOptions()},set usesOpacity(t){this.setUsesOpacity(t)},get usesOpacity(){return this.getUsesOpacity()},set cursor(t){this.setCursor(t)},get cursor(){return this.getCursor()},set mouseArea(t){this.setMouseArea(t)},get mouseArea(){return this.getMouseArea()},set touchArea(t){this.setTouchArea(t)},get touchArea(){return this.getTouchArea()},set clipArea(t){this.setClipArea(t)},get clipArea(){return this.getClipArea()},set visible(t){this.setVisible(t)},get visible(){return this.isVisible()},set opacity(t){this.setOpacity(t)},get opacity(){return this.getOpacity()},set pickable(t){this.setPickable(t)},get pickable(){return this.isPickable()},set transform(t){this.setTransform(t)},get transform(){return this.getTransform()},set matrix(t){this.setMatrix(t)},get matrix(){return this.getMatrix()},set translation(t){this.setTranslation(t)},get translation(){return this.getTranslation()},set rotation(t){this.setRotation(t)},get rotation(){return this.getRotation()},set x(t){this.setX(t)},get x(){return this.getX()},set y(t){this.setY(t)},get y(){return this.getY()},set left(t){this.setLeft(t)},get left(){return this.getLeft()},set right(t){this.setRight(t)},get right(){return this.getRight()},set top(t){this.setTop(t)},get top(){return this.getTop()},set bottom(t){this.setBottom(t)},get bottom(){return this.getBottom()},set centerX(t){this.setCenterX(t)},get centerX(){return this.getCenterX()},set centerY(t){this.setCenterY(t)},get centerY(){return this.getCenterY()},set children(t){this.setChildren(t)},get children(){return this.getChildren()},get parents(){return this.getParents()},get width(){return this.getWidth()},get height(){return this.getHeight()},get bounds(){return this.getBounds()},get selfBounds(){return this.getSelfBounds()},get childBounds(){return this.getChildBounds()},get localBounds(){return this.getLocalBounds()},set localBounds(t){return this.setLocalBounds(t)},set transformBounds(t){return this.setTransformBounds(t)},get transformBounds(){return this.getTransformBounds()},get globalBounds(){return this.getGlobalBounds()},get visibleBounds(){return this.getVisibleBounds()},get id(){return this.getId()},get instances(){return this.getInstances()},mutate:function(t){if(!t)return this;var e=this;return _.each(this._mutatorKeys,function(i){if(void 0!==t[i]){var n=Object.getOwnPropertyDescriptor(m.prototype,i);n&&"function"==typeof n.value?e[i](t[i]):e[i]=t[i]}}),this},getDebugHTMLExtras:function(){return""},toString:function(t,e){t=t||"";var i=this.getPropString(t+"  ",void 0===e?!0:e);return t+this.getBasicConstructor(i?"\n"+i+"\n"+t:"")},getBasicConstructor:function(t){return"new scenery.Node( {"+t+"} )"},getPropString:function(t,e){function i(e,i,r){n&&(n+=",\n"),n+=r||"string"!=typeof i?t+e+": "+i:t+e+": '"+i+"'"}var n="";if(this._children.length&&e){var r="";_.each(this._children,function(e){r&&(r+=",\n"),r+=e.toString(t+"  ")}),i("children","[\n"+r+"\n"+t+"]",!0)}if(this.cursor&&i("cursor",this.cursor),this.visible||i("visible",this.visible),null!==this.pickable&&i("pickable",this.pickable),1!==this.opacity&&i("opacity",this.opacity),!this.transform.isIdentity()){var s=this.transform.getMatrix();i("matrix","dot.Matrix3.createFromPool("+s.m00()+", "+s.m01()+", "+s.m02()+", "+s.m10()+", "+s.m11()+", "+s.m12()+", "+s.m20()+", "+s.m21()+", "+s.m22()+" )",!0)}return this.renderer&&(i("renderer",this.renderer.name),this.rendererOptions),this._hints.layerSplit&&i("layerSplit",!0),n},addEventListener:function(t,e){return this.on(t,e)},removeEventListener:function(t,e){return this.off(t,e)},containsEventListener:function(t,e){return this.hasListener(t,e)},onEventListenerAdded:function(t){t in d&&(this.changeBoundsEventCount(1),this._boundsEventSelfCount++)},onEventListenerRemoved:function(t){t in d&&(this.changeBoundsEventCount(-1),this._boundsEventSelfCount--)}},r.prototype,{on:function(t,e){r.prototype.on.call(this,t,e),this.onEventListenerAdded(t,e)},onStatic:function(t,e){r.prototype.onStatic.call(this,t,e),this.onEventListenerAdded(t,e)},off:function(t,e){var i=r.prototype.off.call(this,t,e);return this.onEventListenerRemoved(t,e),i},offStatic:function(t,e){var i=r.prototype.offStatic.call(this,t,e);return this.onEventListenerRemoved(t,e),i}})),e("getLeftTop","setLeftTop","leftTop"),e("getCenterTop","setCenterTop","centerTop"),e("getRightTop","setRightTop","rightTop"),e("getLeftCenter","setLeftCenter","leftCenter"),e("getCenter","setCenter","center"),e("getRightCenter","setRightCenter","rightCenter"),e("getLeftBottom","setLeftBottom","leftBottom"),e("getCenterBottom","setCenterBottom","centerBottom"),e("getRightBottom","setRightBottom","rightBottom"),m.prototype._mutatorKeys=["children","cursor","visible","pickable","opacity","matrix","translation","x","y","rotation","scale","leftTop","centerTop","rightTop","leftCenter","center","rightCenter","leftBottom","centerBottom","rightBottom","left","right","top","bottom","centerX","centerY","renderer","rendererOptions","layerSplit","usesOpacity","mouseArea","touchArea","clipArea","transformBounds","focusable"],m}),i("SCENERY/display/Renderer",["require","SCENERY/scenery"],function(t){var e=t("SCENERY/scenery");e.Renderer={};var i=e.Renderer;i.bitmaskRendererArea=e.bitmaskRendererArea,i.bitmaskCanvas=e.bitmaskSupportsCanvas,i.bitmaskSVG=e.bitmaskSupportsSVG,i.bitmaskDOM=e.bitmaskSupportsDOM,i.bitmaskWebGL=e.bitmaskSupportsWebGL,i.bitmaskPixi=e.bitmaskSupportsPixi,i.bitmaskFitting=768,i.bitmaskFitFullScene=0,i.bitmaskFitLoose=256,i.bitmaskFitTight=512,i.bitmaskFitHybrid=768,i.bitmaskForceAcceleration=1024,i.bitmaskSkipBounds=2048,i.bitmaskCanvasLowResolution=4096,i.bitmaskCanvasNoPruning=8192,i.bitmaskCanvasNoDirtyBounds=16384,i.bitmaskCanvasBeforeAfterBounds=32768,i.bitmaskSVGOptimizations=196608,i.bitmaskSVGOptimizeAuto=0,i.bitmaskSVGOptimizeSpeed=65536,i.bitmaskSVGOptimizeQuality=131072,i.bitmaskSVGOptimizeCrisp=196608,i.bitmaskSVGCollapse=262144,i.isCanvas=function(t){return 0!==(t&i.bitmaskCanvas)},i.isSVG=function(t){return 0!==(t&i.bitmaskSVG)},i.isDOM=function(t){return 0!==(t&i.bitmaskDOM)},i.isWebGL=function(t){return 0!==(t&i.bitmaskWebGL)},i.isPixi=function(t){return 0!==(t&i.bitmaskPixi)};var n={canvas:i.bitmaskCanvas,svg:i.bitmaskSVG,dom:i.bitmaskDOM,webgl:i.bitmaskWebGL,pixi:i.bitmaskPixi};return i.fromName=function(t){return n[t]},i.getStrippedBitmask=function(t){return t&i.bitmaskRendererArea},i.getFitStrategy=function(t){return i.fitStrategies[t&i.bitmaskFitting]},i.isAccelerationForced=function(t){return 0!==(t&i.bitmaskForceAcceleration)},i.isSkipBounds=function(t){return 0!==(t&i.bitmaskSkipBounds)},i.isCanvasLowResolution=function(t){return 0!==(t&i.bitmaskCanvasLowResolution)},i.isCanvasNoPruning=function(t){return 0!==(t&i.bitmaskCanvasNoPruning)},i.isCanvasNoDirtyBounds=function(t){return 0!==(t&i.bitmaskCanvasNoDirtyBounds)},i.isCanvasBeforeAfterBounds=function(t){return 0!==(t&i.bitmaskCanvasBeforeAfterBounds)},i.getSVGOptimizations=function(t){return i.svgOptimizations[t&i.bitmaskSVGOptimizations]},i.createOrderBitmask=function(t,e,i,n,r){return t=t||0,e=e||0,i=i||0,n=n||0,r=r||0,t|e<<5|i<<10|n<<15|r<<20},i.bitmaskOrderFirst=function(t){return 31&t},i.bitmaskOrderSecond=function(t){return t>>5&31},i.bitmaskOrderThird=function(t){return t>>10&31},i.bitmaskOrderFourth=function(t){return t>>15&31},i.bitmaskOrderFifth=function(t){return t>>20&31},i.pushOrderBitmask=function(t,e){for(var i=e,n=0;30>n;n+=5){var r=t>>n&31;if(r===i)return t;if(0===r)return t|=i<<n;if(t&=~(31<<n),t|=i<<n,i=r,i===e)return t}throw new Error("pushOrderBitmask overflow")},i.createSelfDrawable=function(t,e,n){if(i.isCanvas(n))return e.createCanvasDrawable(n,t);if(i.isSVG(n))return e.createSVGDrawable(n,t);if(i.isDOM(n))return e.createDOMDrawable(n,t);if(i.isWebGL(n))return e.createWebGLDrawable(n,t);if(i.isPixi(n))return e.createPixiDrawable(n,t);throw new Error("Unrecognized renderer: "+n)},i.fitStrategies={},i.fitStrategies.bitmaskFitFullScene=function(){},i.fitStrategies.bitmaskFitLoose=function(){},i.fitStrategies.bitmaskFitTight=function(){},i.fitStrategies.bitmaskFitHybrid=function(){},i.svgOptimizations={},i.svgOptimizations.bitmaskSVGOptimizeAuto={text:"auto",shape:"auto",image:"auto"},i.svgOptimizations.bitmaskSVGOptimizeSpeed={text:"optimizeSpeed",shape:"optimizeSpeed",image:"optimizeSpeed"},i.svgOptimizations.bitmaskSVGOptimizeQuality={text:"geometricPrecision",shape:"optimizeQuality",image:"optimizeQuality"},i.svgOptimizations.bitmaskSVGOptimizeCrisp={text:"optimizeLegibility",shape:"crispEdges",image:"optimizeQuality"},i}),i("SCENERY/util/Color",["require","PHET_CORE/inherit","SCENERY/scenery","DOT/Util","DOT/Util"],function(t){function e(t){var e=1;return"%"===t.charAt(t.length-1)&&(e=2.55,t=t.slice(0,t.length-1)),Math.round(parseInt(t,10)*e)}var i=t("PHET_CORE/inherit"),n=t("SCENERY/scenery"),r=t("DOT/Util").clamp,s=t("DOT/Util").linear;n.Color=function u(t,e,i,n){if(this.listeners=[],"string"==typeof t)this.setCSS(t);else if(t instanceof u)this.setRGBA(t.r,t.g,t.b,t.a);else{var r=void 0===n?1:n;void 0===e||void 0===i?this.setRGBA(t>>16&&255,t>>8&&255,t>>0&&255,r):this.setRGBA(t,e,i,r)}};var a=n.Color,o="(-?\\d{1,3}%?)",h="(\\d+|\\d*\\.\\d+)",l="(\\d{1,3})";return a.formatParsers=[{regexp:/^transparent$/,apply:function(t){t.setRGBA(0,0,0,0)}},{regexp:/^#(\w{1})(\w{1})(\w{1})$/,apply:function(t,e){t.setRGBA(parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),1)}},{regexp:/^#(\w{2})(\w{2})(\w{2})$/,apply:function(t,e){t.setRGBA(parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),1)}},{regexp:new RegExp("^rgb\\("+o+","+o+","+o+"\\)$"),apply:function(t,i){t.setRGBA(e(i[1]),e(i[2]),e(i[3]),1)}},{regexp:new RegExp("^rgba\\("+o+","+o+","+o+","+h+"\\)$"),apply:function(t,i){t.setRGBA(e(i[1]),e(i[2]),e(i[3]),parseFloat(i[4]))}},{regexp:new RegExp("^hsl\\("+l+","+l+"%,"+l+"%\\)$"),apply:function(t,e){t.setHSLA(parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3],10),1)}},{regexp:new RegExp("^hsla\\("+l+","+l+"%,"+l+"%,"+h+"\\)$"),apply:function(t,e){t.setHSLA(parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3],10),parseFloat(e[4]))}}],a.hueToRGB=function(t,e,i){return 0>i&&(i+=1),i>1&&(i-=1),1>6*i?t+(e-t)*i*6:1>2*i?e:2>3*i?t+(e-t)*(2/3-i)*6:t},a.toColor=function(t){return t instanceof a?t:new a(t)},i(Object,a,{copy:function(){return new a(this.r,this.g,this.b,this.a)},getRed:function(){return this.r},setRed:function(t){return this.setRGBA(t,this.g,this.b,this.a)},get red(){return this.getRed()},set red(t){return this.setRed(t)},getGreen:function(){return this.g},setGreen:function(t){return this.setRGBA(this.r,t,this.b,this.a)},get green(){return this.getGreen()},set green(t){return this.setGreen(t)},getBlue:function(){return this.b},setBlue:function(t){return this.setRGBA(this.r,this.g,t,this.a)},get blue(){return this.getBlue()},set blue(t){return this.setBlue(t)},getAlpha:function(){return this.a},setAlpha:function(t){return this.setRGBA(this.r,this.g,this.b,t)},get alpha(){return this.getAlpha()},set alpha(t){return this.setAlpha(t)},setRGBA:function(t,e,i,n){return this.r=Math.round(r(t,0,255)),this.g=Math.round(r(e,0,255)),this.b=Math.round(r(i,0,255)),this.a=r(n,0,1),this.updateColor(),this},computeCSS:function(){if(1===this.a)return"rgb("+this.r+","+this.g+","+this.b+")";var t=0===this.a||1===this.a?this.a:this.a.toFixed(20);return"rgba("+this.r+","+this.g+","+this.b+","+t+")"},toCSS:function(){return this._css},setCSS:function(t){var e=t.replace(/ /g,"").toLowerCase(),i=!1,n=a.colorKeywords[e];n&&(e="#"+n);for(var r=0;r<a.formatParsers.length;r++){var s=a.formatParsers[r],o=s.regexp.exec(e);if(o){s.apply(this,o),i=!0;break}}if(!i)throw new Error("scenery.Color unable to parse color string: "+t);this.updateColor()},toNumber:function(){return(this.r<<16)+(this.g<<8)+this.b},updateColor:function(){var t=this._css;if(this._css=this.computeCSS(),t!==this._css&&this.listeners.length)for(var e=this.listeners.slice(0),i=e.length,n=0;i>n;n++)e[n]()},setImmutable:function(){return this},getCanvasStyle:function(){return this.toCSS()},setHSLA:function(t,e,i,n){t=t%360/360,e=r(e/100,0,1),i=r(i/100,0,1);var s,o;return o=.5>i?i*(e+1):i+e-i*e,s=2*i-o,this.r=Math.round(255*a.hueToRGB(s,o,t+1/3)),this.g=Math.round(255*a.hueToRGB(s,o,t)),this.b=Math.round(255*a.hueToRGB(s,o,t-1/3)),this.a=r(n,0,1),this.updateColor(),this},equals:function(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a},withAlpha:function(t){return new a(this.r,this.g,this.b,t)},checkFactor:function(t){if(0>t||t>1)throw new Error("factor must be between 0 and 1: "+t);return void 0===t?.7:t},brighterColor:function(t){t=this.checkFactor(t);var e=Math.min(255,Math.floor(this.r/t)),i=Math.min(255,Math.floor(this.g/t)),n=Math.min(255,Math.floor(this.b/t));return new a(e,i,n,this.a)},colorUtilsBrighter:function(t){t=this.checkFactor(t);var e=Math.min(255,this.getRed()+Math.floor(t*(255-this.getRed()))),i=Math.min(255,this.getGreen()+Math.floor(t*(255-this.getGreen()))),n=Math.min(255,this.getBlue()+Math.floor(t*(255-this.getBlue())));return new a(e,i,n,this.getAlpha())},darkerColor:function(t){t=this.checkFactor(t);var e=Math.max(0,Math.floor(t*this.r)),i=Math.max(0,Math.floor(t*this.g)),n=Math.max(0,Math.floor(t*this.b));return new a(e,i,n,this.a)},colorUtilsDarker:function(t){t=this.checkFactor(t);var e=Math.max(0,this.getRed()-Math.floor(t*this.getRed())),i=Math.max(0,this.getGreen()-Math.floor(t*this.getGreen())),n=Math.max(0,this.getBlue()-Math.floor(t*this.getBlue()));return new a(e,i,n,this.getAlpha())},colorUtilsBrightness:function(t){return 0===t?this:t>0?this.colorUtilsBrighter(t):this.colorUtilsDarker(-t)},addChangeListener:function(t){this.listeners.push(t)},removeChangeListener:function(t){this.listeners.splice(_.indexOf(this.listeners,t),1)},toString:function(){return this.constructor.name+"[r:"+this.r+" g:"+this.g+" b:"+this.b+" a:"+this.a+"]"}}),a.basicColorKeywords={aqua:"00ffff",black:"000000",blue:"0000ff",fuchsia:"ff00ff",gray:"808080",green:"008000",lime:"00ff00",maroon:"800000",navy:"000080",olive:"808000",purple:"800080",red:"ff0000",silver:"c0c0c0",teal:"008080",white:"ffffff",yellow:"ffff00"},a.colorKeywords={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"},a.BLACK=new a(0,0,0).setImmutable(),a.BLUE=new a(0,0,255).setImmutable(),a.CYAN=new a(0,255,255).setImmutable(),a.DARK_GRAY=new a(64,64,64).setImmutable(),a.GRAY=new a(128,128,128).setImmutable(),a.GREEN=new a(0,255,0).setImmutable(),a.LIGHT_GRAY=new a(192,192,192).setImmutable(),a.MAGENTA=new a(255,0,255).setImmutable(),a.ORANGE=new a(255,200,0).setImmutable(),a.PINK=new a(255,175,175).setImmutable(),a.RED=new a(255,0,0).setImmutable(),a.WHITE=new a(255,255,255).setImmutable(),a.YELLOW=new a(255,255,0).setImmutable(),a.interpolateRGBA=function(t,e,i){if(0>i||i>1)throw new Error("distance must be between 0 and 1: "+i);
var n=Math.floor(s(0,1,t.r,e.r,i)),r=Math.floor(s(0,1,t.g,e.g,i)),o=Math.floor(s(0,1,t.b,e.b,i)),h=s(0,1,t.a,e.a,i);return new a(n,r,o,h)},a}),i("PHET_CORE/platform",["require","PHET_CORE/core"],function(t){function e(t){return i()===t}function i(){var t=-1,e=null;return"Microsoft Internet Explorer"===navigator.appName?(e=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),null!==e.exec(r)&&(t=parseFloat(RegExp.$1))):"Netscape"===navigator.appName&&(e=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),null!==e.exec(r)&&(t=parseFloat(RegExp.$1))),t}var n=t("PHET_CORE/core"),r=navigator.userAgent;return n.platform={get firefox(){return r.toLowerCase().indexOf("firefox")>-1},get mobileSafari(){return r.match(/(iPod|iPhone|iPad)/)&&r.match(/AppleWebKit/)},get safari5(){return r.match(/Version\/5\./)&&r.match(/Safari\//)&&r.match(/AppleWebKit/)},get safari6(){return r.match(/Version\/6\./)&&r.match(/Safari\//)&&r.match(/AppleWebKit/)},get safari7(){return r.match(/Version\/7\./)&&r.match(/Safari\//)&&r.match(/AppleWebKit/)},get ie9(){return e(9)},get ie10(){return e(10)},get ie11(){return e(11)},get ie(){return-1!==i()},get android(){return r.indexOf("Android")>0},get chromium(){return/chrom(e|ium)/.test(r.toLowerCase())}},n.platform}),i("PHET_CORE/arrayRemove",["require","PHET_CORE/core"],function(t){var e=t("PHET_CORE/core");return e.arrayRemove=function(t,e){var i=_.indexOf(t,e);t.splice(i,1)},e.arrayRemove}),i("SCENERY/nodes/Paintable",["require","SCENERY/scenery","SCENERY/util/Color","KITE/util/LineStyles","PHET_CORE/inherit","PHET_CORE/extend","PHET_CORE/platform","PHET_CORE/arrayRemove"],function(t){var e=t("SCENERY/scenery"),i=t("SCENERY/util/Color"),n=t("KITE/util/LineStyles"),r=t("PHET_CORE/inherit"),s=t("PHET_CORE/extend"),a=t("PHET_CORE/platform"),o=t("PHET_CORE/arrayRemove"),h=a.safari5,l=a.ie9;e.Paintable=function(t){var r=t.prototype;if(s(r,{initializePaintable:function(){this._fill=null,this._stroke=null,this._fillPickable=!0,this._strokePickable=!1,this._cachedPaints=[],this._lineDrawingStyles=new n,this._fillColor=null,this._fillColorDirty=!0,this._strokeColor=null,this._strokeColorDirty=!0;var t=this;this._fillListener=function(){t.invalidateFill()},this._strokeListener=function(){t.invalidateStroke()}},hasFill:function(){return null!==this._fill},getFill:function(){return this._fill},validateFillColor:function(){this._fillColorDirty&&(this._fillColorDirty=!1,this._fillColor?"string"==typeof this._fill?this._fillColor.setCSS(this._fill):this._fillColor.setRGBA(this._fill.r,this._fill.g,this._fill.b,this._fill.a):this._fillColor=new i(this._fill))},getFillColor:function(){return this.validateFillColor(),this._fillColor},setFill:function(t){if(this._fill!==t){this._fillColorDirty=!0;var e=this._instances.length>0;e&&this._fill&&this._fill.removeChangeListener&&this._fill.removeChangeListener(this._fillListener),this._fill=t,e&&this._fill&&this._fill.addChangeListener&&this._fill.addChangeListener(this._fillListener),this.invalidateFill();for(var i=this._drawables.length,n=0;i>n;n++)this._drawables[n].markDirtyFill()}return this},isFillPickable:function(){return this._fillPickable},setFillPickable:function(t){return this._fillPickable!==t&&(this._fillPickable=t,this.invalidateFill()),this},hasStroke:function(){return null!==this._stroke},getLineWidth:function(){return this._lineDrawingStyles.lineWidth},setLineWidth:function(t){if(this.getLineWidth()!==t){this._lineDrawingStyles.lineWidth=t,this.invalidateStroke();for(var e=this._drawables.length,i=0;e>i;i++)this._drawables[i].markDirtyLineWidth()}return this},getLineCap:function(){return this._lineDrawingStyles.lineCap},setLineCap:function(t){if(this._lineDrawingStyles.lineCap!==t){this._lineDrawingStyles.lineCap=t,this.invalidateStroke();for(var e=this._drawables.length,i=0;e>i;i++)this._drawables[i].markDirtyLineOptions()}return this},getLineJoin:function(){return this._lineDrawingStyles.lineJoin},setLineJoin:function(t){if(this._lineDrawingStyles.lineJoin!==t){this._lineDrawingStyles.lineJoin=t,this.invalidateStroke();for(var e=this._drawables.length,i=0;e>i;i++)this._drawables[i].markDirtyLineOptions()}return this},getMiterLimit:function(){return this._lineDrawingStyles.miterLimit},setMiterLimit:function(t){if(this._lineDrawingStyles.miterLimit!==t){this._lineDrawingStyles.miterLimit=t,this.invalidateStroke();for(var e=this._drawables.length,i=0;e>i;i++)this._drawables[i].markDirtyLineOptions()}return this},getLineDash:function(){return this._lineDrawingStyles.lineDash},hasLineDash:function(){return!!this._lineDrawingStyles.lineDash.length},setLineDash:function(t){if(this._lineDrawingStyles.lineDash!==t){this._lineDrawingStyles.lineDash=t||[],this.invalidateStroke();for(var e=this._drawables.length,i=0;e>i;i++)this._drawables[i].markDirtyLineOptions()}return this},getLineDashOffset:function(){return this._lineDrawingStyles.lineDashOffset},setLineDashOffset:function(t){if(this._lineDrawingStyles.lineDashOffset!==t){this._lineDrawingStyles.lineDashOffset=t,this.invalidateStroke();for(var e=this._drawables.length,i=0;e>i;i++)this._drawables[i].markDirtyLineOptions()}return this},isStrokePickable:function(){return this._strokePickable},setStrokePickable:function(t){return this._strokePickable!==t&&(this._strokePickable=t,this.invalidateStroke()),this},setLineStyles:function(t){return this._lineDrawingStyles=t,this.invalidateStroke(),this},getLineStyles:function(){return this._lineDrawingStyles},getStroke:function(){return this._stroke},validateStrokeColor:function(){this._strokeColorDirty&&(this._strokeColorDirty=!1,this._strokeColor?"string"==typeof this._stroke?this._strokeColor.setCSS(this._stroke):this._strokeColor.setRGBA(this._stroke.r,this._stroke.g,this._stroke.b,this._stroke.a):this._strokeColor=new i(this._stroke))},getStrokeColor:function(){return this.validateStrokeColor(),this._strokeColor},setStroke:function(t){if(this._stroke!==t){this._strokeColorDirty=!0;var e=this._instances.length>0;e&&this._stroke&&this._stroke.removeChangeListener&&this._stroke.removeChangeListener(this._strokeListener),this._stroke=t,e&&this._stroke&&this._stroke.addChangeListener&&this._stroke.addChangeListener(this._strokeListener),this.invalidateStroke();for(var i=this._drawables.length,n=0;i>n;n++)this._drawables[n].markDirtyStroke()}return this},getCachedPaints:function(){return this._cachedPaints},setCachedPaints:function(t){this._cachedPaints=t.slice();for(var e=this._drawables.length,i=0;e>i;i++)this._drawables[i].markDirtyCachedPaints();return this},addCachedPaint:function(t){this._cachedPaints.push(t);for(var e=this._drawables.length,i=0;e>i;i++)this._drawables[i].markDirtyCachedPaints()},removeCachedPaint:function(t){o(this._cachedPaints,t);for(var e=this._drawables.length,i=0;e>i;i++)this._drawables[i].markDirtyCachedPaints()},firstInstanceAdded:function(){this._fill&&this._fill.addChangeListener&&this._fill.addChangeListener(this._fillListener),this._stroke&&this._stroke.addChangeListener&&this._stroke.addChangeListener(this._strokeListener)},lastInstanceRemoved:function(){this._fill&&this._fill.removeChangeListener&&this._fill.removeChangeListener(this._fillListener),this._stroke&&this._stroke.removeChangeListener&&this._stroke.removeChangeListener(this._strokeListener)},beforeCanvasFill:function(t){t.setFillStyle(this._fill),this._fill.transformMatrix&&(t.context.save(),this._fill.transformMatrix.canvasAppendTransform(t.context))},afterCanvasFill:function(t){this._fill.transformMatrix&&t.context.restore()},beforeCanvasStroke:function(t){t.setStrokeStyle(this._stroke),t.setLineWidth(this.getLineWidth()),t.setLineCap(this.getLineCap()),t.setLineJoin(this.getLineJoin()),t.setMiterLimit(this.getMiterLimit()),t.setLineDash(this.getLineDash()),t.setLineDashOffset(this.getLineDashOffset()),this._stroke.transformMatrix&&(t.context.save(),this._stroke.transformMatrix.canvasAppendTransform(t.context))},afterCanvasStroke:function(t){this._stroke.transformMatrix&&t.context.restore()},getCSSFill:function(){return this._fill?this._fill.toCSS?this._fill.toCSS():this._fill:"transparent"},requiresSVGBoundsWorkaround:function(){if(!this._stroke||!this._stroke.getSVGDefinition)return!1;var t=this.computeShapeBounds(!1);return t.x*t.y===0},getSimpleCSSStroke:function(){return this._stroke?this._stroke.toCSS?this._stroke.toCSS():this._stroke:"transparent"},appendFillablePropString:function(t,e){return this._fill&&(e&&(e+=",\n"),e+="string"==typeof this._fill?t+"fill: '"+this._fill+"'":t+"fill: "+this._fill.toString()),e},appendStrokablePropString:function(t,e){function i(i,n,r){e&&(e+=",\n"),e+=r||"string"!=typeof n?t+i+": "+n:t+i+": '"+n+"'"}var r=this;if(this._stroke){var s=new n;"string"==typeof this._stroke?i("stroke",this._stroke):i("stroke",this._stroke.toString(),!0),_.each(["lineWidth","lineCap","miterLimit","lineJoin","lineDashOffset"],function(t){r[t]!==s[t]&&i(t,r[t])}),this.lineDash.length&&i("lineDash",JSON.stringify(this.lineDash),!0)}return e},getFillRendererBitmask:function(){var t=0;return h&&this._fill&&this._fill.isGradient||(t|=e.bitmaskSupportsSVG),t|=e.bitmaskSupportsCanvas,t|=e.bitmaskBoundsValid,this._fill?this._fill.isPattern||this._fill.isGradient||(t|=e.bitmaskSupportsDOM,t|=e.bitmaskSupportsWebGL,t|=e.bitmaskSupportsPixi):(t|=e.bitmaskSupportsDOM,t|=e.bitmaskWebGL),t},getStrokeRendererBitmask:function(){var t=0;return l&&this.hasStroke()&&this.hasLineDash()||(t|=e.bitmaskSupportsCanvas),t|=e.bitmaskSupportsSVG,t|=e.bitmaskBoundsValid,this.hasStroke()||(t|=e.bitmaskSupportsDOM),t|=e.bitmaskSupportsWebGL}}),r._mutatorKeys=["fill","fillPickable","stroke","lineWidth","lineCap","lineJoin","miterLimit","lineDash","lineDashOffset","strokePickable","cachedPaints"].concat(r._mutatorKeys),Object.defineProperty(r,"fill",{set:r.setFill,get:r.getFill}),Object.defineProperty(r,"fillColor",{set:r.setFill,get:r.getFillColor}),Object.defineProperty(r,"fillPickable",{set:r.setFillPickable,get:r.isFillPickable}),Object.defineProperty(r,"stroke",{set:r.setStroke,get:r.getStroke}),Object.defineProperty(r,"strokeColor",{set:r.setStroke,get:r.getStrokeColor}),Object.defineProperty(r,"lineWidth",{set:r.setLineWidth,get:r.getLineWidth}),Object.defineProperty(r,"lineCap",{set:r.setLineCap,get:r.getLineCap}),Object.defineProperty(r,"lineJoin",{set:r.setLineJoin,get:r.getLineJoin}),Object.defineProperty(r,"miterLimit",{set:r.setMiterLimit,get:r.getMiterLimit}),Object.defineProperty(r,"lineDash",{set:r.setLineDash,get:r.getLineDash}),Object.defineProperty(r,"lineDashOffset",{set:r.setLineDashOffset,get:r.getLineDashOffset}),Object.defineProperty(r,"strokePickable",{set:r.setStrokePickable,get:r.isStrokePickable}),Object.defineProperty(r,"cachedPaints",{set:r.setCachedPaints,get:r.getCachedPaints}),r.invalidateFill){var a=r.invalidateFill;r.invalidateFill=function(){this.invalidateSupportedRenderers(),a.call(this)}}else r.invalidateFill=function(){this.invalidateSupportedRenderers()};if(r.invalidateStroke){var u=r.invalidateStroke;r.invalidateStroke=function(){this.invalidateSupportedRenderers(),u.call(this)}}else r.invalidateStroke=function(){this.invalidateSupportedRenderers()}};var u=e.Paintable;return u.PaintableStatefulDrawableMixin=function(t){var e=t.prototype;e.initializePaintableState=function(){this.lastFill=void 0,this.dirtyFill=!0,this.lastStroke=void 0,this.dirtyStroke=!0,this.dirtyLineWidth=!0,this.dirtyLineOptions=!0,this.dirtyCachedPaints=!0,this.lastCachedPaints=[]},e.cleanPaintableState=function(){this.dirtyFill=!1,this.lastFill=this.node.getFill(),this.dirtyStroke=!1,this.dirtyLineWidth=!1,this.dirtyLineOptions=!1,this.dirtyCachedPaints=!1,this.lastStroke=this.node.getStroke()},e.markDirtyFill=function(){this.dirtyFill=!0,this.markPaintDirty()},e.markDirtyStroke=function(){this.dirtyStroke=!0,this.markPaintDirty()},e.markDirtyLineWidth=function(){this.dirtyLineWidth=!0,this.markPaintDirty()},e.markDirtyLineOptions=function(){this.dirtyLineOptions=!0,this.markPaintDirty()},e.markDirtyCachedPaints=function(){this.dirtyCachedPaints=!0,this.markPaintDirty()}},u.PaintableStatelessDrawableMixin=function(t){var e=t.prototype;e.markDirtyFill=function(){this.markPaintDirty()},e.markDirtyStroke=function(){this.markPaintDirty()},e.markDirtyLineWidth=function(){this.markPaintDirty()},e.markDirtyLineOptions=function(){this.markPaintDirty()},e.markDirtyCachedPaints=function(){this.markPaintDirty()}},u.PaintSVGState=function(){this.initialize()},r(Object,u.PaintSVGState,{initialize:function(){this.svgBlock=null,this.fill=null,this.stroke=null,this.fillPaint=null,this.strokePaint=null,this.baseStyle=this.computeStyle(),this.extraStyle=""},dispose:function(){this.fill=null,this.stroke=null,this.releaseFillPaint(),this.releaseStrokePaint()},releaseFillPaint:function(){this.fillPaint&&(this.svgBlock.decrementPaint(this.fillPaint),this.fillPaint=null)},releaseStrokePaint:function(){this.strokePaint&&(this.svgBlock.decrementPaint(this.strokePaint),this.strokePaint=null)},updateFill:function(t,e){e!==this.fill&&(this.releaseFillPaint(),this.fill=e,this.baseStyle=this.computeStyle(),this.fill&&this.fill.isPaint&&(this.fillPaint=this.fill,t.incrementPaint(this.fill)))},updateStroke:function(t,e){e!==this.stroke&&(this.releaseStrokePaint(),this.stroke=e,this.baseStyle=this.computeStyle(),this.stroke&&this.stroke.isPaint&&(this.strokePaint=this.stroke,t.incrementPaint(this.stroke)))},updateStrokeParameters:function(t){var e="",i=t.getLineWidth();1!==i&&(e+="stroke-width: "+i+";");var n=t.getLineCap();"butt"!==n&&(e+="stroke-linecap: "+n+";");var r=t.getLineJoin();"miter"!==r&&(e+="stroke-linejoin: "+r+";");var s=t.getMiterLimit();e+="stroke-miterlimit: "+s+";",t.hasLineDash()&&(e+="stroke-dasharray: "+t.getLineDash().join(",")+";",e+="stroke-dashoffset: "+t.getLineDashOffset()+";"),this.extraStyle=e},updateSVGBlock:function(t){var e=this.svgBlock;e&&(this.fillPaint&&e.decrementPaint(this.fillPaint),this.strokePaint&&e.decrementPaint(this.strokePaint)),this.svgBlock=t,this.fillPaint&&t.incrementPaint(this.fillPaint),this.strokePaint&&t.incrementPaint(this.strokePaint)},computeStyle:function(){var t="fill: ";return t+=this.fill?this.fill.toCSS?this.fill.toCSS()+";":this.fill.isPaint?"url(#"+this.fill.id+");":this.fill+";":"none;",this.stroke?(t+=" stroke: ",t+=this.stroke.toCSS?this.stroke.toCSS()+";":this.stroke.isPaint?"url(#"+this.stroke.id+");":this.stroke+";"):t+=" stroke: none;",t}}),u}),i("SCENERY/display/Drawable",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/display/Renderer"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/display/Renderer"),r=1;i.Drawable=function(t){this.initializeDrawable(t)};var s=i.Drawable;return e(Object,s,{initializeDrawable:function(t){return this.id=this.id||r++,this.cleanDrawable(),this.renderer=t,this.dirty=!0,this.disposed=!1,this.linksDirty=!1,this},cleanDrawable:function(){this.parentDrawable=null,this.backbone=null,this.pendingParentDrawable=null,this.pendingBackbone=null,this.pendingAddition=!1,this.pendingRemoval=!1,this.previousDrawable=null,this.nextDrawable=null,this.oldPreviousDrawable=null,this.oldNextDrawable=null},setBlockBackbone:function(t){this.parentDrawable=t,this.backbone=t,this.pendingParentDrawable=t,this.pendingBackbone=t,this.pendingAddition=!1,this.pendingRemoval=!1},notePendingAddition:function(t,e,i){this.pendingParentDrawable=e,this.pendingBackbone=i,this.pendingAddition=!0,this.pendingRemoval||t.markDrawableChangedBlock(this)},notePendingRemoval:function(t){this.pendingRemoval=!0,this.pendingAddition||t.markDrawableChangedBlock(this)},notePendingMove:function(t,e){this.pendingParentDrawable=e,this.pendingRemoval&&this.pendingAddition||t.markDrawableChangedBlock(this),this.pendingAddition=!0,this.pendingRemoval=!0},updateBlock:function(){var t=!1;return(this.pendingRemoval||this.pendingAddition)&&(t=!this.pendingRemoval||!this.pendingAddition||this.parentDrawable!==this.pendingParentDrawable||this.backbone!==this.pendingBackbone,t?(this.pendingRemoval&&(this.parentDrawable.removeDrawable(this),this.pendingAddition||(this.pendingParentDrawable=null,this.pendingBackbone=null)),this.parentDrawable=this.pendingParentDrawable,this.backbone=this.pendingBackbone,this.pendingAddition&&this.parentDrawable.addDrawable(this)):this.pendingAddition&&n.isCanvas(this.renderer)&&this.parentDrawable.onPotentiallyMovedDrawable(this),this.pendingAddition=!1,this.pendingRemoval=!1),t},updateLinks:function(){this.oldNextDrawable=this.nextDrawable,this.oldPreviousDrawable=this.previousDrawable,this.linksDirty=!1},markDirty:function(){this.dirty||(this.dirty=!0,this.parentDrawable&&this.parentDrawable.markDirtyDrawable(this))},markLinksDirty:function(t){this.linksDirty||(this.linksDirty=!0,t.markDrawableForLinksUpdate(this))},markForDisposal:function(t){s.disconnectBefore(this,t),s.disconnectAfter(this,t),t.markDrawableForDisposal(this)},disposeImmediately:function(t){s.disconnectBefore(this,t),s.disconnectAfter(this,t),this.dispose()},dispose:function(){this.cleanDrawable(),this.disposed=!0,this.freeToPool()},audit:function(t,e,i){},toString:function(){return this.constructor.name+"#"+this.id},toDetailedString:function(){return this.toString()}}),s.connectDrawables=function(t,e,i){t.nextDrawable!==e&&(t.nextDrawable&&(t.nextDrawable.markLinksDirty(i),t.nextDrawable.previousDrawable=null),e.previousDrawable&&(e.previousDrawable.markLinksDirty(i),e.previousDrawable.nextDrawable=null),t.nextDrawable=e,e.previousDrawable=t,t.markLinksDirty(i),e.markLinksDirty(i))},s.disconnectBefore=function(t,e){t.previousDrawable&&(t.markLinksDirty(e),t.previousDrawable.markLinksDirty(e),t.previousDrawable.nextDrawable=null,t.previousDrawable=null)},s.disconnectAfter=function(t,e){t.nextDrawable&&(t.markLinksDirty(e),t.nextDrawable.markLinksDirty(e),t.nextDrawable.previousDrawable=null,t.nextDrawable=null)},s.listToArray=function(t,e){for(var i=[],n=t;i.push(n),n!==e;n=n.nextDrawable);return i},s.oldListToArray=function(t,e){for(var i=[],n=t;i.push(n),n!==e;n=n.oldNextDrawable);return i},s}),i("SCENERY/display/SelfDrawable",["require","PHET_CORE/inherit","PHET_CORE/PoolableMixin","SCENERY/scenery","SCENERY/display/Drawable"],function(t){var e=t("PHET_CORE/inherit"),i=t("PHET_CORE/PoolableMixin"),n=t("SCENERY/scenery"),r=t("SCENERY/display/Drawable");n.SelfDrawable=function(t,e){this.initializeSelfDrawable(t,e)};var s=n.SelfDrawable;return e(n.Drawable,s,{initializeSelfDrawable:function(t,e){return this.initializeDrawable(t),this.instance=e,this.node=e.trail.lastNode(),this.node.attachDrawable(this),this},dispose:function(){this.node.detachDrawable(this),this.instance=null,this.node=null,r.prototype.dispose.call(this)},toDetailedString:function(){return this.toString()+" ("+this.instance.trail.toPathString()+")"}}),s.PoolableMixin=function(t){i(t,{defaultFactory:function(){return new t},constructorDuplicateFactory:function(e){return function(i,n){return e.length?e.pop().initialize(i,n):new t(i,n)}}})},s}),i("SCENERY/display/SVGSelfDrawable",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/display/SelfDrawable","SCENERY/nodes/Paintable"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/display/SelfDrawable"),r=t("SCENERY/nodes/Paintable");i.SVGSelfDrawable=function(t,e){throw this.initializeSVGSelfDrawable(t,e),new Error("Should use initialization and pooling")};var s=i.SVGSelfDrawable;return e(n,s,{initializeSVGSelfDrawable:function(t,e){return this.initializeSelfDrawable(t,e),this.svgElement=null,this.svgBlock=null,this},updateSVGBlock:function(t){this.svgBlock=t},update:function(){this.dirty&&(this.dirty=!1,this.updateSVG())},updateSVG:function(){},dispose:function(){this.svgBlock=null,n.prototype.dispose.call(this)}}),s.createDrawable=function(t){var i=t.type,a=t.stateType,o=t.initialize,h=t.updateSVG,l=t.updateDefs,u=t.usesPaint,c=t.keepElements;return e(s,i,{initialize:function(t,e){return this.initializeSVGSelfDrawable(t,e),this.initializeState(),o.call(this,t,e),this.svgBlock=null,u&&(this.paintState?this.paintState.initialize():this.paintState=new r.PaintSVGState),this},updateFillStrokeStyle:function(t){if(u){this.dirtyFill&&this.paintState.updateFill(this.svgBlock,this.node._fill),this.dirtyStroke&&this.paintState.updateStroke(this.svgBlock,this.node._stroke);var e=this.dirtyLineWidth||this.dirtyLineOptions;e&&this.paintState.updateStrokeParameters(this.node),(this.dirtyFill||this.dirtyStroke||e)&&t.setAttribute("style",this.paintState.baseStyle+this.paintState.extraStyle)}},updateSVG:function(){if(this.paintDirty&&h.call(this,this.node,this.svgElement),u&&this.dirtyCachedPaints){var t,e,i=this.node._cachedPaints.slice();for(t=0;t<i.length;t++){var n=i[t],r=!0;for(e=0;e<this.lastCachedPaints.length;e++)if(n===this.lastCachedPaints[e]){r=!1;break}r&&this.svgBlock.incrementPaint(n)}for(t=0;t<this.lastCachedPaints.length;t++){var s=this.lastCachedPaints[t],a=!0;for(e=0;e<i.length;e++)if(s===i[e]){a=!1;break}a&&this.svgBlock.decrementPaint(s)}this.lastCachedPaints=i}this.setToClean()},updateSVGBlock:function(t){var e=this.svgBlock;if(u&&e)for(var i=0;i<this.lastCachedPaints.length;i++)e.decrementPaint(this.lastCachedPaints[i]);if(this.svgBlock=t,u)for(var n=0;n<this.lastCachedPaints.length;n++)t.incrementPaint(this.lastCachedPaints[n]);l&&l.call(this,t),u&&this.paintState.updateSVGBlock(t)},onAttach:function(){},onDetach:function(){c||(this.svgElement=null),l&&l.call(this,null),u&&this.paintState.dispose(),this.defs=null},setToClean:function(){this.setToCleanState()}}),a(i),n.PoolableMixin(i),i},s}),i("SCENERY/display/CanvasSelfDrawable",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/display/SelfDrawable","SCENERY/nodes/Paintable"],function(t){function e(){this.markDirty()}var i=t("PHET_CORE/inherit"),n=t("SCENERY/scenery"),r=t("SCENERY/display/SelfDrawable"),s=t("SCENERY/nodes/Paintable");n.CanvasSelfDrawable=function(t,e){throw this.initializeCanvasSelfDrawable(t,e),new Error("Should use initialization and pooling")};var a=n.CanvasSelfDrawable;return i(r,a,{initializeCanvasSelfDrawable:function(t,e){return this.initializeSelfDrawable(t,e),this.transformListener=this.transformListener||this.markTransformDirty.bind(this),e.relativeTransform.addListener(this.transformListener),e.relativeTransform.addPrecompute(),this},markTransformDirty:function(){this.markDirty()},dispose:function(){this.instance.relativeTransform.removeListener(this.transformListener),this.instance.relativeTransform.removePrecompute(),r.prototype.dispose.call(this)}}),a.createDrawable=function(t){var n=t.type,o=t.paintCanvas,h=t.usesPaint;if(i(a,n,{initialize:function(t,e){return this.initializeCanvasSelfDrawable(t,e),this},markPaintDirty:function(){this.markDirty()},paintCanvas:o,onAttach:function(){},onDetach:function(){},update:function(){this.dirty=!1}}),h&&s.PaintableStatelessDrawableMixin(n),r.PoolableMixin(n),t.dirtyMethods)for(var l=0;l<t.dirtyMethods.length;l++)n.prototype[t.dirtyMethods[l]]=e;return n},a}),i("SCENERY/display/WebGLSelfDrawable",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/display/SelfDrawable"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/display/SelfDrawable");i.WebGLSelfDrawable=function(t,e){throw this.initializeWebGLSelfDrawable(t,e),new Error("Should use initialization and pooling")};var r=i.WebGLSelfDrawable;return e(n,r,{initializeWebGLSelfDrawable:function(t,e){return this.initializeSelfDrawable(t,e),this.transformListener=this.transformListener||this.markTransformDirty.bind(this),e.relativeTransform.addListener(this.transformListener),e.relativeTransform.addPrecompute(),this},markTransformDirty:function(){this.markDirty()},dispose:function(){this.instance.relativeTransform.removeListener(this.transformListener),this.instance.relativeTransform.removePrecompute(),n.prototype.dispose.call(this)}}),r}),i("PHET_CORE/cleanArray",["require","PHET_CORE/core"],function(t){var e=t("PHET_CORE/core");return e.cleanArray=function(t){if(t){for(;t.length;)t.pop();return t}return[]},e.cleanArray}),i("SCENERY/display/Block",["require","PHET_CORE/inherit","PHET_CORE/cleanArray","SCENERY/scenery","SCENERY/display/Drawable"],function(t){var e=t("PHET_CORE/inherit"),i=(t("PHET_CORE/cleanArray"),t("SCENERY/scenery")),n=t("SCENERY/display/Drawable");i.Block=function(){throw new Error("Should never be called")};var r=i.Block;return e(n,r,{initializeBlock:function(t,e){return this.initializeDrawable(e),this.display=t,this.drawableCount=0,this.used=!0,this.firstDrawable=null,this.lastDrawable=null,this.pendingFirstDrawable=null,this.pendingLastDrawable=null,this.previousBlock=null,this.nextBlock=null,this.zIndex=0,this},dispose:function(){this.display=null,this.firstDrawable=null,this.lastDrawable=null,this.pendingFirstDrawable=null,this.pendingLastDrawable=null,this.previousBlock=null,this.nextBlock=null,n.prototype.dispose.call(this)},addDrawable:function(t){this.drawableCount++,this.markDirtyDrawable(t)},removeDrawable:function(t){this.drawableCount--},onIntervalChange:function(){},updateInterval:function(){(this.pendingFirstDrawable!==this.firstDrawable||this.pendingLastDrawable!==this.lastDrawable)&&(this.onIntervalChange(this.pendingFirstDrawable,this.pendingLastDrawable),this.firstDrawable=this.pendingFirstDrawable,this.lastDrawable=this.pendingLastDrawable)},notifyInterval:function(t,e){this.pendingFirstDrawable=t,this.pendingLastDrawable=e,this.updateInterval()},audit:function(t,e,i){}}),r}),i("SCENERY/display/FittedBlock",["require","PHET_CORE/inherit","DOT/Bounds2","DOT/Vector2","SCENERY/scenery","SCENERY/display/Block","SCENERY/display/Renderer"],function(t){var e=t("PHET_CORE/inherit"),i=t("DOT/Bounds2"),n=t("DOT/Vector2"),r=t("SCENERY/scenery"),s=t("SCENERY/display/Block"),a=t("SCENERY/display/Renderer");r.FittedBlock=function(t,e,i){this.initialize(t,e,i)};var o=r.FittedBlock;return e(s,o,{initializeFittedBlock:function(t,e,r){return this.initializeBlock(t,e),this.transformRootInstance=r,this.fit=o.COMMON_ANCESTOR,this.dirtyFit=!0,this.dirtyFitListener=this.dirtyFitListener||this.markDirtyFit.bind(this),this.commonFitInstance=null,this.fitBounds=i.NOTHING.copy(),this.oldFitBounds=i.NOTHING.copy(),this.fitOffset=new n,this.forceAcceleration=0!==(e&a.bitmaskForceAcceleration),this.fit===o.FULL_DISPLAY&&this.display.onStatic("displaySize",this.dirtyFitListener),this},markDirtyFit:function(){this.dirtyFit=!0,this.markDirty()},updateFit:function(){if(this.dirtyFit||this.fit!==o.FULL_DISPLAY)if(this.dirtyFit=!1,this.fit===o.FULL_DISPLAY)this.setSizeFullDisplay();else{if(this.fit!==o.COMMON_ANCESTOR)throw new Error("unknown fit");this.fitBounds.set(this.commonFitInstance.node.getLocalBounds());for(var t=this.commonFitInstance;t!==this.transformRootInstance;)this.fitBounds.transform(t.node.getMatrix()),t=t.parent;this.fitBounds.equals(this.oldFitBounds)||(this.oldFitBounds.set(this.fitBounds),this.fitBounds.roundOut(),this.fitBounds.dilate(4),this.setSizeFitBounds())}},setSizeFullDisplay:function(){},setSizeFitBounds:function(){},dispose:function(){this.fit===o.FULL_DISPLAY&&this.display.offStatic("displaySize",this.dirtyFitListener),this.transformRootInstance=null,this.commonFitInstance=null,s.prototype.dispose.call(this)},onIntervalChange:function(t,e){if(s.prototype.onIntervalChange.call(this,t,e),this.fit===o.COMMON_ANCESTOR){for(var i=t.instance,n=e.instance,r=Math.min(i.trail.length,n.trail.length);i.trail.length>r;)i=i.parent;for(;n.trail.length>r;)n=n.parent;for(;i!==n;)i=i.parent,n=n.parent;this.commonFitInstance=i,this.markDirtyFit()}}}),o.FULL_DISPLAY=1,o.COMMON_ANCESTOR=2,o.fitString={1:"fullDisplay",2:"commonAncestor"},o}),i("PHET_CORE/detectPrefix",["require","PHET_CORE/core"],function(t){var e=t("PHET_CORE/core");return e.detectPrefix=function(t,e){return void 0!==t[e]?e:(e=e.charAt(0).toUpperCase()+e.slice(1),void 0!==t["moz"+e]?"moz"+e:void 0!==t["Moz"+e]?"Moz"+e:void 0!==t["webkit"+e]?"webkit"+e:void 0!==t["ms"+e]?"ms"+e:void 0!==t["o"+e]?"o"+e:void 0)},e.detectPrefix}),i("SCENERY/util/Features",["require","PHET_CORE/detectPrefix","SCENERY/scenery"],function(t){function e(t){try{var e=document.createElement("canvas");e.width=1,e.height=1;var i=e.getContext("2d");i.fillStyle="black",i.fillRect(0,0,1,1);var n=e.toDataURL([t]),r="data:"+t;return n.slice(0,r.length)===r}catch(s){return!1}}function i(t,e){var i=document.createElement("canvas");i.width=1,i.height=1;var n=i.getContext("2d"),r=document.createElement("img");r.crossOrigin="Anonymous";var a=function(){try{n.drawImage(r,0,0),i.toDataURL(),s[t]=!0}catch(e){s[t]=!1}};r.onload=a;try{r.src=e,r.complete&&a()}catch(o){s[t]=!1}}var n=t("PHET_CORE/detectPrefix"),r=t("SCENERY/scenery"),s=r.Features={};s.canvasPNGOutput=e("image/png"),s.canvasJPEGOutput=e("image/jpeg"),s.canvasGIFOutput=e("image/gif"),s.canvasICONOutput=e("image/x-icon"),i("canvasPNGInput","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQIW2NkYGD4DwABCQEBtxmN7wAAAABJRU5ErkJggg=="),i("canvasJPEGInput","data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAMCAgICAgMCAgIDAwMDBAYEBAQEBAgGBgUGCQgKCgkICQkKDA8MCgsOCwkJDRENDg8QEBEQCgwSExIQEw8QEBD/2wBDAQMDAwQDBAgEBAgQCwkLEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBD/wAARCAABAAEDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD8qqKKKAP/2Q=="),i("canvasSVGInput","data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIj8+DQo8c3ZnIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3cG9ydD0iMCAwIDEgMSIgd2lkdGg9IjEiIGhlaWdodD0iMSIgPg0KICA8cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMSIgaGVpZ2h0PSIxIiByeD0iMCIgcnk9IjAiIHN0eWxlPSJmaWxsOiBibGFjazsgc3Ryb2tlOiBub25lOyI+PC9yZWN0Pg0KPC9zdmc+DQo="),i("canvasGIFInput","data:image/gif;base64,R0lGODlhAQABAJEAAAAAAP///////wAAACH5BAEAAAIALAAAAAABAAEAAAICRAEAOw==");var a=document.createElement("canvas"),o=a.getContext("2d");s.toDataURLHD=n(a,"toDataURLHD"),s.createImageDataHD=n(o,"createImageDataHD"),s.getImageDataHD=n(o,"getImageDataHD"),s.putImageDataHD=n(o,"putImageDataHD"),s.currentTransform=n(o,"currentTransform");var h=document.createElement("span"),l=document.createElement("div");return s.textStroke=n(h.style,"textStroke"),s.textStrokeColor=n(h.style,"textStrokeColor"),s.textStrokeWidth=n(h.style,"textStrokeWidth"),s.transform=n(l.style,"transform"),s.transformOrigin=n(l.style,"transformOrigin"),s.backfaceVisibility=n(l.style,"backfaceVisibility"),s.borderRadius=n(l.style,"borderRadius"),s.userSelect=n(l.style,"userSelect"),s.touchAction=n(l.style,"touchAction"),s.touchCallout=n(l.style,"touchCallout"),s.userDrag=n(l.style,"userDrag"),s.tapHighlightColor=n(l.style,"tapHighlightColor"),s.setStyle=function(t,e,i){void 0!==e&&(t.style[e]=i)},s}),i("SCENERY/util/Util",["require","SCENERY/scenery","DOT/Matrix3","DOT/Transform3","DOT/Bounds2","DOT/Vector2","SCENERY/util/Features"],function(t){function e(t,e){return new a(t,e)}var i=t("SCENERY/scenery"),n=t("DOT/Matrix3"),r=t("DOT/Transform3"),s=t("DOT/Bounds2"),a=t("DOT/Vector2"),o=t("SCENERY/util/Features"),h=!1,l=o.transform,u=o.transformOrigin||"transformOrigin";i.Util={extend:function(t){return _.each(Array.prototype.slice.call(arguments,1),function(e){if(e)for(var i in e)Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))}),t},applyCSSTransform:function(t,e,i){var n=t.getCSSTransform();i&&(e.style.webkitBackfaceVisibility="hidden",n+=" translateZ(0)"),e.style[l]=n,e.style[u]="top left"},prepareForTransform:function(t,e){t.style[u]="top left",e?i.Util.setTransformAcceleration(t):i.Util.unsetTransformAcceleration(t)
},setTransformAcceleration:function(t){t.style.webkitBackfaceVisibility="hidden"},unsetTransformAcceleration:function(t){t.style.webkitBackfaceVisibility=""},applyPreparedTransform:function(t,e){e.style[l]=t.getCSSTransform()},setTransform:function(t,e){e.style[l]=t},unsetTransform:function(t){t.style[l]=""},testAssert:function(){return"assert.basic: false"},testAssertExtra:function(){return"assert.slow: false"},polyfillRequestAnimationFrame:function(){for(var t=0,e=["ms","moz","webkit","o"],i=0;i<e.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]||window[e[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var i=(new Date).getTime(),n=Math.max(0,16-(i-t)),r=window.setTimeout(function(){e(i+n)},n);return t=i+n,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})},backingStorePixelRatio:function(t){return t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1},backingScale:function(t){if("devicePixelRatio"in window){var e=c.backingStorePixelRatio(t);return window.devicePixelRatio/e}return 1},scanBounds:function(t,i,n){for(var r=_.map(_.range(i),function(){return!1}),a=_.map(_.range(i),function(){return!1}),o=0;i>o;o++)for(var h=0;i>h;h++){var l=4*(h*i+o);(0!==t.data[l]||0!==t.data[l+1]||0!==t.data[l+2]||0!==t.data[l+3])&&(r[o]=!0,a[h]=!0)}var u=_.indexOf(r,!0),c=_.lastIndexOf(r,!0),d=_.indexOf(a,!0),f=_.lastIndexOf(a,!0),m=i/16;return{minBounds:new s(1>u||u>=i-1?Number.POSITIVE_INFINITY:n.inversePosition2(e(u+1+m,0)).x,1>d||d>=i-1?Number.POSITIVE_INFINITY:n.inversePosition2(e(0,d+1+m)).y,1>c||c>=i-1?Number.NEGATIVE_INFINITY:n.inversePosition2(e(c-m,0)).x,1>f||f>=i-1?Number.NEGATIVE_INFINITY:n.inversePosition2(e(0,f-m)).y),maxBounds:new s(1>u||u>=i-1?Number.NEGATIVE_INFINITY:n.inversePosition2(e(u-1-m,0)).x,1>d||d>=i-1?Number.NEGATIVE_INFINITY:n.inversePosition2(e(0,d-1-m)).y,1>c||c>=i-1?Number.POSITIVE_INFINITY:n.inversePosition2(e(c+2+m,0)).x,1>f||f>=i-1?Number.POSITIVE_INFINITY:n.inversePosition2(e(0,f+2+m)).y)}},canvasAccurateBounds:function(t,i){function a(e){function i(t){var e=document.createElement("canvas");e.width=u,e.height=u;var i=e.getContext("2d");i.putImageData(t,0,0),$(e).css("border","1px solid black"),$(window).ready(function(){$("#display").append(e)})}g.save(),e.matrix.canvasSetTransform(g),t(g),g.restore();var n=g.getImageData(0,0,u,u),r=c.scanBounds(n,u,e);return h&&i(n),g.clearRect(0,0,u,u),r}function o(t){var e=2,i=(u-2*e)/(t.maxX-t.minX),s=(u-2*e)/(t.maxY-t.minY),a=-i*t.minX+e,o=-s*t.minY+e;return new r(n.translation(a,o).timesMatrix(n.scaling(i,s)))}var l=i&&i.precision?i.precision:.001,u=i&&i.resolution?i.resolution:128,d=i&&i.initialScale?i.initialScale:1/16,f=s.NOTHING,m=s.EVERYTHING,p=document.createElement("canvas");p.width=u,p.height=u;var g=p.getContext("2d");h&&$(window).ready(function(){var t=document.createElement("h2");$(t).text("Bounds Scan"),$("#display").append(t)});var v=new r;v.append(n.translation(u/2,u/2)),v.append(n.scaling(d));var b=a(v);f=f.union(b.minBounds),m=m.intersection(b.maxBounds);var y,E,x;for(y=m.minY,E=m.maxY;isFinite(f.minX)&&isFinite(m.minX)&&Math.abs(f.minX-m.minX)>l;){if(x=a(o(new s(m.minX,y,f.minX,E))),f.minX<=x.minBounds.minX&&m.minX>=x.maxBounds.minX){h&&(console.log("warning, exiting infinite loop!"),console.log('transformed "min" minX: '+o(new s(m.minX,m.minY,f.minX,m.maxY)).transformPosition2(e(f.minX,0))),console.log('transformed "max" minX: '+o(new s(m.minX,m.minY,f.minX,m.maxY)).transformPosition2(e(m.minX,0))));break}f=f.withMinX(Math.min(f.minX,x.minBounds.minX)),m=m.withMinX(Math.max(m.minX,x.maxBounds.minX)),y=Math.max(y,x.maxBounds.minY),E=Math.min(E,x.maxBounds.maxY)}for(y=m.minY,E=m.maxY;isFinite(f.maxX)&&isFinite(m.maxX)&&Math.abs(f.maxX-m.maxX)>l;){if(x=a(o(new s(f.maxX,y,m.maxX,E))),f.maxX>=x.minBounds.maxX&&m.maxX<=x.maxBounds.maxX){h&&console.log("warning, exiting infinite loop!");break}f=f.withMaxX(Math.max(f.maxX,x.minBounds.maxX)),m=m.withMaxX(Math.min(m.maxX,x.maxBounds.maxX)),y=Math.max(y,x.maxBounds.minY),E=Math.min(E,x.maxBounds.maxY)}for(y=m.minX,E=m.maxX;isFinite(f.minY)&&isFinite(m.minY)&&Math.abs(f.minY-m.minY)>l;){if(x=a(o(new s(y,m.minY,E,f.minY))),f.minY<=x.minBounds.minY&&m.minY>=x.maxBounds.minY){h&&console.log("warning, exiting infinite loop!");break}f=f.withMinY(Math.min(f.minY,x.minBounds.minY)),m=m.withMinY(Math.max(m.minY,x.maxBounds.minY)),y=Math.max(y,x.maxBounds.minX),E=Math.min(E,x.maxBounds.maxX)}for(y=m.minX,E=m.maxX;isFinite(f.maxY)&&isFinite(m.maxY)&&Math.abs(f.maxY-m.maxY)>l;){if(x=a(o(new s(y,f.maxY,E,m.maxY))),f.maxY>=x.minBounds.maxY&&m.maxY<=x.maxBounds.maxY){h&&console.log("warning, exiting infinite loop!");break}f=f.withMaxY(Math.max(f.maxY,x.minBounds.maxY)),m=m.withMaxY(Math.min(m.maxY,x.maxBounds.maxY)),y=Math.max(y,x.maxBounds.minX),E=Math.min(E,x.maxBounds.maxX)}h&&(console.log("minBounds: "+f),console.log("maxBounds: "+m));var _=new s((f.minX+m.minX)/2,(f.minY+m.minY)/2,(f.maxX+m.maxX)/2,(f.maxY+m.maxY)/2);return _.minBounds=f,_.maxBounds=m,_.isConsistent=m.containsBounds(f),_.precision=Math.max(Math.abs(f.minX-m.minX),Math.abs(f.minY-m.minY),Math.abs(f.maxX-m.maxX),Math.abs(f.maxY-m.maxY)),_},toPowerOf2:function(t){for(var e=1;t>e;)e*=2;return e},createShader:function(t,e,i){var n=t.createShader(i);return t.shaderSource(n,e),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)||(console.log("GLSL compile error:"),console.log(t.getShaderInfoLog(n)),console.log(e)),n},isWebGLSupported:function(){var t=document.createElement("canvas"),e={failIfMajorPerformanceCaveat:!0};try{var i=!!window.WebGLRenderingContext&&(t.getContext("webgl",e)||t.getContext("experimental-webgl",e));return!!i}catch(n){return!1}}};var c=i.Util;return c}),i("SCENERY/display/webgl/colorTriangleBufferData",["require","PHET_CORE/inherit","SCENERY/util/Color","DOT/Matrix4"],function(t){function e(){this.vertexArray=[],this.elementsPerVertex=13}var i=t("PHET_CORE/inherit"),n=t("SCENERY/util/Color"),r=t("DOT/Matrix4");return i(Object,e,{reserveVertices:function(t){for(var e=this.vertexArray.length,i=0;t>i;i++)for(var n=0;n<this.elementsPerVertex;n++)this.vertexArray.push(0);var r=this.vertexArray.length;return{startIndex:e,endIndex:r}},createFromPath:function(t,e){for(var i,r=t.getLocalToGlobalMatrix().toMatrix4(),s=t.shape,a=new n(t.fill),o=s.toPiecewiseLinear({}),h=o.subpaths,l="",u=[],c=0;c<h.length;c++){var d=h[c];for(i=0;i<d.points.length;i++)l=l+""+d.points[i].x+" "+d.points[i].y+"\n",i<d.points.length-1&&u.push(new poly2tri.Point(d.points[i].x,d.points[i].y))}var f;try{f=new poly2tri.SweepContext(u).triangulate().getTriangles()}catch(m){console.log("error in triangulation",m),f=[]}for(i=0;i<f.length;i++)for(var p=f[i],g=0;g<p.points_.length;g++){var v=p.points_[g],b=0;this.vertexArray.push(v.x+Math.random()*b,v.y+Math.random()*b,e,a.red/255,a.green/255,a.blue/255,a.alpha,r.m00(),r.m01(),r.m03(),r.m10(),r.m11(),r.m13())}},createFromTriangle:function(t,e,i,s,a,o,h,l,u){u=u||r.identity(),h=new n(h);var c=h.red/255,d=h.green/255,f=h.blue/255,m=h.alpha,p=this,g=this.vertexArray.length;return p.vertexArray.push(t,e,l,c,d,f,m,u.m00(),u.m01(),u.m03(),u.m10(),u.m11(),u.m13(),i,s,l,c,d,f,m,u.m00(),u.m01(),u.m03(),u.m10(),u.m11(),u.m13(),a,o,l,c,d,f,m,u.m00(),u.m01(),u.m03(),u.m10(),u.m11(),u.m13()),{startIndex:g,endIndex:p.vertexArray.length,setTriangle:function(t,e,i,n,r,s){p.vertexArray[g+0+0]=t,p.vertexArray[g+1+0]=e,p.vertexArray[g+0+13]=i,p.vertexArray[g+1+13]=n,p.vertexArray[g+0+26]=r,p.vertexArray[g+1+26]=s},setZ:function(t){p.vertexArray[g+2]=t,p.vertexArray[g+5]=t,p.vertexArray[g+8]=t}}},createStar:function(t,e,i,n,r){for(var s=this,a=this.vertexArray.length,o=0;18>o;o++)this.vertexArray.push(0);var h={startIndex:a,setStar:function(t,e,i,n,r){var a=[];for(o=0;10>o;o++){var h=o/10*Math.PI*2-Math.PI/2+r,l=o%2===0?n:i,u=l*Math.cos(h)+t,c=l*Math.sin(h)+e;a.push({x:u,y:c})}var d=this.index;s.vertexArray[d+0]=a[0].x,s.vertexArray[d+1]=a[0].y,s.vertexArray[d+2]=a[3].x,s.vertexArray[d+3]=a[3].y,s.vertexArray[d+4]=a[6].x,s.vertexArray[d+5]=a[6].y,s.vertexArray[d+6]=a[8].x,s.vertexArray[d+7]=a[8].y,s.vertexArray[d+8]=a[2].x,s.vertexArray[d+9]=a[2].y,s.vertexArray[d+10]=a[5].x,s.vertexArray[d+11]=a[5].y,s.vertexArray[d+12]=a[0].x,s.vertexArray[d+13]=a[0].y,s.vertexArray[d+14]=a[7].x,s.vertexArray[d+15]=a[7].y,s.vertexArray[d+16]=a[4].x,s.vertexArray[d+17]=a[4].y}};return h.setStar(t,e,i,n,r),h},dispose:function(){}})}),i("SCENERY/display/webgl/WebGLUtil",["require","PHET_CORE/inherit"],function(t){function e(){}var i=t("PHET_CORE/inherit");return i(Object,e,{},{toShader:function(t,e,i,n){var r=t.createShader(i);return t.shaderSource(r,e),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(console.log("ERROR IN "+n+" SHADER : "+t.getShaderInfoLog(r)),!1)}})}),i("text",["module"],function(t){var i,n,r,s,a,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],h=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,l=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,u="undefined"!=typeof location&&location.href,c=u&&location.protocol&&location.protocol.replace(/\:/,""),d=u&&location.hostname,f=u&&(location.port||void 0),m={},p=t.config&&t.config()||{};return i={version:"2.0.12",strip:function(t){if(t){t=t.replace(h,"");var e=t.match(l);e&&(t=e[1])}else t="";return t},jsEscape:function(t){return t.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:p.createXhr||function(){var t,e,i;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(e=0;3>e;e+=1){i=o[e];try{t=new ActiveXObject(i)}catch(n){}if(t){o=[i];break}}return t},parseName:function(t){var e,i,n,r=!1,s=t.indexOf("."),a=0===t.indexOf("./")||0===t.indexOf("../");return-1!==s&&(!a||s>1)?(e=t.substring(0,s),i=t.substring(s+1,t.length)):e=t,n=i||e,s=n.indexOf("!"),-1!==s&&(r="strip"===n.substring(s+1),n=n.substring(0,s),i?i=n:e=n),{moduleName:e,ext:i,strip:r}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(t,e,n,r){var s,a,o,h=i.xdRegExp.exec(t);return h?(s=h[2],a=h[3],a=a.split(":"),o=a[1],a=a[0],!(s&&s!==e||a&&a.toLowerCase()!==n.toLowerCase()||(o||a)&&o!==r)):!0},finishLoad:function(t,e,n,r){n=e?i.strip(n):n,p.isBuild&&(m[t]=n),r(n)},load:function(t,e,n,r){if(r&&r.isBuild&&!r.inlineText)return void n();p.isBuild=r&&r.isBuild;var s=i.parseName(t),a=s.moduleName+(s.ext?"."+s.ext:""),o=e.toUrl(a),h=p.useXhr||i.useXhr;return 0===o.indexOf("empty:")?void n():void(!u||h(o,c,d,f)?i.get(o,function(e){i.finishLoad(t,s.strip,e,n)},function(t){n.error&&n.error(t)}):e([a],function(t){i.finishLoad(s.moduleName+"."+s.ext,s.strip,t,n)}))},write:function(t,e,n){if(m.hasOwnProperty(e)){var r=i.jsEscape(m[e]);n.asModule(t+"!"+e,"define(function () { return '"+r+"';});\n")}},writeFile:function(t,e,n,r,s){var a=i.parseName(e),o=a.ext?"."+a.ext:"",h=a.moduleName+o,l=n.toUrl(a.moduleName+o)+".js";i.load(h,n,function(){var e=function(t){return r(l,t)};e.asModule=function(t,e){return r.asModule(t,l,e)},i.write(t,h,e,s)},s)}},"node"===p.env||!p.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(n=e.nodeRequire("fs"),i.get=function(t,e,i){try{var r=n.readFileSync(t,"utf8");0===r.indexOf("﻿")&&(r=r.substring(1)),e(r)}catch(s){i&&i(s)}}):"xhr"===p.env||!p.env&&i.createXhr()?i.get=function(t,e,n,r){var s,a=i.createXhr();if(a.open("GET",t,!0),r)for(s in r)r.hasOwnProperty(s)&&a.setRequestHeader(s.toLowerCase(),r[s]);p.onXhr&&p.onXhr(a,t),a.onreadystatechange=function(){var i,r;4===a.readyState&&(i=a.status||0,i>399&&600>i?(r=new Error(t+" HTTP status: "+i),r.xhr=a,n&&n(r)):e(a.responseText),p.onXhrComplete&&p.onXhrComplete(a,t))},a.send(null)}:"rhino"===p.env||!p.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?i.get=function(t,e){var i,n,r="utf-8",s=new java.io.File(t),a=java.lang.System.getProperty("line.separator"),o=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),r)),h="";try{for(i=new java.lang.StringBuffer,n=o.readLine(),n&&n.length()&&65279===n.charAt(0)&&(n=n.substring(1)),null!==n&&i.append(n);null!==(n=o.readLine());)i.append(a),i.append(n);h=String(i.toString())}finally{o.close()}e(h)}:("xpconnect"===p.env||!p.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(r=Components.classes,s=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),a="@mozilla.org/windows-registry-key;1"in r,i.get=function(t,e){var i,n,o,h={};a&&(t=t.replace(/\//g,"\\")),o=new FileUtils.File(t);try{i=r["@mozilla.org/network/file-input-stream;1"].createInstance(s.nsIFileInputStream),i.init(o,1,0,!1),n=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(s.nsIConverterInputStream),n.init(i,"utf-8",i.available(),s.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),n.readString(i.available(),h),n.close(),i.close(),e(h.value)}catch(l){throw new Error((o&&o.path||"")+": "+l)}}),i}),i("text!SCENERY/display/webgl/color2d.vert",[],function(){return"//This shader assumes 2d vertices that have a specified color.\n\n// Position\nattribute vec3 aPosition;\n\n// Color for the vertex\nattribute vec4 aVertexColor;\n\n// Output to the fragment shader\nvarying vec4 vColor;\n\n// (x,y) size of the viewport\nuniform vec2 uResolution;\n\n// Components of the affine transform matrix.  6 float elements, so specified as two vec3\nattribute vec3 aTransform1;\nattribute vec3 aTransform2;\n\nvoid main(void) {\n\n  //This transform code is based on http://www.html5rocks.com/en/tutorials/webgl/webgl_fundamentals/\n  //TODO: Should be converted to matrix multiply, probably faster.\n\n  // Just do the affine transform ourselves.\n  // see http://cs.iupui.edu/~sfang/cs550/cs550-note3.pdf\n  vec2 transformed = vec2( aTransform1.x * aPosition.x + aTransform1.y * aPosition.y + aTransform1.z,\n                           aTransform2.x * aPosition.x + aTransform2.y * aPosition.y + aTransform2.z );\n\n  // convert the rectangle from pixels to 0.0 to 1.0\n  vec2 zeroToOne = vec2( transformed.x / uResolution.x , transformed.y / uResolution.y );\n\n  // convert from 0->1 to 0->2\n  vec2 zeroToTwo = zeroToOne * 2.0;\n\n  // convert from 0->2 to -1->+1 (clipspace)\n  vec2 clipSpace = zeroToTwo - 1.0;\n\n  gl_Position = vec4(clipSpace * vec2(1, -1), aPosition.z, 1.0); //0. is the z, and 1 is w\n  vColor = aVertexColor;\n}"}),i("text!SCENERY/display/webgl/color2d.frag",[],function(){return"// Simple fragment shader that simply uses the color provided by the vertex shader\nprecision mediump float;\n\n// Color from the vertex shader\nvarying vec4 vColor;\n\n// Returns the color from the vertex shader\nvoid main(void) {\n  gl_FragColor = vColor;\n}"}),i("SCENERY/display/webgl/ColorTriangleRenderer",["require","PHET_CORE/inherit","SCENERY/display/webgl/colorTriangleBufferData","SCENERY/display/webgl/WebGLUtil","text!SCENERY/display/webgl/color2d.vert","text!SCENERY/display/webgl/color2d.frag"],function(t){function e(t,e,i){this.gl=t,this.canvas=i,this.backingScale=e,this.colorTriangleBufferData=new n,this.colorShaderProgram=t.createProgram(),t.attachShader(this.colorShaderProgram,r.toShader(t,s,t.VERTEX_SHADER,"VERTEX")),t.attachShader(this.colorShaderProgram,r.toShader(t,a,t.FRAGMENT_SHADER,"FRAGMENT")),t.linkProgram(this.colorShaderProgram),this.positionAttribLocation=t.getAttribLocation(this.colorShaderProgram,"aPosition"),this.colorAttributeLocation=t.getAttribLocation(this.colorShaderProgram,"aVertexColor"),this.transform1AttributeLocation=t.getAttribLocation(this.colorShaderProgram,"aTransform1"),this.transform2AttributeLocation=t.getAttribLocation(this.colorShaderProgram,"aTransform2"),t.enableVertexAttribArray(this.positionAttribLocation),t.enableVertexAttribArray(this.colorAttributeLocation),t.enableVertexAttribArray(this.transform1AttributeLocation),t.enableVertexAttribArray(this.transform2AttributeLocation),t.useProgram(this.colorShaderProgram),this.resolutionLocation=t.getUniformLocation(this.colorShaderProgram,"uResolution"),this.vertexBuffer=t.createBuffer(),this.bindVertexBuffer(),t.clearColor(0,0,0,0),t.enable(t.DEPTH_TEST)}var i=t("PHET_CORE/inherit"),n=t("SCENERY/display/webgl/colorTriangleBufferData"),r=t("SCENERY/display/webgl/WebGLUtil"),s=t("text!SCENERY/display/webgl/color2d.vert"),a=t("text!SCENERY/display/webgl/color2d.frag");return i(Object,e,{draw:function(){var t=this.gl,e=Float32Array.BYTES_PER_ELEMENT,i=13,n=e*i;t.useProgram(this.colorShaderProgram),t.enableVertexAttribArray(this.positionAttribLocation),t.enableVertexAttribArray(this.colorAttributeLocation),t.enableVertexAttribArray(this.transform1AttributeLocation),t.enableVertexAttribArray(this.transform2AttributeLocation),t.uniform2f(this.resolutionLocation,this.canvas.width/this.backingScale,this.canvas.height/this.backingScale),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.vertexAttribPointer(this.positionAttribLocation,3,t.FLOAT,!1,n,0),t.vertexAttribPointer(this.colorAttributeLocation,4,t.FLOAT,!1,n,3*e),t.vertexAttribPointer(this.transform1AttributeLocation,3,t.FLOAT,!1,n,7*e),t.vertexAttribPointer(this.transform2AttributeLocation,3,t.FLOAT,!1,n,10*e),t.drawArrays(t.TRIANGLES,0,this.colorTriangleBufferData.vertexArray.length/13),t.disableVertexAttribArray(this.positionAttribLocation),t.disableVertexAttribArray(this.colorAttributeLocation),t.disableVertexAttribArray(this.transform1AttributeLocation),t.disableVertexAttribArray(this.transform2AttributeLocation)},bindVertexBuffer:function(){var t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray=new Float32Array(this.colorTriangleBufferData.vertexArray),t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.DYNAMIC_DRAW)},reBufferData:function(){var t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.DYNAMIC_DRAW)},updateTriangleBuffer:function(t){var e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer);for(var i=t.startIndex;i<t.endIndex;i++)this.vertexArray[i]=this.colorTriangleBufferData.vertexArray[i];var n=this.vertexArray.subarray(t.startIndex,t.endIndex);e.bufferSubData(e.ARRAY_BUFFER,4*t.startIndex,n)}})}),i("SCENERY/display/webgl/TextureBufferData",["require","PHET_CORE/inherit"],function(t){function e(){this.vertexArray=[]}var i=t("PHET_CORE/inherit");return i(Object,e,{createFromImageNode:function(t,e,i){return this.createFromImage(t.x,t.y,e,t._image.width,t._image.height,t.image,t.getLocalToGlobalMatrix().toMatrix4(),i)},createFromImage:function(t,e,i,n,r,s,a,o){var h=this,l=this.vertexArray.length,u=t,c=t+n,d=e,f=e+r,m=o.bounds.minX,p=o.bounds.maxX,g=o.bounds.minY,v=o.bounds.maxY;return this.vertexArray.push(u,d,i,m,g,a.m00(),a.m01(),a.m02(),a.m10(),a.m11(),a.m12(),c,d,i,p,g,a.m00(),a.m01(),a.m02(),a.m10(),a.m11(),a.m12(),u,f,i,m,v,a.m00(),a.m01(),a.m02(),a.m10(),a.m11(),a.m12(),u,f,i,m,v,a.m00(),a.m01(),a.m02(),a.m10(),a.m11(),a.m12(),c,d,i,p,g,a.m00(),a.m01(),a.m02(),a.m10(),a.m11(),a.m12(),c,f,i,p,v,a.m00(),a.m01(),a.m02(),a.m10(),a.m11(),a.m12()),{startIndex:l,endIndex:h.vertexArray.length,image:s,frameRange:o,setTransform:function(t){for(var e=0;6>e;e++)h.vertexArray[l+5+11*e]=t.m00(),h.vertexArray[l+6+11*e]=t.m01(),h.vertexArray[l+7+11*e]=t.m03(),h.vertexArray[l+8+11*e]=t.m10(),h.vertexArray[l+9+11*e]=t.m11(),h.vertexArray[l+10+11*e]=t.m13()},setXWidth:function(t,e){h.vertexArray[l]=t,h.vertexArray[l+2]=t+e,h.vertexArray[l+4]=t,h.vertexArray[l+6]=t+e,h.vertexArray[l+8]=t+e,h.vertexArray[l+10]=t},setRect:function(t,e,i,n){h.vertexArray[l]=t,h.vertexArray[l+1]=e,h.vertexArray[l+2]=t+i,h.vertexArray[l+3]=e,h.vertexArray[l+4]=t,h.vertexArray[l+5]=e+n,h.vertexArray[l+6]=t+i,h.vertexArray[l+7]=e+n,h.vertexArray[l+8]=t+i,h.vertexArray[l+9]=e,h.vertexArray[l+10]=t,h.vertexArray[l+11]=e+n}}}})}),i("SCENERY/display/webgl/BlockItem",["require","PHET_CORE/inherit"],function(t){function e(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n,this.used=!1,this.position=null,this.right=null,this.down=null}var i=t("PHET_CORE/inherit");return i(Object,e)}),i("SCENERY/display/webgl/Packer",["require","PHET_CORE/inherit","SCENERY/display/webgl/BlockItem","DOT/Vector2"],function(t){function e(t,e){this.root=new n(0,0,t,e)}var i=t("PHET_CORE/inherit"),n=t("SCENERY/display/webgl/BlockItem"),r=t("DOT/Vector2");return i(Object,e,{reserveSpace:function(t,e){var i=null,n=this.findBlock(this.root,t,e);return n&&(i=new r(n.x,n.y),this.splitBlock(n,t,e)),i},findBlock:function(t,e,i){return t.used?this.findBlock(t.right,e,i)||this.findBlock(t.down,e,i):e<=t.width&&i<=t.height?t:null},splitBlock:function(t,e,i){t.used=!0,t.right=new n(t.x+e,t.y,t.width-e,i),t.down=new n(t.x,t.y+i,t.width,t.height-i)}})}),i("SCENERY/display/webgl/SpriteSheet",["require","PHET_CORE/inherit","SCENERY/display/webgl/Packer","DOT/Bounds2"],function(t){function e(){this.image=document.createElement("canvas"),this.image.width=2048,this.image.height=2048,this.context=this.image.getContext("2d"),this.packer=new n(this.image.width,this.image.height),this.dirty=!0}var i=t("PHET_CORE/inherit"),n=t("SCENERY/display/webgl/Packer"),r=t("DOT/Bounds2");return i(Object,e,{addImage:function(t){this.context.drawImage(t,0,0),this.dirty=!0},reserveImageSpace:function(t){var e=this.packer.reserveSpace(t.width,t.height),i=null;return e&&(this.context.drawImage(t,e.x,e.y),i=r.rect(e.x/this.image.width,e.y/this.image.height,t.width/this.image.width,t.height/this.image.height)),i}})}),i("SCENERY/display/webgl/FrameRange",["require","PHET_CORE/inherit"],function(t){function e(t,e){this.bounds=t,this.spriteSheetIndex=e}var i=t("PHET_CORE/inherit");return i(Object,e)}),i("SCENERY/display/webgl/SpriteSheetCollection",["require","PHET_CORE/inherit","SCENERY/display/webgl/SpriteSheet","SCENERY/display/webgl/FrameRange"],function(t){function e(){this.spriteSheets=[new n],this.imageFrameRangeCache={}}var i=t("PHET_CORE/inherit"),n=t("SCENERY/display/webgl/SpriteSheet"),r=t("SCENERY/display/webgl/FrameRange");return i(Object,e,{addImage:function(t){if(this.imageFrameRangeCache[t.src])return this.imageFrameRangeCache[t.src];var e=this.spriteSheets[this.spriteSheets.length-1].reserveImageSpace(t);if(!e){var i=new n;e=i.reserveImageSpace(t),this.spriteSheets.push(i)}var s=new r(e,this.spriteSheets.length-1);return this.imageFrameRangeCache[t.src]=s,s}})}),i("text!SCENERY/display/webgl/texture.vert",[],function(){return"// From http://www.html5rocks.com/en/tutorials/webgl/webgl_fundamentals/\n\nattribute vec3 aPosition;\nattribute vec2 aTextureCoordinate;\n\nuniform vec2 uResolution;\n\nvarying vec2 vTextureCoordinate;\n\n// Components of the affine transform matrix.  6 float elements, so specified as two vec3\nattribute vec3 aTransform1;\nattribute vec3 aTransform2;\n\nvoid main() {\n  // Just do the affine transform ourselves.\n  // see http://cs.iupui.edu/~sfang/cs550/cs550-note3.pdf\n  vec2 transformed = vec2( aTransform1.x * aPosition.x + aTransform1.y * aPosition.y + aTransform1.z,\n                           aTransform2.x * aPosition.x + aTransform2.y * aPosition.y + aTransform2.z );\n\n   // convert the rectangle from pixels to 0.0 to 1.0\n   vec2 zeroToOne = transformed / uResolution;\n\n   // convert from 0->1 to 0->2\n   vec2 zeroToTwo = zeroToOne * 2.0;\n\n   // convert from 0->2 to -1->+1 (clipspace)\n   vec2 clipSpace = zeroToTwo - 1.0;\n\n   gl_Position = vec4(clipSpace * vec2(1, -1), aPosition.z, 1);\n\n   // pass the texCoord to the fragment shader\n   // The GPU will interpolate this value between points.\n   vTextureCoordinate = aTextureCoordinate;\n}"}),i("text!SCENERY/display/webgl/texture.frag",[],function(){return"// From http://www.html5rocks.com/en/tutorials/webgl/webgl_fundamentals/\n\nprecision mediump float;\n\n// our texture\nuniform sampler2D uImage;\n\n// the texCoords passed in from the vertex shader.\nvarying vec2 vTextureCoordinate;\n\nvoid main() {\n   gl_FragColor = texture2D(uImage, vTextureCoordinate);\n}"}),i("SCENERY/display/webgl/TextureRenderer",["require","PHET_CORE/inherit","SCENERY/display/webgl/TextureBufferData","SCENERY/display/webgl/SpriteSheetCollection","text!SCENERY/display/webgl/texture.vert","text!SCENERY/display/webgl/texture.frag"],function(t){function e(t,e,i){this.gl=t,this.canvas=i,this.backingScale=e;var n=function(e,i,n){var r=t.createShader(i);return t.shaderSource(r,e),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(console.log("ERROR IN "+n+" SHADER : "+t.getShaderInfoLog(r)),!1)};this.colorShaderProgram=t.createProgram();var o=this.colorShaderProgram;t.attachShader(this.colorShaderProgram,n(s,t.VERTEX_SHADER,"VERTEX")),t.attachShader(this.colorShaderProgram,n(a,t.FRAGMENT_SHADER,"FRAGMENT")),t.linkProgram(this.colorShaderProgram),this.positionLocation=t.getAttribLocation(o,"aPosition"),this.texCoordLocation=t.getAttribLocation(o,"aTextureCoordinate"),this.transform1AttributeLocation=t.getAttribLocation(this.colorShaderProgram,"aTransform1"),this.transform2AttributeLocation=t.getAttribLocation(this.colorShaderProgram,"aTransform2"),this.resolutionLocation=t.getUniformLocation(o,"uResolution"),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.enable(this.gl.BLEND),this.spriteSheetCollection=new r,this.textureBufferDataArray=[],this.vertexBufferArray=[],this.textureArray=[],this.vertexArrayList=[]}var i=t("PHET_CORE/inherit"),n=t("SCENERY/display/webgl/TextureBufferData"),r=t("SCENERY/display/webgl/SpriteSheetCollection"),s=t("text!SCENERY/display/webgl/texture.vert"),a=t("text!SCENERY/display/webgl/texture.frag");return i(Object,e,{createFromImageNode:function(t,e){var i=this.spriteSheetCollection.addImage(t.image);this.textureBufferDataArray[i.spriteSheetIndex]||(this.textureBufferDataArray[i.spriteSheetIndex]=new n,this.vertexBufferArray[i.spriteSheetIndex]=this.gl.createBuffer(),this.textureArray[i.spriteSheetIndex]=this.gl.createTexture());var r=this.textureBufferDataArray[i.spriteSheetIndex];return r.createFromImage(0,0,e,t._image.width,t._image.height,t.image,t.getLocalToGlobalMatrix().toMatrix4(),i)},draw:function(){for(var t=0;t<this.textureArray.length;t++)this.doDraw(t)},doDraw:function(t){var e=this.gl;e.useProgram(this.colorShaderProgram),e.enableVertexAttribArray(this.positionLocation),e.enableVertexAttribArray(this.texCoordLocation),e.enableVertexAttribArray(this.transform1AttributeLocation),e.enableVertexAttribArray(this.transform2AttributeLocation),e.bindTexture(e.TEXTURE_2D,this.textureArray[t]),e.activeTexture(e.TEXTURE0+t),e.uniform2f(this.resolutionLocation,this.canvas.width/this.backingScale,this.canvas.height/this.backingScale);var i=Float32Array.BYTES_PER_ELEMENT,n=11,r=i*n;e.bindBuffer(e.ARRAY_BUFFER,this.vertexBufferArray[t]),e.vertexAttribPointer(this.positionLocation,3,e.FLOAT,!1,r,0),e.vertexAttribPointer(this.texCoordLocation,2,e.FLOAT,!1,r,3*i),e.vertexAttribPointer(this.transform1AttributeLocation,3,e.FLOAT,!1,r,5*i),e.vertexAttribPointer(this.transform2AttributeLocation,3,e.FLOAT,!1,r,8*i),e.drawArrays(e.TRIANGLES,0,this.textureBufferDataArray[t].vertexArray.length/n),e.disableVertexAttribArray(this.texCoordLocation),e.disableVertexAttribArray(this.positionLocation),e.disableVertexAttribArray(this.transform1AttributeLocation),e.disableVertexAttribArray(this.transform2AttributeLocation),e.bindTexture(e.TEXTURE_2D,null)},getSpriteSheets:function(){return this.spriteSheetCollection.spriteSheets},bindDirtyTextures:function(){for(var t=this.gl,e=this.getSpriteSheets(),i=0;i<e.length;i++){var n=e[i];n.dirty&&(t.bindTexture(t.TEXTURE_2D,this.textureArray[i]),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n.image),t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null),n.dirty=!1)}},bindVertexBuffer:function(){for(var t=this.gl,e=this.getSpriteSheets(),i=0;i<e.length;i++)t.bindBuffer(t.ARRAY_BUFFER,this.vertexBufferArray[i]),this.vertexArrayList[i]=new Float32Array(this.textureBufferDataArray[i].vertexArray),t.bufferData(t.ARRAY_BUFFER,this.vertexArrayList[i],t.DYNAMIC_DRAW)},updateTriangleBuffer:function(t){var e=this.gl,i=t.frameRange;e.bindBuffer(e.ARRAY_BUFFER,this.vertexBufferArray[i.spriteSheetIndex]);for(var n=this.vertexArrayList[i.spriteSheetIndex],r=t.startIndex;r<t.endIndex;r++)n[r]=this.textureBufferDataArray[i.spriteSheetIndex].vertexArray[r];var s=n.subarray(t.startIndex,t.endIndex);e.bufferSubData(e.ARRAY_BUFFER,4*t.startIndex,s)}})}),i("SCENERY/display/webgl/WebGLRenderer",["require","PHET_CORE/inherit","AXON/Events","SCENERY/util/Util","SCENERY/display/webgl/ColorTriangleRenderer","SCENERY/display/webgl/TextureRenderer"],function(t){function e(t){t=_.extend({stats:!0},t),this.events=new n,t.stats&&(this.stats=this.createStats()),this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.left="0",this.canvas.style.top="0",this.canvas.style.pointerEvents="none",document.body.appendChild(this.canvas),t.stats&&document.body.appendChild(this.stats.domElement);var e;try{e=this.canvas.getContext("experimental-webgl",{antialias:!0})}catch(i){return!1}this.gl=e,this.backingScale=r.backingScale(this.gl),this.setCanvasSize(window.innerWidth,window.innerHeight),this.colorTriangleRenderer=new s(e,this.backingScale,this.canvas),this.textureRenderer=new a(e,this.backingScale,this.canvas),this.customWebGLRenderers=[],this.boundAnimate=this.animate.bind(this)}var i=t("PHET_CORE/inherit"),n=t("AXON/Events"),r=t("SCENERY/util/Util"),s=t("SCENERY/display/webgl/ColorTriangleRenderer"),a=t("SCENERY/display/webgl/TextureRenderer");return i(Object,e,{addCustomWebGLRenderer:function(t){this.customWebGLRenderers.push(t)},createStats:function(){var t=new Stats;return t.setMode(0),t.domElement.style.position="absolute",t.domElement.style.left="0px",t.domElement.style.top="0px",t},start:function(){window.requestAnimationFrame(this.boundAnimate)},animate:function(){this.stats.begin(),window.requestAnimationFrame(this.boundAnimate),this.events.trigger("step"),this.draw(),this.stats.end()},draw:function(){var t=this.gl;t.viewport(0,0,this.canvas.width,this.canvas.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.colorTriangleRenderer.draw(),this.textureRenderer.draw();for(var e=0;e<this.customWebGLRenderers.length;e++)this.customWebGLRenderers[e].draw();t.flush()},setCanvasSize:function(t,e){this.canvas.style.width=t+"px",this.canvas.style.height=e+"px";var i=window.devicePixelRatio||1;this.canvas.width=t*i,this.canvas.height=e*i},dispose:function(){this.canvas.width=0,this.canvas.height=0}})}),i("SCENERY/display/WebGLBlock",["require","PHET_CORE/inherit","PHET_CORE/PoolableMixin","PHET_CORE/cleanArray","SCENERY/scenery","SCENERY/display/FittedBlock","SCENERY/util/Util","SCENERY/display/webgl/WebGLRenderer"],function(t){var e=t("PHET_CORE/inherit"),i=t("PHET_CORE/PoolableMixin"),n=t("PHET_CORE/cleanArray"),r=t("SCENERY/scenery"),s=t("SCENERY/display/FittedBlock"),a=t("SCENERY/util/Util"),o=t("SCENERY/display/webgl/WebGLRenderer");r.WebGLBlock=function(t,e,i,n){this.initialize(t,e,i,n)};var h=r.WebGLBlock;return e(s,h,{initialize:function(t,e,i,r){return this.initializeFittedBlock(t,e,i),this.fit=s.FULL_DISPLAY,this.filterRootInstance=r,this.dirtyDrawables=n(this.dirtyDrawables),this.webglRenderer=new o({stats:!1}),this.domElement=this.webglRenderer.canvas,this.domElement.style.position="absolute",this.domElement.style.left="0",this.domElement.style.top="0",this.domElement.style.pointerEvents="none",a.prepareForTransform(this.webglRenderer.canvas,this.forceAcceleration),a.unsetTransform(this.webglRenderer.canvas),this.initializeWebGLState(),this
},initializeWebGLState:function(){},setSizeFullDisplay:function(){var t=this.display.getSize();this.webglRenderer.setCanvasSize(t.width,t.height)},setSizeFitBounds:function(){var t=this.fitBounds.minX,e=this.fitBounds.minY;a.setTransform("matrix(1,0,0,1,"+t+","+e+")",this.canvas,this.forceAcceleration),this.webglRenderer.setCanvasSize(this.fitBounds.width,this.fitBounds.height)},update:function(){if(this.dirty&&!this.disposed){for(this.dirty=!1;this.dirtyDrawables.length;)this.dirtyDrawables.pop().update();this.updateFit(),this.webglRenderer.draw()}},dispose:function(){this.webglRenderer.dispose(),n(this.dirtyDrawables),s.prototype.dispose.call(this)},markDirtyDrawable:function(t){this.dirtyDrawables.push(t),this.markDirty()},addDrawable:function(t){s.prototype.addDrawable.call(this,t),t.initializeContext(this),this.webglRenderer.colorTriangleRenderer.bindVertexBuffer()},removeDrawable:function(t){s.prototype.removeDrawable.call(this,t)},onIntervalChange:function(t,e){s.prototype.onIntervalChange.call(this,t,e)},onPotentiallyMovedDrawable:function(t){t.markDirty()},simulateWebGLContextLoss:function(){console.log("simulating webgl context loss in WebGLBlock"),this.canvas.loseContextInNCalls(5)},toString:function(){return"WebGLBlock#"+this.id+"-"+s.fitString[this.fit]}},{fragmentTypeFill:0,fragmentTypeTexture:1}),i(h,{constructorDuplicateFactory:function(t){return function(e,i,n,r){return t.length?t.pop().initialize(e,i,n,r):new h(e,i,n,r)}}}),h}),i("SCENERY/nodes/Path",["require","PHET_CORE/inherit","KITE/Shape","SCENERY/scenery","SCENERY/nodes/Node","SCENERY/display/Renderer","SCENERY/nodes/Paintable","SCENERY/display/SVGSelfDrawable","SCENERY/display/CanvasSelfDrawable","SCENERY/display/SelfDrawable","SCENERY/display/WebGLSelfDrawable","SCENERY/display/WebGLBlock","SCENERY/util/Util"],function(t){var e=t("PHET_CORE/inherit"),i=t("KITE/Shape"),n=t("SCENERY/scenery"),r=t("SCENERY/nodes/Node");t("SCENERY/display/Renderer");var s=t("SCENERY/nodes/Paintable"),a=t("SCENERY/display/SVGSelfDrawable"),o=t("SCENERY/display/CanvasSelfDrawable"),h=t("SCENERY/display/SelfDrawable"),l=t("SCENERY/display/WebGLSelfDrawable"),u=t("SCENERY/display/WebGLBlock"),c=t("SCENERY/util/Util"),d=!0;n.Path=function(t,e){this._shape=null,this._strokedShape=null,e=e||{},this.initializePaintable(),r.call(this),this.invalidateSupportedRenderers(),this.setShape(t),this.mutate(e)};var f=n.Path;e(r,f,{getPathRendererBitmask:function(){return n.bitmaskBoundsValid|n.bitmaskSupportsCanvas|n.bitmaskSupportsSVG|n.bitmaskSupportsWebGL|n.bitmaskSupportsPixi},invalidateSupportedRenderers:function(){this.setRendererBitmask(this.getFillRendererBitmask()&this.getStrokeRendererBitmask()&this.getPathRendererBitmask())},setShape:function(t){if(this._shape!==t){"string"==typeof t&&(t=new i(t)),this._shape=t,this.invalidateShape();for(var e=this._drawables.length,n=0;e>n;n++)this._drawables[n].markDirtyShape()}return this},getShape:function(){return this._shape},getStrokedShape:function(){return this._strokedShape||(this._strokedShape=this.getShape().getStrokedShape(this._lineDrawingStyles)),this._strokedShape},invalidateShape:function(){this._strokedShape=null,this.hasShape()&&this.invalidateSelf(this.computeShapeBounds())},computeShapeBounds:function(){return this._stroke?this.getStrokedShape().bounds:this.getShape().bounds},getTransformedSelfBounds:function(t){return(this._stroke?this.getStrokedShape():this.getShape()).getBoundsWithTransform(t)},invalidateStroke:function(){this.invalidateShape()},hasShape:function(){return this._shape},canvasPaintSelf:function(t){f.PathCanvasDrawable.prototype.paintCanvas(t,this)},createSVGDrawable:function(t,e){return f.PathSVGDrawable.createFromPool(t,e)},createCanvasDrawable:function(t,e){return f.PathCanvasDrawable.createFromPool(t,e)},createWebGLDrawable:function(t,e){return f.PathWebGLDrawable.createFromPool(t,e)},isPainted:function(){return!0},containsPointSelf:function(t){var e=!1;return this.hasShape()?(this._fillPickable&&(e=this.getShape().containsPoint(t)),!e&&this._strokePickable&&(e=this.getStrokedShape().containsPoint(t)),e):e},intersectsBoundsSelf:function(t){return this.hasShape()?this._shape.intersectsBounds(t):!1},set shape(t){this.setShape(t)},get shape(){return this.getShape()},getDebugHTMLExtras:function(){return this._shape?" (<span style=\"color: #88f\" onclick=\"window.open( 'data:text/plain;charset=utf-8,' + encodeURIComponent( '"+this._shape.getSVGPath()+"' ) );\">path</span>)":""},getBasicConstructor:function(t){return"new scenery.Path( "+(this._shape?this._shape.toString():this._shape)+", {"+t+"} )"},getPropString:function(t,e){var i=r.prototype.getPropString.call(this,t,e);return i=this.appendFillablePropString(t,i),i=this.appendStrokablePropString(t,i)}}),f.prototype._mutatorKeys=["shape"].concat(r.prototype._mutatorKeys),s(f);var m=f.PathStatefulDrawableMixin=function(t){var e=t.prototype;e.initializeState=function(){return this.paintDirty=!0,this.dirtyShape=!0,this.initializePaintableState(),this},e.markPaintDirty=function(){this.paintDirty=!0,this.markDirty()},e.markDirtyShape=function(){this.dirtyShape=!0,this.markPaintDirty()},e.setToCleanState=function(){this.paintDirty=!1,this.dirtyShape=!1,this.cleanPaintableState()},s.PaintableStatefulDrawableMixin(t)};return f.PathSVGDrawable=a.createDrawable({type:function(t,e){this.initialize(t,e)},stateType:m,initialize:function(){this.svgElement||(this.svgElement=document.createElementNS(n.svgns,"path"))},updateSVG:function(t,e){if(this.dirtyShape){var i=t.hasShape()?t._shape.getSVGPath():"";i||(i="M0 0"),e.setAttribute("d",i)}this.updateFillStrokeStyle(e)},usesPaint:!0,keepElements:d}),f.PathCanvasDrawable=o.createDrawable({type:function(t,e){this.initialize(t,e)},paintCanvas:function(t,e){var i=t.context;e.hasShape()&&(i.beginPath(),e._shape.writeToContext(i),e._fill&&(e.beforeCanvasFill(t),i.fill(),e.afterCanvasFill(t)),e._stroke&&(e.beforeCanvasStroke(t),i.stroke(),e.afterCanvasStroke(t)))},usesPaint:!0,dirtyMethods:["markDirtyShape"]}),f.PathWebGLDrawable=e(l,function(t,e){this.initialize(t,e)},{initialize:function(t,e){this.initializeWebGLSelfDrawable(t,e),this.vertexCoordinates=this.vertexCoordinates||new Float32Array(8),this.textureCoordinates=this.textureCoordinates||new Float32Array([0,0,1,0,0,1,1,1])},initializeContext:function(t){this.gl=t,this.disposeWebGLBuffers(),this.vertexBuffer=t.createBuffer(),this.textureBuffer=t.createBuffer(),this.updateImage()},transformVertexCoordinateX:function(t){return t*this.canvasWidth+this.cachedBounds.minX},transformVertexCoordinateY:function(t){return(1-t)*this.canvasHeight+this.cachedBounds.minY},updateImage:function(){var t=this.gl;if(null!==this.texture&&t.deleteTexture(this.texture),this.node._shape){var e=document.createElement("canvas"),i=e.getContext("2d");this.cachedBounds=this.node.getShape().bounds,console.log(this.cachedBounds),this.canvasWidth=e.width=c.toPowerOf2(this.cachedBounds.width),this.canvasHeight=e.height=c.toPowerOf2(this.cachedBounds.height);var n=this.node.toCanvasNodeSynchronous().children[0].image;i.drawImage(n,0,0);var r=this.texture=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_NEAREST),t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null),this.vertexCoordinates[0]=this.transformVertexCoordinateX(0),this.vertexCoordinates[1]=this.transformVertexCoordinateY(0),this.vertexCoordinates[2]=this.transformVertexCoordinateX(1),this.vertexCoordinates[3]=this.transformVertexCoordinateY(0),this.vertexCoordinates[4]=this.transformVertexCoordinateX(0),this.vertexCoordinates[5]=this.transformVertexCoordinateY(1),this.vertexCoordinates[6]=this.transformVertexCoordinateX(1),this.vertexCoordinates[7]=this.transformVertexCoordinateY(1),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertexCoordinates,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.textureBuffer),t.bufferData(t.ARRAY_BUFFER,this.textureCoordinates,t.STATIC_DRAW)}},render:function(t){if(this.node._shape){var e=this.gl,i=this.instance.relativeTransform.matrix.toAffineMatrix4();e.uniformMatrix4fv(t.uniformLocations.uModelViewMatrix,!1,i.entries),e.uniform1i(t.uniformLocations.uTexture,0),e.uniform1i(t.uniformLocations.uFragmentType,u.fragmentTypeTexture),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.texture),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.vertexAttribPointer(t.attributeLocations.aVertex,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.textureBuffer),e.vertexAttribPointer(t.attributeLocations.aTexCoord,2,e.FLOAT,!1,0,0),e.drawArrays(e.TRIANGLE_STRIP,0,4)}},shaderAttributes:["aVertex","aTexCoord"],dispose:function(){this.gl&&(this.disposeWebGLBuffers(),this.gl=null),l.prototype.dispose.call(this)},disposeWebGLBuffers:function(){this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.textureBuffer),this.gl.deleteTexture(this.texture)},markDirtyRectangle:function(){this.markDirty()},markPaintDirty:function(){this.markDirty()},onAttach:function(){},onDetach:function(){},update:function(){this.dirtyShape&&(this.updateImage(),this.setToCleanState()),this.dirty=!1}}),h.PoolableMixin(f.PathWebGLDrawable),m(f.PathWebGLDrawable),f}),i("DOT/Dimension2",["require","DOT/dot","DOT/Bounds2"],function(t){var e=t("DOT/dot");t("DOT/Bounds2"),e.Dimension2=function(t,e){this.width=t,this.height=e};var i=e.Dimension2;return i.prototype={constructor:i,toString:function(){return"["+this.width+"w, "+this.height+"h]"},set:function(t){return this.width=t.width,this.height=t.height,this},setWidth:function(t){return this.width=t,this},setHeight:function(t){return this.width=t,this},copy:function(t){return t?t.set(this):new i(this.width,this.height)},toBounds:function(t,i){return t=t||0,i=i||0,new e.Bounds2(t,i,this.width+t,this.height+i)},equals:function(t){return this.width===t.width&&this.height===t.height}},i}),i("SCENERY/display/DOMSelfDrawable",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/display/SelfDrawable","SCENERY/display/Renderer"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/display/SelfDrawable");t("SCENERY/display/Renderer"),i.DOMSelfDrawable=function(t,e){throw this.initializeDOMSelfDrawable(t,e),new Error("Should use initialization and pooling")};var r=i.DOMSelfDrawable;return e(n,r,{initializeDOMSelfDrawable:function(t,e){return this.transformListener=this.transformListener||this.markTransformDirty.bind(this),this.initializeSelfDrawable(t,e),this.forceAcceleration=0!==(t&i.Renderer.bitmaskForceAcceleration),this.markTransformDirty(),e.relativeTransform.addListener(this.transformListener),e.relativeTransform.addPrecompute(),this},markTransformDirty:function(){this.transformDirty=!0,this.markDirty()},getTransformMatrix:function(){return this.instance.relativeTransform.validate(),this.instance.relativeTransform.matrix},update:function(){this.dirty&&(this.dirty=!1,this.updateDOM())},updateDOM:function(){},onAttach:function(){},onDetach:function(){},dispose:function(){this.instance.relativeTransform.removeListener(this.transformListener),this.instance.relativeTransform.removePrecompute(),n.prototype.dispose.call(this)}}),r}),i("SCENERY/display/PixiSelfDrawable",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/display/SelfDrawable"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/display/SelfDrawable");i.PixiSelfDrawable=function(t,e){throw this.initializePixiSelfDrawable(t,e),new Error("Should use initialization and pooling")};var r=i.PixiSelfDrawable;return e(n,r,{initializePixiSelfDrawable:function(t,e){return this.initializeSelfDrawable(t,e),this.transformListener=this.transformListener||this.markTransformDirty.bind(this),e.relativeTransform.addListener(this.transformListener),e.relativeTransform.addPrecompute(),this},markTransformDirty:function(){this.markDirty()},dispose:function(){this.instance.relativeTransform.removeListener(this.transformListener),this.instance.relativeTransform.removePrecompute(),n.prototype.dispose.call(this)}}),r}),i("SCENERY/display/webgl/SquareUnstrokedRectangle",["require","PHET_CORE/inherit"],function(t){function e(t,e,i){this.z=i,this.rectangle=e,this.colorTriangleBufferData=t.colorTriangleBufferData,this.colorTriangleRenderer=t,this.indexObject=this.colorTriangleBufferData.reserveVertices(6),this.startIndex=this.indexObject.startIndex,this.endIndex=this.indexObject.endIndex,this.update()}var i=t("PHET_CORE/inherit");return i(Object,e,{update:function(){for(var t=this.rectangle._rectX,e=this.rectangle._rectY,i=this.rectangle._rectWidth,n=this.rectangle._rectHeight,r=this.z,s=this.rectangle.fillColor,a=s.red/255,o=s.green/255,h=s.blue/255,l=s.alpha,u=this.rectangle.getLocalToGlobalMatrix().toMatrix4(),c=[t,e,r,a,o,h,l,u.m00(),u.m01(),u.m03(),u.m10(),u.m11(),u.m13(),t+i,e,r,a,o,h,l,u.m00(),u.m01(),u.m03(),u.m10(),u.m11(),u.m13(),t,e+n,r,a,o,h,l,u.m00(),u.m01(),u.m03(),u.m10(),u.m11(),u.m13(),t+i,e+n,r,a,o,h,l,u.m00(),u.m01(),u.m03(),u.m10(),u.m11(),u.m13(),t+i,e,r,a,o,h,l,u.m00(),u.m01(),u.m03(),u.m10(),u.m11(),u.m13(),t,e+n,r,a,o,h,l,u.m00(),u.m01(),u.m03(),u.m10(),u.m11(),u.m13()],d=0;d<c.length;d++)this.colorTriangleBufferData.vertexArray[this.startIndex+d]=c[d];this.colorTriangleRenderer.updateTriangleBuffer(this)}})}),i("SCENERY/nodes/Rectangle",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/nodes/Path","KITE/Shape","DOT/Bounds2","DOT/Dimension2","DOT/Matrix3","SCENERY/util/Features","SCENERY/util/Color","SCENERY/nodes/Paintable","SCENERY/display/DOMSelfDrawable","SCENERY/display/SVGSelfDrawable","SCENERY/display/CanvasSelfDrawable","SCENERY/display/WebGLSelfDrawable","SCENERY/display/PixiSelfDrawable","SCENERY/display/SelfDrawable","SCENERY/display/webgl/SquareUnstrokedRectangle"],function(t){function e(t){var e="getRect"+t,i="setRect"+t,n="_rect"+t,r="markDirty"+t;_.prototype[e]=function(){return this[n]},_.prototype[i]=function(t){if(this[n]!==t){this[n]=t;for(var e=this._drawables.length,i=0;e>i;i++){var s=this._drawables[i];s[r](),s.markPaintDirty()}this.invalidateRectangle()}return this},Object.defineProperty(_.prototype,"rect"+t,{set:_.prototype[i],get:_.prototype[e]})}var i=t("PHET_CORE/inherit"),n=t("SCENERY/scenery"),r=t("SCENERY/nodes/Path"),s=t("KITE/Shape"),a=t("DOT/Bounds2"),o=t("DOT/Dimension2"),h=t("DOT/Matrix3"),l=t("SCENERY/util/Features"),u=t("SCENERY/util/Color"),c=t("SCENERY/nodes/Paintable"),d=t("SCENERY/display/DOMSelfDrawable"),f=t("SCENERY/display/SVGSelfDrawable"),m=t("SCENERY/display/CanvasSelfDrawable"),p=t("SCENERY/display/WebGLSelfDrawable"),g=t("SCENERY/display/PixiSelfDrawable"),v=t("SCENERY/display/SelfDrawable"),b=t("SCENERY/display/webgl/SquareUnstrokedRectangle"),y=!0,E=!0,x=h.dirtyFromPool();n.Rectangle=function(t,e,i,n,s,o,h){"object"==typeof t?t instanceof a?(this._rectX=t.minX,this._rectY=t.minY,this._rectWidth=t.width,this._rectHeight=t.height,arguments.length<3?(h=e,this._rectArcWidth=0,this._rectArcHeight=0):(h=n,this._rectArcWidth=e,this._rectArcHeight=i)):(h=t,this._rectX=h.rectX||0,this._rectY=h.rectY||0,this._rectWidth=h.rectWidth,this._rectHeight=h.rectHeight,this._rectArcWidth=h.rectArcWidth||0,this._rectArcHeight=h.rectArcHeight||0):arguments.length<6?(this._rectX=t,this._rectY=e,this._rectWidth=i,this._rectHeight=n,this._rectArcWidth=0,this._rectArcHeight=0,h=s||{}):(this._rectX=t,this._rectY=e,this._rectWidth=i,this._rectHeight=n,this._rectArcWidth=s,this._rectArcHeight=o,h=h||{}),r.call(this,null,h)};var _=n.Rectangle;i(r,_,{getMaximumArcSize:function(){return Math.min(this._rectWidth/2,this._rectHeight/2)},getStrokeRendererBitmask:function(){var t=r.prototype.getStrokeRendererBitmask.call(this);return!this.hasStroke()||this.getStroke().isGradient||this.getStroke().isPattern||this.hasLineDash()||("miter"===this.getLineJoin()||"round"===this.getLineJoin()&&l.borderRadius)&&(t|=n.bitmaskSupportsDOM),this.hasStroke()||(t|=n.bitmaskSupportsWebGL,t|=n.bitmaskSupportsPixi),t},getPathRendererBitmask:function(){var t=n.bitmaskSupportsCanvas|n.bitmaskSupportsSVG|n.bitmaskBoundsValid,e=this.getMaximumArcSize();return(!this.hasStroke()||this.getLineWidth()<=this._rectHeight&&this.getLineWidth()<=this._rectWidth)&&(!this.isRounded()||l.borderRadius&&this._rectArcWidth===this._rectArcHeight)&&this._rectArcHeight<=e&&this._rectArcWidth<=e&&(t|=n.bitmaskSupportsDOM),this.isRounded()||this.hasStroke()&&"round"===this.getLineJoin()||(t|=n.bitmaskSupportsWebGL,t|=n.bitmaskSupportsPixi),t},setRect:function(t,e,i,n,r,s){if(this._rectX!==t||this._rectY!==e||this._rectWidth!==i||this._rectHeight!==n||this._rectArcWidth!==r||this._rectArcHeight!==s){this._rectX=t,this._rectY=e,this._rectWidth=i,this._rectHeight=n,this._rectArcWidth=r||0,this._rectArcHeight=s||0;for(var a=this._drawables.length,o=0;a>o;o++)this._drawables[o].markDirtyRectangle();this.invalidateRectangle()}},setRectBounds:function(t){this.setRect(t.x,t.y,t.width,t.height)},set rectBounds(t){this.setRectBounds(t)},getRectBounds:function(){return a.rect(this._rectX,this._rectY,this._rectWidth,this._rectHeight)},get rectBounds(){return this.getRectBounds()},setRectSize:function(t){this.setRectWidth(t.width),this.setRectHeight(t.height)},set rectSize(t){this.setRectSize(t)},getRectSize:function(){return new o(this._rectWidth,this._rectHeight)},get rectSize(){return this.getRectSize()},setRectWidthFromRight:function(t){if(this._rectWidth!==t){var e=this._rectX+this._rectWidth;this.setRectWidth(t),this.setRectX(e-t)}},set rectWidthFromRight(t){this.setRectWidthFromRight(t)},get rectWidthFromRight(){return this.getRectWidth()},setRectHeightFromBottom:function(t){if(this._rectHeight!==t){var e=this._rectY+this._rectHeight;this.setRectHeight(t),this.setRectY(e-t)}},set rectHeightFromBottom(t){this.setRectHeightFromBottom(t)},get rectHeightFromBottom(){return this.getRectHeight()},isRounded:function(){return 0!==this._rectArcWidth&&0!==this._rectArcHeight},computeShapeBounds:function(){var t=new a(this._rectX,this._rectY,this._rectX+this._rectWidth,this._rectY+this._rectHeight);return this._stroke&&(t=t.dilated(this.getLineWidth()/2)),t},getTransformedSelfBounds:function(t){return this._selfBounds.transformed(t)},createRectangleShape:function(){if(this.isRounded()){var t=Math.min(this._rectWidth/2,this._rectHeight/2);return s.roundRectangle(this._rectX,this._rectY,this._rectWidth,this._rectHeight,Math.min(t,this._rectArcWidth),Math.min(t,this._rectArcHeight))}return s.rectangle(this._rectX,this._rectY,this._rectWidth,this._rectHeight)},invalidateRectangle:function(){this._shape=null,this.invalidateShape(),this.invalidateSupportedRenderers()},containsPointSelf:function(t){var e=this._rectX,i=this._rectY,n=this._rectWidth,s=this._rectHeight,a=this._rectArcWidth,o=this._rectArcHeight,h=this.getLineWidth()/2,l=!0;if(this._strokePickable){var u=this.isRounded();if(!u&&"bevel"===this.getLineJoin())return r.prototype.containsPointSelf.call(this,t);var c="miter"===this.getLineJoin()&&!u;l=l&&_.intersects(e-h,i-h,n+2*h,s+2*h,c?0:a+h,c?0:o+h,t)}return this._fillPickable?this._strokePickable?l:_.intersects(e,i,n,s,a,o,t):this._strokePickable?l&&!_.intersects(e+h,i+h,n-2*h,s-2*h,a-h,o-h,t):!1},intersectsBoundsSelf:function(t){return!this.computeShapeBounds().intersection(t).isEmpty()},canvasPaintSelf:function(t){_.RectangleCanvasDrawable.prototype.paintCanvas(t,this)},createDOMDrawable:function(t,e){return _.RectangleDOMDrawable.createFromPool(t,e)},createSVGDrawable:function(t,e){return _.RectangleSVGDrawable.createFromPool(t,e)},createCanvasDrawable:function(t,e){return _.RectangleCanvasDrawable.createFromPool(t,e)},createWebGLDrawable:function(t,e){return _.RectangleWebGLDrawable.createFromPool(t,e)},createPixiDrawable:function(t,e){return _.RectanglePixiDrawable.createFromPool(t,e)},getBasicConstructor:function(t){return"new scenery.Rectangle( "+this._rectX+", "+this._rectY+", "+this._rectWidth+", "+this._rectHeight+", "+this._rectArcWidth+", "+this._rectArcHeight+", {"+t+"} )"},setShape:function(t){if(null!==t)throw new Error("Cannot set the shape of a scenery.Rectangle to something non-null");this.invalidateShape()},getShape:function(){return this._shape||(this._shape=this.createRectangleShape()),this._shape},hasShape:function(){return!0}}),e("X"),e("Y"),e("Width"),e("Height"),e("ArcWidth"),e("ArcHeight"),_.prototype._mutatorKeys=["rectX","rectY","rectWidth","rectHeight","rectArcWidth","rectArcHeight"].concat(r.prototype._mutatorKeys),_.intersects=function(t,e,i,n,r,s,a){var o=a.x>=t&&a.x<=t+i&&a.y>=e&&a.y<=e+n;if(!o||0>=r||0>=s)return o;var h=Math.min(i/2,n/2);r=Math.min(h,r),s=Math.min(h,s);var l,u,c=!1;if(a.x<t+i/2?(l=t+r,c=c||a.x>=l):(l=t+i-r,c=c||a.x<=l),c)return!0;if(a.y<e+n/2?(u=e+s,c=c||a.y>=u):(u=e+n-s,c=c||a.y<=u),c)return!0;var d=a.x-l,f=a.y-u;return d/=r,f/=s,d*=d,f*=f,1>=d+f},_.rect=function(t,e,i,n,r){return new _(t,e,i,n,0,0,r)},_.roundedRect=function(t,e,i,n,r,s,a){return new _(t,e,i,n,r,s,a)},_.bounds=function(t,e){return new _(t.minX,t.minY,t.width,t.height,0,0,e)},_.roundedBounds=function(t,e,i,n){return new _(t.minX,t.minY,t.width,t.height,e,i,n)};var S=_.RectangleStatefulDrawableMixin=function(t){var e=t.prototype;e.initializeState=function(){return this.paintDirty=!0,this.dirtyX=!0,this.dirtyY=!0,this.dirtyWidth=!0,this.dirtyHeight=!0,this.dirtyArcWidth=!0,this.dirtyArcHeight=!0,this.initializePaintableState(),this},e.markPaintDirty=function(){this.paintDirty=!0,this.markDirty()},e.markDirtyRectangle=function(){this.dirtyX=!0,this.dirtyY=!0,this.dirtyWidth=!0,this.dirtyHeight=!0,this.dirtyArcWidth=!0,this.dirtyArcHeight=!0,this.markPaintDirty()},e.markDirtyX=function(){this.dirtyX=!0,this.markPaintDirty()},e.markDirtyY=function(){this.dirtyY=!0,this.markPaintDirty()},e.markDirtyWidth=function(){this.dirtyWidth=!0,this.markPaintDirty()},e.markDirtyHeight=function(){this.dirtyHeight=!0,this.markPaintDirty()},e.markDirtyArcWidth=function(){this.dirtyArcWidth=!0,this.markPaintDirty()},e.markDirtyArcHeight=function(){this.dirtyArcHeight=!0,this.markPaintDirty()},e.setToCleanState=function(){this.paintDirty=!1,this.dirtyX=!1,this.dirtyY=!1,this.dirtyWidth=!1,this.dirtyHeight=!1,this.dirtyArcWidth=!1,this.dirtyArcHeight=!1,this.cleanPaintableState()},c.PaintableStatefulDrawableMixin(t)},C=_.RectangleDOMDrawable=i(d,function(t,e){this.initialize(t,e)},{initialize:function(t,e){if(this.initializeDOMSelfDrawable(t,e),this.initializeState(),!this.fillElement||!this.strokeElement){var i=this.fillElement=document.createElement("div");i.style.display="block",i.style.position="absolute",i.style.left="0",i.style.top="0",i.style.pointerEvents="none";var r=this.strokeElement=document.createElement("div");r.style.display="block",r.style.position="absolute",r.style.left="0",r.style.top="0",r.style.pointerEvents="none",i.appendChild(r)}return this.domElement=this.fillElement,n.Util.prepareForTransform(this.domElement,this.forceAcceleration),this},updateDOM:function(){var t=this.node,e=this.fillElement,i=this.strokeElement;if(this.paintDirty){var r=Math.min(t._rectArcWidth,t._rectArcHeight),s=this.dirtyArcWidth||this.dirtyArcHeight;if(this.dirtyWidth&&(e.style.width=t._rectWidth+"px"),this.dirtyHeight&&(e.style.height=t._rectHeight+"px"),s&&(e.style[l.borderRadius]=r+"px"),this.dirtyFill&&(e.style.backgroundColor=t.getCSSFill()),this.dirtyStroke&&(i.style.borderStyle=t.hasStroke()?"solid":"none"),t.hasStroke()){var a=null===this.lastStroke;(a||this.dirtyWidth||this.dirtyLineWidth)&&(i.style.width=t._rectWidth-t.getLineWidth()+"px"),(a||this.dirtyHeight||this.dirtyLineWidth)&&(i.style.height=t._rectHeight-t.getLineWidth()+"px"),(a||this.dirtyLineWidth)&&(i.style.left=-t.getLineWidth()/2+"px",i.style.top=-t.getLineWidth()/2+"px",i.style.borderWidth=t.getLineWidth()+"px"),(a||this.dirtyStroke)&&(i.style.borderColor=t.getSimpleCSSStroke()),(a||s||this.dirtyLineWidth||this.dirtyLineOptions)&&(i.style[l.borderRadius]=t.isRounded()||"round"===t.getLineJoin()?r+t.getLineWidth()/2+"px":"0")}}if(this.transformDirty||this.dirtyX||this.dirtyY){x.set(this.getTransformMatrix());var o=h.translation(t._rectX,t._rectY);x.multiplyMatrix(o),o.freeToPool(),n.Util.applyPreparedTransform(x,this.fillElement,this.forceAcceleration)}this.setToClean()},onAttach:function(){},onDetach:function(){y||(this.fillElement=null,this.strokeElement=null,this.domElement=null)},setToClean:function(){this.setToCleanState(),this.transformDirty=!1}});return S(C),v.PoolableMixin(C),_.RectangleSVGDrawable=f.createDrawable({type:function(t,e){this.initialize(t,e)},stateType:S,initialize:function(){this.lastArcW=-1,this.lastArcH=-1,this.svgElement||(this.svgElement=document.createElementNS(n.svgns,"rect"))},updateSVG:function(t,e){if(this.dirtyX&&e.setAttribute("x",t._rectX),this.dirtyY&&e.setAttribute("y",t._rectY),this.dirtyWidth&&e.setAttribute("width",t._rectWidth),this.dirtyHeight&&e.setAttribute("height",t._rectHeight),this.dirtyArcWidth||this.dirtyArcHeight||this.dirtyWidth||this.dirtyHeight){var i=0,n=0;if(t.isRounded()){var r=t.getMaximumArcSize();i=Math.min(t._rectArcWidth,r),n=Math.min(t._rectArcHeight,r)}i!==this.lastArcW&&(this.lastArcW=i,e.setAttribute("rx",i)),n!==this.lastArcH&&(this.lastArcH=n,e.setAttribute("ry",n))}this.updateFillStrokeStyle(e)},usesPaint:!0,keepElements:E}),_.RectangleCanvasDrawable=m.createDrawable({type:function(t,e){this.initialize(t,e)},paintCanvas:function(t,e){var i=t.context;if(e.isRounded()){i.beginPath();var n=e.getMaximumArcSize(),r=Math.min(e._rectArcWidth,n),s=Math.min(e._rectArcHeight,n),a=e._rectX+r,o=e._rectX+e._rectWidth-r,h=e._rectY+s,l=e._rectY+e._rectHeight-s;r===s?(i.arc(o,h,r,-Math.PI/2,0,!1),i.arc(o,l,r,0,Math.PI/2,!1),i.arc(a,l,r,Math.PI/2,Math.PI,!1),i.arc(a,h,r,Math.PI,3*Math.PI/2,!1)):(i.ellipse(o,h,r,s,0,-Math.PI/2,0,!1),i.ellipse(o,l,r,s,0,0,Math.PI/2,!1),i.ellipse(a,l,r,s,0,Math.PI/2,Math.PI,!1),i.ellipse(a,h,r,s,0,Math.PI,3*Math.PI/2,!1)),i.closePath(),e._fill&&(e.beforeCanvasFill(t),i.fill(),e.afterCanvasFill(t)),e._stroke&&(e.beforeCanvasStroke(t),i.stroke(),e.afterCanvasStroke(t))}else e._fill&&(e.beforeCanvasFill(t),i.fillRect(e._rectX,e._rectY,e._rectWidth,e._rectHeight),e.afterCanvasFill(t)),e._stroke&&(e.beforeCanvasStroke(t),i.strokeRect(e._rectX,e._rectY,e._rectWidth,e._rectHeight),e.afterCanvasStroke(t))},usesPaint:!0,dirtyMethods:["markDirtyRectangle"]}),_.RectangleWebGLDrawable=i(p,function(t,e){this.initialize(t,e)},{initialize:function(t,e){this.initializeWebGLSelfDrawable(t,e)},initializeContext:function(t){this.webglBlock=t,this.rectangleHandle=new b(t.webglRenderer.colorTriangleRenderer,this.node,.5),this.disposeWebGLBuffers(),this.initializePaintableState(),this.updateRectangle()},updateRectangle:function(){this.dirtyFill&&(this.color=u.toColor(this.node._fill),this.cleanPaintableState())},render:function(){},dispose:function(){this.disposeWebGLBuffers(),p.prototype.dispose.call(this)},disposeWebGLBuffers:function(){this.webglBlock.webglRenderer.colorTriangleRenderer.colorTriangleBufferData.dispose(this.rectangleHandle)},markDirtyRectangle:function(){this.markDirty()},markPaintDirty:function(){this.markDirty()},onAttach:function(){},onDetach:function(){},update:function(){this.dirty&&(this.updateRectangle(),this.dirty=!1)}}),c.PaintableStatefulDrawableMixin(_.RectangleWebGLDrawable),v.PoolableMixin(_.RectangleWebGLDrawable),_.RectanglePixiDrawable=i(g,function(t,e){this.initialize(t,e)},{initialize:function(t,e){this.initializePixiSelfDrawable(t,e);var i=new PIXI.Graphics;i.beginFill(u.toColor(this.node._fill).toNumber()),i.moveTo(this.node._rectX,this.node._rectY),i.lineTo(this.node._rectX+this.node._rectWidth,this.node._rectY),i.lineTo(this.node._rectX+this.node._rectWidth,this.node._rectY+this.node._rectHeight),i.lineTo(this.node._rectX,this.node._rectY+this.node._rectHeight),i.endFill(),this.displayObject=i},initializeContext:function(t){this.pixiBlock=t},updateRectangle:function(){this.dirtyFill&&(this.color=u.toColor(this.node._fill),this.cleanPaintableState())},render:function(){},dispose:function(){this.disposePixiBuffers(),g.prototype.dispose.call(this)},disposePixiBuffers:function(){this.pixiBlock.PixiRenderer.colorTriangleRenderer.colorTriangleBufferData.dispose(this.rectangleHandle)},markDirtyRectangle:function(){this.markDirty()},markPaintDirty:function(){this.markDirty()},onAttach:function(){},onDetach:function(){},update:function(){this.dirty&&(this.updateRectangle(),this.dirty=!1)}}),c.PaintableStatefulDrawableMixin(_.RectanglePixiDrawable),v.PoolableMixin(_.RectanglePixiDrawable),_}),i("SCENERY/util/TrailPointer",["require","PHET_CORE/inherit","SCENERY/scenery"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery");i.TrailPointer=function(t,e){this.trail=t,this.setBefore(e)};var n=i.TrailPointer;return e(Object,n,{copy:function(){return new n(this.trail.copy(),this.isBefore)},setBefore:function(t){this.isBefore=t,this.isAfter=!t},getRenderSwappedPointer:function(){var t=this.isBefore?this.trail.previous():this.trail.next();return null===t?null:new n(t,!this.isBefore)},getRenderBeforePointer:function(){return this.isBefore?this:this.getRenderSwappedPointer()},getRenderAfterPointer:function(){return this.isAfter?this:this.getRenderSwappedPointer()},compareRender:function(t){var e=this.getRenderBeforePointer(),i=t.getRenderBeforePointer();return null!==e&&null!==i?e.trail.compare(i.trail):e===i?0:null===e?1:-1},compareNested:function(t){var e=this.trail.compare(t.trail);return 0===e?this.isBefore===t.isBefore?0:this.isBefore?-1:1:this.trail.isExtensionOf(t.trail)?t.isBefore?1:-1:t.trail.isExtensionOf(this.trail)?this.isBefore?-1:1:e},equalsRender:function(t){return 0===this.compareRender(t)},equalsNested:function(t){return 0===this.compareNested(t)},hasTrail:function(){return!!this.trail},nestedForwards:function(){if(this.isBefore)this.trail.lastNode()._children.length>0?this.trail.addDescendant(this.trail.lastNode()._children[0],0):this.setBefore(!1);else{if(0===this.trail.indices.length)return this.trail=null,null;var t=this.trail.indices[this.trail.indices.length-1];this.trail.removeDescendant(),this.trail.lastNode()._children.length>t+1&&(this.trail.addDescendant(this.trail.lastNode()._children[t+1],t+1),this.setBefore(!0))}return this},nestedBackwards:function(){if(this.isBefore){if(0===this.trail.indices.length)return this.trail=null,null;var t=this.trail.indices[this.trail.indices.length-1];this.trail.removeDescendant(),t-1>=0&&(this.trail.addDescendant(this.trail.lastNode()._children[t-1],t-1),this.setBefore(!1))}else if(this.trail.lastNode()._children.length>0){var e=this.trail.lastNode()._children;this.trail.addDescendant(e[e.length-1],e.length-1)}else this.setBefore(!0);return this},eachNodeBetween:function(t,e){this.eachTrailBetween(t,function(t){return e(t.lastNode())})},eachTrailBetween:function(t,e){this.isBefore&&e(this.trail),this.depthFirstUntil(t,function(t){return t.isBefore?e(t.trail):void 0},!0)},depthFirstUntil:function(t,e,i){this.trail.reindex(),t.trail.reindex();var n=this.copy();n.trail.setMutable();for(var r=!0;!n.equalsNested(t);){var s=!1;if(r?(i||(s=e(n)),r=!1):s=e(n),s&&n.isBefore){if(n.setBefore(!1),1===n.compareNested(t))break}else n.nestedForwards()}i||e(n)},toString:function(){return"["+(this.isBefore?"before":"after")+" "+this.trail.toString().slice(1)}}),n.compareNested=function(t,e,i,n){var r=t.compare(i);return 0===r?e===n?0:e?-1:1:t.isExtensionOf(i)?n?1:-1:i.isExtensionOf(t)?e?-1:1:r},n}),i("SCENERY/util/Trail",["require","PHET_CORE/inherit","DOT/Matrix3","DOT/Transform3","SCENERY/scenery","SCENERY/util/TrailPointer","SCENERY/nodes/Node"],function(t){var e=t("PHET_CORE/inherit"),i=t("DOT/Matrix3"),n=t("DOT/Transform3"),r=t("SCENERY/scenery");t("SCENERY/util/TrailPointer"),t("SCENERY/nodes/Node"),r.Trail=function a(t){if(t instanceof a){var e=t;
return this.nodes=e.nodes.slice(0),this.length=e.length,this.uniqueId=e.uniqueId,void(this.indices=e.indices.slice(0))}this.nodes=[],this.length=0,this.uniqueId="",this.indices=[];var i=this;if(t)if(t instanceof r.Node){var n=t;i.addDescendant(n)}else for(var s=t.length,o=0;s>o;o++)i.addDescendant(t[o])};var s=r.Trail;return e(Object,s,{copy:function(){return new s(this)},isPainted:function(){return this.lastNode().isPainted()},isVisible:function(){for(var t=this.nodes.length;t--;)if(!this.nodes[t].isVisible())return!1;return!0},getOpacity:function(){for(var t=1,e=this.nodes.length;e--;)t*=this.nodes[e].getOpacity();return t},isPickable:function(){return _.some(this.nodes,function(t){return t._pickable===!1||t._visible===!1})?!1:_.some(this.nodes,function(t){return t._pickable===!0||t._inputListeners.length>0})?!0:this.lastNode()._subtreePickableCount>0?!0:!1},get:function(t){return t>=0?this.nodes[t]:this.nodes[this.nodes.length+t]},slice:function(t,e){return new s(this.nodes.slice(t,e))},subtrailTo:function(t,e){return this.slice(0,_.indexOf(this.nodes,t)+(e?0:1))},isEmpty:function(){return 0===this.nodes.length},getMatrix:function(){for(var t=i.identity(),e=this.nodes,n=e.length,r=0;n>r;r++)t.multiplyMatrix(e[r]._transform.getMatrix());return t},getParentMatrix:function(){for(var t=i.identity(),e=this.nodes,n=e.length,r=0;n-1>r;r++)t.multiplyMatrix(e[r]._transform.getMatrix());return t},getTransform:function(){return new n(this.getMatrix())},getParentTransform:function(){return new n(this.getParentMatrix())},addAncestor:function(t,e){if(this.nodes.length){var i=this.nodes[0];this.indices.unshift(void 0===e?_.indexOf(t._children,i):e)}return this.nodes.unshift(t),this.length++,this.uniqueId=this.uniqueId?t._id+"-"+this.uniqueId:t._id+"",this},removeAncestor:function(){return this.nodes.shift(),this.indices.length&&this.indices.shift(),this.length--,this.updateUniqueId(),this},addDescendant:function(t,e){if(this.nodes.length){var i=this.lastNode();this.indices.push(void 0===e?_.indexOf(i._children,t):e)}return this.nodes.push(t),this.length++,this.uniqueId=this.uniqueId?this.uniqueId+"-"+t._id:t._id+"",this},removeDescendant:function(){return this.nodes.pop(),this.indices.length&&this.indices.pop(),this.length--,this.updateUniqueId(),this},reindex:function(){for(var t=this.length,e=1;t>e;e++){var i=this.indices[e-1],n=this.nodes[e-1];n._children[i]!==this.nodes[e]&&(this.indices[e-1]=_.indexOf(n._children,this.nodes[e]))}},setImmutable:function(){return this},setMutable:function(){return this},areIndicesValid:function(){for(var t=1;t<this.length;t++){var e=this.indices[t-1];if(this.nodes[t-1]._children[e]!==this.nodes[t])return!1}return!0},equals:function(t){if(this.length!==t.length)return!1;for(var e=0;e<this.nodes.length;e++)if(this.nodes[e]!==t.nodes[e])return!1;return!0},upToNode:function(t){_.indexOf(this.nodes,t);return this.slice(0,_.indexOf(this.nodes,t)+1)},isExtensionOf:function(t,e){if(this.length<=t.length-(e?1:0))return!1;for(var i=0;i<t.nodes.length;i++)if(this.nodes[i]!==t.nodes[i])return!1;return!0},getTransformTo:function(t){return new n(this.getMatrixTo(t))},getMatrixTo:function(t){this.reindex(),t.reindex();var e,n=this.getBranchIndexTo(t),r=i.IDENTITY;for(e=this.length-1;e>=n;e--)r=this.nodes[e].getTransform().getMatrix().timesMatrix(r);for(e=n;e<t.length;e++)r=t.nodes[e].getTransform().getInverse().timesMatrix(r);return r},getBranchIndexTo:function(t){var e;for(e=0;e<Math.min(this.length,t.length)&&this.nodes[e]===t.nodes[e];e++);return e},nodeFromTop:function(t){return this.nodes[this.length-1-t]},lastNode:function(){return this.nodeFromTop(0)},rootNode:function(){return this.nodes[0]},previous:function(){if(this.nodes.length<=1)return null;var t=this.nodeFromTop(0),e=this.nodeFromTop(1),i=_.indexOf(e._children,t),n=this.nodes.slice(0,this.nodes.length-1);if(0===i)return new s(n);for(n.push(e._children[i-1]);0!==n[n.length-1]._children.length;){var r=n[n.length-1];n.push(r._children[r._children.length-1])}return new s(n)},previousPainted:function(){for(var t=this.previous();t&&!t.isPainted();)t=t.previous();return t},next:function(){var t=this.nodes.slice(0),e=this.nodeFromTop(0);if(e._children.length>0)return t.push(e._children[0]),new s(t);for(var i=this.nodes.length-1;i>0;){var n=this.nodes[i],r=this.nodes[i-1];t.pop();var a=_.indexOf(r._children,n);if(a!==r._children.length-1)return t.push(r._children[a+1]),new s(t);i--}return null},nextPainted:function(){for(var t=this.next();t&&!t.isPainted();)t=t.next();return t},eachTrailUnder:function(t){new r.TrailPointer(this,!0).eachTrailBetween(new r.TrailPointer(this,!1),t)},compare:function(t){for(var e=Math.min(this.indices.length,t.indices.length),i=0;e>i;i++)if(this.indices[i]!==t.indices[i])return this.indices[i]<t.indices[i]?-1:1;return this.nodes.length<t.nodes.length?-1:this.nodes.length>t.nodes.length?1:0},isBefore:function(t){return-1===this.compare(t)},isAfter:function(t){return 1===this.compare(t)},localToGlobalPoint:function(t){return this.getMatrix().timesVector2(t)},localToGlobalBounds:function(t){return t.transformed(this.getMatrix())},globalToLocalPoint:function(t){return this.getTransform().inversePosition2(t)},globalToLocalBounds:function(t){return this.getTransform().inverseBounds2(t)},parentToGlobalPoint:function(t){return this.getParentMatrix().timesVector2(t)},parentToGlobalBounds:function(t){return t.transformed(this.getParentMatrix())},globalToParentPoint:function(t){return this.getParentTransform().inversePosition2(t)},globalToParentBounds:function(t){return this.getParentTransform().inverseBounds2(t)},updateUniqueId:function(){var t="",e=this.nodes.length;e>0&&(t+=this.nodes[0]._id);for(var i=1;e>i;i++)t+="-"+this.nodes[i]._id;this.uniqueId=t},getUniqueId:function(){return this.uniqueId},toString:function(){return this.reindex(),this.length?"[Trail "+this.indices.join(".")+" "+this.getUniqueId()+"]":"Empty Trail"},toPathString:function(){var t=_.filter(this.nodes,function(t){return"Node"!==t.constructor.name});return _.map(t,function(t){return t.constructor.name}).join("/")}}),s.eachPaintedTrailBetween=function(t,e,i,n,r){s.eachTrailBetween(t,e,function(t){return t&&t.isPainted()?i(t):void 0},n,r)},s.eachTrailBetween=function(t,e,i,n,s){var a=t?new r.TrailPointer(t.copy(),!0):new r.TrailPointer(new r.Trail(s),!0),o=e?new r.TrailPointer(e.copy(),!0):new r.TrailPointer(new r.Trail(s),!1);n&&(a.nestedForwards(),o.nestedBackwards(),1===a.compareNested(o))||a.depthFirstUntil(o,function(t){return t.isBefore?i(t.trail):void 0},!1)},s.branchIndex=function(t,e){var i,n=Math.min(t.length,e.length);for(i=0;n>i&&t.nodes[i]===e.nodes[i];i++);return i},s.sharedTrail=function(t,e){return t.slice(0,s.branchIndex(t,e))},s.spannedSubtrees=function(){},s}),i("SCENERY/input/Pointer",["require","PHET_CORE/inherit","SCENERY/scenery"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery");i.Pointer=function(){this.listeners=[]};var n=i.Pointer;return e(Object,n,{addInputListener:function(t){this.listeners.push(t)},removeInputListener:function(t){var e=_.indexOf(this.listeners,t);this.listeners.splice(e,1)},hasPointChanged:function(t){return!(this.point===t||t&&this.point&&this.point.equals(t))}}),n}),i("SCENERY/input/Mouse",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/input/Pointer"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/input/Pointer");i.Mouse=function(){n.call(this),this.point=null,this.leftDown=!1,this.middleDown=!1,this.rightDown=!1,this.isMouse=!0,this.trail=null,this.isDown=!1,this._cursor=null,this.type="mouse"};var r=i.Mouse;return e(n,r,{set cursor(t){return this.setCursor(t)},get cursor(){return this._cursor},setCursor:function(t){return this._cursor=t,this},clearCursor:function(){this.setCursor(null)},down:function(t,e){var i=this.hasPointChanged(t);switch(this.point=t,this.isDown=!0,e.button){case 0:this.leftDown=!0;break;case 1:this.middleDown=!0;break;case 2:this.rightDown=!0}return i},up:function(t,e){var i=this.hasPointChanged(t);switch(this.point=t,this.isDown=!1,e.button){case 0:this.leftDown=!1;break;case 1:this.middleDown=!1;break;case 2:this.rightDown=!1}return i},move:function(t){var e=this.hasPointChanged(t);return this.point=t,e},over:function(t){var e=this.hasPointChanged(t);return this.point=t,e},out:function(t){var e=this.hasPointChanged(t);return this.point=null,e},toString:function(){return"Mouse"}}),r}),i("SCENERY/input/Touch",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/input/Pointer"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/input/Pointer");i.Touch=function(t,e){n.call(this),this.id=t,this.point=e,this.isTouch=!0,this.trail=null,this.isDown=!0,this.type="touch"};var r=i.Touch;return e(n,r,{move:function(t){var e=this.hasPointChanged(t);return this.point=t,e},end:function(t){var e=this.hasPointChanged(t);return this.point=t,this.isDown=!1,e},cancel:function(t){var e=this.hasPointChanged(t);return this.point=t,this.isDown=!1,e},toString:function(){return"Touch#"+this.id}}),r}),i("SCENERY/input/Pen",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/input/Pointer"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/input/Pointer");i.Pen=function(t,e){n.call(this),this.id=t,this.point=e,this.isPen=!0,this.trail=null,this.isDown=!0,this.type="pen"};var r=i.Pen;return e(n,r,{move:function(t){var e=this.hasPointChanged(t);return this.point=t,e},end:function(t){var e=this.hasPointChanged(t);return this.point=t,this.isDown=!1,e},cancel:function(t){var e=this.hasPointChanged(t);return this.point=t,this.isDown=!1,e},toString:function(){return"Pen#"+this.id}}),r}),i("SCENERY/input/Event",["require","PHET_CORE/inherit","SCENERY/scenery"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery");i.Event=function(t){this.handled=!1,this.aborted=!1,this.trail=t.trail,this.type=t.type,this.pointer=t.pointer,this.domEvent=t.domEvent,this.currentTarget=t.currentTarget,this.target=t.target};var n=i.Event;return e(Object,n,{handle:function(){this.handled=!0},abort:function(){this.handled=!0,this.aborted=!0}}),n}),i("SCENERY/input/Key",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/input/Pointer"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/input/Pointer");i.Key=function(t){n.call(this),this.event=t,this.isKey=!0,this.trail=null,this.type="key"};var r=i.Key;return e(n,r)}),i("SCENERY/input/BatchedDOMEvent",["require","PHET_CORE/inherit","PHET_CORE/PoolableMixin","SCENERY/scenery"],function(t){var e=t("PHET_CORE/inherit"),i=t("PHET_CORE/PoolableMixin"),n=t("SCENERY/scenery");n.BatchedDOMEvent=function(t,e,i){this.domEvent=t,this.type=e,this.callback=i};var r=n.BatchedDOMEvent;return r.POINTER_TYPE=1,r.MS_POINTER_TYPE=2,r.TOUCH_TYPE=3,r.MOUSE_TYPE=4,r.KEY_TYPE=5,e(Object,r,{run:function(t){var e=this.domEvent,i=this.callback;if(t.validatePointers(),t.logEvents&&t.eventLog.push("validatePointers();"),this.type===r.POINTER_TYPE)i.call(t,e.pointerId,e.pointerType,t.pointFromEvent(e),e);else if(this.type===r.MS_POINTER_TYPE)i.call(t,e.pointerId,n.Input.msPointerType(e),t.pointFromEvent(e),e);else if(this.type===r.TOUCH_TYPE)for(var s=0;s<e.changedTouches.length;s++){var a=e.changedTouches.item(s);i.call(t,a.identifier,t.pointFromEvent(a),e)}else if(this.type===r.MOUSE_TYPE)i.call(t,t.pointFromEvent(e),e);else{if(this.type!==r.KEY_TYPE)throw new Error("bad type value: "+this.type);i.call(t,e)}},dispose:function(){this.domEvent=null,this.callback=null,this.freeToPool()}}),r.fromPointerEvent=function(t,e){return r.createFromPool(t,e(t),t.pointerId)},i(r,{constructorDuplicateFactory:function(t){return function(e,i,n){if(t.length){var s=t.pop();return r.call(s,e,i,n),s}return new r(e,i,n)}}}),r}),i("AXON/Multilink",["require","AXON/axon","PHET_CORE/inherit"],function(t){var e=t("AXON/axon"),i=t("PHET_CORE/inherit");return e.Multilink=function(t,e,i){this.dependencies=t,this.dependencyValues=t.map(function(t){return t.get()});var n=this;this.dependencyListeners=[];for(var r=0;r<t.length;r++){var s=t[r];!function(t,i){var r=function(t){n.dependencyValues[i]=t,e.apply(null,n.dependencyValues)};n.dependencyListeners.push(r),t.lazyLink(r)}(s,r)}i||e.apply(null,this.dependencyValues)},i(Object,e.Multilink,{detach:function(){for(var t=0;t<this.dependencies.length;t++){var e=this.dependencies[t];e.unlink(this.dependencyListeners[t])}this.dependencies=null,this.dependencyListeners=null,this.dependencyValues=null}})}),i("AXON/Property",["require","AXON/axon","AXON/Multilink"],function(t){var e=t("AXON/axon");return t("AXON/Multilink"),e.Property=function(t,e){this.storeValue(t),this.storeInitialValue(t),this._observers=[],this.id=e?e.id:null,this.sendPhetEvents=!0,this.lastMessageTime=0,this.delay=0},e.Property.prototype={get:function(){return this._value},set:function(t){return this.equalsValue(t)||this._setAndNotifyObservers(t),this},equalsValue:function(t){return t===this._value},storeValue:function(t){this._value=t},storeInitialValue:function(t){this._initialValue=t},get initialValue(){return this._initialValue},_setAndNotifyObservers:function(t){var e=this.get();this.storeValue(t),this._notifyObservers(e)},_notifyObservers:function(t){var e=this.get(),i=null,n=null;phet.arch.active&&(i=Date.now(),n=this.sendPhetEvents&&(0===this.delay||i-this.lastMessageTime>1e3*this.delay),n&&phet.arch.start("model",this.id,"Property","changed",{value:e}));for(var r=this._observers.slice(),s=0;s<r.length;s++)r[s](e,t);n&&(phet.arch.end(),this.lastMessageTime=i)},notifyObserversStatic:function(){for(var t=this.get(),e=0;e<this._observers.length;e++)this._observers[e](t)},reset:function(){this.set(this._initialValue)},_set:function(t){return this.set.bind(this,t)},get value(){return this.get()},set value(t){this.set(t)},link:function(t){-1===this._observers.indexOf(t)&&(this._observers.push(t),t(this.get(),null))},unlink:function(t){var e=this._observers.indexOf(t);-1!==e&&this._observers.splice(e,1)},lazyLink:function(t){-1===this._observers.indexOf(t)&&this._observers.push(t)},toString:function(){return"Property{"+this.get()+"}"},valueOf:function(){return this.toString()},once:function(t){var e=this,i=function(n,r){e.unlink(i),t(n,r)};return this.lazyLink(i),i},linkAttribute:function(t,e){var i=function(i){t[e]=i};return this.link(i),i},valueEquals:function(t){return new e.DerivedProperty([this],function(e){return e===t})},and:function(t){return new e.DerivedProperty([this,t],function(t,e){return t&&e})},or:function(t){return new e.DerivedProperty([this,t],function(t,e){return t||e})},times:function(t){return new e.DerivedProperty([this],function(e){return e*t})},plus:function(t){return new e.DerivedProperty([this],function(e){return e+t})},lessThanNumber:function(t){return new e.DerivedProperty([this],function(e){return t>e})},greaterThanNumber:function(t){return new e.DerivedProperty([this],function(e){return e>t})},derivedNot:function(){return new e.DerivedProperty([this],function(t){return!t})},not:function(){var t=this,i=new e.Property(!this.value),n=function(t){i.set(!t)};t.link(n);var r=function(e){t.set(!e)};return i.link(r),i.detach=function(){t.unlink(n),i.unlink(r)},i},debug:function(t){var e=function(e){console.log(t,e)};return this.link(e),e},mapValues:function(t){return new e.DerivedProperty([this],function(e){return t[e]})},map:function(t){return new e.DerivedProperty([this],function(e){return t(e)})},get toggleFunction(){return this.toggle.bind(this)},toggle:function(){this.value=!this.value},onValue:function(t,e){var i=function(i){i===t&&e()};return this.link(i),i}},e.Property.multilink=function(t,i){return new e.Multilink(t,i,!1)},e.Property.lazyMultilink=function(t,i){return new e.Multilink(t,i,!0)},e.Property.prototype.setSendPhetEvents=function(t){return this.sendPhetEvents=t,this},e.Property.prototype.throttle=function(t){return this.delay=t,this},e.Property.initArch=function(){window.phet=window.phet||{},window.phet.arch=window.phet.arch||{active:!1,wrap:function(t,e,i,n,r){return r},trigger:function(){},start:function(){},end:function(){}}},e.Property.initArch(),e.Property}),i("SCENERY/input/Input",["require","PHET_CORE/inherit","PHET_CORE/cleanArray","SCENERY/scenery","SCENERY/util/Trail","SCENERY/input/Mouse","SCENERY/input/Touch","SCENERY/input/Pen","SCENERY/input/Event","SCENERY/input/Key","SCENERY/input/BatchedDOMEvent","AXON/Property"],function(t){var e=t("PHET_CORE/inherit"),i=t("PHET_CORE/cleanArray"),n=t("SCENERY/scenery");t("SCENERY/util/Trail"),t("SCENERY/input/Mouse"),t("SCENERY/input/Touch"),t("SCENERY/input/Pen"),t("SCENERY/input/Event"),t("SCENERY/input/Key");var r=t("SCENERY/input/BatchedDOMEvent"),s=t("AXON/Property");n.Input=function(t,e,i,n,s){this.rootNode=t,this.listenerTarget=e,this.batchDOMEvents=i,this.enablePointerEvents=n,this.pointFromEvent=s,this.displayUpdateOnEvent=!1,this.batchedCallbacks=[],this.batchedEvents=[],this.mouse=null,this.pointers=[],this.listenerReferences=[],this.eventLog=[],this.logEvents=!1,this.pointerAddedListeners=[];var a=this;this.onpointerdown=function(t){a.batchEvent(t,r.POINTER_TYPE,a.pointerDown,!1)},this.onpointerup=function(t){a.batchEvent(t,r.POINTER_TYPE,a.pointerUp,!0)},this.onpointermove=function(t){a.batchEvent(t,r.POINTER_TYPE,a.pointerMove,!1)},this.onpointerover=function(t){a.batchEvent(t,r.POINTER_TYPE,a.pointerOver,!1)},this.onpointerout=function(t){a.batchEvent(t,r.POINTER_TYPE,a.pointerOut,!1)},this.onpointercancel=function(t){a.batchEvent(t,r.POINTER_TYPE,a.pointerCancel,!1)},this.onMSPointerDown=function(t){a.batchEvent(t,r.MS_POINTER_TYPE,a.pointerDown,!1)},this.onMSPointerUp=function(t){a.batchEvent(t,r.MS_POINTER_TYPE,a.pointerUp,!0)},this.onMSPointerMove=function(t){a.batchEvent(t,r.MS_POINTER_TYPE,a.pointerMove,!1)},this.onMSPointerOver=function(t){a.batchEvent(t,r.MS_POINTER_TYPE,a.pointerOver,!1)},this.onMSPointerOut=function(t){a.batchEvent(t,r.MS_POINTER_TYPE,a.pointerOut,!1)},this.onMSPointerCancel=function(t){a.batchEvent(t,r.MS_POINTER_TYPE,a.pointerCancel,!1)},this.ontouchstart=function(t){a.batchEvent(t,r.TOUCH_TYPE,a.touchStart,!1)},this.ontouchend=function(t){a.batchEvent(t,r.TOUCH_TYPE,a.touchEnd,!0)},this.ontouchmove=function(t){a.batchEvent(t,r.TOUCH_TYPE,a.touchMove,!1)},this.ontouchcancel=function(t){a.batchEvent(t,r.TOUCH_TYPE,a.touchCancel,!1)},this.onmousedown=function(t){a.batchEvent(t,r.MOUSE_TYPE,a.mouseDown,!1)},this.onmouseup=function(t){a.batchEvent(t,r.MOUSE_TYPE,a.mouseUp,!0)},this.onmousemove=function(t){a.batchEvent(t,r.MOUSE_TYPE,a.mouseMove,!1)},this.onmouseover=function(t){a.batchEvent(t,r.MOUSE_TYPE,a.mouseOver,!1)},this.onmouseout=function(t){a.batchEvent(t,r.MOUSE_TYPE,a.mouseOut,!1)},this.onkeydown=function(t){a.batchEvent(t,r.KEY_TYPE,a.keyDown,!1)},this.onkeyup=function(t){a.batchEvent(t,r.KEY_TYPE,a.keyUp,!1)},this.uselessListener=function(){}};var a=n.Input;e(Object,a,{batchEvent:function(t,e,i,n){this.batchedEvents.push(r.createFromPool(t,e,i)),(n||!this.batchDOMEvents)&&this.fireBatchedEvents(),this.displayUpdateOnEvent,e!==r.KEY_TYPE&&t.preventDefault()},fireBatchedEvents:function(){if(this.batchedEvents.length){for(var t=this.batchedEvents.length,e=0;t>e;e++){var n=this.batchedEvents[e];n.run(this),n.dispose()}i(this.batchedEvents)}},clearBatchedEvents:function(){this.batchedEvents.length=0},pointerListenerTypes:["pointerdown","pointerup","pointermove","pointerover","pointerout","pointercancel"],msPointerListenerTypes:["MSPointerDown","MSPointerUp","MSPointerMove","MSPointerOver","MSPointerOut","MSPointerCancel"],touchListenerTypes:["touchstart","touchend","touchmove","touchcancel"],mouseListenerTypes:["mousedown","mouseup","mousemove","mouseover","mouseout"],keyListenerTypes:["keydown","keyup"],canUsePointerEvents:function(){return window.navigator&&window.navigator.pointerEnabled&&this.enablePointerEvents},canUseMSPointerEvents:function(){return window.navigator&&window.navigator.msPointerEnabled&&this.enablePointerEvents},getUsedEventTypes:function(){var t;return t=this.canUsePointerEvents()?this.pointerListenerTypes:this.canUseMSPointerEvents()?this.msPointerListenerTypes:this.touchListenerTypes.concat(this.mouseListenerTypes),t=t.concat(this.keyListenerTypes)},connectListeners:function(){this.processListeners(!0)},disconnectListeners:function(){this.processListeners(!1)},processListeners:function(t){for(var e=this.getUsedEventTypes(),i=0;i<e.length;i++){var n=e[i];this.listenerTarget===window&&(t?document.addEventListener(n,this.uselessListener):document.removeEventListener(n,this.uselessListener));var r=this["on"+n];t?this.listenerTarget.addEventListener(n,r,!1):this.listenerTarget.removeEventListener(n,r,!1)}},addPointer:function(t){if(this.pointers.push(t),this.pointerAddedListeners.length)for(var e=0;e<this.pointerAddedListeners.length;e++)this.pointerAddedListeners[e](t)},addPointerAddedListener:function(t){this.pointerAddedListeners.push(t)},removePointerAddedListener:function(t){var e=this.pointerAddedListeners.indexOf(t);-1!==e&&this.pointerAddedListeners.splice(e,e+1)},removePointer:function(t){for(var e=this.pointers.length-1;e>=0;e--)this.pointers[e]===t&&this.pointers.splice(e,1)},findTouchById:function(t){for(var e=this.pointers.length;e--;){var i=this.pointers[e];if(i.id===t)return i}return void 0},findKeyByEvent:function(t){var e=_.find(this.pointers,function(e){return e.event&&e.event.keyCode===t.keyCode&&e.event.charCode===t.charCode});return e},initMouse:function(){this.mouse=new n.Mouse,this.addPointer(this.mouse)},mouseDown:function(t,e){this.logEvents&&this.eventLog.push("mouseDown("+a.serializeVector2(t)+","+a.serializeDomEvent(e)+");"),this.mouse||this.initMouse();var i=this.mouse.down(t,e);i&&this.moveEvent(this.mouse,e),this.downEvent(this.mouse,e)},mouseUp:function(t,e){this.logEvents&&this.eventLog.push("mouseUp("+a.serializeVector2(t)+","+a.serializeDomEvent(e)+");"),this.mouse||this.initMouse();var i=this.mouse.up(t,e);i&&this.moveEvent(this.mouse,e),this.upEvent(this.mouse,e)},mouseMove:function(t,e){this.logEvents&&this.eventLog.push("mouseMove("+a.serializeVector2(t)+","+a.serializeDomEvent(e)+");"),this.mouse||this.initMouse(),this.mouse.move(t,e),this.moveEvent(this.mouse,e)},mouseOver:function(t,e){this.logEvents&&this.eventLog.push("mouseOver("+a.serializeVector2(t)+","+a.serializeDomEvent(e)+");"),this.mouse||this.initMouse(),this.mouse.over(t,e)},mouseOut:function(t,e){this.logEvents&&this.eventLog.push("mouseOut("+a.serializeVector2(t)+","+a.serializeDomEvent(e)+");"),this.mouse||this.initMouse(),this.mouse.out(t,e)},keyDown:function(t){this.logEvents&&this.eventLog.push("keyDown("+a.serializeDomEvent(t)+");");var e=t.which;-1===h.indexOf(e)&&h.push(e);var i=h.indexOf(16)>=0;if(9===e||84===e){var r=i?-1:1;a.moveFocus(r)}var s=new n.Key(t);this.addPointer(s);var o=n.Input.focusedInstanceProperty.value;if(o){var l=o.node.getUniqueTrail();this.dispatchEvent(l,"down",s,t,!0)}},keyUp:function(t){this.logEvents&&this.eventLog.push("keyUp("+a.serializeDomEvent(t)+");");for(var e=t.which;;){var i=h.indexOf(e);if(!(i>-1))break;h.splice(i,1)}var r=this.findKeyByEvent(t);if(r){this.removePointer(r);var s=n.Input.focusedInstanceProperty.value;if(s){var o=s.node.getUniqueTrail();this.dispatchEvent(o,"up",r,t,!0)}}},touchStart:function(t,e,i){this.logEvents&&this.eventLog.push("touchStart('"+t+"',"+a.serializeVector2(e)+","+a.serializeDomEvent(i)+");");var r=new n.Touch(t,e,i);this.addPointer(r),this.downEvent(r,i)},touchEnd:function(t,e,i){this.logEvents&&this.eventLog.push("touchEnd('"+t+"',"+a.serializeVector2(e)+","+a.serializeDomEvent(i)+");");var n=this.findTouchById(t);if(n){var r=n.end(e,i);r&&this.moveEvent(n,i),this.removePointer(n),this.upEvent(n,i)}},touchMove:function(t,e,i){this.logEvents&&this.eventLog.push("touchMove('"+t+"',"+a.serializeVector2(e)+","+a.serializeDomEvent(i)+");");var n=this.findTouchById(t);n&&(n.move(e,i),this.moveEvent(n,i))},touchCancel:function(t,e,i){this.logEvents&&this.eventLog.push("touchCancel('"+t+"',"+a.serializeVector2(e)+","+a.serializeDomEvent(i)+");");var n=this.findTouchById(t);if(n){var r=n.cancel(e,i);r&&this.moveEvent(n,i),this.removePointer(n),this.cancelEvent(n,i)}},penStart:function(t,e,i){this.logEvents&&this.eventLog.push("penStart('"+t+"',"+a.serializeVector2(e)+","+a.serializeDomEvent(i)+");");var r=new n.Pen(t,e,i);this.addPointer(r),this.downEvent(r,i)},penEnd:function(t,e,i){this.logEvents&&this.eventLog.push("penEnd('"+t+"',"+a.serializeVector2(e)+","+a.serializeDomEvent(i)+");");var n=this.findTouchById(t);if(n){var r=n.end(e,i);r&&this.moveEvent(n,i),this.removePointer(n),this.upEvent(n,i)}},penMove:function(t,e,i){this.logEvents&&this.eventLog.push("penMove('"+t+"',"+a.serializeVector2(e)+","+a.serializeDomEvent(i)+");");var n=this.findTouchById(t);n&&(n.move(e,i),this.moveEvent(n,i))},penCancel:function(t,e,i){this.logEvents&&this.eventLog.push("penCancel('"+t+"',"+a.serializeVector2(e)+","+a.serializeDomEvent(i)+");");var n=this.findTouchById(t);if(n){var r=n.cancel(e,i);r&&this.moveEvent(n,i),this.removePointer(n),this.cancelEvent(n,i)}},pointerDown:function(t,e,i,n){switch(e){case"mouse":this.mouseDown(i,n);break;case"touch":this.touchStart(t,i,n);break;case"pen":this.penStart(t,i,n);break;default:console.log&&console.log("Unknown pointer type: "+e)}},pointerUp:function(t,e,i,n){switch(e){case"mouse":this.mouseUp(i,n);break;case"touch":this.touchEnd(t,i,n);break;case"pen":this.penEnd(t,i,n);break;default:console.log&&console.log("Unknown pointer type: "+e)}},pointerCancel:function(t,e,i,n){switch(e){case"mouse":console&&console.log&&console.log("WARNING: Pointer mouse cancel was received");break;case"touch":this.touchCancel(t,i,n);break;case"pen":this.penCancel(t,i,n);break;default:console.log&&console.log("Unknown pointer type: "+e)}},pointerMove:function(t,e,i,n){switch(e){case"mouse":this.mouseMove(i,n);break;case"touch":this.touchMove(t,i,n);break;case"pen":this.penMove(t,i,n);break;default:console.log&&console.log("Unknown pointer type: "+e)}},pointerOver:function(){},pointerOut:function(){},pointerEnter:function(){},pointerLeave:function(){},upEvent:function(t,e){var i=this.rootNode.trailUnderPointer(t)||new n.Trail(this.rootNode);this.dispatchEvent(i,"up",t,e,!0),t.isTouch&&this.exitEvents(t,e,i,0,!0),t.trail=i},downEvent:function(t,e){var i=this.rootNode.trailUnderPointer(t)||new n.Trail(this.rootNode);t.isTouch&&this.enterEvents(t,e,i,0,!0),this.dispatchEvent(i,"down",t,e,!0),t.trail=i},moveEvent:function(t,e){this.branchChangeEvents(t,e,!0)},cancelEvent:function(t,e){var i=this.rootNode.trailUnderPointer(t)||new n.Trail(this.rootNode);this.dispatchEvent(i,"cancel",t,e,!0),t.isTouch&&this.exitEvents(t,e,i,0,!0),t.trail=i},branchChangeEvents:function(t,e,i){var r=this.rootNode.trailUnderPointer(t)||new n.Trail(this.rootNode),s=t.trail||new n.Trail(this.rootNode),a=s.lastNode()!==r.lastNode();if(!a&&!i)return!1;var o=n.Trail.branchIndex(r,s),h=o!==r.length||o!==s.length;return i&&this.dispatchEvent(r,"move",t,e,!0),this.exitEvents(t,e,s,o,a),this.enterEvents(t,e,r,o,a),t.trail=r,h},enterEvents:function(t,e,i,n,r){if(i.length>n)for(var s=i.length-1;s>=n;s--)this.dispatchEvent(i.slice(0,s+1),"enter",t,e,!1);r&&this.dispatchEvent(i,"over",t,e,!0)},exitEvents:function(t,e,i,n,r){if(r&&this.dispatchEvent(i,"out",t,e,!0),i.length>n)for(var s=n;s<i.length;s++)this.dispatchEvent(i.slice(0,s+1),"exit",t,e,!1)},validatePointers:function(){for(var t=this,e=this.pointers.length;e--;){var i=this.pointers[e];if(i.point){t.branchChangeEvents(i,null,!1)}}},dispatchEvent:function(t,e,i,r,s){if(!t)try{throw new Error("falsy trail for dispatchEvent")}catch(a){throw console.log(a.stack),a}var o=new n.Event({trail:t,type:e,pointer:i,domEvent:r,currentTarget:null,target:t.lastNode()});this.dispatchToPointer(e,i,o),this.dispatchToTargets(t,i,e,o,s),!t.lastNode().interactive&&!i.isKey&&r&&r.preventDefault&&r.preventDefault()},dispatchToPointer:function(t,e,i){if(!i.aborted&&!i.handled)for(var n=e.type+t,r=e.listeners.slice(0),s=0;s<r.length;s++){var a=r[s],o=!1;if(!o&&a[n]&&(a[n](i),o=i.aborted),!o&&a[t]&&(a[t](i),o=i.aborted),o)return}},dispatchToTargets:function(t,e,i,n,r){if(!n.aborted&&!n.handled)for(var s=e.type+i,a=t.length-1;a>=0;r?a--:a=-1){var o=t.nodes[a];n.currentTarget=o;for(var h=o.getInputListeners(),l=0;l<h.length;l++){var u=h[l],c=!1;if(!c&&u[s]&&(u[s](n),c=n.aborted),!c&&u[i]&&(u[i](n),c=n.aborted),c)return}if(n.handled)return}}}),a.serializeDomEvent=function l(t){var e=[];for(var i in t)if(t.hasOwnProperty(i))if("touches"===i||"targetTouches"===i||"changedTouches"===i){for(var n=[],r=0;r<t[i].length;r++){var s=t[i].item(r);n.push(l(s))}e.push(i+":["+n.join(",")+"]")}else e.push(i+":"+("object"==typeof t[i]&&null!==t[i]?"{}":JSON.stringify(t[i])));return"{"+e.join(",")+"}"},a.serializeVector2=function(t){return"dot("+t.x+","+t.y+")"},a.debugKeyEvent=function(t){return t.timeStamp+" "+t.type},a.debugText=function(t,e){return t.x+","+t.y+" "+e.timeStamp+" "+e.type},a.msPointerType=function(t){return t.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_TOUCH?"touch":t.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_PEN?"pen":t.pointerType===window.MSPointerEvent.MSPOINTER_TYPE_MOUSE?"mouse":t.pointerType},a.focusedInstanceProperty=new s(null);var o=function(t,e,i){i(t)&&e.push(t);for(var n=0;n<t.children.length;n++)o(t.children[n],e,i);return e};a.focusableInstances=[],a.getAllFocusableInstances=function(){for(var t=[],e=function(t){return t.node.focusable===!0},i=n.Display,r=0;r<i.displays.length;r++){var s=i.displays[r];s._baseInstance&&o(s._baseInstance,t,e)}return t},a.moveFocus=function(t){var e=a.focusableInstances||[];if(null===a.focusedInstanceProperty.value)a.focusedInstanceProperty.value=e[0];else{for(var i=e.indexOf(a.focusedInstanceProperty.value),n=i+t;0>n;)n+=e.length;for(;n>=e.length;)n-=e.length;a.focusedInstanceProperty.value=e[n]}};var h=[];return a.KEY_SPACE=32,a.KEY_ENTER=13,a}),i("SCENERY/accessibility/AccessibilityLayer",["require","PHET_CORE/inherit","SCENERY/nodes/Node","SCENERY/nodes/Rectangle","SCENERY/input/Input","SCENERY/nodes/Path","KITE/Shape"],function(t){function e(){var t=this;this.focusRectangle=new r(0,0,100,100,10,10,{stroke:"blue",lineWidth:2}),this.focusTriangle=new a((new o).moveTo(0,0).lineTo(h,0).lineTo(h/2,h/10*8).close(),{fill:"blue",stroke:"black",lineWidth:1}),n.call(this,{children:[this.focusRectangle,this.focusTriangle]});var e=5;s.focusedInstanceProperty.link(function(i,n){if(i&&n){var r=i.node,s=r.getGlobalBounds();t.focusRectangle.visible=!0,t.focusTriangle.visible=!0;var a={x:s.left-e,y:s.top-e,width:s.width+2*e,height:s.height+2*e};new TWEEN.Tween({x:t.focusRectangle.getRectX(),y:t.focusRectangle.getRectY(),width:t.focusRectangle.getRectWidth(),height:t.focusRectangle.getRectHeight()}).to(a,300).easing(TWEEN.Easing.Cubic.InOut).onUpdate(function(){t.focusRectangle.setRect(this.x,this.y,this.width,this.height,10,10),t.focusTriangle.bottom=this.y,t.focusTriangle.centerX=this.x+this.width/2}).start()}else if(i){var o=i.node.getGlobalBounds(),h={x:o.left-e,y:o.top-e,width:o.width+2*e,height:o.height+2*e};t.focusRectangle.visible=!0,t.focusTriangle.visible=!0,t.focusRectangle.setRect(h.x,h.y,h.width,h.height,10,10),t.focusTriangle.bottom=h.y,t.focusTriangle.centerX=h.x+h.width/2}else t.focusRectangle.visible=!1,t.focusTriangle.visible=!1})}var i=t("PHET_CORE/inherit"),n=t("SCENERY/nodes/Node"),r=t("SCENERY/nodes/Rectangle"),s=t("SCENERY/input/Input"),a=t("SCENERY/nodes/Path"),o=t("KITE/Shape"),h=20;return i(n,e)}),i("SCENERY/debug/DebugContext",["require","PHET_CORE/inherit","SCENERY/scenery"],function(t){function e(t){return JSON.stringify(t)}function i(t){console.log("context."+t+";")}function n(t){i(t)}function r(t,n){i(t+" = "+e(n))}function s(t,n){i(void 0===n||0===n.length?t+"()":t+"( "+_.reduce(n,function(t,i){return t.length>0?t+", "+e(i):e(i)},"")+" )")}var a=t("PHET_CORE/inherit"),o=t("SCENERY/scenery");o.DebugContext=function(t){this._context=t,t&&!t.ellipse&&(this.ellipse=t.ellipse)
};var h=o.DebugContext;return a(Object,h,{get canvas(){return n("canvas"),this._context.canvas},get width(){return n("width"),this._context.width},get height(){return n("height"),this._context.height},commit:function(){s("commit"),this._context.commit()},save:function(){s("save"),this._context.save()},restore:function(){s("restore"),this._context.restore()},get currentTransform(){return n("currentTransform"),this._context.currentTransform},set currentTransform(t){r("currentTransform",t),this._context.currentTransform=t},scale:function(t,e){s("scale",[t,e]),this._context.scale(t,e)},rotate:function(t){s("rotate",[t]),this._context.rotate(t)},translate:function(t,e){s("translate",[t,e]),this._context.translate(t,e)},transform:function(t,e,i,n,r,a){s("transform",[t,e,i,n,r,a]),this._context.transform(t,e,i,n,r,a)},setTransform:function(t,e,i,n,r,a){s("setTransform",[t,e,i,n,r,a]),this._context.setTransform(t,e,i,n,r,a)},resetTransform:function(){s("resetTransform"),this._context.resetTransform()},get globalAlpha(){return n("globalAlpha"),this._context.globalAlpha},set globalAlpha(t){r("globalAlpha",t),this._context.globalAlpha=t},get globalCompositeOperation(){return n("globalCompositeOperation"),this._context.globalCompositeOperation},set globalCompositeOperation(t){r("globalCompositeOperation",t),this._context.globalCompositeOperation=t},get imageSmoothingEnabled(){return n("imageSmoothingEnabled"),this._context.imageSmoothingEnabled},set imageSmoothingEnabled(t){r("imageSmoothingEnabled",t),this._context.imageSmoothingEnabled=t},get strokeStyle(){return n("strokeStyle"),this._context.strokeStyle},set strokeStyle(t){r("strokeStyle",t),this._context.strokeStyle=t},get fillStyle(){return n("fillStyle"),this._context.fillStyle},set fillStyle(t){r("fillStyle",t),this._context.fillStyle=t},createLinearGradient:function(t,e,i,n){return s("createLinearGradient",[t,e,i,n]),this._context.createLinearGradient(t,e,i,n)},createRadialGradient:function(t,e,i,n,r,a){return s("createRadialGradient",[t,e,i,n,r,a]),this._context.createRadialGradient(t,e,i,n,r,a)},createPattern:function(t,e){return s("createPattern",[t,e]),this._context.createPattern(t,e)},get shadowOffsetX(){return n("shadowOffsetX"),this._context.shadowOffsetX},set shadowOffsetX(t){r("shadowOffsetX",t),this._context.shadowOffsetX=t},get shadowOffsetY(){return n("shadowOffsetY"),this._context.shadowOffsetY},set shadowOffsetY(t){r("shadowOffsetY",t),this._context.shadowOffsetY=t},get shadowBlur(){return n("shadowBlur"),this._context.shadowBlur},set shadowBlur(t){r("shadowBlur",t),this._context.shadowBlur=t},get shadowColor(){return n("shadowColor"),this._context.shadowColor},set shadowColor(t){r("shadowColor",t),this._context.shadowColor=t},clearRect:function(t,e,i,n){s("clearRect",[t,e,i,n]),this._context.clearRect(t,e,i,n)},fillRect:function(t,e,i,n){s("fillRect",[t,e,i,n]),this._context.fillRect(t,e,i,n)},strokeRect:function(t,e,i,n){s("strokeRect",[t,e,i,n]),this._context.strokeRect(t,e,i,n)},get fillRule(){return n("fillRule"),this._context.fillRule},set fillRule(t){r("fillRule",t),this._context.fillRule=t},beginPath:function(){s("beginPath"),this._context.beginPath()},fill:function(t){s("fill",t?[t]:void 0),this._context.fill(t)},stroke:function(t){s("stroke",t?[t]:void 0),this._context.stroke(t)},drawSystemFocusRing:function(t,e){s("drawSystemFocusRing",e?[t,e]:[t]),this._context.drawSystemFocusRing(t,e)},drawCustomFocusRing:function(t,e){return s("drawCustomFocusRing",e?[t,e]:[t]),this._context.drawCustomFocusRing(t,e)},scrollPathIntoView:function(t){s("scrollPathIntoView",t?[t]:void 0),this._context.scrollPathIntoView(t)},clip:function(t){s("clip",t?[t]:void 0),this._context.clip(t)},resetClip:function(){s("resetClip"),this._context.resetClip()},isPointInPath:function(t,e,i){return s("isPointInPath",i?[t,e,i]:[t,e]),this._context.isPointInPath(t,e,i)},fillText:function(t,e,i,n){s("fillText",void 0!==n?[t,e,i,n]:[t,e,i]),this._context.fillText(t,e,i,n)},strokeText:function(t,e,i,n){s("strokeText",void 0!==n?[t,e,i,n]:[t,e,i]),this._context.strokeText(t,e,i,n)},measureText:function(t){return s("measureText",[t]),this._context.measureText(t)},drawImage:function(t,e,i,n,r,a,o,h,l){s("drawImage",void 0!==n?void 0!==a?[t,e,i,n,r,a,o,h,l]:[t,e,i,n,r]:[t,e,i]),this._context.drawImage(t,e,i,n,r,a,o,h,l)},addHitRegion:function(t){s("addHitRegion",[t]),this._context.addHitRegion(t)},removeHitRegion:function(t){s("removeHitRegion",[t]),this._context.removeHitRegion(t)},createImageData:function(t,e){return s("createImageData",void 0!==e?[t,e]:[t]),this._context.createImageData(t,e)},createImageDataHD:function(t,e){return s("createImageDataHD",[t,e]),this._context.createImageDataHD(t,e)},getImageData:function(t,e,i,n){return s("getImageData",[t,e,i,n]),this._context.getImageData(t,e,i,n)},getImageDataHD:function(t,e,i,n){return s("getImageDataHD",[t,e,i,n]),this._context.getImageDataHD(t,e,i,n)},putImageData:function(t,e,i,n,r,a,o){s("putImageData",void 0!==n?[t,e,i,n,r,a,o]:[t,e,i]),this._context.putImageData(t,e,i,n,r,a,o)},putImageDataHD:function(t,e,i,n,r,a,o){s("putImageDataHD",void 0!==n?[t,e,i,n,r,a,o]:[t,e,i]),this._context.putImageDataHD(t,e,i,n,r,a,o)},get lineWidth(){return n("lineWidth"),this._context.lineWidth},set lineWidth(t){r("lineWidth",t),this._context.lineWidth=t},get lineCap(){return n("lineCap"),this._context.lineCap},set lineCap(t){r("lineCap",t),this._context.lineCap=t},get lineJoin(){return n("lineJoin"),this._context.lineJoin},set lineJoin(t){r("lineJoin",t),this._context.lineJoin=t},get miterLimit(){return n("miterLimit"),this._context.miterLimit},set miterLimit(t){r("miterLimit",t),this._context.miterLimit=t},setLineDash:function(t){s("setLineDash",[t]),this._context.setLineDash(t)},getLineDash:function(){return s("getLineDash"),this._context.getLineDash()},get lineDashOffset(){return n("lineDashOffset"),this._context.lineDashOffset},set lineDashOffset(t){r("lineDashOffset",t),this._context.lineDashOffset=t},get font(){return n("font"),this._context.font},set font(t){r("font",t),this._context.font=t},get textAlign(){return n("textAlign"),this._context.textAlign},set textAlign(t){r("textAlign",t),this._context.textAlign=t},get textBaseline(){return n("textBaseline"),this._context.textBaseline},set textBaseline(t){r("textBaseline",t),this._context.textBaseline=t},get direction(){return n("direction"),this._context.direction},set direction(t){r("direction",t),this._context.direction=t},closePath:function(){s("closePath"),this._context.closePath()},moveTo:function(t,e){s("moveTo",[t,e]),this._context.moveTo(t,e)},lineTo:function(t,e){s("lineTo",[t,e]),this._context.lineTo(t,e)},quadraticCurveTo:function(t,e,i,n){s("quadraticCurveTo",[t,e,i,n]),this._context.quadraticCurveTo(t,e,i,n)},bezierCurveTo:function(t,e,i,n,r,a){s("bezierCurveTo",[t,e,i,n,r,a]),this._context.bezierCurveTo(t,e,i,n,r,a)},arcTo:function(t,e,i,n,r,a,o){s("arcTo",void 0!==a?[t,e,i,n,r,a,o]:[t,e,i,n,r]),this._context.arcTo(t,e,i,n,r,a,o)},rect:function(t,e,i,n){s("rect",[t,e,i,n]),this._context.rect(t,e,i,n)},arc:function(t,e,i,n,r,a){s("arc",[t,e,i,n,r,a]),this._context.arc(t,e,i,n,r,a)},ellipse:function(t,e,i,n,r,a,o,h){s("ellipse",[t,e,i,n,r,a,o,h]),this._context.ellipse(t,e,i,n,r,a,o,h)}}),h}),i("SCENERY/display/CanvasBlock",["require","PHET_CORE/inherit","PHET_CORE/PoolableMixin","PHET_CORE/cleanArray","DOT/Vector2","SCENERY/scenery","SCENERY/display/FittedBlock","SCENERY/util/CanvasContextWrapper","SCENERY/display/Renderer","SCENERY/util/Util"],function(t){var e=t("PHET_CORE/inherit"),i=t("PHET_CORE/PoolableMixin"),n=t("PHET_CORE/cleanArray"),r=t("DOT/Vector2"),s=t("SCENERY/scenery"),a=t("SCENERY/display/FittedBlock"),o=t("SCENERY/util/CanvasContextWrapper"),h=t("SCENERY/display/Renderer"),l=t("SCENERY/util/Util");s.CanvasBlock=function(t,e,i,n){this.initialize(t,e,i,n)};var u=s.CanvasBlock;return e(a,u,{initialize:function(t,e,i,a){return this.initializeFittedBlock(t,e,i),this.filterRootInstance=a,this.dirtyDrawables=n(this.dirtyDrawables),this.domElement||(this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.left="0",this.canvas.style.top="0",this.canvas.style.pointerEvents="none",this.context=this.canvas.getContext("2d"),this.context.miterLimit=20,this.context.miterLimit=10,this.wrapper=new o(this.canvas,this.context),this.domElement=this.canvas),l.prepareForTransform(this.canvas,this.forceAcceleration),l.unsetTransform(this.canvas),this.canvasDrawOffset=new r,this.backingScale=e&h.bitmaskCanvasLowResolution?1:s.Util.backingScale(this.context),this},setSizeFullDisplay:function(){var t=this.display.getSize();this.canvas.width=t.width*this.backingScale,this.canvas.height=t.height*this.backingScale,this.canvas.style.width=t.width+"px",this.canvas.style.height=t.height+"px",this.wrapper.resetStyles()},setSizeFitBounds:function(){var t=this.fitBounds.minX,e=this.fitBounds.minY;this.canvasDrawOffset.setXY(-t,-e),l.setTransform("matrix(1,0,0,1,"+t+","+e+")",this.canvas,this.forceAcceleration),this.canvas.width=this.fitBounds.width*this.backingScale,this.canvas.height=this.fitBounds.height*this.backingScale,this.canvas.style.width=this.fitBounds.width+"px",this.canvas.style.height=this.fitBounds.height+"px",this.wrapper.resetStyles()},update:function(){if(this.dirty&&!this.disposed){for(this.dirty=!1;this.dirtyDrawables.length;)this.dirtyDrawables.pop().update();this.updateFit(),this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.filterRootInstance.node._clipArea&&(this.context.save(),this.temporaryRecursiveClip(this.filterRootInstance));for(var t=this.firstDrawable;null!==t&&(this.renderDrawable(t),t!==this.lastDrawable);t=t.nextDrawable);this.filterRootInstance.node._clipArea&&this.context.restore()}},temporaryRecursiveClip:function(t){t.parent&&this.temporaryRecursiveClip(t.parent),t.node._clipArea&&(this.context.setTransform(this.backingScale,0,0,this.backingScale,this.canvasDrawOffset.x*this.backingScale,this.canvasDrawOffset.y*this.backingScale),t.relativeTransform.matrix.canvasAppendTransform(this.context),this.context.beginPath(),t.node._clipArea.writeToContext(this.context),this.context.clip())},renderDrawable:function(t){var e=t.instance.relativeTransform.matrix;this.context.setTransform(this.backingScale,0,0,this.backingScale,this.canvasDrawOffset.x*this.backingScale,this.canvasDrawOffset.y*this.backingScale),t.instance!==this.transformRootInstance&&e.canvasAppendTransform(this.context),t.paintCanvas(this.wrapper,t.instance.node)},dispose:function(){this.transformRootInstance=null,n(this.dirtyDrawables),this.canvas.width=0,this.canvas.height=0,a.prototype.dispose.call(this)},markDirtyDrawable:function(t){this.dirtyDrawables.push(t),this.markDirty()},addDrawable:function(t){a.prototype.addDrawable.call(this,t)},removeDrawable:function(t){a.prototype.removeDrawable.call(this,t)},onIntervalChange:function(t,e){a.prototype.onIntervalChange.call(this,t,e)},onPotentiallyMovedDrawable:function(t){t.markDirty()},toString:function(){return"CanvasBlock#"+this.id+"-"+a.fitString[this.fit]}}),i(u,{constructorDuplicateFactory:function(t){return function(e,i,n,r){return t.length?t.pop().initialize(e,i,n,r):new u(e,i,n,r)}}}),u}),i("SCENERY/display/SVGGroup",["require","PHET_CORE/inherit","PHET_CORE/PoolableMixin","PHET_CORE/cleanArray","SCENERY/scenery"],function(t){var e=t("PHET_CORE/inherit"),i=t("PHET_CORE/PoolableMixin"),n=t("PHET_CORE/cleanArray"),r=t("SCENERY/scenery");r.SVGGroup=function(t,e,i){this.initialize(t,e,i)};var s=r.SVGGroup;return e(Object,s,{initialize:function(t,e,i){return this.block=t,this.instance=e,this.node=e.trail.lastNode(),this.parent=i,this.children=n(this.children),this.hasSelfDrawable=!1,this.selfDrawable=null,this.dirty=!0,this.willApplyTransforms=this.block.transformRootInstance.trail.nodes.length<this.instance.trail.nodes.length,this.willApplyFilters=this.block.filterRootInstance.trail.nodes.length<this.instance.trail.nodes.length,this.transformDirty=!0,this.hasTransform=void 0!==this.hasTransform?this.hasTransform:!1,this.transformDirtyListener=this.transformDirtyListener||this.markTransformDirty.bind(this),this.willApplyTransforms&&this.node.onStatic("transform",this.transformDirtyListener),this.opacityDirty=!0,this.visibilityDirty=!0,this.clipDirty=!0,this.hasOpacity=void 0!==this.hasOpacity?this.hasOpacity:!1,this.clipDefinition=void 0!==this.clipDefinition?this.clipDefinition:null,this.clipPath=void 0!==this.clipPath?this.clipPath:null,this.opacityDirtyListener=this.opacityDirtyListener||this.markOpacityDirty.bind(this),this.visibilityDirtyListener=this.visibilityDirtyListener||this.markVisibilityDirty.bind(this),this.clipDirtyListener=this.clipDirtyListener||this.markClipDirty.bind(this),this.willApplyFilters&&(this.node.onStatic("opacity",this.opacityDirtyListener),this.node.onStatic("visibility",this.visibilityDirtyListener)),this.node.onStatic("clip",this.clipDirtyListener),this.orderDirty=!0,this.orderDirtyListener=this.orderDirtyListener||this.markOrderDirty.bind(this),this.node.onStatic("childInserted",this.orderDirtyListener),this.node.onStatic("childRemoved",this.orderDirtyListener),this.svgGroup||(this.svgGroup=document.createElementNS(r.svgns,"g")),this.instance.addSVGGroup(this),this.block.markDirtyGroup(this),this},addSelfDrawable:function(t){this.selfDrawable=t,this.svgGroup.insertBefore(t.svgElement,this.children.length?this.children[0].svgGroup:null),this.hasSelfDrawable=!0},removeSelfDrawable:function(t){this.hasSelfDrawable=!1,this.svgGroup.removeChild(t.svgElement),this.selfDrawable=null},addChildGroup:function(t){this.markOrderDirty(),t.parent=this,this.children.push(t),this.svgGroup.appendChild(t.svgGroup)},removeChildGroup:function(t){this.markOrderDirty(),t.parent=null,this.children.splice(_.indexOf(this.children,t),1),this.svgGroup.removeChild(t.svgGroup)},markDirty:function(){this.dirty||(this.dirty=!0,this.block.markDirtyGroup(this))},markOrderDirty:function(){this.orderDirty||(this.orderDirty=!0,this.markDirty())},markTransformDirty:function(){this.transformDirty||(this.transformDirty=!0,this.markDirty())},markOpacityDirty:function(){this.opacityDirty||(this.opacityDirty=!0,this.markDirty())},markVisibilityDirty:function(){this.visibilityDirty||(this.visibilityDirty=!0,this.markDirty())},markClipDirty:function(){this.clipDirty||(this.clipDirty=!0,this.markDirty())},update:function(){if(this.block){var t=this.svgGroup;if(this.dirty=!1,this.transformDirty)if(this.transformDirty=!1,this.willApplyTransforms){var e=this.node.transform.isIdentity();e?this.hasTransform&&(this.hasTransform=!1,t.removeAttribute("transform")):(this.hasTransform=!0,t.setAttribute("transform",this.node.transform.getMatrix().getSVGTransform()))}else this.hasTransform&&(this.hasTransform=!1,t.removeAttribute("transform"));if(this.visibilityDirty&&(this.visibilityDirty=!1,t.style.display=this.willApplyFilters&&!this.node.isVisible()?"none":""),this.opacityDirty&&(this.opacityDirty=!1,this.willApplyFilters&&1!==this.node.opacity?(this.hasOpacity=!0,t.setAttribute("opacity",this.node.opacity)):this.hasOpacity&&(this.hasOpacity=!1,t.removeAttribute("opacity"))),this.clipDirty){this.clipDirty=!1;var i=this.block.filterRootInstance.trail.nodes.length>=this.instance.trail.nodes.length;if(i&&this.node._clipArea){if(!this.clipDefinition){var n="clip"+this.node.getId();this.clipDefinition=document.createElementNS(r.svgns,"clipPath"),this.clipDefinition.setAttribute("id",n),this.clipDefinition.setAttribute("clipPathUnits","userSpaceOnUse"),this.block.defs.appendChild(this.clipDefinition),this.clipPath=document.createElementNS(r.svgns,"path"),this.clipDefinition.appendChild(this.clipPath),t.setAttribute("clip-path","url(#"+n+")")}this.clipPath.setAttribute("d",this.node._clipArea.getSVGPath())}else this.clipDefinition&&(t.removeAttribute("clip-path"),this.block.defs.removeChild(this.clipDefinition),this.clipDefinition=null,this.clipPath=null)}if(this.orderDirty){this.orderDirty=!1;for(var s=this.children.length-1,a=this.instance.children,o=a.length-1;o>=0;o--){var h=a[o].lookupSVGGroup(this.block);if(h){if(this.children[s]!==h){t.insertBefore(h.svgGroup,s+1>=this.children.length?null:this.children[s+1].svgGroup);var l=_.indexOf(this.children,h);this.children.splice(l,1),this.children.splice(s,0,h)}s--}}}}},isReleasable:function(){return!this.hasSelfDrawable&&!this.children.length&&this.parent},dispose:function(){this.willApplyTransforms&&this.node.offStatic("transform",this.transformDirtyListener),this.willApplyFilters&&(this.node.offStatic("opacity",this.opacityDirtyListener),this.node.offStatic("visibility",this.visibilityDirtyListener)),this.node.offStatic("clip",this.clipDirtyListener),this.node.offStatic("childInserted",this.orderDirtyListener),this.node.offStatic("childRemoved",this.orderDirtyListener),this.instance.removeSVGGroup(this),this.clipDefinition&&(this.svgGroup.removeAttribute("clip-path"),this.block.defs.removeChild(this.clipDefinition),this.clipDefinition=null,this.clipPath=null),this.parent=null,this.block=null,this.instance=null,this.node=null,n(this.children),this.selfDrawable=null,this.freeToPool()},toString:function(){return"SVGGroup:"+this.block.toString()+"_"+this.instance.toString()}}),s.addDrawable=function(t,e){var i=s.ensureGroupsToInstance(t,e.instance);i.addSelfDrawable(e)},s.removeDrawable=function(t,e){e.instance.lookupSVGGroup(t).removeSelfDrawable(e),s.releaseGroupsToInstance(t,e.instance)},s.ensureGroupsToInstance=function(t,e){var i=e.lookupSVGGroup(t);if(!i){var n=s.ensureGroupsToInstance(t,e.parent);i=s.createFromPool(t,e,n),n.addChildGroup(i)}return i},s.releaseGroupsToInstance=function(t,e){var i=e.lookupSVGGroup(t);if(i.isReleasable()){var n=i.parent;n.removeChildGroup(i),s.releaseGroupsToInstance(t,n.instance),i.dispose()}},i(s,{constructorDuplicateFactory:function(t){return function(e,i,n){return t.length?t.pop().initialize(e,i,n):new s(e,i,n)}}}),s}),i("SCENERY/display/SVGBlock",["require","PHET_CORE/inherit","PHET_CORE/PoolableMixin","PHET_CORE/cleanArray","SCENERY/scenery","SCENERY/display/FittedBlock","SCENERY/display/SVGGroup","SCENERY/util/Util"],function(t){var e=t("PHET_CORE/inherit"),i=t("PHET_CORE/PoolableMixin"),n=t("PHET_CORE/cleanArray"),r=t("SCENERY/scenery"),s=t("SCENERY/display/FittedBlock"),a=t("SCENERY/display/SVGGroup"),o=t("SCENERY/util/Util");r.SVGBlock=function(t,e,i,n){this.initialize(t,e,i,n)};var h=r.SVGBlock;return e(s,h,{initialize:function(t,e,i,s){this.initializeFittedBlock(t,e,i),this.filterRootInstance=s,this.dirtyGroups=n(this.dirtyGroups),this.dirtyDrawables=n(this.dirtyDrawables),this.paintMap={},this.domElement||(this.svg=document.createElementNS(r.svgns,"svg"),this.svg.style.position="absolute",this.svg.style.left="0",this.svg.style.top="0",this.svg.style["pointer-events"]="none",this.defs=document.createElementNS(r.svgns,"defs"),this.svg.appendChild(this.defs),this.baseTransformGroup=document.createElementNS(r.svgns,"g"),this.svg.appendChild(this.baseTransformGroup),this.domElement=this.svg),o.prepareForTransform(this.svg,this.forceAcceleration),o.unsetTransform(this.svg),this.baseTransformGroup.setAttribute("transform","");var h=i.trail.nodes.length>s.trail.nodes.length?s:i;return this.rootGroup=a.createFromPool(this,h,null),this.baseTransformGroup.appendChild(this.rootGroup.svgGroup),this},incrementPaint:function(t){if(this.paintMap.hasOwnProperty(t.id))this.paintMap[t.id].count++;else{var e=t.getSVGDefinition();this.paintMap[t.id]={count:1,paint:t,def:e},this.defs.appendChild(e)}},decrementPaint:function(t){if(this.paintMap.hasOwnProperty(t.id)){var e=this.paintMap[t.id];1===e.count?(this.defs.removeChild(e.def),delete this.paintMap[t.id]):e.count--}},markDirtyGroup:function(t){this.dirtyGroups.push(t),this.markDirty()},markDirtyDrawable:function(t){this.dirtyDrawables.push(t),this.markDirty()},setSizeFullDisplay:function(){var t=this.display.getSize();this.svg.setAttribute("width",t.width),this.svg.setAttribute("height",t.height)},setSizeFitBounds:function(){var t=this.fitBounds.minX,e=this.fitBounds.minY;this.baseTransformGroup.setAttribute("transform","translate("+-t+","+-e+")"),o.setTransform("matrix(1,0,0,1,"+t+","+e+")",this.svg,this.forceAcceleration),this.svg.setAttribute("width",this.fitBounds.width),this.svg.setAttribute("height",this.fitBounds.height)},update:function(){if(this.dirty&&!this.disposed){for(this.dirty=!1;this.dirtyGroups.length;){var t=this.dirtyGroups.pop();t.block===this&&t.update()}for(;this.dirtyDrawables.length;){var e=this.dirtyDrawables.pop();e.parentDrawable===this&&e.update()}this.updateFit()}},dispose:function(){for(this.svg.setAttribute("width",0),this.svg.setAttribute("height",0),this.filterRootInstance=null,n(this.dirtyGroups),n(this.dirtyDrawables),this.paintMap={},this.baseTransformGroup.removeChild(this.rootGroup.svgGroup),this.rootGroup.dispose(),this.rootGroup=null;this.defs.childNodes.length;)this.defs.removeChild(this.defs.childNodes[0]);s.prototype.dispose.call(this)},addDrawable:function(t){s.prototype.addDrawable.call(this,t),a.addDrawable(this,t),t.updateSVGBlock(this)},removeDrawable:function(t){a.removeDrawable(this,t),s.prototype.removeDrawable.call(this,t)},onIntervalChange:function(t,e){s.prototype.onIntervalChange.call(this,t,e)},toString:function(){return"SVGBlock#"+this.id+"-"+s.fitString[this.fit]}}),i(h,{constructorDuplicateFactory:function(t){return function(e,i,n,r){return t.length?t.pop().initialize(e,i,n,r):new h(e,i,n,r)}}}),h}),i("SCENERY/display/DOMBlock",["require","PHET_CORE/inherit","PHET_CORE/PoolableMixin","SCENERY/scenery","SCENERY/display/Block"],function(t){var e=t("PHET_CORE/inherit"),i=t("PHET_CORE/PoolableMixin"),n=t("SCENERY/scenery"),r=t("SCENERY/display/Block");n.DOMBlock=function(t,e){this.initialize(t,e)};var s=n.DOMBlock;return e(r,s,{initialize:function(t,e){return this.initializeBlock(t,e.renderer),this.domDrawable=e,this.domElement=e.domElement,this},dispose:function(){this.domDrawable=null,this.domElement=null,r.prototype.dispose.call(this)},update:function(){this.dirty&&!this.disposed&&(this.dirty=!1,this.domDrawable.update())},markDirtyDrawable:function(){this.markDirty()},addDrawable:function(t){r.prototype.addDrawable.call(this,t)},removeDrawable:function(t){r.prototype.removeDrawable.call(this,t)}}),i(s,{constructorDuplicateFactory:function(t){return function(e,i){return t.length?t.pop().initialize(e,i):new s(e,i)}}}),s}),i("SCENERY/display/PixiBlock",["require","PHET_CORE/inherit","PHET_CORE/PoolableMixin","PHET_CORE/cleanArray","SCENERY/scenery","SCENERY/display/FittedBlock","SCENERY/util/Util"],function(t){var e=t("PHET_CORE/inherit"),i=t("PHET_CORE/PoolableMixin"),n=t("PHET_CORE/cleanArray"),r=t("SCENERY/scenery"),s=t("SCENERY/display/FittedBlock"),a=t("SCENERY/util/Util");r.PixiBlock=function(t,e,i,n){this.initialize(t,e,i,n)};var o=r.PixiBlock;return e(s,o,{initialize:function(t,e,i,r){return this.initializeFittedBlock(t,e,i),this.fit=s.FULL_DISPLAY,this.filterRootInstance=r,this.dirtyDrawables=n(this.dirtyDrawables),this.pixiRenderer=PIXI.autoDetectRenderer(400,300,{transparent:!0}),this.domElement=this.pixiRenderer.view,this.domElement.style.position="absolute",this.domElement.style.left="0",this.domElement.style.top="0",this.domElement.style.pointerEvents="none",this.stage=new PIXI.Stage,a.prepareForTransform(this.pixiRenderer.view,this.forceAcceleration),a.unsetTransform(this.pixiRenderer.view),this.initializeWebGLState(),this},initializeWebGLState:function(){},setSizeFullDisplay:function(){},setSizeFitBounds:function(){var t=this.fitBounds.minX,e=this.fitBounds.minY;a.setTransform("matrix(1,0,0,1,"+t+","+e+")",this.pixiRenderer.view,this.forceAcceleration)},update:function(){if(this.dirty&&!this.disposed){for(this.dirty=!1;this.dirtyDrawables.length;)this.dirtyDrawables.pop().update();this.updateFit(),this.pixiRenderer.render(this.stage)}},dispose:function(){this.pixiRenderer.dispose(),n(this.dirtyDrawables),s.prototype.dispose.call(this)},markDirtyDrawable:function(t){this.dirtyDrawables.push(t),this.markDirty()},addDrawable:function(t){s.prototype.addDrawable.call(this,t),this.stage.addChild(t.displayObject),t.initializeContext(this)},removeDrawable:function(t){s.prototype.removeDrawable.call(this,t),this.stage.removeChild(t.displayObject)},onIntervalChange:function(t,e){s.prototype.onIntervalChange.call(this,t,e)},onPotentiallyMovedDrawable:function(t){t.markDirty()},simulateWebGLContextLoss:function(){console.log("simulating webgl context loss in PixiBlock"),this.pixiRenderer.view.loseContextInNCalls(5)},toString:function(){return"PixiBlock#"+this.id+"-"+s.fitString[this.fit]}},{fragmentTypeFill:0,fragmentTypeTexture:1}),i(o,{constructorDuplicateFactory:function(t){return function(e,i,n,r){return t.length?t.pop().initialize(e,i,n,r):new o(e,i,n,r)}}}),o}),i("SCENERY/display/Stitcher",["require","PHET_CORE/inherit","PHET_CORE/cleanArray","SCENERY/scenery","SCENERY/display/Drawable","SCENERY/display/Renderer","SCENERY/display/CanvasBlock","SCENERY/display/SVGBlock","SCENERY/display/DOMBlock","SCENERY/display/WebGLBlock","SCENERY/display/PixiBlock"],function(t){var e=t("PHET_CORE/inherit"),i=t("PHET_CORE/cleanArray"),n=t("SCENERY/scenery"),r=(t("SCENERY/display/Drawable"),t("SCENERY/display/Renderer")),s=t("SCENERY/display/CanvasBlock"),a=t("SCENERY/display/SVGBlock"),o=t("SCENERY/display/DOMBlock"),h=t("SCENERY/display/WebGLBlock"),l=t("SCENERY/display/PixiBlock");n.Stitcher=function(){throw new Error("We are too abstract for that!")};var u=n.Stitcher;return e(Object,u,{initialize:function(t,e,n,r,s,a,o){this.backbone=t,this.firstDrawable=e,this.lastDrawable=n,this.touchedBlocks=i(this.touchedBlocks)},clean:function(){this.backbone=null,this.firstDrawable=null,this.lastDrawable=null},recordBackboneBoundaries:function(){this.backbone.previousFirstDrawable=this.firstDrawable,this.backbone.previousLastDrawable=this.lastDrawable},notePendingAddition:function(t,e){t.notePendingAddition(this.backbone.display,e,this.backbone)},notePendingMove:function(t,e){t.notePendingMove(this.backbone.display,e)},notePendingRemoval:function(t){t.notePendingRemoval(this.backbone.display)},markBlockForDisposal:function(t){t.domElement.parentNode===this.backbone.domElement&&this.backbone.domElement.removeChild(t.domElement),t.markForDisposal(this.backbone.display)},removeAllBlocks:function(){for(;this.backbone.blocks.length;){var t=this.backbone.blocks[0];this.removeBlock(t),this.markBlockForDisposal(t)}},notifyInterval:function(t,e,i){t.notifyInterval(e,i),this.backbone.markDirtyDrawable(t)},markBeforeBlock:function(t,e){t.pendingFirstDrawable=e,this.touchedBlocks.push(t)},markAfterBlock:function(t,e){t.pendingLastDrawable=e,this.touchedBlocks.push(t)},updateBlockIntervals:function(){for(;this.touchedBlocks.length;){var t=this.touchedBlocks.pop();t.used&&(t.updateInterval(),this.backbone.markDirtyDrawable(t))}},createBlock:function(t,e){var i,n=this.backbone;if(r.isCanvas(t))i=s.createFromPool(n.display,t,n.transformRootInstance,n.backboneInstance);else if(r.isSVG(t))i=a.createFromPool(n.display,t,n.transformRootInstance,n.backboneInstance);else if(r.isDOM(t))i=o.createFromPool(n.display,e);else if(r.isWebGL(t))i=h.createFromPool(n.display,t,n.transformRootInstance,n.backboneInstance);else{if(!r.isPixi(t))throw new Error("unsupported renderer for createBlock: "+t);i=l.createFromPool(n.display,t,n.transformRootInstance,n.backboneInstance)}return i.setBlockBackbone(n),n.domElement.appendChild(i.domElement),n.markDirtyDrawable(i),i},appendBlock:function(t){this.backbone.blocks.push(t)},removeBlock:function(t){var e=_.indexOf(this.backbone.blocks,t);this.backbone.blocks.splice(e,1)},useNoBlocks:function(){i(this.backbone.blocks)},reindex:function(){this.backbone.reindexBlocks()},auditStitch:function(){}}),u.debugIntervals=function(t){},u.debugDrawables=function(t,e,i,n,r){},u}),i("SCENERY/display/GreedyStitcher",["require","PHET_CORE/inherit","PHET_CORE/cleanArray","SCENERY/scenery","SCENERY/display/Renderer","SCENERY/display/Stitcher"],function(t){function e(t,e){return t.renderer!==e.renderer||c.isDOM(t.renderer)||c.isDOM(e.renderer)}function i(t){return null!==t.previousDrawable&&!e(t.previousDrawable,t)}function n(t){return null!==t.nextDrawable&&!e(t,t.nextDrawable)}function r(t,e){return t.drawableBefore?t.drawableBefore.nextDrawable!==t.drawableAfter:t.drawableAfter?t.drawableAfter.previousDrawable!==t.drawableBefore:null!==e}function s(t,e){return t.drawableBefore?t.drawableBefore.oldNextDrawable!==t.drawableAfter:t.drawableAfter?t.drawableAfter.oldPreviousDrawable!==t.drawableBefore:null!==e}function a(t,e){var i=t.drawableBefore?t.drawableBefore.parentDrawable:null,n=t.drawableAfter?t.drawableAfter.parentDrawable:null;return i&&n&&i===n?!1:i?i.nextBlock!==n:n?n.previousBlock!==i:null!==e}function o(t){var e=t.drawableAfter;if(e){for(var i=e.renderer,n=t.nextChangeInterval?t.nextChangeInterval.drawableBefore.nextDrawable:null,r=e;;){var s=r.nextDrawable;if(s===n||s.renderer!==i)break;r=s}return r}return null}var h=t("PHET_CORE/inherit"),l=t("PHET_CORE/cleanArray"),u=t("SCENERY/scenery"),c=t("SCENERY/display/Renderer"),d=t("SCENERY/display/Stitcher"),f={stitch:function(t,e,i,n,r,o,h){this.initialize(t,e,i,n,r,o,h),this.blockOrderChanged=!1,this.reusableBlocks=l(this.reusableBlocks),this.blockWasAdded=!1,this.firstEdgeCase=!0;var u;if(this.recordBackboneBoundaries(),t.blocks.length){var c=t.blocks[0],d=t.blocks[t.blocks.length-1];for(u=o;null!==u;u=u.nextChangeInterval){if(s(u,n,r))for(var f=u.drawableBefore?u.drawableBefore.oldNextDrawable:n,m=u.drawableAfter?u.drawableAfter.oldPreviousDrawable:r,p=f;this.notePendingRemoval(p),p!==m;p=p.oldNextDrawable);if(a(u,c,d))for(var g=null===u.drawableBefore?t.blocks[0]:u.drawableBefore.parentDrawable.nextBlock,v=null===u.drawableAfter?t.blocks[t.blocks.length-1]:u.drawableAfter.parentDrawable.previousBlock,b=g;this.unuseBlock(b),b!==v;b=b.nextBlock);}}if(e)for(u=o;null!==u;u=u.nextChangeInterval)this.processInterval(t,u,e,i);this.removeUnusedBlocks(),this.updateBlockIntervals(),null===e?this.useNoBlocks():this.blockOrderChanged&&(this.processBlockLinkedList(t,e.pendingParentDrawable,i.pendingParentDrawable),this.reindex()),this.clean(),l(this.reusableBlocks)},processInterval:function(t,s,a,o){if(r(s,a,o))for(var h=s.drawableBefore?s.drawableBefore.nextDrawable:a,l=null,u=null,c=!0;;){var d=h.nextDrawable,f=d===s.drawableAfter;if(l||(l=h),null===u&&h.parentDrawable&&!h.parentDrawable.used&&h.backbone===t&&h.parentDrawable.parentDrawable===t&&(u=h.parentDrawable),(f||e(h,d))&&(c&&this.processEdgeCases(s,i(l),n(h)),this.processSubBlock(s,l,h,u,c,f),l=null,u=null,c=!1),f)break;h=d}else{if(s.drawableBefore&&s.drawableAfter){var m=!e(s.drawableBefore,s.drawableAfter);this.processEdgeCases(s,m,m)}s.drawableBefore&&!n(s.drawableBefore)?this.linkAfterDrawable(s.drawableBefore):s.drawableAfter&&!i(s.drawableAfter)&&this.linkBeforeDrawable(s.drawableAfter)}},processSubBlock:function(t,e,r,s,a,o){var h=i(e),l=n(r);h&&(s=e.previousDrawable.pendingParentDrawable),l&&(s=r.nextDrawable.pendingParentDrawable),s=this.ensureUsedBlock(s,e);for(var u=e;this.notePendingAddition(u,s),u!==r;u=u.nextDrawable);h||this.linkBeforeDrawable(e),o&&!l&&this.linkAfterDrawable(r)},processEdgeCases:function(t,e,i){if(null!==t.drawableBefore&&null!==t.drawableAfter){var n=t.drawableBefore.pendingParentDrawable,r=t.drawableAfter.pendingParentDrawable,s=t.nextChangeInterval&&t.nextChangeInterval.drawableAfter?t.nextChangeInterval.drawableAfter.pendingParentDrawable:null;this.firstEdgeCase&&(this.firstEdgeCase=!1,n===r&&(this.blockWasAdded=!0));var a;e&&i?a=n:this.blockWasAdded||n===r?(a=this.createBlock(t.drawableAfter.renderer,t.drawableAfter),this.blockOrderChanged=!0):a=r,r===a?this.blockWasAdded=!0:this.changeExternals(t,a),s!==r&&(this.blockWasAdded||this.unuseBlock(r),this.blockWasAdded=!1)}},changeExternals:function(t,e){var i=o(t);this.notePendingMoves(e,t.drawableAfter,i),t.nextChangeInterval&&t.nextChangeInterval.drawableBefore===i||this.linkAfterDrawable(i)
},notePendingMoves:function(t,e,i){for(var n=e;this.notePendingMove(n,t),n!==i;n=n.nextDrawable);},ensureUsedBlock:function(t,e){return t?t.used||this.useBlock(t):t=this.getBlockForRenderer(e.renderer,e),t},getBlockForRenderer:function(t,e){var i;if(!c.isDOM(t))for(var n=this.reusableBlocks.length-1;n>=0;n--){var r=this.reusableBlocks[n];if(r.renderer===t){this.useBlockAtIndex(r,n),i=r;break}}return i||(i=this.createBlock(t,e)),this.blockOrderChanged=!0,i},unuseBlock:function(t){t.used&&(t.used=!1,this.reusableBlocks.push(t))},useBlock:function(t){this.useBlockAtIndex(t,_.indexOf(this.reusableBlocks,t))},useBlockAtIndex:function(t,e){this.reusableBlocks.splice(e,1),t.used=!0},removeUnusedBlocks:function(){for(;this.reusableBlocks.length;){var t=this.reusableBlocks.pop();this.markBlockForDisposal(t),this.blockOrderChanged=!0}},linkBeforeDrawable:function(t){var e=t.previousDrawable;this.linkBlocks(e?e.pendingParentDrawable:null,t.pendingParentDrawable,e,t)},linkAfterDrawable:function(t){var e=t.nextDrawable;this.linkBlocks(t.pendingParentDrawable,e?e.pendingParentDrawable:null,t,e)},linkBlocks:function(t,e,i,n){t&&(t.nextBlock!==e&&(this.blockOrderChanged=!0,t.nextBlock&&(t.nextBlock.previousBlock=null),t.nextBlock=e),this.markAfterBlock(t,i)),e&&(e.previousBlock!==t&&(this.blockOrderChanged=!0,e.previousBlock&&(e.previousBlock.nextBlock=null),e.previousBlock=t),this.markBeforeBlock(e,n))},processBlockLinkedList:function(t,e,i){for(;t.blocks.length;)t.blocks.pop();if(e)for(var n=e;t.blocks.push(n),n!==i;n=n.nextBlock);}},m=u.GreedyStitcher=h(d,function(){},f);return m.stitchPrototype=f,m}),i("SCENERY/display/RebuildStitcher",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/display/Renderer","SCENERY/display/Stitcher"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/display/Renderer"),r=t("SCENERY/display/Stitcher"),s={stitch:function(t,e,i,r,s,a,o){this.initialize(t,e,i,r,s,a,o);for(var h=t.previousFirstDrawable;null!==h&&(this.notePendingRemoval(h),h!==t.previousLastDrawable);h=h.oldNextDrawable);this.recordBackboneBoundaries(),this.removeAllBlocks();for(var l=null,u=0,c=null,d=e;null!==d&&(l&&d.renderer===u||(l&&this.notifyInterval(l,c,d.previousDrawable),u=d.renderer,l=this.createBlock(u,d),n.isDOM(u)&&(u=0),this.appendBlock(l),c=d),this.notePendingAddition(d,l),d!==i);d=d.nextDrawable);l&&this.notifyInterval(l,c,i),this.reindex(),this.clean()}},a=i.RebuildStitcher=e(r,function(){},s);return a.stitchPrototype=s,a}),i("SCENERY/display/BackboneDrawable",["require","PHET_CORE/inherit","PHET_CORE/PoolableMixin","PHET_CORE/cleanArray","SCENERY/scenery","SCENERY/display/Drawable","SCENERY/display/Renderer","SCENERY/display/Stitcher","SCENERY/display/GreedyStitcher","SCENERY/display/RebuildStitcher","SCENERY/util/Util"],function(t){var e=t("PHET_CORE/inherit"),i=t("PHET_CORE/PoolableMixin"),n=t("PHET_CORE/cleanArray"),r=t("SCENERY/scenery"),s=t("SCENERY/display/Drawable"),a=t("SCENERY/display/Renderer"),o=(t("SCENERY/display/Stitcher"),t("SCENERY/display/GreedyStitcher")),h=t("SCENERY/display/RebuildStitcher"),l=t("SCENERY/util/Util"),u=!0;r.BackboneDrawable=function(t,e,i,n,r){this.initialize(t,e,i,n,r)};var c=r.BackboneDrawable;return e(s,c,{initialize:function(t,e,i,r,d){if(s.call(this,r),this.display=t,this.forceAcceleration=a.isAccelerationForced(this.renderer),this.backboneInstance=e,this.transformRootInstance=i,this.filterRootAncestorInstance=e.parent?e.parent.getFilterRootInstance():e,this.transformRootAncestorInstance=e.parent?e.parent.getTransformRootInstance():e,this.willApplyTransform=this.transformRootAncestorInstance!==this.transformRootInstance,this.willApplyFilters=this.filterRootAncestorInstance!==this.backboneInstance,this.transformListener=this.transformListener||this.markTransformDirty.bind(this),this.willApplyTransform&&(this.backboneInstance.relativeTransform.addListener(this.transformListener),this.backboneInstance.relativeTransform.addPrecompute()),this.renderer=r,this.domElement=d?t._domElement:c.createDivBackbone(),this.isDisplayRoot=d,this.dirtyDrawables=n(this.dirtyDrawables),l.prepareForTransform(this.domElement,this.forceAcceleration),this.watchedFilterNodes=n(this.watchedFilterNodes),this.opacityDirty=!0,this.visibilityDirty=!0,this.clipDirty=!0,this.opacityDirtyListener=this.opacityDirtyListener||this.markOpacityDirty.bind(this),this.visibilityDirtyListener=this.visibilityDirtyListener||this.markVisibilityDirty.bind(this),this.clipDirtyListener=this.clipDirtyListener||this.markClipDirty.bind(this),this.willApplyFilters)for(var f=this.backboneInstance;f!==this.filterRootAncestorInstance;f=f.parent){var m=f.node;this.watchedFilterNodes.push(m),m.onStatic("opacity",this.opacityDirtyListener),m.onStatic("visibility",this.visibilityDirtyListener),m.onStatic("clip",this.clipDirtyListener)}return this.lastZIndex=0,this.blocks=this.blocks||[],this.previousFirstDrawable=null,this.previousLastDrawable=null,this.removedDrawables=!1,this.stitcher=this.stitcher||(u?new o:new h),this},dispose:function(){for(;this.watchedFilterNodes.length;){var t=this.watchedFilterNodes.pop();t.offStatic("opacity",this.opacityDirtyListener),t.offStatic("visibility",this.visibilityDirtyListener),t.offStatic("clip",this.clipDirtyListener)}if(!this.removedDrawables)for(var e=this.previousFirstDrawable;null!==e&&(e.parentDrawable.removeDrawable(e),e!==this.previousLastDrawable);e=e.nextDrawable);this.markBlocksForDisposal(),this.willApplyTransform&&(this.backboneInstance.relativeTransform.removeListener(this.transformListener),this.backboneInstance.relativeTransform.removePrecompute()),this.backboneInstance=null,this.transformRootInstance=null,this.filterRootAncestorInstance=null,this.transformRootAncestorInstance=null,n(this.dirtyDrawables),n(this.watchedFilterNodes),this.previousFirstDrawable=null,this.previousLastDrawable=null,s.prototype.dispose.call(this)},markBlocksForDisposal:function(){for(;this.blocks.length;){var t=this.blocks.pop();t.domElement.parentNode===this.domElement&&this.domElement.removeChild(t.domElement),t.markForDisposal(this.display)}},markForDisposal:function(t){for(var e=this.previousFirstDrawable;null!==e&&(e.notePendingRemoval(this.display),e!==this.previousLastDrawable);e=e.oldNextDrawable);this.removedDrawables=!0,s.prototype.markForDisposal.call(this,t)},markDirtyDrawable:function(t){this.dirtyDrawables.push(t),this.markDirty()},markTransformDirty:function(){r.Util.applyPreparedTransform(this.backboneInstance.relativeTransform.matrix,this.domElement,this.forceAcceleration)},markOpacityDirty:function(){this.opacityDirty||(this.opacityDirty=!0,this.markDirty())},markVisibilityDirty:function(){this.visibilityDirty||(this.visibilityDirty=!0,this.markDirty())},markClipDirty:function(){this.clipDirty||(this.clipDirty=!0,this.markDirty())},update:function(){if(this.dirty&&!this.disposed){for(this.dirty=!1;this.dirtyDrawables.length;)this.dirtyDrawables.pop().update();if(this.opacityDirty){this.opacityDirty=!1;var t=this.willApplyFilters?this.getFilterOpacity():1;this.domElement.style.opacity=1!==t?t:""}if(this.visibilityDirty&&(this.visibilityDirty=!1,this.domElement.style.display=this.willApplyFilters&&!this.getFilterVisibility()?"none":""),this.clipDirty){this.clipDirty=!1;var e=this.willApplyFilters?this.getFilterClip():"";this.domElement.style.clipPath=e}}},getFilterOpacity:function(){for(var t=1,e=this.watchedFilterNodes.length,i=0;e>i;i++)t*=this.watchedFilterNodes[i].getOpacity();return t},getFilterVisibility:function(){for(var t=this.watchedFilterNodes.length,e=0;t>e;e++)if(!this.watchedFilterNodes[e].isVisible())return!1;return!0},getFilterClip:function(){var t="";return t},reindexBlocks:function(){for(var t=0,e=0;e<this.blocks.length;e++){var i=this.blocks[e];if(i.zIndex<=t){var n=e+1<this.blocks.length&&this.blocks[e+1].zIndex-1>t?Math.ceil((t+this.blocks[e+1].zIndex)/2):t+20;i.domElement.style.zIndex=i.zIndex=n}t=i.zIndex}this.lastZIndex=t+1},stitch:function(t,e,i,n){if(null!==i&&null!==n){for(var r=null,s=i,a=!1;s;)a=s.constrict()||a,s.isEmpty()?r&&(r.nextChangeInterval=s.nextChangeInterval):(r||(i=s),r=s),s=s.nextChangeInterval;if(r){n=r,n.nextChangeInterval=null;this.stitcher.stitch(this,t,e,this.previousFirstDrawable,this.previousLastDrawable,i,n)}}},audit:function(t,e,i){}}),c.createDivBackbone=function(){var t=document.createElement("div");return t.style.position="absolute",t.style.left="0",t.style.top="0",t.style.width="0",t.style.height="0",t},c.repurposeBackboneContainer=function(t){return("relative"!==t.style.position||"absolute"!==t.style.position)&&(t.style.position="relative"),t.style.left="0",t.style.top="0",t},i(c,{constructorDuplicateFactory:function(t){return function(e,i,n,r,s){return t.length?t.pop().initialize(e,i,n,r,s):new c(e,i,n,r,s)}}}),c}),i("SCENERY/display/ChangeInterval",["require","PHET_CORE/inherit","PHET_CORE/PoolableMixin","SCENERY/scenery","SCENERY/display/Drawable"],function(t){{var e=t("PHET_CORE/inherit"),i=t("PHET_CORE/PoolableMixin"),n=t("SCENERY/scenery");t("SCENERY/display/Drawable")}n.ChangeInterval=function(t,e){this.initialize(t,e)};var r=n.ChangeInterval;return e(Object,r,{initialize:function(t,e){return this.nextChangeInterval=null,this.drawableBefore=t,this.drawableAfter=e,this.collapsedEmpty=!1,this},dispose:function(){this.nextChangeInterval=null,this.drawableBefore=null,this.drawableAfter=null,this.freeToPool()},constrict:function(){var t=!1;if(this.isEmpty())return!0;for(;this.drawableBefore&&this.drawableBefore.nextDrawable===this.drawableBefore.oldNextDrawable;)if(this.drawableBefore=this.drawableBefore.nextDrawable,t=!0,this.drawableBefore||(this.collapsedEmpty=!0),this.isEmpty())return!0;for(;this.drawableAfter&&this.drawableAfter.previousDrawable===this.drawableAfter.oldPreviousDrawable;)if(this.drawableAfter=this.drawableAfter.previousDrawable,t=!0,this.drawableAfter||(this.collapsedEmpty=!0),this.isEmpty())return!0;return t},isEmpty:function(){return this.collapsedEmpty||null!==this.drawableBefore&&this.drawableBefore===this.drawableAfter},getOldInternalDrawableCount:function(t){for(var e=this.drawableBefore?this.drawableBefore.oldNextDrawable:t,i=this.drawableAfter,n=0,r=e;r!==i;r=r.oldNextDrawable)n++;return n},getNewInternalDrawableCount:function(t){for(var e=this.drawableBefore?this.drawableBefore.nextDrawable:t,i=this.drawableAfter,n=0,r=e;r!==i;r=r.nextDrawable)n++;return n}}),i(r,{constructorDuplicateFactory:function(t){return function(e,i){return t.length?t.pop().initialize(e,i):new r(e,i)}}}),r.newForDisplay=function(t,e,i){var n=r.createFromPool(t,e);return i.markChangeIntervalToDispose(n),n},r}),i("SCENERY/display/RelativeTransform",["require","PHET_CORE/inherit","PHET_CORE/cleanArray","DOT/Matrix3","SCENERY/scenery"],function(t){var e=t("PHET_CORE/inherit"),i=t("PHET_CORE/cleanArray"),n=t("DOT/Matrix3"),r=t("SCENERY/scenery");r.RelativeTransform=function(){};var s=r.RelativeTransform;return e(Object,s,{initialize:function(t,e,i){return this.instance=t,this.display=e,this.trail=i,this.node=i.lastNode(),this.transformDirty=!0,this.nodeTransformListener=this.nodeTransformListener||this.onNodeTransformDirty.bind(this),this.matrix=this.matrix||n.identity(),this.relativeSelfDirty=!0,this.relativeChildrenListenersCount=0,this.relativePrecomputeCount=0,this.relativeChildrenPrecomputeCount=0,this.relativeFrameId=-1,this.relativeChildDirtyFrame=e._frameId,this},clean:function(){this.relativeTransformListeners=i(this.relativeTransformListeners)},get parent(){return this.instance.parent?this.instance.parent.relativeTransform:null},insertInstance:function(t){t.stateless||t.isTransformed||(t.relativeTransform.hasAncestorListenerNeed()&&this.incrementTransformListenerChildren(),t.relativeTransform.hasAncestorComputeNeed()&&this.incrementTransformPrecomputeChildren()),t.relativeTransform.forceMarkTransformDirty()},removeInstanceWithIndex:function(t){t.isTransformed||(t.relativeTransform.hasAncestorListenerNeed()&&this.decrementTransformListenerChildren(),t.relativeTransform.hasAncestorComputeNeed()&&this.decrementTransformPrecomputeChildren())},attachNodeListeners:function(){this.node.onStatic("transform",this.nodeTransformListener)},detachNodeListeners:function(){this.node.offStatic("transform",this.nodeTransformListener)},hasDescendantListenerNeed:function(){return this.instance.isTransformed?this.relativeChildrenListenersCount>0:this.relativeChildrenListenersCount>0||this.relativeTransformListeners.length>0},hasAncestorListenerNeed:function(){return this.instance.isTransformed?this.relativeTransformListeners.length>0:this.relativeChildrenListenersCount>0||this.relativeTransformListeners.length>0},hasSelfListenerNeed:function(){return this.relativeTransformListeners.length>0},incrementTransformListenerChildren:function(){var t=this.hasAncestorListenerNeed();this.relativeChildrenListenersCount++,t!==this.hasAncestorListenerNeed()&&this.parent&&this.parent.incrementTransformListenerChildren()},decrementTransformListenerChildren:function(){var t=this.hasAncestorListenerNeed();this.relativeChildrenListenersCount--,t!==this.hasAncestorListenerNeed()&&this.parent&&this.parent.decrementTransformListenerChildren()},addListener:function(t){var e=this.hasAncestorListenerNeed();this.relativeTransformListeners.push(t),e!==this.hasAncestorListenerNeed()&&(this.parent&&this.parent.incrementTransformListenerChildren(),this.hasAncestorComputeNeed()||this.forceMarkTransformDirty())},removeListener:function(t){var e=this.hasAncestorListenerNeed();this.relativeTransformListeners.splice(_.indexOf(this.relativeTransformListeners,t),1),e!==this.hasAncestorListenerNeed()&&this.parent&&this.parent.decrementTransformListenerChildren()},hasDescendantComputeNeed:function(){return this.instance.isTransformed?this.relativeChildrenPrecomputeCount>0:this.relativeChildrenPrecomputeCount>0||this.relativePrecomputeCount>0},hasAncestorComputeNeed:function(){return this.instance.isTransformed?this.relativePrecomputeCount>0:this.relativeChildrenPrecomputeCount>0||this.relativePrecomputeCount>0},hasSelfComputeNeed:function(){return this.relativePrecomputeCount>0},incrementTransformPrecomputeChildren:function(){var t=this.hasAncestorComputeNeed();this.relativeChildrenPrecomputeCount++,t!==this.hasAncestorComputeNeed()&&this.parent&&this.parent.incrementTransformPrecomputeChildren()},decrementTransformPrecomputeChildren:function(){var t=this.hasAncestorComputeNeed();this.relativeChildrenPrecomputeCount--,t!==this.hasAncestorComputeNeed()&&this.parent&&this.parent.decrementTransformPrecomputeChildren()},addPrecompute:function(){var t=this.hasAncestorComputeNeed();this.relativePrecomputeCount++,t!==this.hasAncestorComputeNeed()&&(this.parent&&this.parent.incrementTransformPrecomputeChildren(),this.hasAncestorListenerNeed()||this.forceMarkTransformDirty())},removePrecompute:function(){var t=this.hasAncestorComputeNeed();this.relativePrecomputeCount--,t!==this.hasAncestorComputeNeed()&&this.parent&&this.parent.decrementTransformPrecomputeChildren()},onNodeTransformDirty:function(){this.transformDirty||this.forceMarkTransformDirty()},forceMarkTransformDirty:function(){this.transformDirty=!0,this.relativeSelfDirty=!0;for(var t=this.display._frameId,e=this.instance.parent;e&&e.relativeTransform.relativeChildDirtyFrame!==t;){var i=e.parent,n=e.isTransformed;if(e.relativeTransform.relativeChildDirtyFrame=t,null===i){this.display.markTransformRootDirty(e,n);break}if(n){this.display.markTransformRootDirty(e,!0);break}e=i}},computeRelativeTransform:function(){var t=this.node.getTransform().getMatrix();this.instance.parent&&!this.instance.parent.isTransformed?(this.matrix.set(this.parent.matrix),this.matrix.multiplyMatrix(t)):this.matrix.set(t),this.relativeFrameId=this.display._frameId,this.relativeSelfDirty=!1},isValidationNotNeeded:function(){return this.hasAncestorComputeNeed()||this.relativeFrameId===this.display._frameId},validate:function(){if(!this.isValidationNotNeeded()&&(this.instance.parent&&!this.instance.parent.isTransformed&&this.parent.validate(),this.relativeSelfDirty)){this.computeRelativeTransform();for(var t=this.instance.children.length,e=0;t>e;e++)this.instance.children[e].relativeTransform.relativeSelfDirty=!0}},updateTransformListenersAndCompute:function(t,e,i,n){var r,s;if(n)for(r=this.instance.children.length,s=0;r>s;s++)this.instance.children[s].relativeTransform.updateTransformListenersAndCompute(!1,!1,i,!1);else{var a=t||this.relativeSelfDirty,o=a||this.relativeChildDirtyFrame===i,h=this.hasDescendantComputeNeed(),l=this.hasDescendantListenerNeed(),u=this.hasSelfComputeNeed(),c=this.hasSelfListenerNeed();if(h||!a||e||(this.relativeSelfDirty=!0),!o||!h&&!l&&!u&&!c)return;if(a&&(h||u)&&this.computeRelativeTransform(),this.transformDirty&&(this.transformDirty=!1),this.notifyRelativeTransformListeners(),!this.instance.isTransformed||n){var d=a&&!(h||u);for(r=this.instance.children.length,s=0;r>s;s++)this.instance.children[s].relativeTransform.updateTransformListenersAndCompute(a,d,i,!1)}}},notifyRelativeTransformListeners:function(){for(var t=this.relativeTransformListeners.length,e=0;t>e;e++)this.relativeTransformListeners[e]()},audit:function(t,e){}}),s}),i("SCENERY/display/Instance",["require","PHET_CORE/inherit","PHET_CORE/PoolableMixin","PHET_CORE/cleanArray","SCENERY/scenery","SCENERY/display/ChangeInterval","SCENERY/display/Drawable","SCENERY/display/Renderer","SCENERY/display/RelativeTransform"],function(t){var e=t("PHET_CORE/inherit"),i=t("PHET_CORE/PoolableMixin"),n=t("PHET_CORE/cleanArray"),r=t("SCENERY/scenery"),s=t("SCENERY/display/ChangeInterval"),a=t("SCENERY/display/Drawable"),o=t("SCENERY/display/Renderer"),h=t("SCENERY/display/RelativeTransform"),l=1,u={},c=o.createOrderBitmask(o.bitmaskSVG,o.bitmaskCanvas,o.bitmaskDOM,o.bitmaskWebGL,o.bitmaskPixi);r.Instance=function(t,e,i,n){this.active=!1,this.initialize(t,e,i,n)};var d=r.Instance;return e(Object,d,{initialize:function(t,e,i,n){return e.setImmutable(),this.id=this.id||l++,this.relativeTransform=(this.relativeTransform||new h).initialize(this,t,e),this.addRemoveCounter=0,this.stitchChangeFrame=t._frameId,this.stitchChangeBefore=0,this.stitchChangeAfter=0,this.stitchChangeOnChildren=0,this.stitchChangeIncluded=!1,this.childInsertedListener=this.childInsertedListener||this.onChildInserted.bind(this),this.childRemovedListener=this.childRemovedListener||this.onChildRemoved.bind(this),this.visibilityListener=this.visibilityListener||this.onVisibilityChange.bind(this),this.markRenderStateDirtyListener=this.markRenderStateDirtyListener||this.markRenderStateDirty.bind(this),this.cleanInstance(t,e),this.node.addInstance(this),this.externalReferenceCount=0,this.active=!0,this.stateless=!0,this.isDisplayRoot=i,this.isSharedCanvasCacheRoot=n,this.preferredRenderers=0,this.isUnderCanvasCache=n,this.isBackbone=!1,this.isTransformed=!1,this.isInstanceCanvasCache=!1,this.isSharedCanvasCachePlaceholder=!1,this.isSharedCanvasCacheSelf=n,this.selfRenderer=0,this.groupRenderer=0,this.sharedCacheRenderer=0,this.renderStateDirtyFrame=t._frameId,this.skipPruningFrame=t._frameId,this},cleanInstance:function(t,e){this.display=t,this.trail=e,this.node=e?e.lastNode():null,this.parent=null,this.oldParent=null,this.children=n(this.children),this.sharedCacheInstance=null,this.instanceRemovalCheckList=n(this.instanceRemovalCheckList),this.selfDrawable=null,this.groupDrawable=null,this.sharedCacheDrawable=null,this.firstDrawable=null,this.lastDrawable=null,this.firstInnerDrawable=null,this.lastInnerDrawable=null,this.svgGroups=[],this.cleanSyncTreeResults(),this.relativeTransform.clean()},cleanSyncTreeResults:function(){this.beforeStableIndex=this.children.length,this.afterStableIndex=-1,this.firstChangeInterval=null,this.lastChangeInterval=null,this.incompatibleStateChange=!1,this.groupChanged=!1,this.cascadingStateChange=!1,this.anyStateChange=!1},updateRenderingState:function(){var t=this.isBackbone,e=this.isTransformed,i=this.isInstanceCanvasCache,n=this.isSharedCanvasCacheSelf,r=this.isSharedCanvasCachePlaceholder,s=this.isUnderCanvasCache,a=this.selfRenderer,h=this.groupRenderer,l=this.sharedCacheRenderer,d=this.preferredRenderers;this.isBackbone=!1,this.isTransformed=!1,this.isInstanceCanvasCache=!1,this.isSharedCanvasCacheSelf=!1,this.isSharedCanvasCachePlaceholder=!1,this.selfRenderer=0,this.groupRenderer=0,this.sharedCacheRenderer=0;var f=(this.node._rendererSummary.bitmask,this.node._hints||u),m=1!==this.node._opacity||f.usesOpacity,p=null!==this.node._clipArea;if(this.isUnderCanvasCache=this.isSharedCanvasCacheRoot||(this.parent?this.parent.isUnderCanvasCache||this.parent.isInstanceCanvasCache||this.parent.isSharedCanvasCacheSelf:!1),this.isDisplayRoot||!this.isUnderCanvasCache&&(m||p||f.requireElement||f.cssTransform||f.split)?(this.isBackbone=!0,this.isTransformed=this.isDisplayRoot||!!f.cssTransform,this.groupRenderer=o.bitmaskDOM|(f.forceAcceleration?o.bitmaskForceAcceleration:0)):(m||p||f.canvasCache)&&(f.singleCache?this.isSharedCanvasCacheRoot?(this.isSharedCanvasCacheSelf=!0,this.sharedCacheRenderer=o.bitmaskCanvas):this.isSharedCanvasCachePlaceholder=!0:(this.isInstanceCanvasCache=!0,this.isUnderCanvasCache=!0,this.groupRenderer=o.bitmaskCanvas)),this.preferredRenderers=this.parent?this.parent.preferredRenderers:c,f.renderer&&(this.preferredRenderers=o.pushOrderBitmask(this.preferredRenderers,f.renderer)),this.node.isPainted())if(this.isUnderCanvasCache)this.selfRenderer=o.bitmaskCanvas;else{var g=this.node._rendererBitmask;this.selfRenderer=g&o.bitmaskOrderFirst(this.preferredRenderers)||g&o.bitmaskOrderSecond(this.preferredRenderers)||g&o.bitmaskOrderThird(this.preferredRenderers)||g&o.bitmaskOrderFourth(this.preferredRenderers)||g&o.bitmaskOrderFifth(this.preferredRenderers)||g&o.bitmaskSVG||g&o.bitmaskCanvas||g&o.bitmaskDOM||g&o.bitmaskWebGL||g&o.bitmaskPixi||0}this.groupChanged=t!==this.isBackbone||i!==this.isInstanceCanvasCache||n!==this.isSharedCanvasCacheSelf,this.cascadingStateChange=s!==this.isUnderCanvasCache||d!==this.preferredRenderers,this.incompatibleStateChange=this.isTransformed!==e||this.isSharedCanvasCachePlaceholder!==r,this.anyStateChange=this.groupChanged||this.cascadingStateChange||this.incompatibleStateChange||a!==this.selfRenderer||h!==this.groupRenderer||l!==this.sharedCacheRenderer},getStateString:function(){var t="S[ "+(this.isDisplayRoot?"displayRoot ":"")+(this.isBackbone?"backbone ":"")+(this.isInstanceCanvasCache?"instanceCache ":"")+(this.isSharedCanvasCachePlaceholder?"sharedCachePlaceholder ":"")+(this.isSharedCanvasCacheSelf?"sharedCacheSelf ":"")+(this.isTransformed?"TR ":"")+(this.selfRenderer?this.selfRenderer.toString(16):"-")+","+(this.groupRenderer?this.groupRenderer.toString(16):"-")+","+(this.sharedCacheRenderer?this.sharedCacheRenderer.toString(16):"-")+" ";return t+"]"},baseSyncTree:function(){this.syncTree(),this.cleanSyncTreeResults()},syncTree:function(){var t=this.stateless;if((t||this.parent&&this.parent.cascadingStateChange||this.renderStateDirtyFrame===this.display._frameId)&&this.updateRenderingState(),!t&&this.incompatibleStateChange)return!1;if(this.stateless=!1,t&&(this.isTransformed&&this.display.markTransformRootDirty(this,!0),this.attachNodeListeners()),this.isSharedCanvasCachePlaceholder)this.sharedSyncTree();else if(t||this.skipPruningFrame===this.display._frameId||this.anyStateChange){this.prepareChildInstances(t);var e=(this.firstDrawable,this.lastDrawable,this.firstInnerDrawable,this.lastInnerDrawable,this.updateSelfDrawable());this.localSyncTree(e),this.groupSyncTree(t)}return!0},localSyncTree:function(t){var e=this.display._frameId,i=this.selfDrawable,n=i,r=null;t&&(r=s.newForDisplay(null,null,this.display));for(var o=r,h=t?null:this.selfDrawable,l=0;l<this.children.length;l++){var u=this.children[l],c=u.syncTree();c||(u=this.updateIncompatibleChildInstance(u,l),u.syncTree()),u.node.isVisible()&&u.firstDrawable&&(n?a.connectDrawables(n,u.firstDrawable,this.display):i=u.firstDrawable,n=u.lastDrawable);var d=u.stitchChangeIncluded,f=u.node.isVisible();u.stitchChangeIncluded=f,u.stitchChangeFrame===e&&(u.firstChangeInterval=u.lastChangeInterval=s.newForDisplay(null,null,this.display));var m=u.firstChangeInterval,p=o&&null===o.drawableAfter,g=m&&null===m.drawableBefore,v=u.stitchChangeBefore===e&&!p&&!g;if(v){var b=s.newForDisplay(h,null,this.display);o&&(o.nextChangeInterval=b),o=b,r=r||o,p=!0}if((d||f)&&(p?m?null===m.drawableBefore?(o.drawableAfter=m.drawableAfter,o.nextChangeInterval=m.nextChangeInterval,o=u.lastChangeInterval===m?o:u.lastChangeInterval):(o.drawableAfter=u.firstDrawable,o.nextChangeInterval=m,o=u.lastChangeInterval):o.drawableAfter=u.firstDrawable:m&&(r=r||m,null===m.drawableBefore&&(m.drawableBefore=h),o&&(o.nextChangeInterval=m),o=u.lastChangeInterval),h=o&&null===o.drawableAfter?null:u.lastDrawable?u.lastDrawable:h),l===this.children.length-1&&u.stitchChangeAfter===e&&(!o||null!==o.drawableAfter)){var y=s.newForDisplay(h,null,this.display);o&&(o.nextChangeInterval=y),o=y,r=r||o}u.cleanSyncTreeResults()}r||this.stitchChangeOnChildren!==this.display._frameId||0!==this.children.length||(r=o=s.newForDisplay(null,null,this.display)),this.firstChangeInterval=r,this.lastChangeInterval=o,this.firstDrawable=this.firstInnerDrawable=i,this.lastDrawable=this.lastInnerDrawable=n},updateSelfDrawable:function(){if(this.node.isPainted()){var t=this.selfRenderer;if(!this.selfDrawable||0===(this.selfDrawable.renderer&t&o.bitmaskRendererArea))return this.selfDrawable&&this.selfDrawable.markForDisposal(this.display),this.selfDrawable=o.createSelfDrawable(this,this.node,t),!0}return!1},updateIncompatibleChildInstance:function(t,e){this.display.markInstanceRootForDisposal(t);var i=d.createFromPool(this.display,this.trail.copy().addDescendant(t.node,e),!1,!1);return this.replaceInstanceWithIndex(t,i,e),i},groupSyncTree:function(t){var e=this.groupRenderer,i=!!e!=!!this.groupDrawable||!t&&this.groupChanged||this.groupDrawable&&this.groupDrawable.renderer!==e;i&&(this.groupDrawable&&(this.groupDrawable.markForDisposal(this.display),this.groupDrawable=null),this.firstChangeInterval=this.lastChangeInterval=s.newForDisplay(null,null,this.display)),e&&(this.firstDrawable&&a.disconnectBefore(this.firstDrawable,this.display),this.lastDrawable&&a.disconnectAfter(this.lastDrawable,this.display),this.isBackbone?(i&&(this.groupDrawable=r.BackboneDrawable.createFromPool(this.display,this,this.getTransformRootInstance(),e,this.isDisplayRoot),this.isTransformed&&this.display.markTransformRootDirty(this,!0)),this.firstChangeInterval&&this.groupDrawable.stitch(this.firstDrawable,this.lastDrawable,this.firstChangeInterval,this.lastChangeInterval)):this.isInstanceCanvasCache?(i&&(this.groupDrawable=r.InlineCanvasCacheDrawable.createFromPool(e,this)),this.firstChangeInterval&&this.groupDrawable.stitch(this.firstDrawable,this.lastDrawable,this.firstChangeInterval,this.lastChangeInterval)):this.isSharedCanvasCacheSelf&&i&&(this.groupDrawable=r.CanvasBlock.createFromPool(e,this)),this.firstDrawable=this.lastDrawable=this.groupDrawable),i?this.firstChangeInterval=this.lastChangeInterval=s.newForDisplay(null,null,this.display):e&&(this.firstChangeInterval=this.lastChangeInterval=null)},sharedSyncTree:function(){this.ensureSharedCacheInitialized();var t=this.sharedCacheRenderer;this.sharedCacheDrawable&&this.sharedCacheDrawable.renderer===t||(this.sharedCacheDrawable&&this.sharedCacheDrawable.markForDisposal(this.display),this.sharedCacheDrawable=new r.SharedCanvasCacheDrawable(this.trail,t,this,this.sharedCacheInstance),this.firstDrawable=this.sharedCacheDrawable,this.lastDrawable=this.sharedCacheDrawable,this.firstChangeInterval=this.lastChangeInterval=s.newForDisplay(null,null,this.display))},prepareChildInstances:function(t){for(;this.instanceRemovalCheckList.length;){var e=this.instanceRemovalCheckList.pop();-1===e.addRemoveCounter&&(e.addRemoveCounter=0,this.display.markInstanceRootForDisposal(e))}if(t)for(var i=0;i<this.node.children.length;i++){var n=this.node.children[i];this.appendInstance(d.createFromPool(this.display,this.trail.copy().addDescendant(n,i),!1,!1))}},ensureSharedCacheInitialized:function(){if(!this.sharedCacheInstance){var t=this.node.getId();this.sharedCacheInstance=this.display._sharedCanvasInstances[t],this.sharedCacheInstance||(this.sharedCacheInstance=d.createFromPool(this.display,new r.Trail(this.node),!1,!0),this.sharedCacheInstance.syncTree(),this.display._sharedCanvasInstances[t]=this.sharedCacheInstance,this.display.markTransformRootDirty(this.sharedCacheInstance,!0)),this.sharedCacheInstance.externalReferenceCount++,this.isTransformed&&this.display.markTransformRootDirty(this,!0)}},findPreviousDrawable:function(t){for(var e=t-1;e>=0;e--){var i=this.children[e].lastDrawable;if(null!==i)return i}return null},findNextDrawable:function(t){for(var e=this.children.length,i=t+1;e>i;i++){var n=this.children[i].firstDrawable;if(null!==n)return n}return null},appendInstance:function(t){this.insertInstance(t,this.children.length)},insertInstance:function(t,e){t.stitchChangeFrame=this.display._frameId,this.stitchChangeOnChildren=this.display._frameId,this.children.splice(e,0,t),t.parent=this,t.oldParent=this,e<=this.beforeStableIndex&&(this.beforeStableIndex=e-1),e>this.afterStableIndex?this.afterStableIndex=e+1:this.afterStableIndex++,this.relativeTransform.insertInstance(t,e)},removeInstance:function(t){return this.removeInstanceWithIndex(t,_.indexOf(this.children,t))},removeInstanceWithIndex:function(t,e){var i=this.display._frameId;t.stitchChangeFrame=i,this.stitchChangeOnChildren=i,e-1>=0&&(this.children[e-1].stitchChangeAfter=i),e+1<this.children.length&&(this.children[e+1].stitchChangeBefore=i),this.children.splice(e,1),t.parent=null,t.oldParent=this,e<=this.beforeStableIndex&&(this.beforeStableIndex=e-1),e>=this.afterStableIndex?this.afterStableIndex=e:this.afterStableIndex--,this.relativeTransform.removeInstanceWithIndex(t,e)},replaceInstanceWithIndex:function(t,e,i){this.removeInstanceWithIndex(t,i),this.insertInstance(e,i)},findChildInstanceOnNode:function(t){for(var e=t.getInstances(),i=0;i<e.length;i++)if(e[i].oldParent===this)return e[i];return null},onChildInserted:function(t,e){var i=this.findChildInstanceOnNode(t);i?i.addRemoveCounter+=1:i=d.createFromPool(this.display,this.trail.copy().addDescendant(t,e),!1,!1),this.insertInstance(i,e),this.markSkipPruning()},onChildRemoved:function(t,e){var i=this.findChildInstanceOnNode(t);i.addRemoveCounter-=1,this.instanceRemovalCheckList.push(i),this.removeInstanceWithIndex(i,e),this.markSkipPruning()},onVisibilityChange:function(){this.stitchChangeFrame=this.display._frameId,this.parent&&this.parent.markSkipPruning()},onOpacityChange:function(){this.markRenderStateDirty()},getDescendantCount:function(){for(var t=this.children.length,e=0;e<this.children.length;e++)t+=this.children[e].getDescendantCount();return t},addSVGGroup:function(t){this.svgGroups.push(t)},removeSVGGroup:function(t){var e=_.indexOf(this.svgGroups,t);this.svgGroups.splice(e,1)},lookupSVGGroup:function(t){for(var e=this.svgGroups.length,i=0;e>i;i++){var n=this.svgGroups[i];if(n.block===t)return n}return null},getFilterRootInstance:function(){return this.isBackbone||this.isInstanceCanvasCache||!this.parent?this:this.parent.getFilterRootInstance()},getTransformRootInstance:function(){return this.isTransformed||!this.parent?this:this.parent.getTransformRootInstance()},attachNodeListeners:function(){this.relativeTransform.attachNodeListeners(),this.isSharedCanvasCachePlaceholder||(this.node.onStatic("childInserted",this.childInsertedListener),this.node.onStatic("childRemoved",this.childRemovedListener),this.node.onStatic("visibility",this.visibilityListener),this.node.onStatic("opacity",this.markRenderStateDirtyListener),this.node.onStatic("hint",this.markRenderStateDirtyListener),this.node.onStatic("clip",this.markRenderStateDirtyListener),this.node.onStatic("rendererBitmask",this.markRenderStateDirtyListener),this.node.onStatic("rendererSummary",this.markRenderStateDirtyListener))
},detachNodeListeners:function(){this.relativeTransform.detachNodeListeners(),this.isSharedCanvasCachePlaceholder||(this.node.offStatic("childInserted",this.childInsertedListener),this.node.offStatic("childRemoved",this.childRemovedListener),this.node.offStatic("visibility",this.visibilityListener),this.node.offStatic("opacity",this.markRenderStateDirtyListener),this.node.offStatic("hint",this.markRenderStateDirtyListener),this.node.offStatic("clip",this.markRenderStateDirtyListener),this.node.offStatic("rendererBitmask",this.markRenderStateDirtyListener),this.node.offStatic("rendererSummary",this.markRenderStateDirtyListener))},markRenderStateDirty:function(){this.renderStateDirtyFrame=this.display._frameId,this.parent&&this.parent.markSkipPruning()},markSkipPruning:function(){this.skipPruningFrame=this.display._frameId,this.parent&&this.parent.markSkipPruning()},dispose:function(){this.active=!1,this.groupDrawable&&this.groupDrawable.disposeImmediately(this.display),this.sharedCacheDrawable&&this.sharedCacheDrawable.disposeImmediately(this.display),this.selfDrawable&&this.selfDrawable.disposeImmediately(this.display);for(var t=this.children.length,e=0;t>e;e++)this.children[e].dispose();this.stateless||this.detachNodeListeners(),this.node.removeInstance(this),this.sharedCacheInstance&&(this.sharedCacheInstance.externalReferenceCount--,0===this.sharedCacheInstance.externalReferenceCount&&(delete this.display._sharedCanvasInstances[this.node.getId()],this.sharedCacheInstance.dispose())),this.cleanInstance(null,null),this.freeToPool()},audit:function(t,e){},auditChangeIntervals:function(t,e,i,n){if(t)for(var r=t;r!==e;)r=r.oldNextDrawable;if(i)for(var s=i;s!==n;)s=s.nextDrawable},toString:function(){return this.id+"#"+(this.node?(this.node.constructor.name?this.node.constructor.name:"?")+"#"+this.node.id:"-")}}),i(d,{constructorDuplicateFactory:function(t){return function(e,i,n,r){return t.length?t.pop().initialize(e,i,n,r):new d(e,i,n,r)}}}),d}),i("SCENERY/display/InlineCanvasCacheDrawable",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/display/Drawable"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/display/Drawable");i.InlineCanvasCacheDrawable=function(t,e){n.call(this,t),this.instance=e};var r=i.InlineCanvasCacheDrawable;return e(n,r,{stitch:function(){}}),r}),i("SCENERY/display/SharedCanvasCacheDrawable",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/display/Drawable"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/display/Drawable");i.SharedCanvasCacheDrawable=function(t,e,i,r){n.call(this,e),this.instance=i,this.sharedInstance=r};var r=i.SharedCanvasCacheDrawable;return e(n,r,{}),r}),i("SCENERY/overlays/PointerAreaOverlay",["require","PHET_CORE/inherit","KITE/Shape","SCENERY/scenery","SCENERY/util/Trail"],function(t){var e=t("PHET_CORE/inherit"),i=t("KITE/Shape"),n=t("SCENERY/scenery");t("SCENERY/util/Trail"),n.PointerAreaOverlay=function(t,e){function i(t,e){r.setAttribute("width",t),r.setAttribute("height",e),r.style.clip="rect(0px,"+t+"px,"+e+"px,0px)"}this.display=t,this.scene=e;var r=this.svg=document.createElementNS(n.svgns,"svg");r.style.position="absolute",r.className="mouseTouchAreaOverlay",r.style.top=0,r.style.left=0,r.style["pointer-events"]="none",t.onStatic("displaySize",function(t){i(t.width,t.height)}),i(t.width,t.height),this.domElement=r};var r=n.PointerAreaOverlay;return e(Object,r,{addShape:function(t,e,i){var r=document.createElementNS(n.svgns,"path"),s=t.getSVGPath();s||(s="M0 0"),s?r.setAttribute("d",s):r.hasAttribute("d")&&r.removeAttribute("d"),r.setAttribute("style","fill: none; stroke: "+e+"; stroke-dasharray: 5, 3; stroke-dashoffset: "+(i?5:0)+"; stroke-width: 3;"),this.svg.appendChild(r)},update:function(){for(var t=this,e=this.svg,r=this.scene;e.childNodes.length;)e.removeChild(e.childNodes[e.childNodes.length-1]);new n.Trail(r).eachTrailUnder(function(e){var n=e.lastNode();if(!n.isVisible())return!0;if((n._mouseArea||n._touchArea)&&e.isVisible()){var r=e.getTransform();n._mouseArea&&t.addShape(r.transformShape(n._mouseArea.isBounds?i.bounds(n._mouseArea):n._mouseArea),"rgba(0,0,255,0.8)",!0),n._touchArea&&t.addShape(r.transformShape(n._touchArea.isBounds?i.bounds(n._touchArea):n._touchArea),"rgba(255,0,0,0.8)",!1)}})},dispose:function(){}}),r}),i("SCENERY/overlays/PointerOverlay",["require","PHET_CORE/inherit","DOT/Matrix3","SCENERY/scenery","SCENERY/util/Trail","SCENERY/util/Util"],function(t){var e=t("PHET_CORE/inherit"),i=t("DOT/Matrix3"),n=t("SCENERY/scenery");t("SCENERY/util/Trail");var r=t("SCENERY/util/Util");n.PointerOverlay=function(t,e){var s=this;this.display=t,this.scene=e,this.pointerSVGContainer=document.createElement("div"),this.pointerSVGContainer.style.position="absolute",this.pointerSVGContainer.style.top=0,this.pointerSVGContainer.style.left=0,this.pointerSVGContainer.style["pointer-events"]="none";var a=10,o=1,h=2*(a+o/2),l=h/2;t.onStatic("displaySize",function(t){s.pointerSVGContainer.setAttribute("width",t.width),s.pointerSVGContainer.setAttribute("height",t.height),s.pointerSVGContainer.style.clip="rect(0px,"+t.width+"px,"+t.height+"px,0px)"});var u=this.pointerAdded=function(t){if(!t.isKey){var e=document.createElementNS(n.svgns,"svg");e.style.position="absolute",e.style.top=0,e.style.left=0,e.style["pointer-events"]="none",e.setAttribute("width",h),e.setAttribute("height",h);var u=document.createElementNS(n.svgns,"circle");u.setAttribute("cx",a+o/2),u.setAttribute("cy",a+o/2),u.setAttribute("r",a),u.setAttribute("style","fill:black;"),u.setAttribute("opacity",.4);var c=function(){t.isTouch&&(s.pointerSVGContainer.removeChild(e),t.removeInputListener(d))},d={move:function(){t.point&&r.applyCSSTransform(i.translation(t.point.x-l,t.point.y-l),e)},up:c,cancel:c};t.addInputListener(d),d.move(),e.appendChild(u),s.pointerSVGContainer.appendChild(e)}};t._input.addPointerAddedListener(u),t._input&&t._input.mouse&&u(t._input.mouse),this.domElement=this.pointerSVGContainer};var s=n.PointerOverlay;return e(Object,s,{dispose:function(){this.display._input.removePointerAddedListener(this.pointerAdded)},update:function(){}}),s}),i("SCENERY/overlays/CanvasNodeBoundsOverlay",["require","PHET_CORE/inherit","KITE/Shape","SCENERY/scenery","SCENERY/util/Trail"],function(t){var e=t("PHET_CORE/inherit"),i=t("KITE/Shape"),n=t("SCENERY/scenery");t("SCENERY/util/Trail"),n.CanvasNodeBoundsOverlay=function(t,e){function i(t,e){r.setAttribute("width",t),r.setAttribute("height",e),r.style.clip="rect(0px,"+t+"px,"+e+"px,0px)"}this.display=t,this.scene=e;var r=this.svg=document.createElementNS(n.svgns,"svg");r.style.position="absolute",r.className="canvasNodeBoundsOverlay",r.style.top=0,r.style.left=0,r.style["pointer-events"]="none",t.onStatic("displaySize",function(t){i(t.width,t.height)}),i(t.width,t.height),this.domElement=r};var r=n.CanvasNodeBoundsOverlay;return e(Object,r,{addShape:function(t,e,i){var r=document.createElementNS(n.svgns,"path"),s=t.getSVGPath();s||(s="M0 0"),s?r.setAttribute("d",s):r.hasAttribute("d")&&r.removeAttribute("d"),r.setAttribute("style","fill: none; stroke: "+e+"; stroke-dasharray: 5, 3; stroke-dashoffset: "+(i?5:0)+"; stroke-width: 3;"),this.svg.appendChild(r)},update:function(){for(var t=this,e=this.svg,r=this.scene;e.childNodes.length;)e.removeChild(e.childNodes[e.childNodes.length-1]);new n.Trail(r).eachTrailUnder(function(e){var r=e.lastNode();if(!r.isVisible())return!0;if(r instanceof n.CanvasNode&&e.isVisible()){var s=e.getTransform();t.addShape(s.transformShape(i.bounds(r._selfBounds)),"rgba(0,255,0,0.8)",!0)}})},dispose:function(){}}),r}),i("SCENERY/display/Display",["require","PHET_CORE/inherit","PHET_CORE/extend","AXON/Events","DOT/Dimension2","DOT/Vector2","DOT/Matrix3","SCENERY/scenery","SCENERY/util/Features","SCENERY/display/BackboneDrawable","SCENERY/display/CanvasBlock","SCENERY/display/CanvasSelfDrawable","SCENERY/display/ChangeInterval","SCENERY/display/DOMSelfDrawable","SCENERY/display/Drawable","SCENERY/display/Instance","SCENERY/display/InlineCanvasCacheDrawable","SCENERY/display/Renderer","SCENERY/display/SharedCanvasCacheDrawable","SCENERY/display/SVGSelfDrawable","SCENERY/input/Input","SCENERY/util/Trail","SCENERY/overlays/PointerAreaOverlay","SCENERY/overlays/PointerOverlay","SCENERY/overlays/CanvasNodeBoundsOverlay"],function(t){var e=t("PHET_CORE/inherit"),i=t("PHET_CORE/extend"),n=t("AXON/Events"),r=t("DOT/Dimension2"),s=t("DOT/Vector2"),a=t("DOT/Matrix3"),o=t("SCENERY/scenery"),h=t("SCENERY/util/Features");t("SCENERY/display/BackboneDrawable"),t("SCENERY/display/CanvasBlock"),t("SCENERY/display/CanvasSelfDrawable");t("SCENERY/display/ChangeInterval");t("SCENERY/display/DOMSelfDrawable");t("SCENERY/display/Drawable"),t("SCENERY/display/Instance");t("SCENERY/display/InlineCanvasCacheDrawable"),t("SCENERY/display/Renderer"),t("SCENERY/display/SharedCanvasCacheDrawable"),t("SCENERY/display/SVGSelfDrawable"),t("SCENERY/input/Input"),t("SCENERY/util/Trail");var l=t("SCENERY/overlays/PointerAreaOverlay"),u=t("SCENERY/overlays/PointerOverlay"),c=t("SCENERY/overlays/CanvasNodeBoundsOverlay"),d={isMouse:!0};o.Display=function p(t,e){p.displays.push(this),n.call(this),this.options=_.extend({width:e&&e.container&&e.container.clientWidth||640,height:e&&e.container&&e.container.clientHeight||480,allowCSSHacks:!0,allowSceneOverflow:!1,enablePointerEvents:!0,defaultCursor:"default",backgroundColor:null,allowWebGL:!0,webglMakeLostContextSimulatingCanvas:!1,webglContextLossIncremental:!1},e),this._size=new r(this.options.width,this.options.height),this._currentSize=new r(-1,-1),this._rootNode=t,this._rootBackbone=null,this._domElement=e&&e.container?o.BackboneDrawable.repurposeBackboneContainer(e.container):o.BackboneDrawable.createDivBackbone(),this._sharedCanvasInstances={},this._baseInstance=null,this._frameId=0,this._dirtyTransformRoots=[],this._dirtyTransformRootsWithoutPass=[],this._instanceRootsToDispose=[],this._drawablesToDispose=[],this._drawablesToChangeBlock=[],this._drawablesToUpdateLinks=[],this._changeIntervalsToDispose=[],this._lastCursor=null,this._currentBackgroundCSS=null,this._backgroundColor=null,this._requestAnimationFrameID=0,this._input=null,this._overlays=[],this._pointerOverlay=null,this._pointerAreaOverlay=null,this._canvasAreaBoundsOverlay=null,this.applyCSSHacks(),this.setBackgroundColor(this.options.backgroundColor),this.scenery=o;var i=m();this._domElement.appendChild(i)};var f=o.Display;e(Object,f,i({getDOMElement:function(){return this._domElement},get domElement(){return this.getDOMElement()},updateDisplay:function(){if(!window.sceneryDebugPause){var t=!!this._baseInstance;for(this._input&&this._input.validatePointers(),this._rootNode.validateWatchedBounds(),this._baseInstance=this._baseInstance||o.Instance.createFromPool(this,new o.Trail(this._rootNode),!0,!1),this._baseInstance.baseSyncTree(),t&&this.markTransformRootDirty(this._baseInstance,this._baseInstance.isTransformed);this._drawablesToUpdateLinks.length;)this._drawablesToUpdateLinks.pop().updateLinks();for(;this._changeIntervalsToDispose.length;)this._changeIntervalsToDispose.pop().dispose();for(this._rootBackbone=this._rootBackbone||this._baseInstance.groupDrawable;this._drawablesToChangeBlock.length;){this._drawablesToChangeBlock.pop().updateBlock()}for(this.updateDirtyTransformRoots();this._instanceRootsToDispose.length;)this._instanceRootsToDispose.pop().dispose();for(;this._drawablesToDispose.length;)this._drawablesToDispose.pop().dispose();if(this._rootBackbone.update(),this.updateCursor(),this.updateBackgroundColor(),this.updateSize(),this._overlays.length)for(var e=this._rootBackbone.lastZIndex,i=0;i<this._overlays.length;i++){var n=this._overlays[i];n.domElement.style.zIndex=e++,n.update()}this._frameId++}},updateSize:function(){var t=!1;this._size.width!==this._currentSize.width&&(t=!0,this._currentSize.width=this._size.width,this._domElement.style.width=this._size.width+"px"),this._size.height!==this._currentSize.height&&(t=!0,this._currentSize.height=this._size.height,this._domElement.style.height=this._size.height+"px"),t&&!this.options.allowSceneOverflow&&(this._domElement.style.clip="rect(0px,"+this._size.width+"px,"+this._size.height+"px,0px)")},getRootNode:function(){return this._rootNode},get rootNode(){return this.getRootNode()},getSize:function(){return this._size},get size(){return this.getSize()},getBounds:function(){return this._size.toBounds()},get bounds(){return this.getBounds()},setSize:function(t){this._size.equals(t)||(this._size=t,this.trigger1("displaySize",this._size))},setWidthHeight:function(t,e){this.setSize(new r(t,e))},getWidth:function(){return this._size.width},get width(){return this.getWidth()},setWidth:function(t){this.getWidth()!==t&&this.setSize(new r(t,this.getHeight()))},set width(t){this.setWidth(t)},getHeight:function(){return this._size.height},get height(){return this.getHeight()},setHeight:function(t){this.getHeight()!==t&&this.setSize(new r(this.getWidth(),t))},set height(t){this.setHeight(t)},setBackgroundColor:function(t){this._backgroundColor=t},set backgroundColor(t){this.setBackgroundColor(t)},getBackgroundColor:function(){return this._backgroundColor},get backgroundColor(){return this.getBackgroundColor()},addOverlay:function(t){this._overlays.push(t),this._domElement.appendChild(t.domElement)},removeOverlay:function(t){this._domElement.removeChild(t.domElement),this._overlays.splice(_.indexOf(this._overlays,t),1)},getUsedRenderersBitmask:function(){function t(e){var i=0;return _.each(e.blocks,function(e){i|=e instanceof o.DOMBlock&&e.domDrawable instanceof o.BackboneDrawable?t(e.domDrawable):e.renderer}),i}return t(this._rootBackbone)&o.Renderer.bitmaskRendererArea},markTransformRootDirty:function(t,e){e?this._dirtyTransformRoots.push(t):this._dirtyTransformRootsWithoutPass.push(t)},updateDirtyTransformRoots:function(){for(;this._dirtyTransformRoots.length;)this._dirtyTransformRoots.pop().relativeTransform.updateTransformListenersAndCompute(!1,!1,this._frameId,!0);for(;this._dirtyTransformRootsWithoutPass.length;)this._dirtyTransformRootsWithoutPass.pop().relativeTransform.updateTransformListenersAndCompute(!1,!1,this._frameId,!1)},markDrawableChangedBlock:function(t){this._drawablesToChangeBlock.push(t)},markInstanceRootForDisposal:function(t){this._instanceRootsToDispose.push(t)},markDrawableForDisposal:function(t){this._drawablesToDispose.push(t)},markDrawableForLinksUpdate:function(t){this._drawablesToUpdateLinks.push(t)},markChangeIntervalToDispose:function(t){this._changeIntervalsToDispose.push(t)},updateBackgroundColor:function(){var t=null===this._backgroundColor?"":this._backgroundColor.toCSS?this._backgroundColor.toCSS():this._backgroundColor;t!==this._currentBackgroundCSS&&(this._currentBackgroundCSS=t,this._domElement.style.backgroundColor=t)},updateCursor:function(){if(this._input&&this._input.mouse&&this._input.mouse.point){if(this._input.mouse.cursor)return this.setSceneCursor(this._input.mouse.cursor);var t=this._rootNode.trailUnderPoint(this._input.mouse.point,d);if(t)for(var e=t.length-1;e>=0;e--){var i=t.nodes[e],n=i.getCursor();if(n)return this.setSceneCursor(n)}}return this.setSceneCursor(this.options.defaultCursor)},setSceneCursor:function(t){if(t!==this._lastCursor){this._lastCursor=t;var e=f.customCursors[t];if(e)for(var i=e.length-1;i>=0;i--)this._domElement.style.cursor=e[i];else this._domElement.style.cursor=t}},applyCSSHacks:function(){this.options.allowSceneOverflow||(this._domElement.style.overflow="hidden"),this._domElement.style.msTouchAction="none",this.options.allowCSSHacks&&(h.setStyle(this._domElement,h.userDrag,"none"),h.setStyle(this._domElement,h.userSelect,"none"),h.setStyle(this._domElement,h.touchAction,"none"),h.setStyle(this._domElement,h.touchCallout,"none"),h.setStyle(this._domElement,h.tapHighlightColor,"rgba(0,0,0,0)"))},canvasDataURL:function(t){this.canvasSnapshot(function(e){t(e.toDataURL())})},canvasSnapshot:function(t){var e=document.createElement("canvas");e.width=this._size.width,e.height=this._size.height;var i=e.getContext("2d");this._rootNode.renderToCanvas(e,i,function(){t(e,i.getImageData(0,0,e.width,e.height))},this.domElement.style.backgroundColor)},setPointerDisplayVisible:function(t){if(void 0!==t){var e=!!this._pointerOverlay;t!==e&&(t?(this._pointerOverlay=new u(this,this._rootNode),this.addOverlay(this._pointerOverlay)):(this.removeOverlay(this._pointerOverlay),this._pointerOverlay.dispose(),this._pointerOverlay=null))}},setPointerAreaDisplayVisible:function(t){if(void 0!==t){var e=!!this._pointerAreaOverlay;t!==e&&(t?(this._pointerAreaOverlay=new l(this,this._rootNode),this.addOverlay(this._pointerAreaOverlay)):(this.removeOverlay(this._pointerAreaOverlay),this._pointerAreaOverlay.dispose(),this._pointerAreaOverlay=null))}},setCanvasNodeBoundsVisible:function(t){if(void 0!==t){var e=!!this._canvasAreaBoundsOverlay;t!==e&&(t?(this._canvasAreaBoundsOverlay=new c(this,this._rootNode),this.addOverlay(this._canvasAreaBoundsOverlay)):(this.removeOverlay(this._canvasAreaBoundsOverlay),this._canvasAreaBoundsOverlay.dispose(),this._canvasAreaBoundsOverlay=null))}},resizeOnWindowResize:function(){var t=this,e=function(){t.setWidthHeight(window.innerWidth,window.innerHeight)};window.addEventListener("resize",e),e()},updateOnRequestAnimationFrame:function(t){var e=0,i=0,n=this;!function r(){n._requestAnimationFrameID=window.requestAnimationFrame(r,n._domElement);var s=(new Date).getTime();0!==e&&(i=(s-e)/1e3),e=s,t&&t(i),n.updateDisplay()}()},cancelUpdateOnRequestAnimationFrame:function(){window.cancelAnimationFrame(this._requestAnimationFrameID)},initializeStandaloneEvents:function(t){var e=this._domElement;this.initializeEvents(_.extend({},{listenerTarget:e,pointFromEvent:function(t){var i=e.getBoundingClientRect();return s.createFromPool(t.clientX-i.left,t.clientY-i.top)}},t))},initializeFullscreenEvents:function(t){var e=this._domElement;this.initializeEvents(_.extend({},{listenerTarget:document,pointFromEvent:function(t){var i=e.getBoundingClientRect();return s.createFromPool(t.clientX-i.left,t.clientY-i.top)}},t))},initializeWindowEvents:function(t){this.initializeEvents(_.extend({},{listenerTarget:window,pointFromEvent:function(t){return s.createFromPool(t.clientX,t.clientY)}},t))},initializeEvents:function(t){var e=t.pointFromEvent,i=t.listenerTarget,n=t.batchDOMEvents,r=new o.Input(this._rootNode,i,!!n,this.options.enablePointerEvents,e);this._input=r,r.connectListeners()},detachEvents:function(){this._input.disconnectListeners(),this._input=null},getDebugHTML:function(){function t(t){return t?t.toString():t+""}function e(e){function i(t){n+=' <span style="color: #008">'+t+"</span>"}var n="",r=e.node;n+=e.id,n+=" "+(r.constructor.name?r.constructor.name:"?"),n+=' <span style="font-weight: '+(r.isPainted()?"bold":"normal")+'">'+r.id+"</span>",n+=r.getDebugHTMLExtras(),r._visible||i("invisible"),r._pickable===!0&&i("pickable"),r._pickable===!1&&i("unpickable"),e.trail.isPickable()&&i('<span style="color: #808">hits</span>'),r._clipArea&&i("clipArea"),r._mouseArea&&i("mouseArea"),r._touchArea&&i("touchArea"),r._inputListeners.length&&i("inputListeners"),r.getRenderer()&&i("renderer:"+r.getRenderer()),r.isLayerSplit()&&i("layerSplit"),r._opacity<1&&i("opacity:"+r._opacity);var s="";switch(r.transform.getMatrix().type){case a.Types.IDENTITY:s="";break;case a.Types.TRANSLATION_2D:s="translated";break;case a.Types.SCALING:s="scale";break;case a.Types.AFFINE:s="affine";break;case a.Types.OTHER:s="other"}return s&&(n+=' <span style="color: #88f" title="'+r.transform.getMatrix().toString().replace("\n","&#10;")+'">'+s+"</span>"),n+=' <span style="color: #888">[Trail '+e.trail.indices.join(".")+"]</span>",n+=' <span style="color: #c88">'+t(e.state)+"</span>",n+=' <span style="color: #8c8">'+r._rendererSummary.bitmask.toString(16)+(r._rendererBitmask!==o.bitmaskNodeDefault?" ("+r._rendererBitmask.toString(16)+")":"")+"</span>"}function i(t){return t.toString()+(t.dirty?' <span style="color: #c00;">[x]</span>':"")}function n(t){function r(t,e){a+=' <span style="color: #888">'+t+":"+i(e)+"</span>"}var a='<div style="margin-left: '+20*s+'px">';a+=e(t),t.selfDrawable&&r("self",t.selfDrawable),t.groupDrawable&&r("group",t.groupDrawable),t.sharedCacheDrawable&&r("sharedCache",t.sharedCacheDrawable),a+="</div>",h+=a,s+=1,_.each(t.children,function(t){n(t)}),s-=1}function r(t){var n='<div style="margin-left: '+20*s+'px">';if(n+=i(t),t.instance?(n+=' <span style="color: #0a0;">('+t.instance.trail.toPathString()+")</span>",n+="&nbsp;&nbsp;&nbsp;"+e(t.instance)):t.backboneInstance&&(n+=' <span style="color: #a00;">('+t.backboneInstance.trail.toPathString()+")</span>",n+="&nbsp;&nbsp;&nbsp;"+e(t.backboneInstance)),n+="</div>",h+=n,t.blocks)s+=1,_.each(t.blocks,function(t){r(t)}),s-=1;else if(t.firstDrawable&&t.lastDrawable){s+=1;for(var a=t.firstDrawable;a!==t.lastDrawable;a=a.nextDrawable)r(a);r(t.lastDrawable),s-=1}}var s=0,h="Display "+this._size.toString()+" frame:"+this._frameId+" input:"+!!this._input+" cursor:"+this._lastCursor+"<br>";return this._baseInstance&&(h+='<div style="font-weight: bold;">Root Instance Tree</div>',n(this._baseInstance)),_.each(this._sharedCanvasInstances,function(t){h+='<div style="font-weight: bold;">Shared Canvas Instance Tree</div>',n(t)}),this._rootBackbone&&(h+='<div style="font-weight: bold;">Root Drawable Tree</div>',r(this._rootBackbone)),h},popupDebug:function(){var t='<!DOCTYPE html><html lang="en"><head><title>Scenery Debug Snapshot</title></head><body style="font-size: 12px;">'+this.getDebugHTML()+"</body></html>";window.open("data:text/html;charset=utf-8,"+encodeURIComponent(t))},toStringWithChildren:function(t,e){function i(t){return t===n?e:(t.constructor.name?t.constructor.name.toLowerCase():"(node)")+t.id}e=e||"scene";var n=this._rootNode,r="",s=this._rootNode.getTopologicallySortedNodes().slice(0).reverse();return _.each(s,function(s){if(r&&(r+="\n"),t&&s===n){var a=n.getPropString("  ",!1),o=a?"\n"+a+"\n":"";""!==o?r+=e+".mutate( {"+o+"} )":r=r.slice(0,-1)}else r+="var "+i(s)+" = "+s.toString("",!1);_.each(s.children,function(t){r+="\n"+i(s)+".addChild( "+i(t)+" );"})}),r}},n.prototype)),f.customCursors={"scenery-grab-pointer":["grab","-moz-grab","-webkit-grab","pointer"],"scenery-grabbing-pointer":["grabbing","-moz-grabbing","-webkit-grabbing","pointer"]};var m=function(){var t=document.createElement("div");t.setAttribute("id","accessibility"),t.style.position="absolute",t.style.left="0",t.style.top="0",t.style.width="0",t.style.height="0";for(var e=0;100>e;e++){var i=document.createElement("div");i.setAttribute("tabindex",0),t.appendChild(i)}return t};return f.displays=[],f}),i("SCENERY/display/webgl/ColorTriangleBufferData",["require","PHET_CORE/inherit","SCENERY/util/Color","DOT/Matrix4"],function(t){function e(){this.vertexArray=[],this.elementsPerVertex=13}var i=t("PHET_CORE/inherit"),n=t("SCENERY/util/Color"),r=t("DOT/Matrix4");return i(Object,e,{reserveVertices:function(t){for(var e=this.vertexArray.length,i=0;t>i;i++)for(var n=0;n<this.elementsPerVertex;n++)this.vertexArray.push(0);var r=this.vertexArray.length;return{startIndex:e,endIndex:r}},createFromPath:function(t,e){for(var i,r=t.getLocalToGlobalMatrix().toMatrix4(),s=t.shape,a=new n(t.fill),o=s.toPiecewiseLinear({}),h=o.subpaths,l="",u=[],c=0;c<h.length;c++){var d=h[c];for(i=0;i<d.points.length;i++)l=l+""+d.points[i].x+" "+d.points[i].y+"\n",i<d.points.length-1&&u.push(new poly2tri.Point(d.points[i].x,d.points[i].y))}var f;try{f=new poly2tri.SweepContext(u).triangulate().getTriangles()}catch(m){console.log("error in triangulation",m),f=[]}for(i=0;i<f.length;i++)for(var p=f[i],g=0;g<p.points_.length;g++){var v=p.points_[g],b=0;this.vertexArray.push(v.x+Math.random()*b,v.y+Math.random()*b,e,a.red/255,a.green/255,a.blue/255,a.alpha,r.m00(),r.m01(),r.m03(),r.m10(),r.m11(),r.m13())}},createFromTriangle:function(t,e,i,s,a,o,h,l,u){u=u||r.identity(),h=new n(h);var c=h.red/255,d=h.green/255,f=h.blue/255,m=h.alpha,p=this,g=this.vertexArray.length;return p.vertexArray.push(t,e,l,c,d,f,m,u.m00(),u.m01(),u.m03(),u.m10(),u.m11(),u.m13(),i,s,l,c,d,f,m,u.m00(),u.m01(),u.m03(),u.m10(),u.m11(),u.m13(),a,o,l,c,d,f,m,u.m00(),u.m01(),u.m03(),u.m10(),u.m11(),u.m13()),{startIndex:g,endIndex:p.vertexArray.length,setTriangle:function(t,e,i,n,r,s){p.vertexArray[g+0+0]=t,p.vertexArray[g+1+0]=e,p.vertexArray[g+0+13]=i,p.vertexArray[g+1+13]=n,p.vertexArray[g+0+26]=r,p.vertexArray[g+1+26]=s},setZ:function(t){p.vertexArray[g+2]=t,p.vertexArray[g+5]=t,p.vertexArray[g+8]=t}}},createStar:function(t,e,i,n,r){for(var s=this,a=this.vertexArray.length,o=0;18>o;o++)this.vertexArray.push(0);var h={startIndex:a,setStar:function(t,e,i,n,r){var a=[];for(o=0;10>o;o++){var h=o/10*Math.PI*2-Math.PI/2+r,l=o%2===0?n:i,u=l*Math.cos(h)+t,c=l*Math.sin(h)+e;a.push({x:u,y:c})}var d=this.index;s.vertexArray[d+0]=a[0].x,s.vertexArray[d+1]=a[0].y,s.vertexArray[d+2]=a[3].x,s.vertexArray[d+3]=a[3].y,s.vertexArray[d+4]=a[6].x,s.vertexArray[d+5]=a[6].y,s.vertexArray[d+6]=a[8].x,s.vertexArray[d+7]=a[8].y,s.vertexArray[d+8]=a[2].x,s.vertexArray[d+9]=a[2].y,s.vertexArray[d+10]=a[5].x,s.vertexArray[d+11]=a[5].y,s.vertexArray[d+12]=a[0].x,s.vertexArray[d+13]=a[0].y,s.vertexArray[d+14]=a[7].x,s.vertexArray[d+15]=a[7].y,s.vertexArray[d+16]=a[4].x,s.vertexArray[d+17]=a[4].y}};return h.setStar(t,e,i,n,r),h},dispose:function(){}})}),i("SCENERY/display/webgl/WebGLRectangle",["require","PHET_CORE/inherit","SCENERY/display/webgl/SquareUnstrokedRectangle"],function(t){function e(t,e){this.webglRenderer=t,this.rectangle=e,this.update(e)}var i=t("PHET_CORE/inherit"),n=t("SCENERY/display/webgl/SquareUnstrokedRectangle");return i(Object,e,{create:function(){this.rectangleHandle=this.rectangle.isRounded()||null!==this.rectangle.stroke?this.rectangle.isRounded()?null:null:new n},update:function(){null===this.rectangleHandle?this.create():this.rectangleHandle.supports(this.rectangle)?this.rectangleHandle.update(this.rectangle):(this.rectangleHandle.dispose(),this.create())}})}),i("SCENERY/input/DownUpListener",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/util/Trail"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery");t("SCENERY/util/Trail"),i.DownUpListener=function(t){var e=this;this.options=_.extend({mouseButton:0},t),this.isDown=!1,this.downCurrentTarget=null,this.downTrail=null,this.pointer=null,this.downListener={up:function(t){t.pointer.isMouse&&t.domEvent.button!==e.options.mouseButton||e.buttonUp(t)},cancel:function(t){e.buttonUp(t)}}};var n=i.DownUpListener;return e(Object,n,{buttonDown:function(t){this.isDown||t.pointer.isMouse&&t.domEvent.button!==this.options.mouseButton||(t.pointer.addInputListener(this.downListener),this.isDown=!0,this.downCurrentTarget=t.currentTarget,this.downTrail=t.trail.subtrailTo(t.currentTarget,!1),this.pointer=t.pointer,this.options.down&&this.options.down(t,this.downTrail))},buttonUp:function(t){this.isDown=!1,this.pointer.removeInputListener(this.downListener);var e=t.currentTarget;if(t.currentTarget=this.downCurrentTarget,this.options.upInside||this.options.upOutside){var i=t.trail,n=i.isExtensionOf(this.downTrail,!0);n&&this.options.upInside?this.options.upInside(t,this.downTrail):!n&&this.options.upOutside&&this.options.upOutside(t,this.downTrail)}this.options.up&&this.options.up(t,this.downTrail),t.currentTarget=e},down:function(t){this.buttonDown(t)}}),n}),i("SCENERY/input/ButtonListener",["require","SCENERY/scenery","SCENERY/util/Trail","PHET_CORE/inherit","SCENERY/input/DownUpListener"],function(t){var e=t("SCENERY/scenery");t("SCENERY/util/Trail");var i=t("PHET_CORE/inherit"),n=t("SCENERY/input/DownUpListener");e.ButtonListener=function(t){this.buttonState="up",this._overCount=0,this._buttonOptions=t;var e=this;n.call(this,{mouseButton:t.mouseButton||0,down:function(t){e.setButtonState(t,"down")},up:function(t){e.setButtonState(t,e._overCount>0?"over":"up")}})};var r=e.ButtonListener;return i(n,r,{setButtonState:function(t,e){if(e!==this.buttonState){var i=this.buttonState;this.buttonState=e,this._buttonOptions[e]&&this._buttonOptions[e](t,i),this._buttonOptions.fire&&this._overCount>0&&(this._buttonOptions.fireOnDown?"down"===e:"down"===i)&&this._buttonOptions.fire(t)}},enter:function(t){this._overCount++,1===this._overCount&&this.setButtonState(t,this.isDown?"down":"over")},exit:function(t){this._overCount--,0===this._overCount&&this.setButtonState(t,this.isDown?"out":"up")}}),r.TEST_LISTENER=new r({up:function(t,e){console.log("ButtonListener.up oldState="+e)},over:function(t,e){console.log("ButtonListener.over oldState="+e)},down:function(t,e){console.log("ButtonListener.down oldState="+e)},out:function(t,e){console.log("ButtonListener.out oldState="+e)},fire:function(){console.log("ButtonListener.fire")}}),r}),i("SCENERY/input/SimpleDragHandler",["require","PHET_CORE/inherit","SCENERY/scenery"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery");i.SimpleDragHandler=function(t){var e=this;this.options=_.extend({allowTouchSnag:!1,mouseButton:0,dragCursor:"pointer"},t),this.dragging=!1,this.pointer=null,this.trail=null,this.transform=null,this.node=null,this.lastDragPoint=null,this.startTransformMatrix=null,this.mouseButton=void 0,this.transformListener={transform:function(t){if(e.trail.isExtensionOf(t.trail,!0)){var i=t.trail.getTransform().getMatrix(),n=e.transform.getMatrix();e.node.prependMatrix(i.inverted().timesMatrix(n)),e.transform.setMatrix(i)}}},this.dragListener={up:function(t){if(!t.pointer.isMouse||t.domEvent.button===e.mouseButton){var i=t.currentTarget;t.currentTarget=e.node,e.endDrag(t),t.currentTarget=i}},cancel:function(t){var i=t.currentTarget;t.currentTarget=e.node,e.endDrag(t),t.currentTarget=i,e.transform||e.node.setMatrix(e.startTransformMatrix)},move:function(t){var i=e.pointer.point.minus(e.lastDragPoint);if(0!==i.magnitudeSquared()){var n=e.transform.inverseDelta2(i);if(e.options.translate){var r=e.node.getTransform().getMatrix().getTranslation();e.options.translate({delta:n,oldPosition:r,position:r.plus(n)})}if(e.lastDragPoint=e.pointer.point,e.options.drag){var s=t.currentTarget;t.currentTarget=e.node,e.options.drag(t,e.trail),t.currentTarget=s}}}}};var n=i.SimpleDragHandler;return e(Object,n,{startDrag:function(t){t.pointer.dragging=!0,t.pointer.cursor=this.options.dragCursor,t.pointer.addInputListener(this.dragListener),this.dragging=!0,this.pointer=t.pointer,this.trail=t.trail.subtrailTo(t.currentTarget,!0),this.transform=this.trail.getTransform(),this.node=t.currentTarget,this.lastDragPoint=t.pointer.point,this.startTransformMatrix=t.currentTarget.getMatrix(),this.mouseButton=t.pointer.isMouse?t.domEvent.button:void 0,this.options.start&&this.options.start(t,this.trail)},endDrag:function(t){this.pointer.dragging=!1,this.pointer.cursor=null,this.pointer.removeInputListener(this.dragListener),this.dragging=!1,this.options.end&&this.options.end(t,this.trail),this.pointer=null},tryToSnag:function(t){t.pointer.isMouse&&t.domEvent&&this.options.mouseButton!==t.domEvent.button&&-1!==this.options.mouseButton||this.dragging||t.pointer.dragging||this.startDrag(t)},tryTouchToSnag:function(t){this.options.allowTouchSnag&&(this.options.allowTouchSnag===!0||this.options.allowTouchSnag(t))&&this.tryToSnag(t)},down:function(t){t&&t.pointer&&t.pointer.isKey||this.tryToSnag(t)},touchenter:function(t){this.tryTouchToSnag(t)},touchmove:function(t){this.tryTouchToSnag(t)}}),n}),i("SCENERY/nodes/CanvasNode",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/nodes/Node","SCENERY/display/Renderer","SCENERY/display/CanvasSelfDrawable"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/nodes/Node");t("SCENERY/display/Renderer");var r=t("SCENERY/display/CanvasSelfDrawable");i.CanvasNode=function(t){n.call(this,t),this.setRendererBitmask(i.bitmaskBoundsValid|i.bitmaskSupportsCanvas)};var s=i.CanvasNode;return e(n,s,{setCanvasBounds:function(t){this.invalidateSelf(t)},set canvasBounds(t){this.setCanvasBounds(t)
},get canvasBounds(){return this.getSelfBounds()},isPainted:function(){return!0},paintCanvas:function(){throw new Error("CanvasNode needs paintCanvas implemented")},invalidatePaint:function(){for(var t=this._drawables.length,e=0;t>e;e++)this._drawables[e].markDirty()},canvasPaintSelf:function(t){this.paintCanvas(t)},containsPointSelf:function(){return!1},createCanvasDrawable:function(t,e){return s.CanvasNodeDrawable.createFromPool(t,e)},getBasicConstructor:function(t){return"new scenery.CanvasNode( {"+t+"} )"}}),s.prototype._mutatorKeys=["canvasBounds"].concat(n.prototype._mutatorKeys),s.CanvasNodeDrawable=r.createDrawable({type:function(t,e){this.initialize(t,e)},paintCanvas:function(t,e){e._selfBounds.isEmpty()||e.paintCanvas(t)},usesPaint:!1}),s}),i("SCENERY/nodes/Circle",["require","PHET_CORE/inherit","SCENERY/scenery","DOT/Bounds2","DOT/Matrix3","SCENERY/util/Color","SCENERY/nodes/Path","KITE/Shape","SCENERY/util/Features","SCENERY/nodes/Paintable","SCENERY/display/DOMSelfDrawable","SCENERY/display/SVGSelfDrawable","SCENERY/display/CanvasSelfDrawable","SCENERY/display/SelfDrawable","SCENERY/util/Util","SCENERY/display/WebGLSelfDrawable","SCENERY/display/WebGLBlock"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("DOT/Bounds2"),r=t("DOT/Matrix3"),s=t("SCENERY/util/Color"),a=t("SCENERY/nodes/Path"),o=t("KITE/Shape"),h=t("SCENERY/util/Features"),l=t("SCENERY/nodes/Paintable"),u=t("SCENERY/display/DOMSelfDrawable"),c=t("SCENERY/display/SVGSelfDrawable"),d=t("SCENERY/display/CanvasSelfDrawable"),f=t("SCENERY/display/SelfDrawable");t("SCENERY/util/Util");var m=t("SCENERY/display/WebGLSelfDrawable"),p=t("SCENERY/display/WebGLBlock"),g=!0,v=!0;i.Circle=function(t,e){"object"==typeof t?(e=t,this._radius=e.radius):(this._radius=t,e=e||{}),a.call(this,null,e)};var b=i.Circle;e(a,b,{getStrokeRendererBitmask:function(){var t=a.prototype.getStrokeRendererBitmask.call(this);return this.hasStroke()&&!this.getStroke().isGradient&&!this.getStroke().isPattern&&this.getLineWidth()<=this.getRadius()&&(t|=i.bitmaskSupportsDOM),t},getPathRendererBitmask:function(){return i.bitmaskSupportsCanvas|i.bitmaskSupportsSVG|i.bitmaskBoundsValid|(h.borderRadius?i.bitmaskSupportsDOM:0)},invalidateCircle:function(){this._shape=null,this.invalidateShape()},createCircleShape:function(){return o.circle(0,0,this._radius)},intersectsBoundsSelf:function(t){var e=Math.abs(t.centerX),i=Math.abs(t.centerY),n=t.maxX-e,r=t.maxY-i;return e>n+this._radius||i>r+this._radius?!1:n>=e||r>=i?!0:(e-=n,i-=r,e*e+i*i<=this._radius*this._radius)},canvasPaintSelf:function(t){b.CircleCanvasDrawable.prototype.paintCanvas(t,this)},createDOMDrawable:function(t,e){return b.CircleDOMDrawable.createFromPool(t,e)},createSVGDrawable:function(t,e){return b.CircleSVGDrawable.createFromPool(t,e)},createCanvasDrawable:function(t,e){return b.CircleCanvasDrawable.createFromPool(t,e)},createWebGLDrawable:function(t,e){return b.CircleWebGLDrawable.createFromPool(t,e)},getBasicConstructor:function(t){return"new scenery.Circle( "+this._radius+", {"+t+"} )"},getRadius:function(){return this._radius},setRadius:function(t){if(this._radius!==t){this._radius=t,this.invalidateCircle();for(var e=this._drawables.length,i=0;e>i;i++)this._drawables[i].markDirtyRadius()}return this},computeShapeBounds:function(){var t=new n(-this._radius,-this._radius,this._radius,this._radius);return this._stroke&&(t=t.dilated(this.getLineWidth()/2)),t},containsPointSelf:function(t){var e,i=t.x*t.x+t.y*t.y,n=!0;if(this._strokePickable){e=this.getLineWidth()/2;var r=this._radius+e;n=n&&r*r>=i}if(this._fillPickable)return this._strokePickable?n:i<=this._radius*this._radius;if(this._strokePickable){var s=this._radius-e;return n&&i>=s*s}return!1},get radius(){return this.getRadius()},set radius(t){return this.setRadius(t)},setShape:function(t){if(null!==t)throw new Error("Cannot set the shape of a scenery.Circle to something non-null");this.invalidateShape()},getShape:function(){return this._shape||(this._shape=this.createCircleShape()),this._shape},hasShape:function(){return!0}}),b.prototype._mutatorKeys=["radius"].concat(a.prototype._mutatorKeys);var y=b.CircleStatefulDrawableMixin=function(t){var e=t.prototype;e.initializeState=function(){return this.paintDirty=!0,this.dirtyRadius=!0,this.initializePaintableState(),this},e.markPaintDirty=function(){this.paintDirty=!0,this.markDirty()},e.markDirtyRadius=function(){this.dirtyRadius=!0,this.markPaintDirty()},e.setToCleanState=function(){this.paintDirty=!1,this.dirtyRadius=!1,this.cleanPaintableState()},l.PaintableStatefulDrawableMixin(t)},E=b.CircleDOMDrawable=e(u,function(t,e){this.initialize(t,e)},{initialize:function(t,e){if(this.initializeDOMSelfDrawable(t,e),this.initializeState(),this.matrix||(this.matrix=r.dirtyFromPool()),!this.fillElement||!this.strokeElement){var n=this.fillElement=document.createElement("div"),s=this.strokeElement=document.createElement("div");n.style.display="block",n.style.position="absolute",n.style.left="0",n.style.top="0",n.style.pointerEvents="none",s.style.display="block",s.style.position="absolute",s.style.left="0",s.style.top="0",s.style.pointerEvents="none",n.appendChild(s)}return this.domElement=this.fillElement,i.Util.prepareForTransform(this.domElement,this.forceAcceleration),this},updateDOM:function(){var t=this.node,e=this.fillElement,n=this.strokeElement;if(this.paintDirty&&(this.dirtyRadius&&(e.style.width=2*t._radius+"px",e.style.height=2*t._radius+"px",e.style[h.borderRadius]=t._radius+"px"),this.dirtyFill&&(e.style.backgroundColor=t.getCSSFill()),this.dirtyStroke&&(n.style.borderStyle=t.hasStroke()?"solid":"none"),t.hasStroke())){var s=null===this.lastStroke;(s||this.dirtyLineWidth||this.dirtyRadius)&&(n.style.width=2*t._radius-t.getLineWidth()+"px",n.style.height=2*t._radius-t.getLineWidth()+"px",n.style[h.borderRadius]=t._radius+t.getLineWidth()/2+"px"),(s||this.dirtyLineWidth)&&(n.style.left=-t.getLineWidth()/2+"px",n.style.top=-t.getLineWidth()/2+"px",n.style.borderWidth=t.getLineWidth()+"px"),(s||this.dirtyStroke)&&(n.style.borderColor=t.getSimpleCSSStroke())}if(this.transformDirty||this.dirtyRadius){this.matrix.set(this.getTransformMatrix());var a=r.translation(-t._radius,-t._radius);this.matrix.multiplyMatrix(a),a.freeToPool(),i.Util.applyPreparedTransform(this.matrix,this.fillElement,this.forceAcceleration)}this.setToClean()},onAttach:function(){},onDetach:function(){g||(this.fillElement=null,this.strokeElement=null,this.domElement=null)},setToClean:function(){this.setToCleanState(),this.transformDirty=!1}});return y(E),f.PoolableMixin(E),b.CircleSVGDrawable=c.createDrawable({type:function(t,e){this.initialize(t,e)},stateType:y,initialize:function(){this.svgElement||(this.svgElement=document.createElementNS(i.svgns,"circle"))},updateSVG:function(t,e){this.dirtyRadius&&e.setAttribute("r",t._radius),this.updateFillStrokeStyle(e)},usesPaint:!0,keepElements:v}),b.CircleCanvasDrawable=d.createDrawable({type:function(t,e){this.initialize(t,e)},paintCanvas:function(t,e){var i=t.context;i.beginPath(),i.arc(0,0,e._radius,0,2*Math.PI,!1),i.closePath(),e._fill&&(e.beforeCanvasFill(t),i.fill(),e.afterCanvasFill(t)),e._stroke&&(e.beforeCanvasStroke(t),i.stroke(),e.afterCanvasStroke(t))},usesPaint:!0,dirtyMethods:["markDirtyRadius"]}),b.CircleWebGLDrawable=e(m,function(t,e){this.initialize(t,e)},{initialize:function(t,e){this.initializeWebGLSelfDrawable(t,e),this.vertexCoordinates=this.vertexCoordinates||new Float32Array([0,0,1,0,0,1,1,1])},initializeContext:function(t){this.gl=t,this.disposeWebGLBuffers(),this.vertexBuffer=t.createBuffer(),this.initializePaintableState(),this.updateCircle()},updateCircle:function(){var t=this.gl,e=this.node,i={_rectX:-e.width/2,_rectY:-e.height/2,_rectWidth:e.width,_rectHeight:e.height};this.vertexCoordinates[0]=i._rectX,this.vertexCoordinates[1]=i._rectY,this.vertexCoordinates[2]=i._rectX+i._rectWidth,this.vertexCoordinates[3]=i._rectY,this.vertexCoordinates[4]=i._rectX,this.vertexCoordinates[5]=i._rectY+i._rectHeight,this.vertexCoordinates[6]=i._rectX+i._rectWidth,this.vertexCoordinates[7]=i._rectY+i._rectHeight,t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertexCoordinates,t.STATIC_DRAW),this.dirtyFill&&(this.color=s.toColor(this.node._fill),this.cleanPaintableState())},render:function(t){var e=this.gl;if(this.node._fill){var i=this.instance.relativeTransform.matrix.toAffineMatrix4();e.uniformMatrix4fv(t.uniformLocations.uModelViewMatrix,!1,i.entries),e.uniform1i(t.uniformLocations.uFragmentType,p.fragmentTypeFill),e.uniform4f(t.uniformLocations.uColor,this.color.r/255,this.color.g/255,this.color.b/255,this.color.a),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.vertexAttribPointer(t.attributeLocations.aVertex,2,e.FLOAT,!1,0,0),e.drawArrays(e.TRIANGLE_STRIP,0,4)}},shaderAttributes:["aVertex"],dispose:function(){this.gl&&(this.disposeWebGLBuffers(),this.gl=null),m.prototype.dispose.call(this)},disposeWebGLBuffers:function(){this.gl&&this.gl.deleteBuffer(this.vertexBuffer)},markDirtyCircle:function(){this.markDirty()},markPaintDirty:function(){this.markDirty()},onAttach:function(){},onDetach:function(){},update:function(){this.dirty&&(this.updateCircle(),this.dirty=!1)}}),l.PaintableStatefulDrawableMixin(b.CircleWebGLDrawable),f.PoolableMixin(b.CircleWebGLDrawable),b}),i("PHET_CORE/escapeHTML",["require","PHET_CORE/core"],function(t){var e=t("PHET_CORE/core");return e.escapeHTML=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/\'/g,"&#x27;").replace(/\//g,"&#x2F;")},e.escapeHTML}),i("SCENERY/nodes/DOM",["require","PHET_CORE/inherit","PHET_CORE/escapeHTML","DOT/Bounds2","SCENERY/scenery","SCENERY/nodes/Node","SCENERY/display/Renderer","SCENERY/util/Util","SCENERY/display/DOMSelfDrawable","SCENERY/display/SelfDrawable"],function(t){var e=t("PHET_CORE/inherit"),i=t("PHET_CORE/escapeHTML"),n=t("DOT/Bounds2"),r=t("SCENERY/scenery"),s=t("SCENERY/nodes/Node");t("SCENERY/display/Renderer"),t("SCENERY/util/Util");var a=t("SCENERY/display/DOMSelfDrawable"),o=t("SCENERY/display/SelfDrawable");r.DOM=function(t,e){e=e||{},this._interactive=!1,t&&t.jquery&&(t=t[0]),this._container=document.createElement("div"),this._$container=$(this._container),this._$container.css("position","absolute"),this._$container.css("left",0),this._$container.css("top",0),this.invalidateDOMLock=!1,this._preventTransform=!1,e.element=t,s.call(this,e),this.setRendererBitmask(r.bitmaskBoundsValid|r.bitmaskSupportsDOM)};var h=r.DOM;e(s,h,{allowsMultipleDOMInstances:!1,calculateDOMBounds:function(){var t=$(this._element);return new n(0,0,t.width(),t.height())},createTemporaryContainer:function(){var t=document.createElement("div");return $(t).css({display:"hidden",padding:"0 !important",margin:"0 !important",position:"absolute",left:0,top:0,width:65535,height:65535}),t},invalidateDOM:function(){if(!this.invalidateDOMLock){this.invalidateDOMLock=!0;var t=this.createTemporaryContainer();this._container.removeChild(this._element),t.appendChild(this._element),document.body.appendChild(t);var e=this.calculateDOMBounds();this.invalidateSelf(e),this._$container.width(e.getWidth()),this._$container.height(e.getHeight()),document.body.removeChild(t),t.removeChild(this._element),this._container.appendChild(this._element),this.invalidateDOMLock=!1}},getDOMElement:function(){return this._container},createDOMDrawable:function(t,e){return h.DOMDrawable.createFromPool(t,e)},isPainted:function(){return!0},setElement:function(t){return this._element!==t&&(this._element&&this._container.removeChild(this._element),this._element=t,this._$element=$(t),this._container.appendChild(this._element),this.invalidateDOM()),this},getElement:function(){return this._element},setInteractive:function(t){this._interactive!==t&&(this._interactive=t)},isInteractive:function(){return this._interactive},setPreventTransform:function(t){this._preventTransform!==t&&(this._preventTransform=t)},isTransformPrevented:function(){return this._preventTransform},set element(t){this.setElement(t)},get element(){return this.getElement()},set interactive(t){this.setInteractive(t)},get interactive(){return this.isInteractive()},set preventTransform(t){this.setPreventTransform(t)},get preventTransform(){return this.isTransformPrevented()},getBasicConstructor:function(t){return"new scenery.DOM( $( '"+i(this._container.innerHTML.replace(/'/g,"\\'"))+"' ), {"+t+"} )"},getPropString:function(t,e){var i=s.prototype.getPropString.call(this,t,e);return this.interactive&&(i&&(i+=",\n"),i+=t+"interactive: true"),i}}),h.prototype._mutatorKeys=["element","interactive","preventTransform"].concat(s.prototype._mutatorKeys);var l=h.DOMDrawable=e(a,function(t,e){this.initialize(t,e)},{initialize:function(t,e){return this.initializeDOMSelfDrawable(t,e),this.domElement=this.node._container,r.Util.prepareForTransform(this.domElement,this.forceAcceleration),this},updateDOM:function(){this.transformDirty&&!this.node._preventTransform&&r.Util.applyPreparedTransform(this.getTransformMatrix(),this.domElement,this.forceAcceleration),this.setToClean()},onAttach:function(){},onDetach:function(){this.domElement=null},setToClean:function(){this.transformDirty=!1}});return o.PoolableMixin(l),h}),i("SCENERY/nodes/LayoutBox",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/nodes/Node"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/nodes/Node");i.LayoutBox=function(t){if(n.call(this),this.boundsListener=this.updateLayout.bind(this),this.options=_.extend({orientation:"vertical",spacing:function(){return 0},align:"center",resize:!0},t),"vertical"===this.options.orientation,"number"==typeof this.options.spacing){var e=this.options.spacing;this.options.spacing=function(){return e}}this.inited=!1,this.mutate(this.options),this.inited=!0};var r=i.LayoutBox;return e(n,r,{layout:function(){var t,e=0;if("vertical"===this.options.orientation){var i=_.min(_.map(this.children,function(t){return t.left})),n=_.max(_.map(this.children,function(t){return t.left+t.width})),r=(n+i)/2,s=0;for(e=0;e<this.children.length;e++)t=this.children[e],t.top=s,"left"===this.options.align?t.left=i:"right"===this.options.align?t.right=n:t.centerX=r,s+=t.height+this.options.spacing(t,this.children[e+1])}else{var a=_.min(_.map(this.children,function(t){return t.top})),o=_.max(_.map(this.children,function(t){return t.top+t.height})),h=(o+a)/2,l=0;for(e=0;e<this.children.length;e++)t=this.children[e],t.left=l,"top"===this.options.align?t.top=a:"bottom"===this.options.align?t.bottom=o:t.centerY=h,l+=t.width+this.options.spacing(t,this.children[e+1])}},updateLayout:function(){this.updatingLayout||(this.updatingLayout=!0,this.layout(),this.updatingLayout=!1)},insertChild:function(t,e){var i=this;this.options.resize&&this.children.forEach(function(t){t.containsEventListener("bounds",i.boundsListener)&&t.removeEventListener("bounds",i.boundsListener)}),n.prototype.insertChild.call(this,t,e),(this.options.resize||!this.inited)&&this.updateLayout(),this.options.resize&&this.children.forEach(function(t){t.containsEventListener("bounds",i.boundsListener)||t.addEventListener("bounds",i.boundsListener)})},removeChildWithIndex:function(t,e){var i=this;this.options.resize&&this.children.forEach(function(t){t.containsEventListener("bounds",i.boundsListener)&&t.removeEventListener("bounds",i.boundsListener)}),n.prototype.removeChildWithIndex.call(this,t,e),(this.options.resize||!this.inited)&&this.updateLayout(),this.options.resize&&this.children.forEach(function(t){t.containsEventListener("bounds",i.boundsListener)||t.addEventListener("bounds",i.boundsListener)})}})}),i("SCENERY/nodes/HBox",["require","PHET_CORE/inherit","SCENERY/nodes/LayoutBox","SCENERY/scenery"],function(t){function e(t){n.call(this,_.extend({},t,{orientation:"horizontal"}))}var i=t("PHET_CORE/inherit"),n=t("SCENERY/nodes/LayoutBox"),r=t("SCENERY/scenery");return r.HBox=e,i(n,e)}),i("SCENERY/util/Font",["require","PHET_CORE/inherit","SCENERY/scenery"],function(t){function e(t){return"number"==typeof t?t+"px":t}var i=t("PHET_CORE/inherit"),n=t("SCENERY/scenery"),r=["normal","italic","oblique"],s=["normal","small-caps"],a=["normal","bold","bolder","lighter","100","200","300","400","500","600","700","800","900"],o=["normal","ultra-condensed","extra-condensed","condensed","semi-condensed","semi-expanded","expanded","extra-expanded","ultra-expanded"];n.Font=function(t){this._style="normal",this._variant="normal",this._weight="normal",this._stretch="normal",this._size="10px",this._lineHeight="normal",this._family="sans-serif";var i=typeof t;if("string"===i)for(var n=_.filter(t.split(/[\x09\x0A\x0C\x0D\x20]/),function(t){return t.length>0}),h=0;h<n.length;h++){var l=n[h];if("normal"===l);else if(_.contains(r,l))this._style=l;else if(_.contains(s,l))this._variant=l;else if(_.contains(a,l))this._weight=l;else{if(!_.contains(o,l)){var u=l.split(/\//);this._size=u[0],u[1]&&(this._lineHeight=u[1]),this._family=n.slice(h+1).join(" ");break}this._stretch=l}}else"object"===i&&(void 0!==t.style&&(this._style=t.style),void 0!==t.variant&&(this._variant=t.variant),void 0!==t.weight&&(this._weight=""+t.weight),void 0!==t.stretch&&(this._stretch=t.stretch),void 0!==t.size&&(this._size=e(t.size)),void 0!==t.lineHeight&&(this._lineHeight=t.lineHeight),void 0!==t.family&&(this._family=t.family));this._font=this.computeShorthand()};var h=n.Font;return i(Object,h,{getFont:function(){return this._font},getStyle:function(){return this._style},getVariant:function(){return this._variant},getWeight:function(){return this._weight},getStretch:function(){return this._stretch},getSize:function(){return this._size},getLineHeight:function(){return this._lineHeight},getFamily:function(){return this._family},get font(){return this.getFont()},get style(){return this.getStyle()},get variant(){return this.getVariant()},get weight(){return this.getWeight()},get stretch(){return this.getStretch()},get size(){return this.getSize()},get lineHeight(){return this.getLineHeight()},get family(){return this.getFamily()},copy:function(t){return new h(_.extend({style:this._style,variant:this._variant,weight:this._weight,stretch:this._stretch,size:this._size,lineHeight:this._lineHeight,family:this._family},t))},computeShorthand:function(){var t="";return"normal"!==this._style&&(t+=this._style+" "),"normal"!==this._variant&&(t+=this._variant+" "),"normal"!==this._weight&&(t+=this._weight+" "),"normal"!==this._stretch&&(t+=this._stretch+" "),t+=this._size,"normal"!==this._lineHeight&&(t+="/"+this._lineHeight),t+=" "+this._family},toCSS:function(){return this.getFont()}}),h.DEFAULT=new h,h}),i("SCENERY/nodes/Text",["require","PHET_CORE/inherit","PHET_CORE/escapeHTML","DOT/Bounds2","DOT/Matrix3","SCENERY/scenery","SCENERY/nodes/Node","SCENERY/display/Renderer","SCENERY/nodes/Paintable","SCENERY/util/Font","SCENERY/util/Util","SCENERY/util/CanvasContextWrapper","SCENERY/display/DOMSelfDrawable","SCENERY/display/SVGSelfDrawable","SCENERY/display/CanvasSelfDrawable","SCENERY/display/SelfDrawable","SCENERY/display/WebGLSelfDrawable","SCENERY/display/WebGLBlock","SCENERY/util/Util"],function(t){function e(t,e,i){var n="get"+e,r="set"+e;R.prototype[n]=function(){return this._font[i]},R.prototype[r]=function(t){var e={};e[i]=t;var n=this._font.copy(e);return this.setFont(n),this},Object.defineProperty(R.prototype,t,{set:R.prototype[r],get:R.prototype[n]})}function i(){var t=document.createElementNS(h.svgns,"text");return t.appendChild(document.createTextNode("")),t.setAttribute("dominant-baseline","alphabetic"),t.setAttribute("text-rendering","geometricPrecision"),t.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),t}function n(t,e){t.setAttribute("direction",e._direction),t.setAttribute("font-family",e._font.getFamily()),t.setAttribute("font-size",e._font.getSize()),t.setAttribute("font-style",e._font.getStyle()),t.setAttribute("font-weight",e._font.getWeight()),t.setAttribute("font-stretch",e._font.getStretch()),t.lastChild.nodeValue=e.getNonBreakingText()}var r=t("PHET_CORE/inherit"),s=t("PHET_CORE/escapeHTML"),a=t("DOT/Bounds2"),o=t("DOT/Matrix3"),h=t("SCENERY/scenery"),l=t("SCENERY/nodes/Node");t("SCENERY/display/Renderer");var u=t("SCENERY/nodes/Paintable");t("SCENERY/util/Font"),t("SCENERY/util/Util"),t("SCENERY/util/CanvasContextWrapper");var c,d=t("SCENERY/display/DOMSelfDrawable"),f=t("SCENERY/display/SVGSelfDrawable"),m=t("SCENERY/display/CanvasSelfDrawable"),p=t("SCENERY/display/SelfDrawable"),g=t("SCENERY/display/WebGLSelfDrawable"),v=t("SCENERY/display/WebGLBlock"),b=t("SCENERY/util/Util"),y=!0,E=!0,x=o.dirtyFromPool(),_="sceneryTextSizeContainer",S="sceneryTextSizeElement",C=document.getElementById(_),w=document.getElementById(S),T=-1!==window.navigator.userAgent.indexOf("like Gecko) Version/5")&&-1!==window.navigator.userAgent.indexOf("Safari/"),D=!1;h.Text=function(t,e){this._text="",this._font=h.Font.DEFAULT,this._direction="ltr",this._boundsMethod="hybrid",this._isHTML=void 0===this._isHTML?!1:this._isHTML,e=e||{},void 0===e.fill&&(e.fill="#000000"),void 0!==t&&(e.text=t),this.initializePaintable(),l.call(this,e),this.updateTextFlags()};var R=h.Text;r(l,R,{domUpdateTransformOnRepaint:!0,requiresSafeBounds:!0,setText:function(t){if(t=""+t,t!==this._text){this._text=t;for(var e=this._drawables.length,i=0;e>i;i++)this._drawables[i].markDirtyText();this.invalidateText()}return this},getText:function(){return this._text},getNonBreakingText:function(){return this._text.replace(" "," ")},setBoundsMethod:function(t){if(t!==this._boundsMethod){this._boundsMethod=t,this.updateTextFlags();for(var e=this._drawables.length,i=0;e>i;i++)this._drawables[i].markDirtyBounds();this.invalidateText()}return this},getBoundsMethod:function(){return this._boundsMethod},getTextRendererBitmask:function(){var t=0;return"fast"===this._boundsMethod||this._isHTML||(t|=h.bitmaskSupportsCanvas),this._isHTML||(t|=h.bitmaskSupportsSVG),"accurate"===this._boundsMethod&&(t|=h.bitmaskBoundsValid),t|=h.bitmaskSupportsDOM,t|=h.bitmaskSupportsWebGL},invalidateSupportedRenderers:function(){this.setRendererBitmask(this.getFillRendererBitmask()&this.getStrokeRendererBitmask()&this.getTextRendererBitmask())},updateTextFlags:function(){this.invalidateSupportedRenderers()},invalidateText:function(){var t;if(t=this._isHTML||T&&"accurate"!==this._boundsMethod?this.approximateDOMBounds():"hybrid"===this._boundsMethod?this.approximateHybridBounds():"fast"===this._boundsMethod||"fastCanvas"===this._boundsMethod?this.approximateSVGBounds():this.accurateCanvasBounds(),this.hasStroke()&&t.dilate(this.getLineWidth()/2),!this._selfBounds.equals(t))for(var e=this._drawables.length,i=0;e>i;i++)this._drawables[i].markDirtyBounds();this.invalidateSelf(t),this.updateTextFlags()},invalidateStroke:function(){this.invalidateText()},invalidateFill:function(){this.invalidateText()},canvasPaintSelf:function(t){R.TextCanvasDrawable.prototype.paintCanvas(t,this)},createDOMDrawable:function(t,e){return R.TextDOMDrawable.createFromPool(t,e)},createSVGDrawable:function(t,e){return R.TextSVGDrawable.createFromPool(t,e)},createCanvasDrawable:function(t,e){return R.TextCanvasDrawable.createFromPool(t,e)},createWebGLDrawable:function(t,e){return R.TextWebGLDrawable.createFromPool(t,e)},getDOMTextNode:function(){if(this._isHTML){var t=document.createElement("span");return t.innerHTML=this._text,t}return document.createTextNode(this.getNonBreakingText())},accurateCanvasBounds:function(){var t=this,e=this.approximateSVGBounds();return this._text&&0!==e.width?h.Util.canvasAccurateBounds(function(e){if(e.font=t.font,e.direction=t.direction,e.fillText(t.text,0,0),t.hasStroke()){var i=new h.CanvasContextWrapper(null,e);t.beforeCanvasStroke(i),e.strokeText(t.text,0,0),t.afterCanvasStroke(i)}},{precision:.5,resolution:128,initialScale:32/Math.max(Math.abs(e.minX),Math.abs(e.minY),Math.abs(e.maxX),Math.abs(e.maxY))}):e},approximateCanvasWidth:function(){var t=h.scratchContext;return t.font=this.font,t.direction=this.direction,t.measureText(this.text).width},approximateSVGBounds:function(){if(!C.parentNode){if(!document.body){if(D)return a.NOTHING;throw new Error("No document.body and trying to get approximate SVG bounds of a Text node")}document.body.appendChild(C)}n(w,this);var t=w.getBBox();return new a(t.x,t.y,t.x+t.width,t.y+t.height)},approximateHybridBounds:function(){if(!c)return a.NOTHING;void 0===this._font._cachedSVGBounds&&(c.setFont(this._font),this._font._cachedSVGBounds=c.getBounds());var t=this.approximateCanvasWidth(),e=this._font._cachedSVGBounds;return new a(0,e.minY,t,e.maxY)},approximateDOMBounds:function(){var t=1024,e="rtl"===this.direction,i=document.createElement("div");$(i).css({position:"absolute",left:0,top:0,padding:"0 !important",margin:"0 !important",display:"hidden"});var n=document.createElement("span");$(n).css("font",this.getFont()),n.appendChild(this.getDOMTextNode()),n.setAttribute("direction",this._direction);var r=document.createElement("div");$(r).css({"vertical-align":"baseline",display:"inline-block",width:0,height:t+"px",margin:"0 !important",padding:"0 !important"}),i.appendChild(n),i.appendChild(r),document.body.appendChild(i);var s=n.getBoundingClientRect(),o=i.getBoundingClientRect(),h=new a(s.left,s.top-t,s.right+1,s.bottom-t).shifted(-o.left,-o.top);document.body.removeChild(i);var l=s.right-s.left;return h.shiftedX(e?-l:0)},getSafeSelfBounds:function(){var t=1,e=this.getSelfBounds();return e.dilatedXY(t*e.width,t*e.height)},setFont:function(t){if(this.font!==t){this._font=t instanceof h.Font?t:new h.Font(t);for(var e=this._drawables.length,i=0;e>i;i++)this._drawables[i].markDirtyFont();this.invalidateText()}return this},getFont:function(){return this._font.getFont()},setDirection:function(t){this._direction=t;for(var e=this._drawables.length,i=0;e>i;i++)this._drawables[i].markDirtyDirection();return this.invalidateText(),this},getDirection:function(){return this._direction},isPainted:function(){return!0},getDebugHTMLExtras:function(){return' "'+s(this.getNonBreakingText())+'"'+(this._isHTML?" (html)":"")},getBasicConstructor:function(t){return"new scenery.Text( '"+s(this._text.replace(/'/g,"\\'"))+"', {"+t+"} )"},getPropString:function(t,e){function i(e,i,r){n&&(n+=",\n"),n+=r||"string"!=typeof i?t+e+": "+i:t+e+": '"+i+"'"}var n=l.prototype.getPropString.call(this,t,e);return n=this.appendFillablePropString(t,n),n=this.appendStrokablePropString(t,n),this.font!==(new h.Font).getFont()&&i("font",this.font.replace(/'/g,"\\'")),"ltr"!==this._direction&&i("direction",this._direction),n}}),e("fontWeight","FontWeight","weight"),e("fontFamily","FontFamily","family"),e("fontStretch","FontStretch","stretch"),e("fontStyle","FontStyle","style"),e("fontSize","FontSize","size"),e("lineHeight","LineHeight","lineHeight"),R.prototype._mutatorKeys=["boundsMethod","text","font","fontWeight","fontFamily","fontStretch","fontStyle","fontSize","lineHeight","direction"].concat(l.prototype._mutatorKeys),Object.defineProperty(R.prototype,"font",{set:R.prototype.setFont,get:R.prototype.getFont}),Object.defineProperty(R.prototype,"text",{set:R.prototype.setText,get:R.prototype.getText}),Object.defineProperty(R.prototype,"direction",{set:R.prototype.setDirection,get:R.prototype.getDirection}),Object.defineProperty(R.prototype,"boundsMethod",{set:R.prototype.setBoundsMethod,get:R.prototype.getBoundsMethod}),u(R);var P=R.TextStatefulDrawableMixin=function(t){var e=t.prototype;e.initializeState=function(){return this.paintDirty=!0,this.dirtyText=!0,this.dirtyFont=!0,this.dirtyBounds=!0,this.dirtyDirection=!0,this.initializePaintableState(),this},e.markPaintDirty=function(){this.paintDirty=!0,this.markDirty()},e.markDirtyText=function(){this.dirtyText=!0,this.markPaintDirty()},e.markDirtyFont=function(){this.dirtyFont=!0,this.markPaintDirty()},e.markDirtyBounds=function(){this.dirtyBounds=!0,this.markPaintDirty()},e.markDirtyDirection=function(){this.dirtyDirection=!0,this.markPaintDirty()},e.setToCleanState=function(){this.paintDirty=!1,this.dirtyText=!1,this.dirtyFont=!1,this.dirtyBounds=!1,this.dirtyDirection=!1,this.cleanPaintableState()},u.PaintableStatefulDrawableMixin(t)},A=R.TextDOMDrawable=r(d,function(t,e){this.initialize(t,e)},{initialize:function(t,e){return this.initializeDOMSelfDrawable(t,e),this.initializeState(),this.domElement||(this.domElement=document.createElement("div"),this.domElement.style.display="block",this.domElement.style.position="absolute",this.domElement.style.pointerEvents="none",this.domElement.style.left="0",this.domElement.style.top="0"),h.Util.prepareForTransform(this.domElement,this.forceAcceleration),this},updateDOM:function(){var t=this.node,e=this.domElement;if(this.paintDirty&&(this.dirtyFont&&(e.style.font=t.getFont()),this.dirtyStroke&&(e.style.color=t.getCSSFill()),this.dirtyBounds&&(e.style.width=t.getSelfBounds().width+"px",e.style.height=t.getSelfBounds().height+"px"),this.dirtyText&&(e.innerHTML=t.getNonBreakingText()),this.dirtyDirection&&e.setAttribute("dir",t._direction)),this.transformDirty||this.dirtyText||this.dirtyFont||this.dirtyBounds){var i=t.getSelfBounds().minY;x.set(this.getTransformMatrix());var n=o.translation(0,i);x.multiplyMatrix(n),n.freeToPool(),h.Util.applyPreparedTransform(x,e,this.forceAcceleration)}this.setToClean()},onAttach:function(){},onDetach:function(){y||(this.domElement=null)},setToClean:function(){this.setToCleanState(),this.transformDirty=!1}});return P(A),p.PoolableMixin(A),R.TextSVGDrawable=f.createDrawable({type:function(t,e){this.initialize(t,e)},stateType:P,initialize:function(){if(!this.svgElement){var t=this.svgElement=document.createElementNS(h.svgns,"text");t.appendChild(document.createTextNode("")),t.setAttribute("dominant-baseline","alphabetic"),t.setAttribute("text-rendering","geometricPrecision"),t.setAttribute("lengthAdjust","spacingAndGlyphs"),t.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve")}},updateSVG:function(t,e){this.dirtyDirection&&e.setAttribute("direction",t._direction),this.dirtyFont&&(e.setAttribute("font-family",t._font.getFamily()),e.setAttribute("font-size",t._font.getSize()),e.setAttribute("font-style",t._font.getStyle()),e.setAttribute("font-weight",t._font.getWeight()),e.setAttribute("font-stretch",t._font.getStretch())),this.dirtyText&&(e.lastChild.nodeValue=t.getNonBreakingText()),this.dirtyBounds&&isFinite(t._selfBounds.width)&&e.setAttribute("textLength",t._selfBounds.width),this.updateFillStrokeStyle(e)},usesPaint:!0,keepElements:E}),C||(C=document.createElementNS(h.svgns,"svg"),C.setAttribute("width","2"),C.setAttribute("height","2"),C.setAttribute("id",_),C.setAttribute("style","visibility: hidden; pointer-events: none; position: absolute; left: -65535; right: -65535;")),w||(w=i(),w.setAttribute("id",S),C.appendChild(w)),R.TextCanvasDrawable=m.createDrawable({type:function(t,e){this.initialize(t,e)},paintCanvas:function(t,e){var i=t.context;(e.hasFill()||e.hasStroke())&&(t.setFont(e._font.getFont()),t.setDirection(e._direction)),e.hasFill()&&(e.beforeCanvasFill(t),i.fillText(e._text,0,0),e.afterCanvasFill(t)),e.hasStroke()&&(e.beforeCanvasStroke(t),i.strokeText(e._text,0,0),e.afterCanvasStroke(t))},usesPaint:!0,dirtyMethods:["markDirtyText","markDirtyFont","markDirtyBounds","markDirtyDirection"]}),D=!0,c=new R("m",{boundsMethod:"fast"}),D=!1,R.TextWebGLDrawable=r(g,function(t,e){this.initialize(t,e)},{initialize:function(t,e){this.initializeWebGLSelfDrawable(t,e),this.vertexCoordinates=this.vertexCoordinates||new Float32Array(8),this.textureCoordinates=this.textureCoordinates||new Float32Array([0,0,1,0,0,1,1,1])},initializeContext:function(t){this.gl=t,this.disposeWebGLBuffers(),this.vertexBuffer=t.createBuffer(),this.textureBuffer=t.createBuffer(),this.updateImage()},transformVertexCoordinateX:function(t){return t*this.canvasWidth},transformVertexCoordinateY:function(t){return(1-t)*this.canvasHeight+this.dim.minY},updateImage:function(){var t=this.gl;
if(null!==this.texture&&t.deleteTexture(this.texture),this.node._text){var e=document.createElement("canvas"),i=e.getContext("2d"),n=this.node.approximateSVGBounds();this.dim=n,this.canvasWidth=e.width=b.toPowerOf2(n.width),this.canvasHeight=e.height=b.toPowerOf2(n.height),i.fillStyle="black",i.fillText(this.node._text,0,-n.minY);var r=this.texture=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_NEAREST),t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null),this.vertexCoordinates[0]=this.transformVertexCoordinateX(0),this.vertexCoordinates[1]=this.transformVertexCoordinateY(0),this.vertexCoordinates[2]=this.transformVertexCoordinateX(1),this.vertexCoordinates[3]=this.transformVertexCoordinateY(0),this.vertexCoordinates[4]=this.transformVertexCoordinateX(0),this.vertexCoordinates[5]=this.transformVertexCoordinateY(1),this.vertexCoordinates[6]=this.transformVertexCoordinateX(1),this.vertexCoordinates[7]=this.transformVertexCoordinateY(1),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertexCoordinates,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.textureBuffer),t.bufferData(t.ARRAY_BUFFER,this.textureCoordinates,t.STATIC_DRAW)}},render:function(t){if(this.node._text){var e=this.gl,i=this.instance.relativeTransform.matrix.toAffineMatrix4();e.uniformMatrix4fv(t.uniformLocations.uModelViewMatrix,!1,i.entries),e.uniform1i(t.uniformLocations.uTexture,0),e.uniform1i(t.uniformLocations.uFragmentType,v.fragmentTypeTexture),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.texture),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.vertexAttribPointer(t.attributeLocations.aVertex,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.textureBuffer),e.vertexAttribPointer(t.attributeLocations.aTexCoord,2,e.FLOAT,!1,0,0),e.drawArrays(e.TRIANGLE_STRIP,0,4)}},shaderAttributes:["aVertex","aTexCoord"],dispose:function(){this.gl&&(this.disposeWebGLBuffers(),this.gl=null),g.prototype.dispose.call(this)},disposeWebGLBuffers:function(){this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.textureBuffer),this.gl.deleteTexture(this.texture)},markDirtyRectangle:function(){this.markDirty()},markPaintDirty:function(){this.markDirty()},onAttach:function(){},onDetach:function(){},update:function(){(this.dirtyText||this.dirtyFont||this.dirtyBounds||this.dirtyDirection)&&(this.updateImage(),this.setToCleanState()),this.dirty=!1}}),p.PoolableMixin(R.TextWebGLDrawable),P(R.TextWebGLDrawable),R}),i("SCENERY/nodes/HTMLText",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/nodes/Text"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/nodes/Text");i.HTMLText=function(t,e){this._isHTML=!0,n.call(this,t,e)};var r=i.HTMLText;return e(n,r,{}),r}),i("SCENERY/nodes/Image",["require","PHET_CORE/inherit","DOT/Bounds2","SCENERY/scenery","SCENERY/nodes/Node","SCENERY/display/Renderer","SCENERY/util/Util","SCENERY/display/DOMSelfDrawable","SCENERY/display/SVGSelfDrawable","SCENERY/display/CanvasSelfDrawable","SCENERY/display/SelfDrawable","SCENERY/display/WebGLSelfDrawable","SCENERY/display/PixiSelfDrawable"],function(t){var e=t("PHET_CORE/inherit"),i=t("DOT/Bounds2"),n=t("SCENERY/scenery"),r=t("SCENERY/nodes/Node");t("SCENERY/display/Renderer"),t("SCENERY/util/Util");var s=t("SCENERY/display/DOMSelfDrawable"),a=t("SCENERY/display/SVGSelfDrawable"),o=t("SCENERY/display/CanvasSelfDrawable"),h=t("SCENERY/display/SelfDrawable"),l=t("SCENERY/display/WebGLSelfDrawable"),u=t("SCENERY/display/PixiSelfDrawable"),c=!0,d=!0;n.Image=function(t,e){e=e||{},t&&(e.image=t);var i=this;this.loadListener=function(){i.invalidateImage(),i._image.removeEventListener("load",i.loadListener)},r.call(this,e),this.invalidateSupportedRenderers()};var f=n.Image;e(r,f,{allowsMultipleDOMInstances:!1,invalidateImage:function(){this.invalidateSelf(this._image?new i(0,0,this.getImageWidth(),this.getImageHeight()):i.NOTHING)},getImage:function(){return this._image},invalidateSupportedRenderers:function(){this.setRendererBitmask(this._image instanceof HTMLCanvasElement?n.bitmaskBoundsValid|n.bitmaskSupportsCanvas|n.bitmaskSupportsWebGL|n.bitmaskSupportsPixi:n.bitmaskBoundsValid|n.bitmaskSupportsCanvas|n.bitmaskSupportsSVG|n.bitmaskSupportsDOM|n.bitmaskSupportsPixi)},setImage:function(t){if(this._image!==t&&("string"!=typeof t||!this._image||t!==this._image.src)){if(this._image&&this._image.removeEventListener("load",this.loadListener),"string"==typeof t){var e=t;t=document.createElement("img"),t.addEventListener("load",this.loadListener),t.src=e}else t instanceof HTMLImageElement&&(t.width&&t.height||t.addEventListener("load",this.loadListener));this.invalidateSupportedRenderers(),this._image=t;for(var i=this._drawables.length,n=0;i>n;n++)this._drawables[n].markDirtyImage();this.invalidateImage()}return this},getImageWidth:function(){return this._image.naturalWidth||this._image.width},getImageHeight:function(){return this._image.naturalHeight||this._image.height},getImageURL:function(){return this._image.src},isPainted:function(){return!0},canvasPaintSelf:function(t){f.ImageCanvasDrawable.prototype.paintCanvas(t,this)},createDOMDrawable:function(t,e){return f.ImageDOMDrawable.createFromPool(t,e)},createSVGDrawable:function(t,e){return f.ImageSVGDrawable.createFromPool(t,e)},createCanvasDrawable:function(t,e){return f.ImageCanvasDrawable.createFromPool(t,e)},createWebGLDrawable:function(t,e){return f.ImageWebGLDrawable.createFromPool(t,e)},createPixiDrawable:function(t,e){return f.ImagePixiDrawable.createFromPool(t,e)},set image(t){this.setImage(t)},get image(){return this.getImage()},getBasicConstructor:function(t){return"new scenery.Image( '"+(this._image.src?this._image.src.replace(/'/g,"\\'"):"other")+"', {"+t+"} )"}}),f.prototype._mutatorKeys=["image"].concat(r.prototype._mutatorKeys),f.createSVGImage=function(t,e,i){var r=document.createElementNS(n.svgns,"image");return r.setAttribute("x",0),r.setAttribute("y",0),r.setAttribute("width",e+"px"),r.setAttribute("height",i+"px"),r.setAttributeNS(n.xlinkns,"xlink:href",t),r};var m=f.ImageStatefulDrawableMixin=function(t){var e=t.prototype;e.initializeState=function(){return this.paintDirty=!0,this.dirtyImage=!0,this},e.markPaintDirty=function(){this.paintDirty=!0,this.markDirty()},e.markDirtyImage=function(){this.dirtyImage=!0,this.markPaintDirty()},e.setToCleanState=function(){this.paintDirty=!1,this.dirtyImage=!1}},p=f.ImageDOMDrawable=e(s,function(t,e){this.initialize(t,e)},{initialize:function(t,e){return this.initializeDOMSelfDrawable(t,e),this.initializeState(),this.domElement||(this.domElement=document.createElement("img"),this.domElement.style.display="block",this.domElement.style.position="absolute",this.domElement.style.pointerEvents="none",this.domElement.style.left="0",this.domElement.style.top="0"),n.Util.prepareForTransform(this.domElement,this.forceAcceleration),this},updateDOM:function(){var t=this.node,e=this.domElement;this.paintDirty&&this.dirtyImage&&(e.src=t._image?t._image.src:"//:0"),this.transformDirty&&n.Util.applyPreparedTransform(this.getTransformMatrix(),this.domElement,this.forceAcceleration),this.setToClean()},onAttach:function(){},onDetach:function(){c||(this.domElement=null)},setToClean:function(){this.setToCleanState(),this.transformDirty=!1}});return m(p),h.PoolableMixin(p),f.ImageSVGDrawable=a.createDrawable({type:function(t,e){this.initialize(t,e)},stateType:m,initialize:function(){this.svgElement||(this.svgElement=document.createElementNS(n.svgns,"image"),this.svgElement.setAttribute("x",0),this.svgElement.setAttribute("y",0))},updateSVG:function(t,e){this.dirtyImage&&(t._image?(e.setAttribute("width",t.getImageWidth()+"px"),e.setAttribute("height",t.getImageHeight()+"px"),e.setAttributeNS(n.xlinkns,"xlink:href",t.getImageURL())):(e.setAttribute("width","0"),e.setAttribute("height","0"),e.setAttributeNS(n.xlinkns,"xlink:href","//:0")))},usesPaint:!1,keepElements:d}),f.ImageCanvasDrawable=o.createDrawable({type:function(t,e){this.initialize(t,e)},paintCanvas:function(t,e){e._image&&t.context.drawImage(e._image,0,0)},usesPaint:!1,dirtyMethods:["markDirtyImage"]}),f.ImageWebGLDrawable=e(l,function(t,e){this.initialize(t,e)},{initialize:function(t,e){this.initializeWebGLSelfDrawable(t,e)},initializeContext:function(t){this.webglBlock=t,this.rectangleHandle=t.webglRenderer.textureRenderer.textureBufferData.createFromImageNode(this.node,.5),t.webglRenderer.textureRenderer.bindVertexBuffer(),t.webglRenderer.textureRenderer.bindDirtyTextures(),this.updateRectangle()},updateRectangle:function(){},render:function(){},dispose:function(){this.disposeWebGLBuffers(),l.prototype.dispose.call(this)},disposeWebGLBuffers:function(){this.webglBlock.webglRenderer.colorTriangleRenderer.colorTriangleBufferData.dispose(this.rectangleHandle)},markDirtyRectangle:function(){this.markDirty()},markPaintDirty:function(){this.markDirty()},onAttach:function(){},onDetach:function(){},update:function(){this.dirty&&(this.updateRectangle(),this.dirty=!1)}}),h.PoolableMixin(f.ImageWebGLDrawable),m(f.ImageWebGLDrawable),f.ImagePixiDrawable=e(u,function(t,e){this.initialize(t,e)},{initialize:function(t,e){this.initializePixiSelfDrawable(t,e);var i=new PIXI.BaseTexture(this.node._image,PIXI.scaleModes.DEFAULT),n=new PIXI.Texture(i);this.displayObject=new PIXI.Sprite(n),this.updateMatrix()},updateMatrix:function(){var t=this.node.getLocalToGlobalMatrix();this.displayObject.position.x=t.getTranslation().x,this.displayObject.position.y=t.getTranslation().y},initializeContext:function(t){this.pixiBlock=t},updateRectangle:function(){},render:function(){},dispose:function(){this.disposePixiBuffers(),u.prototype.dispose.call(this)},disposePixiBuffers:function(){this.pixiBlock.pixiRenderer.colorTriangleRenderer.colorTriangleBufferData.dispose(this.rectangleHandle)},markTransformDirty:function(){u.prototype.markTransformDirty.call(this),this.updateMatrix()},markDirtyRectangle:function(){this.markDirty()},markPaintDirty:function(){this.markDirty()},onAttach:function(){},onDetach:function(){},update:function(){this.dirty&&(this.updateRectangle(),this.dirty=!1)}}),h.PoolableMixin(f.ImagePixiDrawable),m(f.ImagePixiDrawable),f}),i("SCENERY/nodes/LayoutNode",["require","PHET_CORE/inherit","PHET_CORE/extend","SCENERY/scenery","SCENERY/nodes/Node","DOT/Bounds2"],function(t){var e=t("PHET_CORE/inherit"),i=t("PHET_CORE/extend"),n=t("SCENERY/scenery"),r=t("SCENERY/nodes/Node"),s=t("DOT/Bounds2");n.LayoutNode=function(t,e){var n=this;throw e=i({updateOnBounds:!0,defaultMethod:t},e),this._activelyLayingOut=!1,this._updateOnBounds=!0,this._defaultMethod=null,this._elements=[],this._elementMap={},this._boundsListener=function(){n._updateOnBounds&&n.updateLayout()},r.call(this,e),this.updateLayout(),new Error("Deprecated, please do not use (replacement for overrideBounds has not been provided)")};var a=n.LayoutNode;e(r,a,{get layoutProperties(){return new h(this._elements)},get layoutBounds(){var t=s.NOTHING.copy();return _.each(this._elements,function(e){t.includeBounds(e.layoutBounds)}),t},set defaultMethod(t){return this._defaultMethod=t,this.updateLayout(),this},get defaultMethod(){return this._defaultMethod},set updateOnBounds(t){return this._updateOnBounds=t,this},get updateOnBounds(){return this._updateOnBounds},insertChild:function(t,e,n){var a=this;n=i({useVisibleBounds:!1,padLeft:0,padRight:0,padTop:0,padBottom:0},n),r.prototype.insertChild.call(this,t,e);var o=n.layoutMethod?function(){return n.layoutMethod}:function(){return a._defaultMethod},h=new l(e,o,n.boundsMethod?n.boundsMethod:function(t){return n.useVisibleBounds&&(t=e.visibleBounds),new s(t.minX-n.padLeft,t.minY-n.padTop,t.maxX+n.padRight,t.maxY+n.padBottom)});this.addElement(h),this.updateLayout()},addChild:function(t,e){this.insertChild(this._children.length,t,e)},removeChildWithIndex:function(t,e){r.prototype.removeChildWithIndex.call(this,t,e),this._elementMap[t.id]&&delete this._elementMap[t.id],this.updateLayout()},addElement:function(t){this._elements.push(t),t.node.addEventListener("bounds",this._boundsListener)},removeElement:function(t){this._elements.splice(this._elements.indexOf(t),1),t.node.removeEventListener("bounds",this._boundsListener)},updateLayout:function(){if(!this._activelyLayingOut){this._activelyLayingOut=!0;for(var t=this.layoutProperties,e=0;e<this._elements.length;e++){var i=this._elements[e];i.layoutMethod.layout(i,e,e>0?this._elements[e-1]:null,t)}this._activelyLayingOut=!1}}});var o=a.LayoutMethod=function(t){t&&(this.layout=t)};e(Object,o,{and:function(t){var e=this;return new o(function(i,n,r,s){e.layout(i,n,r,s),t.layout(i,n,r,s)})}}),a.Vertical=new o(function(t,e,i){t.layoutTop=i?i.layoutBounds.bottom:0}),a.Horizontal=new o(function(t,e,i){t.layoutLeft=i?i.layoutBounds.right:0}),a.AlignLeft=new o(function(t){t.layoutLeft=0}),a.AlignHorizontalCenter=new o(function(t,e,i,n){t.layoutLeft=(n.maxWidth-t.layoutBounds.width)/2}),a.AlignRight=new o(function(t,e,i,n){t.layoutLeft=n.maxWidth-t.layoutBounds.width}),a.AlignTop=new o(function(t){t.layoutTop=0}),a.AlignVerticalCenter=new o(function(t,e,i,n){t.layoutTop=(n.maxHeight-t.layoutBounds.height)/2}),a.AlignBottom=new o(function(t,e,i,n){t.layoutTop=n.maxHeight-t.layoutBounds.height});var h=a.LayoutProperties=function(t){var e=0,i=0;_.each(t,function(t){e=Math.max(e,t.layoutBounds.width),i=Math.max(i,t.layoutBounds.height)}),this.maxWidth=e,this.maxHeight=i},l=a.LayoutElement=function(t,e,i){this.node=t,this.layoutMethodGetter=e,this.boundsMethod=i};return e(Object,l,{get bounds(){return this.node.bounds},get layoutBounds(){return this.boundsMethod(this.bounds)},get layoutMethod(){return this.layoutMethodGetter()},get layoutTop(){throw new Error("JSHint wants this getter")},set layoutTop(t){var e=this.bounds.top-this.layoutBounds.top;this.node.top=t+e},get layoutLeft(){throw new Error("JSHint wants this getter")},set layoutLeft(t){var e=this.bounds.left-this.layoutBounds.left;this.node.left=t+e}}),a.prototype._mutatorKeys=["defaultMethod","updateOnBounds"].concat(r.prototype._mutatorKeys),a}),i("SCENERY/nodes/Line",["require","PHET_CORE/inherit","SCENERY/scenery","KITE/segments/Line","SCENERY/nodes/Path","KITE/Shape","DOT/Vector2","SCENERY/nodes/Paintable","SCENERY/display/SVGSelfDrawable","SCENERY/display/CanvasSelfDrawable","SCENERY/display/WebGLSelfDrawable","SCENERY/display/SelfDrawable","SCENERY/display/WebGLBlock","SCENERY/util/Color"],function(t){function e(t){var e=t.toLowerCase(),i="get"+t,n="set"+t,r="_"+e,s="markDirty"+t;g.prototype[i]=function(){return this[r]},g.prototype[n]=function(t){if(this[r]!==t){this[r]=t;for(var e=this._drawables.length,i=0;e>i;i++){var n=this._drawables[i];n[s]()}this.invalidateLine()}return this},Object.defineProperty(g.prototype,e,{set:g.prototype[n],get:g.prototype[i]})}var i=t("PHET_CORE/inherit"),n=t("SCENERY/scenery"),r=t("KITE/segments/Line"),s=t("SCENERY/nodes/Path"),a=t("KITE/Shape"),o=t("DOT/Vector2"),h=t("SCENERY/nodes/Paintable"),l=t("SCENERY/display/SVGSelfDrawable"),u=t("SCENERY/display/CanvasSelfDrawable"),c=t("SCENERY/display/WebGLSelfDrawable"),d=t("SCENERY/display/SelfDrawable"),f=t("SCENERY/display/WebGLBlock"),m=t("SCENERY/util/Color"),p=!0;n.Line=function(t,e,i,n,r){"object"==typeof t?t instanceof o?(this._x1=t.x,this._y1=t.y,this._x2=e.x,this._y2=e.y,r=i||{}):(this._x1=0,this._y1=0,this._x2=0,this._y2=0,r=t||{}):(this._x1=t,this._y1=e,this._x2=i,this._y2=n,r=r||{}),s.call(this,null,r)};var g=n.Line;i(s,g,{setLine:function(t,e,i,n){this._x1=t,this._y1=e,this._x2=i,this._y2=n;for(var r=this._drawables.length,s=0;r>s;s++){var a=this._drawables[s];a.markDirtyLine()}this.invalidateLine()},setPoint1:function(t,e){"number"==typeof t?(this._x1=t,this._y1=e):(this._x1=t.x,this._y1=t.y);for(var i=this._drawables.length,n=0;i>n;n++){var r=this._drawables[n];r.markDirtyP1()}this.invalidateLine()},set p1(t){this.setPoint1(t)},get p1(){return new o(this._x1,this._y1)},setPoint2:function(t,e){"number"==typeof t?(this._x2=t,this._y2=e):(this._x2=t.x,this._y2=t.y);for(var i=this._drawables.length,n=0;i>n;n++){var r=this._drawables[n];r.markDirtyP2()}this.invalidateLine()},set p2(t){this.setPoint2(t)},get p2(){return new o(this._x2,this._y2)},createLineShape:function(){return a.lineSegment(this._x1,this._y1,this._x2,this._y2)},invalidateLine:function(){this._shape=null,this.invalidateShape()},containsPointSelf:function(t){return this._strokePickable?s.prototype.containsPointSelf.call(this,t):!1},intersectsBoundsSelf:function(t){return new r(this.p1,this.p2).intersectsBounds(t)},canvasPaintSelf:function(t){g.LineCanvasDrawable.prototype.paintCanvas(t,this)},computeShapeBounds:function(){return s.prototype.computeShapeBounds.call(this)},createSVGDrawable:function(t,e){return g.LineSVGDrawable.createFromPool(t,e)},createCanvasDrawable:function(t,e){return g.LineCanvasDrawable.createFromPool(t,e)},createWebGLDrawable:function(t,e){return g.LineWebGLDrawable.createFromPool(t,e)},getBasicConstructor:function(t){return"new scenery.Line( "+this._x1+", "+this._y1+", "+this._x1+", "+this._y1+", {"+t+"} )"},setShape:function(t){if(null!==t)throw new Error("Cannot set the shape of a scenery.Line to something non-null");this.invalidateShape()},getShape:function(){return this._shape||(this._shape=this.createLineShape()),this._shape},hasShape:function(){return!0},getFillRendererBitmask:function(){return n.bitmaskSupportsCanvas|n.bitmaskSupportsSVG|n.bitmaskSupportsDOM|n.bitmaskSupportsWebGL}}),e("X1"),e("Y1"),e("X2"),e("Y2"),g.prototype._mutatorKeys=["p1","p2","x1","y1","x2","y2"].concat(s.prototype._mutatorKeys);var v=g.LineStatefulDrawableMixin=function(t){var e=t.prototype;e.initializeState=function(){return this.paintDirty=!0,this.dirtyX1=!0,this.dirtyY1=!0,this.dirtyX2=!0,this.dirtyY2=!0,this.initializePaintableState(),this},e.markPaintDirty=function(){this.paintDirty=!0,this.markDirty()},e.markDirtyLine=function(){this.dirtyX1=!0,this.dirtyY1=!0,this.dirtyX2=!0,this.dirtyY2=!0,this.markPaintDirty()},e.markDirtyP1=function(){this.dirtyX1=!0,this.dirtyY1=!0,this.markPaintDirty()},e.markDirtyP2=function(){this.dirtyX2=!0,this.dirtyY2=!0,this.markPaintDirty()},e.markDirtyX1=function(){this.dirtyX1=!0,this.markPaintDirty()},e.markDirtyY1=function(){this.dirtyY1=!0,this.markPaintDirty()},e.markDirtyX2=function(){this.dirtyX2=!0,this.markPaintDirty()},e.markDirtyY2=function(){this.dirtyY2=!0,this.markPaintDirty()},e.setToCleanState=function(){this.paintDirty=!1,this.dirtyX1=!1,this.dirtyY1=!1,this.dirtyX2=!1,this.dirtyY2=!1,this.cleanPaintableState()},h.PaintableStatefulDrawableMixin(t)};return g.LineStatelessDrawableMixin=function(t){var e=t.prototype;e.initializeLineStateless=function(){return this.paintDirty=!0,this},e.markPaintDirty=function(){this.paintDirty=!0,this.markDirty()},e.markDirtyLine=function(){this.markPaintDirty()},e.markDirtyP1=function(){this.markPaintDirty()},e.markDirtyP2=function(){this.markPaintDirty()},e.markDirtyX1=function(){this.markPaintDirty()},e.markDirtyY1=function(){this.markPaintDirty()},e.markDirtyX2=function(){this.markPaintDirty()},e.markDirtyY2=function(){this.markPaintDirty()},h.PaintableStatefulDrawableMixin(t)},g.LineSVGDrawable=l.createDrawable({type:function(t,e){this.initialize(t,e)},stateType:v,initialize:function(){this.svgElement||(this.svgElement=document.createElementNS(n.svgns,"line"))},updateSVG:function(t,e){this.dirtyX1&&e.setAttribute("x1",t._x1),this.dirtyY1&&e.setAttribute("y1",t._y1),this.dirtyX2&&e.setAttribute("x2",t._x2),this.dirtyY2&&e.setAttribute("y2",t._y2),this.updateFillStrokeStyle(e)},usesPaint:!0,keepElements:p}),g.LineCanvasDrawable=u.createDrawable({type:function(t,e){this.initialize(t,e)},paintCanvas:function(t,e){var i=t.context;i.beginPath(),i.moveTo(e._x1,e._y1),i.lineTo(e._x2,e._y2),i.closePath(),e._stroke&&(e.beforeCanvasStroke(t),i.stroke(),e.afterCanvasStroke(t))},usesPaint:!0,dirtyMethods:["markDirtyX1","markDirtyY1","markDirtyX2","markDirtyY2"]}),g.LineWebGLDrawable=i(c,function(t,e){this.initialize(t,e)},{initialize:function(t,e){this.initializeWebGLSelfDrawable(t,e),this.vertexCoordinates=this.vertexCoordinates||new Float32Array([0,0,1,0,0,1,1,1]),this.paintDirty=!0,this.initializeLineStateless(),this.initializePaintableState()},initializeContext:function(t){this.gl=t,this.disposeWebGLBuffers(),this.vertexBuffer=t.createBuffer(),this.updateLine(),this.updateLineStroke()},updateLine:function(){var t=this.gl,e=this.node,i=e.lineWidth/2,n=new o(e._x1,e._y1),r=new o(e._x2,e._y2),s=r.x-n.x,a=r.y-n.y,h=Math.sqrt(s*s+a*a);s/=h,a/=h;var l=a,u=-s,c=l*i,d=u*i,f=n.x-c,m=n.y-d,p=n.x+c,g=n.y+d,v=r.x+c,b=r.y+d,y=r.x-c,E=r.y-d;this.vertexCoordinates[0]=f,this.vertexCoordinates[1]=m,this.vertexCoordinates[2]=p,this.vertexCoordinates[3]=g,this.vertexCoordinates[4]=y,this.vertexCoordinates[5]=E,this.vertexCoordinates[6]=v,this.vertexCoordinates[7]=b,t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertexCoordinates,t.STATIC_DRAW)},updateLineStroke:function(){this.color=m.toColor(this.node._stroke)},render:function(t){var e=this.gl;if(this.node._stroke){var i=this.instance.relativeTransform.matrix.toAffineMatrix4();e.uniformMatrix4fv(t.uniformLocations.uModelViewMatrix,!1,i.entries),e.uniform1i(t.uniformLocations.uFragmentType,f.fragmentTypeFill),e.uniform4f(t.uniformLocations.uColor,this.color.r/255,this.color.g/255,this.color.b/255,this.color.a),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.vertexAttribPointer(t.attributeLocations.aVertex,2,e.FLOAT,!1,0,0),e.drawArrays(e.TRIANGLE_STRIP,0,4)}},shaderAttributes:["aVertex"],dispose:function(){this.gl&&(this.disposeWebGLBuffers(),this.gl=null),c.prototype.dispose.call(this)},disposeWebGLBuffers:function(){this.gl&&this.gl.deleteBuffer(this.vertexBuffer)},onAttach:function(){},onDetach:function(){},update:function(){this.dirtyStroke&&(this.updateLineStroke(),this.cleanPaintableState()),this.paintDirty&&(this.updateLine(),this.paintDirty=!1),this.dirty=!1}}),g.LineStatelessDrawableMixin(g.LineWebGLDrawable),h.PaintableStatefulDrawableMixin(g.LineWebGLDrawable),d.PoolableMixin(g.LineWebGLDrawable),g}),i("SCENERY/nodes/PixiNode",["require","PHET_CORE/inherit","SCENERY/nodes/DOM","SCENERY/nodes/Path","SCENERY/scenery"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/nodes/DOM"),n=t("SCENERY/nodes/Path"),r=t("SCENERY/scenery");return r.PixiNode=function(t,e){var r=new PIXI.Stage(16777215),s=PIXI.autoDetectRenderer(400,300,{transparent:!0});i.call(this,s.view,e);var a=function(t){if(t instanceof n){var e=t,i=new PIXI.Graphics;i.beginFill(e.getFillColor().toNumber());for(var r=e.shape,s=0;s<r.subpaths.length;s++)for(var a=r.subpaths[s],o=0;o<a.segments.length;o++){var h=a.segments[o];0===s&&0===o?i.moveTo(h.start.x,h.start.y):i.lineTo(h.start.x,h.start.y),s===r.subpaths.length-1&&o===a.segments.length-1&&i.lineTo(h.end.x,h.end.y)}return i.endFill(),i}console.log("unknown node type",t)},o=a(t);r.addChild(o),s.render(r)},e(i,r.PixiNode)}),i("SCENERY/nodes/Plane",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/nodes/Rectangle"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/nodes/Rectangle");i.Plane=function(t){n.call(this,-2e3,-2e3,6e3,6e3,t)};var r=i.Plane;return e(n,r)}),i("SCENERY/nodes/VBox",["require","PHET_CORE/inherit","SCENERY/nodes/LayoutBox","SCENERY/scenery"],function(t){function e(t){n.call(this,_.extend({},t,{orientation:"vertical"}))}var i=t("PHET_CORE/inherit"),n=t("SCENERY/nodes/LayoutBox"),r=t("SCENERY/scenery");return r.VBox=e,i(n,e)}),i("SCENERY/nodes/WebGLNode",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/nodes/Node","SCENERY/display/Renderer","SCENERY/display/WebGLSelfDrawable","SCENERY/display/SelfDrawable"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/nodes/Node");t("SCENERY/display/Renderer");var r=t("SCENERY/display/WebGLSelfDrawable"),s=t("SCENERY/display/SelfDrawable");i.WebGLNode=function(t){n.call(this,t),this.setRendererBitmask(i.bitmaskBoundsValid|i.bitmaskSupportsWebGL)};var a=i.WebGLNode;return e(n,a,{setCanvasBounds:function(t){this.invalidateSelf(t)},set canvasBounds(t){this.setCanvasBounds(t)},get canvasBounds(){return this.getSelfBounds()},isPainted:function(){return!0},paintCanvas:function(){throw new Error("WebGLNode needs paintCanvas implemented")},invalidatePaint:function(){for(var t=this._drawables.length,e=0;t>e;e++)this._drawables[e].markDirty()},containsPointSelf:function(){return!1},canvasPaintSelf:function(){},createWebGLDrawable:function(t,e){return a.WebGLNodeDrawable.createFromPool(t,e)},getBasicConstructor:function(t){return"new scenery.WebGLNode( {"+t+"} )"}}),a.prototype._mutatorKeys=["canvasBounds"].concat(n.prototype._mutatorKeys),a.WebGLNodeDrawable=e(r,function(t,e){this.initialize(t,e)},{initialize:function(t,e){this.initializeWebGLSelfDrawable(t,e)},initializeContext:function(t){this.gl=t,this.node.initializeContext(t)},render:function(t){this.node.render(this.gl,t)},dispose:function(){this.gl&&(this.node.dispose(),this.gl=null),r.prototype.dispose.call(this)},markPaintDirty:function(){this.markDirty()},onAttach:function(){},onDetach:function(){},get shaderAttributes(){return this.node.shaderAttributes},update:function(){this.dirty=!1,this.paintDirty&&(this.updateRectangle(),this.setToCleanState())}}),s.PoolableMixin(a.WebGLNodeDrawable),a}),i("SCENERY/util/AccessibilityPeer",["require","PHET_CORE/inherit","SCENERY/scenery"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=i.AccessibilityPeer=function(t,e,i){var n=this;if(i=i||{},i.tabIndex=i.tabIndex||1,this.element="string"==typeof e?$(e)[0]:e,i.label){this.peerElement=document.createElement("div"),this.element.id="peer-"+t.trail.getUniqueId();var r=document.createElement("label");r.appendChild(document.createTextNode(i.label)),r.setAttribute("for",this.element.id),this.peerElement.appendChild(r),this.peerElement.appendChild(this.element)}else this.peerElement=this.element;this.instance=t,this.trail=t.trail,this.element.setAttribute("tabindex",i.tabIndex),this.element.style.position="absolute";var s=t.getScene();this.clickListener=function(t){i.click&&i.click(t)},this.focusListener=function(){s.focusPeer(n)},this.blurListener=function(){s.blurPeer(n)},this.element.addEventListener("click",this.clickListener),this.element.addEventListener("focus",this.focusListener),this.element.addEventListener("blur",this.blurListener),this.keepPeerBoundsInSync=!0,this.keepPeerBoundsInSync&&(this.boundsSyncListener=this.syncBounds.bind(this),t.getNode().addEventListener("bounds",this.boundsSyncListener),this.syncBounds(),t.getScene().addEventListener("resize",this.boundsSyncListener),window.setTimeout(this.syncBounds.bind(this),30))};return e(Object,n,{dispose:function(){this.element.removeEventListener("click",this.clickListener),this.element.removeEventListener("focus",this.focusListener),this.element.removeEventListener("blur",this.blurListener),this.keepPeerBoundsInSync&&(this.instance.getNode().removeEventListener("bounds",this.boundsSyncListener),this.instance.getScene().removeEventListener("resize",this.boundsSyncListener))},getGlobalBounds:function(){return this.trail.parentToGlobalBounds(this.trail.lastNode().getBounds()).roundedOut()},syncBounds:function(){var t=this.getGlobalBounds();this.element.style.left=t.x+"px",this.element.style.top=t.y+"px",this.element.style.width=t.width+"px",this.element.style.height=t.height+"px"}}),n}),i("SCENERY/util/Paint",["require","SCENERY/util/Color","PHET_CORE/inherit","SCENERY/scenery"],function(t){t("SCENERY/util/Color");var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=1;i.Paint=function(){this.id="paint"+n++,this.transformMatrix=null};var r=i.Paint;return e(Object,r,{isPaint:!0,setTransformMatrix:function(t){return this.transformMatrix!==t&&(this.transformMatrix=t),this}}),r}),i("SCENERY/util/Gradient",["require","SCENERY/util/Color","PHET_CORE/inherit","SCENERY/scenery","SCENERY/util/Paint"],function(t){t("SCENERY/util/Color");var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/util/Paint");i.Gradient=function(t){n.call(this),this.stops=[],this.lastStopRatio=0,this.canvasGradient=t};var r=i.Gradient;return e(n,r,{isGradient:!0,addColorStop:function(t,e){if(this.lastStopRatio>t)throw new Error("Color stops not specified in the order of increasing ratios");return this.lastStopRatio=t,"string"==typeof e&&(e=new i.Color(e)),this.stops.push({ratio:t,color:e}),this.canvasGradient.addColorStop(t,e.toCSS()),this},getCanvasStyle:function(){return this.canvasGradient}}),r}),i("SCENERY/util/LinearGradient",["require","SCENERY/scenery","PHET_CORE/inherit","DOT/Vector2","SCENERY/util/Gradient"],function(t){var e=t("SCENERY/scenery"),i=t("PHET_CORE/inherit"),n=t("DOT/Vector2"),r=t("SCENERY/util/Gradient");e.LinearGradient=function(t,i,s,a){var o=void 0===a;this.start=o?t:new n(t,i),this.end=o?i:new n(s,a),r.call(this,e.scratchContext.createLinearGradient(t,i,s,a))};var s=e.LinearGradient;return i(r,s,{isLinearGradient:!0,getSVGDefinition:function(){var t=document.createElementNS(e.svgns,"linearGradient");return t.setAttribute("id",this.id),t.setAttribute("gradientUnits","userSpaceOnUse"),t.setAttribute("x1",this.start.x),t.setAttribute("y1",this.start.y),t.setAttribute("x2",this.end.x),t.setAttribute("y2",this.end.y),this.transformMatrix&&t.setAttribute("gradientTransform",this.transformMatrix.getSVGTransform()),_.each(this.stops,function(i){var n=document.createElementNS(e.svgns,"stop");n.setAttribute("offset",i.ratio),n.setAttribute("style","stop-color: "+i.color.withAlpha(1).toCSS()+"; stop-opacity: "+i.color.a.toFixed(20)+";"),t.appendChild(n)}),t},toString:function(){var t="new scenery.LinearGradient( "+this.start.x+", "+this.start.y+", "+this.end.x+", "+this.end.y+" )";return _.each(this.stops,function(e){t+=".addColorStop( "+e.ratio+", '"+(e.color.toCSS?e.color.toCSS():e.color.toString())+"' )"}),t}}),s}),i("SCENERY/util/LiveRegion",["require","PHET_CORE/inherit","SCENERY/scenery"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=i.LiveRegion=function(t,e,i){var n=this;this.property=e,i=i||{},i.tabIndex=i.tabIndex||1,this.element=document.createElement("div"),this.element.setAttribute("aria-live","polite"),this.element.setAttribute("role","region"),this.textNode=document.createTextNode(""),this.element.appendChild(this.textNode),this.listener=function(t){n.element.removeChild(n.textNode),n.textNode=document.createTextNode(t),n.element.appendChild(n.textNode)},e.link(this.listener)};return e(Object,n,{dispose:function(){this.property.unlink(this.listener)}}),n}),i("SCENERY/util/Pattern",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/util/Paint"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/util/Paint");i.Pattern=function(t){n.call(this),this.image=t,this.canvasPattern=i.scratchContext.createPattern(t,"repeat")};var r=i.Pattern;return e(n,r,{isPattern:!0,getCanvasStyle:function(){return this.canvasPattern},getSVGDefinition:function(){var t=document.createElementNS(i.svgns,"pattern");return t.setAttribute("id",this.id),t.setAttribute("patternUnits","userSpaceOnUse"),t.setAttribute("patternContentUnits","userSpaceOnUse"),t.setAttribute("x",0),t.setAttribute("y",0),t.setAttribute("width",this.image.width),t.setAttribute("height",this.image.height),this.transformMatrix&&t.setAttribute("patternTransform",this.transformMatrix.getSVGTransform()),t.appendChild(i.Image.createSVGImage(this.image.src,this.image.width,this.image.height)),t},toString:function(){return"new scenery.Pattern( $( '<img src=\""+this.image.src+"\"/>' )[0] )"}}),r}),i("SCENERY/util/RadialGradient",["require","SCENERY/scenery","PHET_CORE/inherit","DOT/Vector2","SCENERY/util/Gradient"],function(t){var e=t("SCENERY/scenery"),i=t("PHET_CORE/inherit"),n=t("DOT/Vector2"),r=t("SCENERY/util/Gradient");
e.RadialGradient=function(t,i,s,a,o,h){this.start=new n(t,i),this.end=new n(a,o),this.startRadius=s,this.endRadius=h,this.focalPoint=this.start.plus(this.end.minus(this.start).times(this.startRadius/(this.startRadius-this.endRadius))),this.startRadius>=this.endRadius,r.call(this,e.scratchContext.createRadialGradient(t,i,s,a,o,h))};var s=e.RadialGradient;return i(r,s,{isRadialGradient:!0,getSVGDefinition:function(){function t(t,e,i,n,r){return i+(r-t)*(n-i)/(e-t)}function i(i){var r=n?1-i.ratio:i.ratio;a>0&&(r=t(0,1,a/s,1,r));var h=document.createElementNS(e.svgns,"stop");h.setAttribute("offset",r),h.setAttribute("style","stop-color: "+i.color.withAlpha(1).toCSS()+"; stop-opacity: "+i.color.a.toFixed(20)+";"),o.appendChild(h)}var n=this.startRadius>this.endRadius,r=n?this.start:this.end,s=Math.max(this.startRadius,this.endRadius),a=Math.min(this.startRadius,this.endRadius),o=document.createElementNS(e.svgns,"radialGradient");o.setAttribute("id",this.id),o.setAttribute("gradientUnits","userSpaceOnUse"),o.setAttribute("cx",r.x),o.setAttribute("cy",r.y),o.setAttribute("r",s),o.setAttribute("fx",this.focalPoint.x),o.setAttribute("fy",this.focalPoint.y),this.transformMatrix&&o.setAttribute("gradientTransform",this.transformMatrix.getSVGTransform());var h;if(n)for(h=this.stops.length-1;h>=0;h--)i(this.stops[h]);else for(h=0;h<this.stops.length;h++)i(this.stops[h]);return o},toString:function(){var t="new scenery.RadialGradient( "+this.start.x+", "+this.start.y+", "+this.startRadius+", "+this.end.x+", "+this.end.y+", "+this.endRadius+" )";return _.each(this.stops,function(e){t+=".addColorStop( "+e.ratio+", '"+e.color.toString()+"' )"}),t}}),s}),i("SCENERY/util/SceneImage",["require","PHET_CORE/inherit","SCENERY/scenery"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery");i.SceneImage=function(t){this.scene=t,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.img=document.createElement("img"),this.update()};var n=i.SceneImage;return e(Object,n,{update:function(t){var e=this;this.scene.updateScene(),this.canvas.width=this.scene.getSceneWidth(),this.canvas.height=this.scene.getSceneHeight(),this.scene.renderToCanvas(this.canvas,this.context,function(){var i=e.toDataURL();e.img.onload=function(){t(),delete e.img.onload},e.img.src=i})}}),n}),i("SCENERY/util/SceneryStyle",["require","SCENERY/scenery"],function(t){t("SCENERY/scenery");var e=document.createElement("style");e.type="text/css",document.head.appendChild(e);var i=document.styleSheets[document.styleSheets.length-1];return{stylesheet:i,styleElement:e,addRule:function(t){this.stylesheet.insertRule(t,0)}}}),i("SCENERY/util/ShaderProgram",["require","PHET_CORE/inherit","SCENERY/scenery","SCENERY/util/Util"],function(t){var e=t("PHET_CORE/inherit"),i=t("SCENERY/scenery"),n=t("SCENERY/util/Util"),r=i.ShaderProgram=function(t,e,i,n,r){this.vertexSource=e,this.fragmentSource=i,this.attributeNames=n,this.uniformNames=r,this.initialize(t)};return e(Object,r,{initialize:function(t){var e=this;this.gl=t,this.used=!1,this.program=this.gl.createProgram(),this.vertexShader=n.createShader(this.gl,this.vertexSource,this.gl.VERTEX_SHADER),this.fragmentShader=n.createShader(this.gl,this.fragmentSource,this.gl.FRAGMENT_SHADER),this.gl.attachShader(this.program,this.vertexShader),this.gl.attachShader(this.program,this.fragmentShader),this.gl.linkProgram(this.program),this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS)||(console.log("GLSL link error:"),console.log(this.gl.getProgramInfoLog(this.program)),console.log("for vertex shader"),console.log(this.vertexSource),console.log("for fragment shader"),console.log(this.fragmentSource)),this.gl.deleteShader(this.vertexShader),this.gl.deleteShader(this.fragmentShader),this.uniformLocations={},this.attributeLocations={},this.activeAttributes={},_.each(this.attributeNames,function(t){e.attributeLocations[t]=e.gl.getAttribLocation(e.program,t),e.activeAttributes[t]=!0}),_.each(this.uniformNames,function(t){e.uniformLocations[t]=e.gl.getUniformLocation(e.program,t)}),this.isInitialized=!0},use:function(){if(!this.used){var t=this;this.used=!0,this.gl.useProgram(this.program),_.each(this.attributeNames,function(e){t.activeAttributes[e]&&t.enableVertexAttribArray(e)})}},activateAttribute:function(t){this.activeAttributes[t]||(this.activeAttributes[t]=!0,this.used&&this.enableVertexAttribArray(t))},enableVertexAttribArray:function(t){this.gl.enableVertexAttribArray(this.attributeLocations[t])},unuse:function(){if(this.used){var t=this;this.used=!1,_.each(this.attributeNames,function(e){t.activeAttributes[e]&&t.disableVertexAttribArray(e)})}},disableVertexAttribArray:function(t){this.gl.disableVertexAttribArray(this.attributeLocations[t])},deactivateAttribute:function(t){this.activeAttributes[t]&&(this.activeAttributes[t]=!1,this.used&&this.disableVertexAttribArray(t))},dispose:function(){this.gl.deleteProgram(this.program)}})}),i("main",["SCENERY/scenery","SCENERY/accessibility/AccessibilityLayer","SCENERY/debug/DebugContext","SCENERY/display/BackboneDrawable","SCENERY/display/Block","SCENERY/display/CanvasBlock","SCENERY/display/CanvasSelfDrawable","SCENERY/display/ChangeInterval","SCENERY/display/Display","SCENERY/display/DOMBlock","SCENERY/display/DOMSelfDrawable","SCENERY/display/Drawable","SCENERY/display/FittedBlock","SCENERY/display/GreedyStitcher","SCENERY/display/InlineCanvasCacheDrawable","SCENERY/display/Instance","SCENERY/display/RebuildStitcher","SCENERY/display/RelativeTransform","SCENERY/display/Renderer","SCENERY/display/SelfDrawable","SCENERY/display/SharedCanvasCacheDrawable","SCENERY/display/Stitcher","SCENERY/display/SVGBlock","SCENERY/display/SVGGroup","SCENERY/display/SVGSelfDrawable","SCENERY/display/WebGLBlock","SCENERY/display/WebGLSelfDrawable","SCENERY/display/webgl/ColorTriangleBufferData","SCENERY/display/webgl/ColorTriangleRenderer","SCENERY/display/webgl/SpriteSheet","SCENERY/display/webgl/SquareUnstrokedRectangle","SCENERY/display/webgl/TextureBufferData","SCENERY/display/webgl/TextureRenderer","SCENERY/display/webgl/WebGLRectangle","SCENERY/display/webgl/WebGLRenderer","SCENERY/display/webgl/WebGLUtil","SCENERY/input/BatchedDOMEvent","SCENERY/input/ButtonListener","SCENERY/input/DownUpListener","SCENERY/input/Event","SCENERY/input/Input","SCENERY/input/Mouse","SCENERY/input/Pen","SCENERY/input/Pointer","SCENERY/input/SimpleDragHandler","SCENERY/input/Touch","SCENERY/nodes/CanvasNode","SCENERY/nodes/Circle","SCENERY/nodes/DOM","SCENERY/nodes/HBox","SCENERY/nodes/HTMLText","SCENERY/nodes/Image","SCENERY/nodes/LayoutNode","SCENERY/nodes/Line","SCENERY/nodes/Node","SCENERY/nodes/Paintable","SCENERY/nodes/Path","SCENERY/nodes/PixiNode","SCENERY/nodes/Plane","SCENERY/nodes/Rectangle","SCENERY/nodes/Text","SCENERY/nodes/VBox","SCENERY/nodes/WebGLNode","SCENERY/overlays/CanvasNodeBoundsOverlay","SCENERY/overlays/PointerAreaOverlay","SCENERY/overlays/PointerOverlay","SCENERY/util/AccessibilityPeer","SCENERY/util/CanvasContextWrapper","SCENERY/util/Color","SCENERY/util/Features","SCENERY/util/Font","SCENERY/util/Gradient","SCENERY/util/LinearGradient","SCENERY/util/LiveRegion","SCENERY/util/Pattern","SCENERY/util/RadialGradient","SCENERY/util/RendererSummary","SCENERY/util/SceneImage","SCENERY/util/SceneryStyle","SCENERY/util/ShaderProgram","SCENERY/util/Trail","SCENERY/util/TrailPointer","SCENERY/util/Util"],function(t){return t}),i("KITE/main",["KITE/kite","KITE/Shape","KITE/segments/Arc","KITE/segments/Cubic","KITE/segments/EllipticalArc","KITE/segments/Line","KITE/segments/Quadratic","KITE/segments/Segment","KITE/util/LineStyles","KITE/util/Subpath","KITE/parser/svgPath"],function(t){return t}),i("DOT/Bounds3",["require","DOT/dot","DOT/Vector3"],function(t){var e=t("DOT/dot");t("DOT/Vector3"),e.Bounds3=function(t,e,i,n,r,s){this.minX=t,this.minY=e,this.minZ=i,this.maxX=n,this.maxY=r,this.maxZ=s};var i=e.Bounds3;return i.prototype={constructor:i,isBounds:!0,dimension:3,getWidth:function(){return this.maxX-this.minX},get width(){return this.getWidth()},getHeight:function(){return this.maxY-this.minY},get height(){return this.getHeight()},getDepth:function(){return this.maxZ-this.minZ},get depth(){return this.getDepth()},getX:function(){return this.minX},get x(){return this.getX()},getY:function(){return this.minY},get y(){return this.getY()},getZ:function(){return this.minZ},get z(){return this.getZ()},getMinX:function(){return this.minX},get left(){return this.minX},getMinY:function(){return this.minY},get top(){return this.minY},getMinZ:function(){return this.minZ},get back(){return this.minZ},getMaxX:function(){return this.maxX},get right(){return this.maxX},getMaxY:function(){return this.maxY},get bottom(){return this.maxY},getMaxZ:function(){return this.maxZ},get front(){return this.maxZ},getCenterX:function(){return(this.maxX+this.minX)/2},get centerX(){return this.getCenterX()},getCenterY:function(){return(this.maxY+this.minY)/2},get centerY(){return this.getCenterY()},getCenterZ:function(){return(this.maxZ+this.minZ)/2},get centerZ(){return this.getCenterZ()},getCenter:function(){return new e.Vector3(this.getCenterX(),this.getCenterY(),this.getCenterZ())},get center(){return this.getCenter()},isEmpty:function(){return this.getWidth()<0||this.getHeight()<0||this.getDepth()<0},isFinite:function(){return isFinite(this.minX)&&isFinite(this.minY)&&isFinite(this.minZ)&&isFinite(this.maxX)&&isFinite(this.maxY)&&isFinite(this.maxZ)},isValid:function(){return!this.isEmpty()&&this.isFinite()},containsCoordinates:function(t,e,i){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY&&this.minZ<=i&&i<=this.maxZ},containsPoint:function(t){return this.containsCoordinates(t.x,t.y,t.z)},containsBounds:function(t){return this.minX<=t.minX&&this.maxX>=t.maxX&&this.minY<=t.minY&&this.maxY>=t.maxY&&this.minZ<=t.minZ&&this.maxZ>=t.maxZ},intersectsBounds:function(t){return!this.intersection(t).isEmpty()},toString:function(){return"[x:("+this.minX+","+this.maxX+"),y:("+this.minY+","+this.maxY+"),z:("+this.minZ+","+this.maxZ+")]"},equals:function(t){return this.minX===t.minX&&this.minY===t.minY&&this.minZ===t.minZ&&this.maxX===t.maxX&&this.maxY===t.maxY&&this.maxZ===t.maxZ},equalsEpsilon:function(t,e){e=e||0;var i=this.isFinite(),n=t.isFinite();return i&&n?Math.abs(this.minX-t.minX)<e&&Math.abs(this.minY-t.minY)<e&&Math.abs(this.minZ-t.minZ)<e&&Math.abs(this.maxX-t.maxX)<e&&Math.abs(this.maxY-t.maxY)<e&&Math.abs(this.maxZ-t.maxZ)<e:i!==n?!1:this===t?!0:(isFinite(this.minX+t.minX)?Math.abs(this.minX-t.minX)<e:this.minX===t.minX)&&(isFinite(this.minY+t.minY)?Math.abs(this.minY-t.minY)<e:this.minY===t.minY)&&(isFinite(this.minZ+t.minZ)?Math.abs(this.minZ-t.minZ)<e:this.minZ===t.minZ)&&(isFinite(this.maxX+t.maxX)?Math.abs(this.maxX-t.maxX)<e:this.maxX===t.maxX)&&(isFinite(this.maxY+t.maxY)?Math.abs(this.maxY-t.maxY)<e:this.maxY===t.maxY)&&(isFinite(this.maxZ+t.maxZ)?Math.abs(this.maxZ-t.maxZ)<e:this.maxZ===t.maxZ)},copy:function(t){return t?t.set(this):new i(this.minX,this.minY,this.minZ,this.maxX,this.maxY,this.maxZ)},union:function(t){return new i(Math.min(this.minX,t.minX),Math.min(this.minY,t.minY),Math.min(this.minZ,t.minZ),Math.max(this.maxX,t.maxX),Math.max(this.maxY,t.maxY),Math.max(this.maxZ,t.maxZ))},intersection:function(t){return new i(Math.max(this.minX,t.minX),Math.max(this.minY,t.minY),Math.max(this.minZ,t.minZ),Math.min(this.maxX,t.maxX),Math.min(this.maxY,t.maxY),Math.min(this.maxZ,t.maxZ))},withCoordinates:function(t,e,n){return new i(Math.min(this.minX,t),Math.min(this.minY,e),Math.min(this.minZ,n),Math.max(this.maxX,t),Math.max(this.maxY,e),Math.max(this.maxZ,n))},withPoint:function(t){return this.withCoordinates(t.x,t.y,t.z)},withMinX:function(t){return new i(t,this.minY,this.minZ,this.maxX,this.maxY,this.maxZ)},withMinY:function(t){return new i(this.minX,t,this.minZ,this.maxX,this.maxY,this.maxZ)},withMinZ:function(t){return new i(this.minX,this.minY,t,this.maxX,this.maxY,this.maxZ)},withMaxX:function(t){return new i(this.minX,this.minY,this.minZ,t,this.maxY,this.maxZ)},withMaxY:function(t){return new i(this.minX,this.minY,this.minZ,this.maxX,t,this.maxZ)},withMaxZ:function(t){return new i(this.minX,this.minY,this.minZ,this.maxX,this.maxY,t)},roundedOut:function(){return new i(Math.floor(this.minX),Math.floor(this.minY),Math.floor(this.minZ),Math.ceil(this.maxX),Math.ceil(this.maxY),Math.ceil(this.maxZ))},roundedIn:function(){return new i(Math.ceil(this.minX),Math.ceil(this.minY),Math.ceil(this.minZ),Math.floor(this.maxX),Math.floor(this.maxY),Math.floor(this.maxZ))},transformed:function(t){return this.copy().transform(t)},dilated:function(t){return new i(this.minX-t,this.minY-t,this.minZ-t,this.maxX+t,this.maxY+t,this.maxZ+t)},dilatedX:function(t){return new i(this.minX-t,this.minY,this.minZ,this.maxX+t,this.maxY,this.maxZ)},dilatedY:function(t){return new i(this.minX,this.minY-t,this.minZ,this.maxX,this.maxY+t,this.maxZ)},dilatedZ:function(t){return new i(this.minX,this.minY,this.minZ-t,this.maxX,this.maxY,this.maxZ+t)},dilatedXYZ:function(t,e,n){return new i(this.minX-t,this.minY-e,this.minZ-n,this.maxX+t,this.maxY+e,this.maxZ+n)},eroded:function(t){return this.dilated(-t)},erodedX:function(t){return this.dilatedX(-t)},erodedY:function(t){return this.dilatedY(-t)},erodedZ:function(t){return this.dilatedZ(-t)},erodedXYZ:function(t,e,i){return this.dilatedXYZ(-t,-e,-i)},shiftedX:function(t){return new i(this.minX+t,this.minY,this.minZ,this.maxX+t,this.maxY,this.maxZ)},shiftedY:function(t){return new i(this.minX,this.minY+t,this.minZ,this.maxX,this.maxY+t,this.maxZ)},shiftedZ:function(t){return new i(this.minX,this.minY,this.minZ+t,this.maxX,this.maxY,this.maxZ+t)},shifted:function(t,e,n){return new i(this.minX+t,this.minY+e,this.minZ+n,this.maxX+t,this.maxY+e,this.maxZ+n)},setMinMax:function(t,e,i,n,r,s){return this.minX=t,this.minY=e,this.minZ=i,this.maxX=n,this.maxY=r,this.maxZ=s,this},setMinX:function(t){return this.minX=t,this},setMinY:function(t){return this.minY=t,this},setMinZ:function(t){return this.minZ=t,this},setMaxX:function(t){return this.maxX=t,this},setMaxY:function(t){return this.maxY=t,this},setMaxZ:function(t){return this.maxZ=t,this},set:function(t){return this.setMinMax(t.minX,t.minY,t.minZ,t.maxX,t.maxY,t.maxZ)},includeBounds:function(t){return this.setMinMax(Math.min(this.minX,t.minX),Math.min(this.minY,t.minY),Math.min(this.minZ,t.minZ),Math.max(this.maxX,t.maxX),Math.max(this.maxY,t.maxY),Math.max(this.maxZ,t.maxZ))},constrainBounds:function(t){return this.setMinMax(Math.max(this.minX,t.minX),Math.max(this.minY,t.minY),Math.max(this.minZ,t.minZ),Math.min(this.maxX,t.maxX),Math.min(this.maxY,t.maxY),Math.min(this.maxZ,t.maxZ))},addCoordinates:function(t,e,i){return this.setMinMax(Math.min(this.minX,t),Math.min(this.minY,e),Math.min(this.minZ,i),Math.max(this.maxX,t),Math.max(this.maxY,e),Math.max(this.maxZ,i))},addPoint:function(t){return this.addCoordinates(t.x,t.y,t.z)},roundOut:function(){return this.setMinMax(Math.floor(this.minX),Math.floor(this.minY),Math.floor(this.minZ),Math.ceil(this.maxX),Math.ceil(this.maxY),Math.ceil(this.maxZ))},roundIn:function(){return this.setMinMax(Math.ceil(this.minX),Math.ceil(this.minY),Math.ceil(this.minZ),Math.floor(this.maxX),Math.floor(this.maxY),Math.floor(this.maxZ))},transform:function(t){function i(t){n=Math.min(n,t.x),r=Math.min(r,t.y),s=Math.min(s,t.z),a=Math.max(a,t.x),o=Math.max(o,t.y),h=Math.max(h,t.z)}if(this.isEmpty())return this;if(t.isIdentity())return this;var n=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY,h=Number.NEGATIVE_INFINITY,l=new e.Vector3;return i(t.multiplyVector3(l.setXYZ(this.minX,this.minY,this.minZ))),i(t.multiplyVector3(l.setXYZ(this.minX,this.maxY,this.minZ))),i(t.multiplyVector3(l.setXYZ(this.maxX,this.minY,this.minZ))),i(t.multiplyVector3(l.setXYZ(this.maxX,this.maxY,this.minZ))),i(t.multiplyVector3(l.setXYZ(this.minX,this.minY,this.maxZ))),i(t.multiplyVector3(l.setXYZ(this.minX,this.maxY,this.maxZ))),i(t.multiplyVector3(l.setXYZ(this.maxX,this.minY,this.maxZ))),i(t.multiplyVector3(l.setXYZ(this.maxX,this.maxY,this.maxZ))),this.setMinMax(n,r,s,a,o,h)},dilate:function(t){return this.setMinMax(this.minX-t,this.minY-t,this.minZ-t,this.maxX+t,this.maxY+t,this.maxZ+t)},dilateX:function(t){return this.setMinMax(this.minX-t,this.minY,this.minZ,this.maxX+t,this.maxY,this.maxZ)},dilateY:function(t){return this.setMinMax(this.minX,this.minY-t,this.minZ,this.maxX,this.maxY+t,this.maxZ)},dilateZ:function(t){return this.setMinMax(this.minX,this.minY,this.minZ-t,this.maxX,this.maxY,this.maxZ+t)},dilateXYZ:function(t,e,i){return this.setMinMax(this.minX-t,this.minY-e,this.minZ-i,this.maxX+t,this.maxY+e,this.maxZ+i)},erode:function(t){return this.dilate(-t)},erodeX:function(t){return this.dilateX(-t)},erodeY:function(t){return this.dilateY(-t)},erodeZ:function(t){return this.dilateZ(-t)},erodeXYZ:function(t,e,i){return this.dilateXYZ(-t,-e,-i)},shiftX:function(t){return this.setMinMax(this.minX+t,this.minY,this.minZ,this.maxX+t,this.maxY,this.maxZ)},shiftY:function(t){return this.setMinMax(this.minX,this.minY+t,this.minZ,this.maxX,this.maxY+t,this.maxZ)},shiftZ:function(t){return this.setMinMax(this.minX,this.minY,this.minZ+t,this.maxX,this.maxY,this.maxZ+t)},shift:function(t,e,i){return this.setMinMax(this.minX+t,this.minY+e,this.minZ+i,this.maxX+t,this.maxY+e,this.maxZ+i)}},i.cuboid=function(t,e,n,r,s,a){return new i(t,e,n,t+r,e+s,n+a)},i.point=function(t,e,n){return new i(t,e,n,t,e,n)},i.EVERYTHING=new i(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i.NOTHING=new i(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),i}),i("DOT/Complex",["require","DOT/dot","PHET_CORE/inherit","DOT/Vector2"],function(t){var e=t("DOT/dot"),i=t("PHET_CORE/inherit"),n=t("DOT/Vector2");e.Complex=function(t,e){n.call(this,t,e),this.real=t,this.imaginary=e};var r=e.Complex;return r.real=function(t){return new r(t,0)},r.imaginary=function(t){return new r(0,t)},r.createPolar=function(t,e){return new r(t*Math.cos(e),t*Math.sin(e))},i(n.Immutable,r,{phase:n.prototype.angle,times:function(t){return new r(this.real*t.real-this.imaginary*t.imaginary,this.real*t.imaginary+this.imaginary*t.real)},dividedBy:function(t){var e=t.magnitudeSquared();return new r((this.real*t.real+this.imaginary*t.imaginary)/e,(this.imaginary*t.real-this.real*t.imaginary)/e)},sqrt:function(){var t=this.magnitude();return new r(Math.sqrt((t+this.real)/2),(this.imaginary>=0?1:-1)*Math.sqrt((t-this.real)/2))},conjugate:function(){return new r(this.real,-this.imaginary)},exponentiated:function(){return r.createPolar(Math.exp(this.real),this.imaginary)},toString:function(){return"Complex("+this.x+", "+this.y+")"}}),r.ZERO=new r(0,0),r.ONE=new r(1,0),r.I=new r(0,1),r}),i("DOT/ConvexHull2",["require","DOT/dot"],function(t){function e(t,e,i){return e.minus(t).crossScalar(i.minus(t))}var i=t("DOT/dot");return i.ConvexHull2={grahamScan:function(t,i){if(t.length<=2)return t;var n=Number.POSITIVE_INFINITY,r=null;_.each(t,function(t){t.y<=n&&(t.y===n&&r?t.x<r.x&&(r=t):(n=t.y,r=t))}),t=_.sortBy(t,function(t){return t.minus(r).angle()}),t.splice(_.indexOf(t,r),1);var s=[r];return _.each(t,function(t){function n(){if(s.length<2)return!1;var n=e(s[s.length-2],s[s.length-1],t);return i?0>n:0>=n}if(r.x!==t.x||r.y!==t.y){for(;n();)s.pop();s.push(t)}}),s}},i.ConvexHull2}),i("DOT/EigenvalueDecomposition",["require","DOT/dot"],function(t){var e=t("DOT/dot"),i=window.Float32Array||Array;e.EigenvalueDecomposition=function(t){var e,n,r=t.entries;this.n=t.getColumnDimension();var s=this.n;for(this.V=new i(s*s),this.d=new i(s),this.e=new i(s),this.issymmetric=!0,n=0;s>n&&this.issymmetric;n++)for(e=0;s>e&&this.issymmetric;e++)this.issymmetric=r[e*this.n+n]===r[n*this.n+e];if(this.issymmetric){for(e=0;s>e;e++)for(n=0;s>n;n++)this.V[e*this.n+n]=r[e*this.n+n];this.tred2(),this.tql2()}else{for(this.H=new i(s*s),this.ort=new i(s),n=0;s>n;n++)for(e=0;s>e;e++)this.H[e*this.n+n]=r[e*this.n+n];this.orthes(),this.hqr2()}};var n=e.EigenvalueDecomposition;return n.prototype={constructor:n,getV:function(){return this.V.copy()},getRealEigenvalues:function(){return this.d},getImagEigenvalues:function(){return this.e},getD:function(){for(var t=this.n,i=this.d,n=this.e,r=new e.Matrix(t,t),s=r.entries,a=0;t>a;a++){for(var o=0;t>o;o++)s[a*this.n+o]=0;s[a*this.n+a]=i[a],n[a]>0?s[a*this.n+a+1]=n[a]:n[a]<0&&(s[a*this.n+a-1]=n[a])}return r},tred2:function(){var t,e,i,n,r,s,a=this.n,o=this.V,h=this.d,l=this.e;for(e=0;a>e;e++)h[e]=o[(a-1)*a+e];for(t=a-1;t>0;t--){var u=0;for(s=0,i=0;t>i;i++)u+=Math.abs(h[i]);if(0===u)for(l[t]=h[t-1],e=0;t>e;e++)h[e]=o[(t-1)*a+e],o[t*this.n+e]=0,o[e*this.n+t]=0;else{for(i=0;t>i;i++)h[i]/=u,s+=h[i]*h[i];for(n=h[t-1],r=Math.sqrt(s),n>0&&(r=-r),l[t]=u*r,s-=n*r,h[t-1]=n-r,e=0;t>e;e++)l[e]=0;for(e=0;t>e;e++){for(n=h[e],o[e*this.n+t]=n,r=l[e]+o[e*a+e]*n,i=e+1;t-1>=i;i++)r+=o[i*a+e]*h[i],l[i]+=o[i*a+e]*n;l[e]=r}for(n=0,e=0;t>e;e++)l[e]/=s,n+=l[e]*h[e];var c=n/(s+s);for(e=0;t>e;e++)l[e]-=c*h[e];for(e=0;t>e;e++){for(n=h[e],r=l[e],i=e;t-1>=i;i++)o[i*a+e]-=n*l[i]+r*h[i];h[e]=o[(t-1)*a+e],o[t*this.n+e]=0}}h[t]=s}for(t=0;a-1>t;t++){if(o[(a-1)*a+t]=o[t*a+t],o[t*a+t]=1,s=h[t+1],0!==s){for(i=0;t>=i;i++)h[i]=o[i*a+(t+1)]/s;for(e=0;t>=e;e++){for(r=0,i=0;t>=i;i++)r+=o[i*a+(t+1)]*o[i*a+e];for(i=0;t>=i;i++)o[i*a+e]-=r*h[i]}}for(i=0;t>=i;i++)o[i*a+(t+1)]=0}for(e=0;a>e;e++)h[e]=o[(a-1)*a+e],o[(a-1)*a+e]=0;o[(a-1)*a+(a-1)]=1,l[0]=0},tql2:function(){var t,i,n,r,s,a,o,h=this.n,l=this.V,u=this.d,c=this.e;for(t=1;h>t;t++)c[t-1]=c[t];c[h-1]=0;var d=0,f=0,m=Math.pow(2,-52);for(r=0;h>r;r++){f=Math.max(f,Math.abs(u[r])+Math.abs(c[r]));for(var p=r;h>p&&!(Math.abs(c[p])<=m*f);)p++;if(p>r){o=0;do{o+=1,s=u[r],a=(u[r+1]-s)/(2*c[r]);var g=e.Matrix.hypot(a,1);0>a&&(g=-g),u[r]=c[r]/(a+g),u[r+1]=c[r]*(a+g);var v=u[r+1],b=s-u[r];for(t=r+2;h>t;t++)u[t]-=b;d+=b,a=u[p];var y=1,E=y,x=y,_=c[r+1],S=0,C=0;for(t=p-1;t>=r;t--)for(x=E,E=y,C=S,s=y*c[t],b=y*a,g=e.Matrix.hypot(a,c[t]),c[t+1]=S*g,S=c[t]/g,y=a/g,a=y*u[t]-S*s,u[t+1]=b+S*(y*s+S*u[t]),n=0;h>n;n++)b=l[n*h+(t+1)],l[n*h+(t+1)]=S*l[n*h+t]+y*b,l[n*h+t]=y*l[n*h+t]-S*b;a=-S*C*x*_*c[r]/v,c[r]=S*a,u[r]=y*a}while(Math.abs(c[r])>m*f)}u[r]=u[r]+d,c[r]=0}for(t=0;h-1>t;t++){for(n=t,a=u[t],i=t+1;h>i;i++)u[i]<a&&(n=i,a=u[i]);if(n!==t)for(u[n]=u[t],u[t]=a,i=0;h>i;i++)a=l[i*this.n+t],l[i*this.n+t]=l[i*h+n],l[i*h+n]=a}},orthes:function(){var t,e,i,n,r,s=this.n,a=this.V,o=this.H,h=this.ort,l=0,u=s-1;for(i=l+1;u-1>=i;i++){var c=0;for(t=i;u>=t;t++)c+=Math.abs(o[t*s+(i-1)]);if(0!==c){var d=0;for(t=u;t>=i;t--)h[t]=o[t*s+(i-1)]/c,d+=h[t]*h[t];for(r=Math.sqrt(d),h[i]>0&&(r=-r),d-=h[i]*r,h[i]=h[i]-r,e=i;s>e;e++){for(n=0,t=u;t>=i;t--)n+=h[t]*o[t*this.n+e];for(n/=d,t=i;u>=t;t++)o[t*this.n+e]-=n*h[t]}for(t=0;u>=t;t++){for(n=0,e=u;e>=i;e--)n+=h[e]*o[t*this.n+e];for(n/=d,e=i;u>=e;e++)o[t*this.n+e]-=n*h[e]}h[i]=c*h[i],o[i*s+(i-1)]=c*r}}for(t=0;s>t;t++)for(e=0;s>e;e++)a[t*this.n+e]=t===e?1:0;for(i=u-1;i>=l+1;i--)if(0!==o[i*s+(i-1)]){for(t=i+1;u>=t;t++)h[t]=o[t*s+(i-1)];for(e=i;u>=e;e++){for(r=0,t=i;u>=t;t++)r+=h[t]*a[t*this.n+e];for(r=r/h[i]/o[i*s+(i-1)],t=i;u>=t;t++)a[t*this.n+e]+=r*h[t]}}},cdiv:function(t,e,i,n){var r,s;Math.abs(i)>Math.abs(n)?(r=n/i,s=i+r*n,this.cdivr=(t+r*e)/s,this.cdivi=(e-r*t)/s):(r=i/n,s=n+r*i,this.cdivr=(r*t+e)/s,this.cdivi=(r*e-t)/s)},hqr2:function(){var t,e,i,n,r,s,a,o=this.V,h=this.d,l=this.e,u=this.H,c=this.n;t=c-1;var d,f,m,p,g=0,v=c-1,b=Math.pow(2,-52),y=0,E=0,x=0,_=0,S=0,C=0,w=0;for(e=0;c>e;e++)for((g>e||e>v)&&(h[e]=u[e*t+e],l[e]=0),i=Math.max(e-1,0);c>i;i++)w+=Math.abs(u[e*this.n+i]);for(a=0;t>=g;){for(r=t;r>g&&(S=Math.abs(u[(r-1)*t+(r-1)])+Math.abs(u[r*t+r]),0===S&&(S=w),!(Math.abs(u[r*t+(r-1)])<b*S));)r--;if(r===t)u[t*t+t]=u[t*t+t]+y,h[t]=u[t*t+t],l[t]=0,t--,a=0;else if(r===t-1){if(f=u[t*t+t-1]*u[(t-1)*t+t],E=(u[(t-1)*t+(t-1)]-u[t*t+t])/2,x=E*E+f,C=Math.sqrt(Math.abs(x)),u[t*t+t]=u[t*t+t]+y,u[(t-1)*t+(t-1)]=u[(t-1)*t+(t-1)]+y,m=u[t*t+t],x>=0){for(C=E>=0?E+C:E-C,h[t-1]=m+C,h[t]=h[t-1],0!==C&&(h[t]=m-f/C),l[t-1]=0,l[t]=0,m=u[t*t+t-1],S=Math.abs(m)+Math.abs(C),E=m/S,x=C/S,_=Math.sqrt(E*E+x*x),E/=_,x/=_,i=t-1;c>i;i++)C=u[(t-1)*t+i],u[(t-1)*t+i]=x*C+E*u[t*t+i],u[t*t+i]=x*u[t*t+i]-E*C;for(e=0;t>=e;e++)C=u[e*t+t-1],u[e*t+t-1]=x*C+E*u[e*t+t],u[e*t+t]=x*u[e*t+t]-E*C;for(e=g;v>=e;e++)C=o[e*t+t-1],o[e*t+t-1]=x*C+E*o[e*t+t],o[e*t+t]=x*o[e*t+t]-E*C}else h[t-1]=m+E,h[t]=m+E,l[t-1]=C,l[t]=-C;t-=2,a=0}else{if(m=u[t*t+t],p=0,f=0,t>r&&(p=u[(t-1)*t+(t-1)],f=u[t*t+t-1]*u[(t-1)*t+t]),10===a){for(y+=m,e=g;t>=e;e++)u[e*t+e]-=m;S=Math.abs(u[t*t+t-1])+Math.abs(u[(t-1)*t+t-2]),m=p=.75*S,f=-.4375*S*S}if(30===a&&(S=(p-m)/2,S=S*S+f,S>0)){for(S=Math.sqrt(S),m>p&&(S=-S),S=m-f/((p-m)/2+S),e=g;t>=e;e++)u[e*t+e]-=S;y+=S,m=p=f=.964}for(a+=1,s=t-2;s>=r&&(C=u[s*t+s],_=m-C,S=p-C,E=(_*S-f)/u[(s+1)*t+s]+u[s*t+s+1],x=u[(s+1)*t+s+1]-C-_-S,_=u[(s+2)*t+s+1],S=Math.abs(E)+Math.abs(x)+Math.abs(_),E/=S,x/=S,_/=S,s!==r)&&!(Math.abs(u[s*t+(s-1)])*(Math.abs(x)+Math.abs(_))<b*Math.abs(E)*(Math.abs(u[(s-1)*t+s-1])+Math.abs(C)+Math.abs(u[(s+1)*t+s+1])));)s--;for(e=s+2;t>=e;e++)u[e*t+e-2]=0,e>s+2&&(u[e*t+e-3]=0);for(n=s;t-1>=n;n++){var T=n!==t-1;if(n!==s&&(E=u[n*t+n-1],x=u[(n+1)*t+n-1],_=T?u[(n+2)*t+n-1]:0,m=Math.abs(E)+Math.abs(x)+Math.abs(_),0!==m&&(E/=m,x/=m,_/=m)),0===m)break;if(S=Math.sqrt(E*E+x*x+_*_),0>E&&(S=-S),0!==S){for(n!==s?u[n*t+n-1]=-S*m:r!==s&&(u[n*t+n-1]=-u[n*t+n-1]),E+=S,m=E/S,p=x/S,C=_/S,x/=E,_/=E,i=n;c>i;i++)E=u[n*t+i]+x*u[(n+1)*t+i],T&&(E+=_*u[(n+2)*t+i],u[(n+2)*t+i]=u[(n+2)*t+i]-E*C),u[n*t+i]=u[n*t+i]-E*m,u[(n+1)*t+i]=u[(n+1)*t+i]-E*p;for(e=0;e<=Math.min(t,n+3);e++)E=m*u[e*t+n]+p*u[e*t+n+1],T&&(E+=C*u[e*t+n+2],u[e*t+n+2]=u[e*t+n+2]-E*_),u[e*t+n]=u[e*t+n]-E,u[e*t+n+1]=u[e*t+n+1]-E*x;for(e=g;v>=e;e++)E=m*o[e*t+n]+p*o[e*t+n+1],T&&(E+=C*o[e*t+n+2],o[e*t+n+2]=o[e*t+n+2]-E*_),o[e*t+n]=o[e*t+n]-E,o[e*t+n+1]=o[e*t+n+1]-E*x}}}}if(0!==w){for(t=c-1;t>=0;t--)if(E=h[t],x=l[t],0===x)for(r=t,u[t*t+t]=1,e=t-1;e>=0;e--){for(f=u[e*t+e]-E,_=0,i=r;t>=i;i++)_+=u[e*this.n+i]*u[i*t+t];if(l[e]<0)C=f,S=_;else if(r=e,0===l[e]?u[e*t+t]=0!==f?-_/f:-_/(b*w):(m=u[e*t+e+1],p=u[(e+1)*t+e],x=(h[e]-E)*(h[e]-E)+l[e]*l[e],d=(m*S-C*_)/x,u[e*t+t]=d,u[(e+1)*t+t]=Math.abs(m)>Math.abs(C)?(-_-f*d)/m:(-S-p*d)/C),d=Math.abs(u[e*t+t]),b*d*d>1)for(i=e;t>=i;i++)u[i*t+t]=u[i*t+t]/d}else if(0>x)for(r=t-1,Math.abs(u[t*t+t-1])>Math.abs(u[(t-1)*t+t])?(u[(t-1)*t+(t-1)]=x/u[t*t+t-1],u[(t-1)*t+t]=-(u[t*t+t]-E)/u[t*t+t-1]):(this.cdiv(0,-u[(t-1)*t+t],u[(t-1)*t+(t-1)]-E,x),u[(t-1)*t+(t-1)]=this.cdivr,u[(t-1)*t+t]=this.cdivi),u[t*t+t-1]=0,u[t*t+t]=1,e=t-2;e>=0;e--){var D,R,P,A;for(D=0,R=0,i=r;t>=i;i++)D+=u[e*this.n+i]*u[i*t+t-1],R+=u[e*this.n+i]*u[i*t+t];if(f=u[e*t+e]-E,l[e]<0)C=f,_=D,S=R;else if(r=e,0===l[e]?(this.cdiv(-D,-R,f,x),u[e*t+t-1]=this.cdivr,u[e*t+t]=this.cdivi):(m=u[e*t+e+1],p=u[(e+1)*t+e],P=(h[e]-E)*(h[e]-E)+l[e]*l[e]-x*x,A=2*(h[e]-E)*x,0===P&&0===A&&(P=b*w*(Math.abs(f)+Math.abs(x)+Math.abs(m)+Math.abs(p)+Math.abs(C))),this.cdiv(m*_-C*D+x*R,m*S-C*R-x*D,P,A),u[e*t+t-1]=this.cdivr,u[e*t+t]=this.cdivi,Math.abs(m)>Math.abs(C)+Math.abs(x)?(u[(e+1)*t+t-1]=(-D-f*u[e*t+t-1]+x*u[e*t+t])/m,u[(e+1)*t+t]=(-R-f*u[e*t+t]-x*u[e*t+t-1])/m):(this.cdiv(-_-p*u[e*t+t-1],-S-p*u[e*t+t],C,x),u[(e+1)*t+t-1]=this.cdivr,u[(e+1)*t+t]=this.cdivi)),d=Math.max(Math.abs(u[e*t+t-1]),Math.abs(u[e*t+t])),b*d*d>1)for(i=e;t>=i;i++)u[i*t+t-1]=u[i*t+t-1]/d,u[i*t+t]=u[i*t+t]/d}for(e=0;c>e;e++)if(g>e||e>v)for(i=e;c>i;i++)o[e*this.n+i]=u[e*this.n+i];for(i=c-1;i>=g;i--)for(e=g;v>=e;e++){for(C=0,n=g;n<=Math.min(i,v);n++)C+=o[e*t+n]*u[n*t+i];o[e*this.n+i]=C}}}},n}),i("DOT/LinearFunction",["require","DOT/dot","DOT/Util"],function(t){var e=t("DOT/dot");return t("DOT/Util"),e.LinearFunction=function(t,i,n,r,s){s=_.isUndefined(s)?!1:s;var a=function(t,i,n,r,s,a){var o=e.Util.linear(t,i,n,r,s);if(a){var h=Math.max(n,r),l=Math.min(n,r);o=e.Util.clamp(o,l,h)}return o},o=function(e){return a(t,i,n,r,e,s)};return o.inverse=function(e){return a(n,r,t,i,e,s)},o},e.LinearFunction}),i("DOT/LUDecomposition",["require","DOT/dot"],function(t){var e=t("DOT/dot"),i=window.Float32Array||Array;e.LUDecomposition=function(t){var e,n,r;this.matrix=t,this.LU=t.getArrayCopy();var s=this.LU;this.m=t.getRowDimension();var a=this.m;this.n=t.getColumnDimension();var o=this.n;for(this.piv=new Uint32Array(a),e=0;a>e;e++)this.piv[e]=e;this.pivsign=1;var h=new i(a);for(n=0;o>n;n++){for(e=0;a>e;e++)h[e]=s[t.index(e,n)];for(e=0;a>e;e++){var l=Math.min(e,n),u=0;for(r=0;l>r;r++){var c=t.index(e,r);u+=s[c]*h[r]}h[e]-=u,s[t.index(e,n)]=h[e]}var d=n;for(e=n+1;a>e;e++)Math.abs(h[e])>Math.abs(h[d])&&(d=e);if(d!==n){for(r=0;o>r;r++){var f=t.index(d,r),m=t.index(n,r),p=s[f];s[f]=s[m],s[m]=p}r=this.piv[d],this.piv[d]=this.piv[n],this.piv[n]=r,this.pivsign=-this.pivsign}if(a>n&&0!==s[this.matrix.index(n,n)])for(e=n+1;a>e;e++)s[t.index(e,n)]/=s[t.index(n,n)]}};var n=e.LUDecomposition;return n.prototype={constructor:n,isNonsingular:function(){for(var t=0;t<this.n;t++){var e=this.matrix.index(t,t);if(0===this.LU[e])return!1}return!0},getL:function(){for(var t=new e.Matrix(this.m,this.n),i=0;i<this.m;i++)for(var n=0;n<this.n;n++)t.entries[t.index(i,n)]=i>n?this.LU[this.matrix.index(i,n)]:i===n?1:0;return t},getU:function(){for(var t=new e.Matrix(this.n,this.n),i=0;i<this.n;i++)for(var n=0;n<this.n;n++)t.entries[t.index(i,n)]=n>=i?this.LU[this.matrix.index(i,n)]:0;return t},getPivot:function(){for(var t=new Uint32Array(this.m),e=0;e<this.m;e++)t[e]=this.piv[e];return t},getDoublePivot:function(){for(var t=new i(this.m),e=0;e<this.m;e++)t[e]=this.piv[e];return t},det:function(){if(this.m!==this.n)throw new Error("Matrix must be square.");for(var t=this.pivsign,e=0;e<this.n;e++)t*=this.LU[this.matrix.index(e,e)];return t},solve:function(t){var e,i,n;if(t.getRowDimension()!==this.m)throw new Error("Matrix row dimensions must agree.");if(!this.isNonsingular())throw new Error("Matrix is singular.");var r=t.getColumnDimension(),s=t.getArrayRowMatrix(this.piv,0,r-1);for(n=0;n<this.n;n++)for(e=n+1;e<this.n;e++)for(i=0;r>i;i++)s.entries[s.index(e,i)]-=s.entries[s.index(n,i)]*this.LU[this.matrix.index(e,n)];for(n=this.n-1;n>=0;n--){for(i=0;r>i;i++)s.entries[s.index(n,i)]/=this.LU[this.matrix.index(n,n)];for(e=0;n>e;e++)for(i=0;r>i;i++)s.entries[s.index(e,i)]-=s.entries[s.index(n,i)]*this.LU[this.matrix.index(e,n)]}return s}},n}),i("PHET_CORE/isArray",["require","PHET_CORE/core"],function(t){var e=t("PHET_CORE/core");return e.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},e.isArray}),i("DOT/SingularValueDecomposition",["require","DOT/dot"],function(t){var e=t("DOT/dot"),i=window.Float32Array||Array;e.SingularValueDecomposition=function(t){this.matrix=t;var n=t,r=n.getArrayCopy();this.m=n.getRowDimension(),this.n=n.getColumnDimension();var s=this.m,a=this.n,o=Math.min,h=Math.max,l=Math.pow,u=Math.abs,c=o(s,a);this.s=new i(o(s+1,a));var d=this.s;this.U=new i(s*c);var f=this.U;this.V=new i(a*a);var m,p,g,v,b,y,E,x=this.V,_=new i(a),S=new i(s),C=!0,w=!0,T=e.Matrix.hypot,D=o(s-1,a),R=h(0,o(a-2,s));for(g=0;g<h(D,R);g++){if(D>g){for(d[g]=0,m=g;s>m;m++)d[g]=T(d[g],r[m*a+g]);if(0!==d[g]){for(r[g*a+g]<0&&(d[g]=-d[g]),m=g;s>m;m++)r[m*a+g]/=d[g];r[g*a+g]+=1}d[g]=-d[g]}for(p=g+1;a>p;p++){if(D>g&&0!==d[g]){for(v=0,m=g;s>m;m++)v+=r[m*a+g]*r[m*a+p];for(v=-v/r[g*a+g],m=g;s>m;m++)r[m*a+p]+=v*r[m*a+g]}_[p]=r[g*a+p]}if(C&&D>g)for(m=g;s>m;m++)f[m*c+g]=r[m*a+g];if(R>g){for(_[g]=0,m=g+1;a>m;m++)_[g]=T(_[g],_[m]);if(0!==_[g]){for(_[g+1]<0&&(_[g]=-_[g]),m=g+1;a>m;m++)_[m]/=_[g];_[g+1]+=1}if(_[g]=-_[g],s>g+1&&0!==_[g]){for(m=g+1;s>m;m++)S[m]=0;for(p=g+1;a>p;p++)for(m=g+1;s>m;m++)S[m]+=_[p]*r[m*a+p];for(p=g+1;a>p;p++)for(v=-_[p]/_[g+1],m=g+1;s>m;m++)r[m*a+p]+=v*S[m]}if(w)for(m=g+1;a>m;m++)x[m*a+g]=_[m]}}var P=o(a,s+1);if(a>D&&(d[D]=r[D*a+D]),P>s&&(d[P-1]=0),P>R+1&&(_[R]=r[R*a+P-1]),_[P-1]=0,C){for(p=D;c>p;p++){for(m=0;s>m;m++)f[m*c+p]=0;
f[p*c+p]=1}for(g=D-1;g>=0;g--)if(0!==d[g]){for(p=g+1;c>p;p++){for(v=0,m=g;s>m;m++)v+=f[m*c+g]*f[m*c+p];for(v=-v/f[g*c+g],m=g;s>m;m++)f[m*c+p]+=v*f[m*c+g]}for(m=g;s>m;m++)f[m*c+g]=-f[m*c+g];for(f[g*c+g]=1+f[g*c+g],m=0;g-1>m;m++)f[m*c+g]=0}else{for(m=0;s>m;m++)f[m*c+g]=0;f[g*c+g]=1}}if(w)for(g=a-1;g>=0;g--){if(R>g&&0!==_[g])for(p=g+1;c>p;p++){for(v=0,m=g+1;a>m;m++)v+=x[m*a+g]*x[m*a+p];for(v=-v/x[(g+1)*a+g],m=g+1;a>m;m++)x[m*a+p]+=v*x[m*a+g]}for(m=0;a>m;m++)x[m*a+g]=0;x[g*a+g]=1}for(var A=P-1,O=0,k=l(2,-52),N=l(2,-966);P>0;){var Y;if(O>500)break;for(g=P-2;g>=-1&&-1!==g;g--)if(u(_[g])<=N+k*(u(d[g])+u(d[g+1]))){_[g]=0;break}if(g===P-2)Y=4;else{var M;for(M=P-1;M>=g&&M!==g;M--)if(v=(M!==P?u(_[M]):0)+(M!==g+1?u(_[M-1]):0),u(d[M])<=N+k*v){d[M]=0;break}M===g?Y=3:M===P-1?Y=1:(Y=2,g=M)}switch(g++,Y){case 1:for(b=_[P-2],_[P-2]=0,p=P-2;p>=g;p--)if(v=T(d[p],b),y=d[p]/v,E=b/v,d[p]=v,p!==g&&(b=-E*_[p-1],_[p-1]=y*_[p-1]),w)for(m=0;a>m;m++)v=y*x[m*a+p]+E*x[m*a+P-1],x[m*a+P-1]=-E*x[m*a+p]+y*x[m*a+P-1],x[m*a+p]=v;break;case 2:for(b=_[g-1],_[g-1]=0,p=g;P>p;p++)if(v=T(d[p],b),y=d[p]/v,E=b/v,d[p]=v,b=-E*_[p],_[p]=y*_[p],C)for(m=0;s>m;m++)v=y*f[m*c+p]+E*f[m*c+g-1],f[m*c+g-1]=-E*f[m*c+p]+y*f[m*c+g-1],f[m*c+p]=v;break;case 3:var I=h(h(h(h(u(d[P-1]),u(d[P-2])),u(_[P-2])),u(d[g])),u(_[g])),B=d[P-1]/I,L=d[P-2]/I,F=_[P-2]/I,j=d[g]/I,X=_[g]/I,V=((L+B)*(L-B)+F*F)/2,H=B*F*B*F,z=0;(0!==V||0!==H)&&(z=Math.sqrt(V*V+H),0>V&&(z=-z),z=H/(V+z)),b=(j+B)*(j-B)+z;var G=j*X;for(p=g;P-1>p;p++){if(v=T(b,G),y=b/v,E=G/v,p!==g&&(_[p-1]=v),b=y*d[p]+E*_[p],_[p]=y*_[p]-E*d[p],G=E*d[p+1],d[p+1]=y*d[p+1],w)for(m=0;a>m;m++)v=y*x[m*a+p]+E*x[m*a+p+1],x[m*a+p+1]=-E*x[m*a+p]+y*x[m*a+p+1],x[m*a+p]=v;if(v=T(b,G),y=b/v,E=G/v,d[p]=v,b=y*_[p]+E*d[p+1],d[p+1]=-E*_[p]+y*d[p+1],G=E*_[p+1],_[p+1]=y*_[p+1],C&&s-1>p)for(m=0;s>m;m++)v=y*f[m*c+p]+E*f[m*c+p+1],f[m*c+p+1]=-E*f[m*c+p]+y*f[m*c+p+1],f[m*c+p]=v}_[P-2]=b,O+=1;break;case 4:if(d[g]<=0&&(d[g]=d[g]<0?-d[g]:0,w))for(m=0;A>=m;m++)x[m*a+g]=-x[m*a+g];for(;A>g&&!(d[g]>=d[g+1]);){if(v=d[g],d[g]=d[g+1],d[g+1]=v,w&&a-1>g)for(m=0;a>m;m++)v=x[m*a+g+1],x[m*a+g+1]=x[m*a+g],x[m*a+g]=v;if(C&&s-1>g)for(m=0;s>m;m++)v=f[m*c+g+1],f[m*c+g+1]=f[m*c+g],f[m*c+g]=v;g++}O=0,P--}}};var n=e.SingularValueDecomposition;return n.prototype={constructor:n,getU:function(){return new e.Matrix(this.m,Math.min(this.m+1,this.n),this.U,!0)},getV:function(){return new e.Matrix(this.n,this.n,this.V,!0)},getSingularValues:function(){return this.s},getS:function(){for(var t=new e.Matrix(this.n,this.n),i=0;i<this.n;i++){for(var n=0;n<this.n;n++)t.entries[t.index(i,n)]=0;t.entries[t.index(i,i)]=this.s[i]}return t},norm2:function(){return this.s[0]},cond:function(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]},rank:function(){for(var t=Math.pow(2,-23),e=Math.max(this.m,this.n)*this.s[0]*t,i=0,n=0;n<this.s.length;n++)this.s[n]>e&&i++;return i}},n}),i("DOT/QRDecomposition",["require","DOT/dot"],function(t){var e=t("DOT/dot"),i=window.Float32Array||Array;e.QRDecomposition=function(t){this.matrix=t,this.QR=t.getArrayCopy();var n=this.QR;this.m=t.getRowDimension();var r=this.m;this.n=t.getColumnDimension();var s=this.n;this.Rdiag=new i(s);var a,o,h;for(h=0;s>h;h++){var l=0;for(a=h;r>a;a++)l=e.Matrix.hypot(l,n[this.matrix.index(a,h)]);if(0!==l){for(n[this.matrix.index(h,h)]<0&&(l=-l),a=h;r>a;a++)n[this.matrix.index(a,h)]/=l;for(n[this.matrix.index(h,h)]+=1,o=h+1;s>o;o++){var u=0;for(a=h;r>a;a++)u+=n[this.matrix.index(a,h)]*n[this.matrix.index(a,o)];for(u=-u/n[this.matrix.index(h,h)],a=h;r>a;a++)n[this.matrix.index(a,o)]+=u*n[this.matrix.index(a,h)]}}this.Rdiag[h]=-l}};var n=e.QRDecomposition;return n.prototype={constructor:n,isFullRank:function(){for(var t=0;t<this.n;t++)if(0===this.Rdiag[t])return!1;return!0},getH:function(){for(var t=new e.Matrix(this.m,this.n),i=0;i<this.m;i++)for(var n=0;n<this.n;n++)t.entries[t.index(i,n)]=i>=n?this.QR[this.matrix.index(i,n)]:0;return t},getR:function(){for(var t=new e.Matrix(this.n,this.n),i=0;i<this.n;i++)for(var n=0;n<this.n;n++)t.entries[t.index(i,n)]=n>i?this.QR[this.matrix.index(i,n)]:i===n?this.Rdiag[i]:0;return t},getQ:function(){var t,i,n,r=new e.Matrix(this.m,this.n);for(n=this.n-1;n>=0;n--){for(t=0;t<this.m;t++)r.entries[r.index(t,n)]=0;for(r.entries[r.index(n,n)]=1,i=n;i<this.n;i++)if(0!==this.QR[this.matrix.index(n,n)]){var s=0;for(t=n;t<this.m;t++)s+=this.QR[this.matrix.index(t,n)]*r.entries[r.index(t,i)];for(s=-s/this.QR[this.matrix.index(n,n)],t=n;t<this.m;t++)r.entries[r.index(t,i)]+=s*this.QR[this.matrix.index(t,n)]}}return r},solve:function(t){if(t.getRowDimension()!==this.m)throw new Error("Matrix row dimensions must agree.");if(!this.isFullRank())throw new Error("Matrix is rank deficient.");var i,n,r,s=t.getColumnDimension(),a=t.getArrayCopy();for(r=0;r<this.n;r++)for(n=0;s>n;n++){var o=0;for(i=r;i<this.m;i++)o+=this.QR[this.matrix.index(i,r)]*a[t.index(i,n)];for(o=-o/this.QR[this.matrix.index(r,r)],i=r;i<this.m;i++)a[t.index(i,n)]+=o*this.QR[this.matrix.index(i,r)]}for(r=this.n-1;r>=0;r--){for(n=0;s>n;n++)a[t.index(r,n)]/=this.Rdiag[r];for(i=0;r>i;i++)for(n=0;s>n;n++)a[t.index(i,n)]-=a[t.index(r,n)]*this.QR[this.matrix.index(i,r)]}return new e.Matrix(a,this.n,s).getMatrix(0,this.n-1,0,s-1)}},n}),i("DOT/Matrix",["require","DOT/dot","PHET_CORE/isArray","DOT/SingularValueDecomposition","DOT/LUDecomposition","DOT/QRDecomposition","DOT/EigenvalueDecomposition","DOT/Vector2","DOT/Vector3","DOT/Vector4"],function(t){var e=t("DOT/dot"),i=window.Float32Array||Array,n=t("PHET_CORE/isArray");t("DOT/SingularValueDecomposition"),t("DOT/LUDecomposition"),t("DOT/QRDecomposition"),t("DOT/EigenvalueDecomposition"),t("DOT/Vector2"),t("DOT/Vector3"),t("DOT/Vector4"),e.Matrix=function(t,e,r,s){this.m=t,this.n=e;var a=t*e;this.size=a;var o;if(s)this.entries=r;else if(r||(r=0),this.entries=new i(a),n(r))for(o=0;a>o;o++)this.entries[o]=r[o];else for(o=0;a>o;o++)this.entries[o]=r};var r=e.Matrix;return r.hypot=function(t,e){var i;return Math.abs(t)>Math.abs(e)?(i=e/t,i=Math.abs(t)*Math.sqrt(1+i*i)):0!==e?(i=t/e,i=Math.abs(e)*Math.sqrt(1+i*i)):i=0,i},r.prototype={constructor:r,copy:function(){for(var t=new r(this.m,this.n),e=0;e<this.size;e++)t.entries[e]=this.entries[e];return t},getArray:function(){return this.entries},getArrayCopy:function(){return new i(this.entries)},getRowDimension:function(){return this.m},getColumnDimension:function(){return this.n},index:function(t,e){return t*this.n+e},get:function(t,e){return this.entries[this.index(t,e)]},set:function(t,e,i){this.entries[this.index(t,e)]=i},getMatrix:function(t,e,i,n){for(var s=new r(e-t+1,n-i+1),a=t;e>=a;a++)for(var o=i;n>=o;o++)s.entries[s.index(a-t,o-i)]=this.entries[this.index(a,o)];return s},getArrayRowMatrix:function(t,e,i){for(var n=new r(t.length,i-e+1),s=0;s<t.length;s++)for(var a=e;i>=a;a++)n.entries[n.index(s,a-e)]=this.entries[this.index(t[s],a)];return n},transpose:function(t){t=t||new r(this.n,this.m);for(var e=0;e<this.m;e++)for(var i=0;i<this.n;i++)t.entries[t.index(i,e)]=this.entries[this.index(e,i)];return t},norm1:function(){for(var t=0,e=0;e<this.n;e++){for(var i=0,n=0;n<this.m;n++)i+=Math.abs(this.entries[this.index(n,e)]);t=Math.max(t,i)}return t},norm2:function(){return new e.SingularValueDecomposition(this).norm2()},normInf:function(){for(var t=0,e=0;e<this.m;e++){for(var i=0,n=0;n<this.n;n++)i+=Math.abs(this.entries[this.index(e,n)]);t=Math.max(t,i)}return t},normF:function(){for(var t=0,e=0;e<this.m;e++)for(var i=0;i<this.n;i++)t=r.hypot(t,this.entries[this.index(e,i)]);return t},uminus:function(){for(var t=new r(this.m,this.n),e=0;e<this.m;e++)for(var i=0;i<this.n;i++)t.entries[t.index(e,i)]=-this.entries[this.index(e,i)];return t},plus:function(t){this.checkMatrixDimensions(t);for(var e=new r(this.m,this.n),i=0;i<this.m;i++)for(var n=0;n<this.n;n++){var s=e.index(i,n);e.entries[s]=this.entries[s]+t.entries[s]}return e},plusEquals:function(t){this.checkMatrixDimensions(t);for(var e=new r(this.m,this.n),i=0;i<this.m;i++)for(var n=0;n<this.n;n++){var s=e.index(i,n);this.entries[s]=this.entries[s]+t.entries[s]}return this},minus:function(t){this.checkMatrixDimensions(t);for(var e=new r(this.m,this.n),i=0;i<this.m;i++)for(var n=0;n<this.n;n++){var s=this.index(i,n);e.entries[s]=this.entries[s]-t.entries[s]}return e},minusEquals:function(t){this.checkMatrixDimensions(t);for(var e=0;e<this.m;e++)for(var i=0;i<this.n;i++){var n=this.index(e,i);this.entries[n]=this.entries[n]-t.entries[n]}return this},arrayTimes:function(t){this.checkMatrixDimensions(t);for(var e=new r(this.m,this.n),i=0;i<this.m;i++)for(var n=0;n<this.n;n++){var s=e.index(i,n);e.entries[s]=this.entries[s]*t.entries[s]}return e},arrayTimesEquals:function(t){this.checkMatrixDimensions(t);for(var e=0;e<this.m;e++)for(var i=0;i<this.n;i++){var n=this.index(e,i);this.entries[n]=this.entries[n]*t.entries[n]}return this},arrayRightDivide:function(t){this.checkMatrixDimensions(t);for(var e=new r(this.m,this.n),i=0;i<this.m;i++)for(var n=0;n<this.n;n++){var s=this.index(i,n);e.entries[s]=this.entries[s]/t.entries[s]}return e},arrayRightDivideEquals:function(t){this.checkMatrixDimensions(t);for(var e=0;e<this.m;e++)for(var i=0;i<this.n;i++){var n=this.index(e,i);this.entries[n]=this.entries[n]/t.entries[n]}return this},arrayLeftDivide:function(t){this.checkMatrixDimensions(t);for(var e=new r(this.m,this.n),i=0;i<this.m;i++)for(var n=0;n<this.n;n++){var s=this.index(i,n);e.entries[s]=t.entries[s]/this.entries[s]}return e},arrayLeftDivideEquals:function(t){this.checkMatrixDimensions(t);for(var e=0;e<this.m;e++)for(var i=0;i<this.n;i++){var n=this.index(e,i);this.entries[n]=t.entries[n]/this.entries[n]}return this},times:function(t){var e,n,s,a,o,h;if(t.isMatrix){if(h=t,h.m!==this.n)throw new Error("Matrix inner dimensions must agree.");e=new r(this.m,h.n);var l=new i(this.n);for(s=0;s<h.n;s++){for(a=0;a<this.n;a++)l[a]=h.entries[h.index(a,s)];for(n=0;n<this.m;n++){for(o=0,a=0;a<this.n;a++)o+=this.entries[this.index(n,a)]*l[a];e.entries[e.index(n,s)]=o}}return e}for(o=t,e=new r(this.m,this.n),n=0;n<this.m;n++)for(s=0;s<this.n;s++)e.entries[e.index(n,s)]=o*this.entries[this.index(n,s)];return e},timesEquals:function(t){for(var e=0;e<this.m;e++)for(var i=0;i<this.n;i++){var n=this.index(e,i);this.entries[n]=t*this.entries[n]}return this},solve:function(t){return this.m===this.n?new e.LUDecomposition(this).solve(t):new e.QRDecomposition(this).solve(t)},solveTranspose:function(t){return this.transpose().solve(t.transpose())},inverse:function(){return this.solve(r.identity(this.m,this.m))},det:function(){return new e.LUDecomposition(this).det()},rank:function(){return new e.SingularValueDecomposition(this).rank()},cond:function(){return new e.SingularValueDecomposition(this).cond()},trace:function(){for(var t=0,e=0;e<Math.min(this.m,this.n);e++)t+=this.entries[this.index(e,e)];return t},checkMatrixDimensions:function(t){if(t.m!==this.m||t.n!==this.n)throw new Error("Matrix dimensions must agree.")},toString:function(){var t="";t+="dim: "+this.getRowDimension()+"x"+this.getColumnDimension()+"\n";for(var e=0;e<this.getRowDimension();e++){for(var i=0;i<this.getColumnDimension();i++)t+=this.get(e,i)+" ";t+="\n"}return t},extractVector2:function(t){return new e.Vector2(this.get(0,t),this.get(1,t))},extractVector3:function(t){return new e.Vector3(this.get(0,t),this.get(1,t),this.get(2,t))},extractVector4:function(t){return new e.Vector4(this.get(0,t),this.get(1,t),this.get(2,t),this.get(3,t))},setVectors3:function(t){for(var e=t.length,i=0;e>i;i++){var n=t[i];this.entries[i]=n.x,this.entries[i+e]=n.y,this.entries[i+2*e]=n.z}return this},isMatrix:!0},r.identity=function(t,e){for(var i=new r(t,e),n=0;t>n;n++)for(var s=0;e>s;s++)i.entries[i.index(n,s)]=n===s?1:0;return i},r.rowVector2=function(t){return new r(1,2,[t.x,t.y])},r.rowVector3=function(t){return new r(1,3,[t.x,t.y,t.z])},r.rowVector4=function(t){return new r(1,4,[t.x,t.y,t.z,t.w])},r.rowVector=function(t){if(t.isVector2)return r.rowVector2(t);if(t.isVector3)return r.rowVector3(t);if(t.isVector4)return r.rowVector4(t);throw new Error("undetected type of vector: "+t.toString())},r.columnVector2=function(t){return new r(2,1,[t.x,t.y])},r.columnVector3=function(t){return new r(3,1,[t.x,t.y,t.z])},r.columnVector4=function(t){return new r(4,1,[t.x,t.y,t.z,t.w])},r.columnVector=function(t){if(t.isVector2)return r.columnVector2(t);if(t.isVector3)return r.columnVector3(t);if(t.isVector4)return r.columnVector4(t);throw new Error("undetected type of vector: "+t.toString())},r.fromVectors2=function(t){for(var e=2,n=t.length,s=new i(e*n),a=0;n>a;a++){var o=t[a];s[a]=o.x,s[a+n]=o.y}return new r(e,n,s,!0)},r.fromVectors3=function(t){for(var e=3,n=t.length,s=new i(e*n),a=0;n>a;a++){var o=t[a];s[a]=o.x,s[a+n]=o.y,s[a+2*n]=o.z}return new r(e,n,s,!0)},r.fromVectors4=function(t){for(var e=4,n=t.length,s=new i(e*n),a=0;n>a;a++){var o=t[a];s[a]=o.x,s[a+n]=o.y,s[a+2*n]=o.z,s[a+3*n]=o.w}return new r(e,n,s,!0)},r}),i("DOT/ObservableBounds2",["require","DOT/dot","PHET_CORE/inherit","PHET_CORE/extend","PHET_CORE/PoolableMixin","AXON/Property","DOT/Bounds2"],function(t){var e=t("DOT/dot"),i=t("PHET_CORE/inherit"),n=t("PHET_CORE/extend"),r=t("PHET_CORE/PoolableMixin"),s=t("AXON/Property");t("DOT/Bounds2"),e.ObservableBounds2=function(t,i,n,r){e.Bounds2.call(this,t,i,n,r),this._oldValue=this.copy(),s.call(this,this)};var a=e.ObservableBounds2;return i(e.Bounds2,a,n({},s.prototype,{get:function(){return this},setMinMax:function(t,e,i,n){return(this.minX!==t||this.minY!==e||this.maxX!==i||this.maxY!==n)&&(this._oldValue.minX=this.minX,this._oldValue.minY=this.minY,this._oldValue.maxX=this.maxX,this._oldValue.maxY=this.maxY,this.minX=t,this.minY=e,this.maxX=i,this.maxY=n,this._notifyObservers(this._oldValue)),this},setMinX:function(t){return this.minX!==t&&(this._oldValue.minX=this.minX,this.minX=t,this._notifyObservers(this._oldValue)),this},setMinY:function(t){return this.minY!==t&&(this._oldValue.minY=this.minY,this.minY=t,this._notifyObservers(this._oldValue)),this},setMaxX:function(t){return this.maxX!==t&&(this._oldValue.maxX=this.maxX,this.maxX=t,this._notifyObservers(this._oldValue)),this},setMaxY:function(t){return this.maxY!==t&&(this._oldValue.maxY=this.maxY,this.maxY=t,this._notifyObservers(this._oldValue)),this},set:e.Bounds2.prototype.set,equalsValue:function(t){return this.equals(t)},storeValue:function(){},storeInitialValue:function(t){this._initialMinX=t.minX,this._initialMinY=t.minY,this._initialMaxX=t.maxX,this._initialMaxY=t.maxY},reset:function(){this.setMinMax(this._initialMinX,this._initialMinY,this._initialMaxX,this._initialMaxY)},toString:function(){return"ObservableBounds2("+this.minX+", "+this.minY+", "+this.maxX+", "+this.maxY+")"}})),r(a,{defaultFactory:function(){return new a},constructorDuplicateFactory:function(t){return function(e,i,n,r){return t.length?t.pop().setMinMax(e,i,n,r):new a(e,i,n,r)}}}),a}),i("DOT/ObservableMatrix3",["require","DOT/dot","PHET_CORE/inherit","PHET_CORE/extend","PHET_CORE/PoolableMixin","AXON/Property","DOT/Matrix3"],function(t){var e=t("DOT/dot"),i=t("PHET_CORE/inherit"),n=t("PHET_CORE/extend"),r=t("PHET_CORE/PoolableMixin"),s=t("AXON/Property");t("DOT/Matrix3"),e.ObservableMatrix3=function(t,i,n,r,a,o,h,l,u,c){e.Matrix3.call(this,t,i,n,r,a,o,h,l,u,c),this._oldValue=this.copy(),this._skipChecks=!1,s.call(this,this)};var a=e.ObservableMatrix3;return i(e.Matrix3,a,n({},s.prototype,{get:function(){return this},rowMajor:function(t,i,n,r,s,a,o,h,l,u){var c=this._skipChecks,d=c||t!==this.entries[0]||r!==this.entries[1]||o!==this.entries[2]||i!==this.entries[3]||s!==this.entries[4]||h!==this.entries[5]||n!==this.entries[6]||a!==this.entries[7]||l!==this.entries[8]||u!==this.type;return d&&(!c&&this._oldValue&&(this._oldValue.entries[0]=this.entries[0],this._oldValue.entries[1]=this.entries[1],this._oldValue.entries[2]=this.entries[2],this._oldValue.entries[3]=this.entries[3],this._oldValue.entries[4]=this.entries[4],this._oldValue.entries[5]=this.entries[5],this._oldValue.entries[6]=this.entries[6],this._oldValue.entries[7]=this.entries[7],this._oldValue.entries[8]=this.entries[8],this._oldValue.type=this.type),this.entries[0]=t,this.entries[1]=r,this.entries[2]=o,this.entries[3]=i,this.entries[4]=s,this.entries[5]=h,this.entries[6]=n,this.entries[7]=a,this.entries[8]=l,this.type=void 0===u?0===o&&0===h&&1===l?e.Matrix3.Types.AFFINE:e.Matrix3.Types.OTHER:u,this._observers&&this._notifyObservers(c?null:this._oldValue)),this},set:e.Matrix3.prototype.set,equalsValue:function(t){return this.equals(t)},storeValue:function(){},storeInitialValue:function(t){this._initial00=t.m00(),this._initial01=t.m01(),this._initial02=t.m02(),this._initial10=t.m10(),this._initial11=t.m11(),this._initial12=t.m12(),this._initial20=t.m20(),this._initial21=t.m21(),this._initial22=t.m22(),this._initialType=t.type},reset:function(){this.rowMajor(this._initial00,this._initial01,this._initial02,this._initial10,this._initial11,this._initial12,this._initial20,this._initial21,this._initial22,this._initialType)},toString:e.Matrix3.prototype.toString})),r(a,{defaultFactory:function(){return new a},constructorDuplicateFactory:function(t){return function(e,i,n,r,s,o,h,l,u,c){return t.length?t.pop().rowMajor(e,i,n,r,s,o,h,l,u,c):new a(e,i,n,r,s,o,h,l,u,c)}}}),a}),i("DOT/ObservableVector2",["require","DOT/dot","PHET_CORE/inherit","PHET_CORE/extend","PHET_CORE/PoolableMixin","AXON/Property","DOT/Vector2"],function(t){var e=t("DOT/dot"),i=t("PHET_CORE/inherit"),n=t("PHET_CORE/extend"),r=t("PHET_CORE/PoolableMixin"),s=t("AXON/Property");t("DOT/Vector2"),e.ObservableVector2=function(t,i){e.Vector2.call(this,t,i),this._oldValue=this.copy(),s.call(this,this)};var a=e.ObservableVector2;return i(e.Vector2,a,n({},s.prototype,{get:function(){return this},setXY:function(t,e){return(this.x!==t||this.y!==e)&&(this._oldValue.x=this.x,this._oldValue.y=this.y,this.x=t,this.y=e,this._notifyObservers(this._oldValue)),this},setX:function(t){return this.x!==t&&(this._oldValue.x=this.x,this.x=t,this._notifyObservers(this._oldValue)),this},setY:function(t){return this.y!==t&&(this._oldValue.y=this.y,this.y=t,this._notifyObservers(this._oldValue)),this},set:e.Vector2.prototype.set,equalsValue:function(t){return this.equals(t)},storeValue:function(){},storeInitialValue:function(t){this._initialX=t.x,this._initialY=t.y},reset:function(){this.setXY(this._initialX,this._initialY)},toString:function(){return"ObservableVector2("+this.x+", "+this.y+")"}})),r(a,{defaultFactory:function(){return new a},constructorDuplicateFactory:function(t){return function(e,i){return t.length?t.pop().setXY(e,i):new a(e,i)}}}),a}),i("DOT/Permutation",["require","DOT/dot","PHET_CORE/isArray","DOT/Util"],function(t){function e(t,i,n){if(0===t.length)n.call(void 0,i);else for(var r=0;r<t.length;r++){var s=t[r],a=t.slice(0);a.splice(r,1);var o=i.slice(0);o.push(s),e(a,o,n)}}var i=t("DOT/dot"),n=t("PHET_CORE/isArray");t("DOT/Util");var r=i.Permutation=function(t){this.indices=t};return r.identity=function(t){for(var e=new Array(t),i=0;t>i;i++)e[i]=i;return new r(e)},r.permutations=function(t){var e=[];return r.forEachPermutation(i.rangeInclusive(0,t-1),function(t){e.push(new r(t))}),e},r.forEachPermutation=function(t,i){e(t,[],i)},r.prototype={constructor:r,size:function(){return this.indices.length},apply:function(t){if(n(t)){if(t.length!==this.size())throw new Error("Permutation length "+this.size()+" not equal to list length "+t.length);for(var e=new Array(t.length),i=0;i<t.length;i++)e[i]=t[this.indices[i]];return e}return this.indices[t]},inverted:function(){for(var t=new Array(this.size()),e=0;e<this.size();e++)t[this.indices[e]]=e;return new r(t)},withIndicesPermuted:function(t){var e=[],i=this;return r.forEachPermutation(t,function(n){for(var s=i.indices,a=s.slice(0),o=0;o<t.length;o++)a[t[o]]=s[n[o]];e.push(new r(a))}),e},toString:function(){return"P["+this.indices.join(", ")+"]"}},r.testMe=function(t){var e=new r([1,4,3,2,0]);t.log(e.toString());var i=e.inverted();t.log(i.toString()),t.log(i.withIndicesPermuted([0,3,4]).toString()),t.log(r.permutations(4).toString())},r}),i("DOT/Plane3",["require","DOT/dot","DOT/Vector3"],function(t){var e=t("DOT/dot"),i=t("DOT/Vector3");e.Plane3=function(t,e){this.normal=t,this.distance=e};var n=e.Plane3;return n.prototype={constructor:n,intersectWithRay:function(t){return t.pointAtDistance(t.distanceToPlane(this))}},n.XY=new n(new i(0,0,1),0),n.XZ=new n(new i(0,1,0),0),n.YZ=new n(new i(1,0,0),0),n.fromTriangle=function(t,e,i){var r=i.minus(t).cross(e.minus(t));return 0===r.magnitude()?null:(r.normalize(),new n(r,r.dot(t)))},n}),i("DOT/Quaternion",["require","DOT/dot","PHET_CORE/PoolableMixin","DOT/Vector3","DOT/Matrix3","DOT/Util"],function(t){var e=t("DOT/dot"),i=t("PHET_CORE/PoolableMixin");t("DOT/Vector3"),t("DOT/Matrix3"),t("DOT/Util"),e.Quaternion=function(t,e,i,n){this.setXYZW(t,e,i,n)};var n=e.Quaternion;return n.prototype={constructor:n,isQuaternion:!0,setXYZW:function(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==n?n:1},plus:function(t){return new n(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},timesScalar:function(t){return new n(this.x*t,this.y*t,this.z*t,this.w*t)},timesQuaternion:function(t){return new n(this.x*t.w-this.z*t.y+this.y*t.z+this.w*t.x,-this.x*t.z+this.y*t.w+this.z*t.x+this.w*t.y,this.x*t.y-this.y*t.x+this.z*t.w+this.w*t.z,-this.x*t.x-this.y*t.y-this.z*t.z+this.w*t.w)},timesVector3:function(t){return 0===t.magnitude()?new e.Vector3:new e.Vector3(this.w*this.w*t.x+2*this.y*this.w*t.z-2*this.z*this.w*t.y+this.x*this.x*t.x+2*this.y*this.x*t.y+2*this.z*this.x*t.z-this.z*this.z*t.x-this.y*this.y*t.x,2*this.x*this.y*t.x+this.y*this.y*t.y+2*this.z*this.y*t.z+2*this.w*this.z*t.x-this.z*this.z*t.y+this.w*this.w*t.y-2*this.x*this.w*t.z-this.x*this.x*t.y,2*this.x*this.z*t.x+2*this.y*this.z*t.y+this.z*this.z*t.z-2*this.w*this.y*t.x-this.y*this.y*t.z+2*this.w*this.x*t.y-this.x*this.x*t.z+this.w*this.w*t.z)},magnitude:function(){return Math.sqrt(this.magnitudeSquared())},magnitudeSquared:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},normalized:function(){var t=this.magnitude();return this.timesScalar(1/t)},negated:function(){return new n(-this.x,-this.y,-this.z,-this.w)},toRotationMatrix:function(){var t=this.magnitudeSquared(),i=1===t?2:t>0?2/t:0,n=this.x*this.x*i,r=this.x*this.y*i,s=this.x*this.z*i,a=this.w*this.x*i,o=this.y*this.y*i,h=this.y*this.z*i,l=this.w*this.y*i,u=this.z*this.z*i,c=this.w*this.z*i;return e.Matrix3.dirtyFromPool().columnMajor(1-(o+u),r+c,s-l,r-c,1-(n+u),h+a,s+l,h-a,1-(n+o))}},n.fromEulerAngles=function(t,e,i){var r=Math.sin(.5*i),s=Math.cos(.5*i),a=Math.sin(.5*e),o=Math.cos(.5*e),h=Math.sin(.5*t),l=Math.cos(.5*t),u=o*s,c=a*r,d=o*r,f=a*s;return new n(u*h+c*l,f*l+d*h,d*l-f*h,u*l-c*h)},n.fromRotationMatrix=function(t){var e,i=t.m00(),r=t.m01(),s=t.m02(),a=t.m10(),o=t.m11(),h=t.m12(),l=t.m20(),u=t.m21(),c=t.m22(),d=i+o+c;return d>=0?(e=Math.sqrt(d+1),new n(.5*(u-h)/e,.5*(s-l)/e,.5*(a-r)/e,.5*e)):i>o&&i>c?(e=Math.sqrt(1+i-o-c),new n(.5*e,.5*(a+r)/e,.5*(s+l)/e,.5*(u-h)/e)):o>c?(e=Math.sqrt(1+o-i-c),new n(.5*(a+r)/e,.5*e,.5*(u+h)/e,.5*(s-l)/e)):(e=Math.sqrt(1+c-i-o),new n(.5*(s+l)/e,.5*(u+h)/e,.5*e,.5*(a-r)/e))},n.getRotationQuaternion=function(t,i){return n.fromRotationMatrix(e.Matrix3.rotateAToB(t,i))},n.slerp=function(t,e,i){if(t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w)return t;var r=t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w;0>r&&(e=e.negated(),r=-r);var s=1-i,a=i;if(1-r>.1){var o=Math.acos(r),h=1/Math.sin(o);s=Math.sin((1-i)*o)*h,a=Math.sin(i*o)*h}return new n(s*t.x+a*e.x,s*t.y+a*e.y,s*t.z+a*e.z,s*t.w+a*e.w)},i(n,{defaultFactory:function(){return new n},constructorDuplicateFactory:function(t){return function(e,i,r,s){return t.length?t.pop().set(e,i,r,s):new n(e,i,r,s)}}}),n}),i("DOT/Ray3",["require","DOT/dot"],function(t){var e=t("DOT/dot");e.Ray3=function(t,e){this.pos=t,this.dir=e};var i=e.Ray3;return i.prototype={constructor:i,shifted:function(t){return new i(this.pointAtDistance(t),this.dir)},pointAtDistance:function(t){return this.pos.plus(this.dir.timesScalar(t))},distanceToPlane:function(t){return(t.distance-this.pos.dot(t.normal))/this.dir.dot(t.normal)},toString:function(){return this.pos.toString()+" => "+this.dir.toString()}},i}),i("DOT/Rectangle",["require","DOT/dot","PHET_CORE/inherit","DOT/Bounds2"],function(t){var e=t("DOT/dot"),i=t("PHET_CORE/inherit"),n=t("DOT/Bounds2");e.Rectangle=function(t,e,i,r){n.call(this,t,e,t+i,e+r)};var r=e.Rectangle;return i(n,r),r}),i("DOT/Sphere3",["require","DOT/dot"],function(t){var e=t("DOT/dot");e.Sphere3=function(t,e){this.center=t,this.radius=e};var i=e.Sphere3;return i.prototype={constructor:i,intersect:function(t,e){var i=t.dir,n=t.pos,r=n.minus(this.center),s=i.dot(r),a=r.magnitudeSquared(),o=4*s*s-4*(a-this.radius*this.radius);if(e>o)return null;var h=i.dot(this.center)-i.dot(n),l=Math.sqrt(o)/2,u=h-l,c=h+l;if(e>c)return null;var d=t.pointAtDistance(c),f=d.minus(this.center).normalized();if(e>u)return{distance:c,hitPoint:d,normal:f.negated(),fromOutside:!1};var m=t.pointAtDistance(u),p=m.minus(this.center).normalized();return{distance:u,hitPoint:m,normal:p,fromOutside:!0}},intersections:function(t,e){var i=t.dir,n=t.pos,r=n.minus(this.center),s=i.dot(r),a=r.magnitudeSquared(),o=4*s*s-4*(a-this.radius*this.radius);if(e>o)return[];var h=i.dot(this.center)-i.dot(n),l=Math.sqrt(o)/2,u=h-l,c=h+l;if(e>c)return[];var d=t.pointAtDistance(c),f=d.minus(this.center).normalized(),m=t.pointAtDistance(u),p=m.minus(this.center).normalized(),g={distance:c,hitPoint:d,normal:f.negated(),fromOutside:!1},v={distance:u,hitPoint:m,normal:p,fromOutside:!0};return e>u?[g,v]:[v,g]}},i}),i("DOT/Transform4",["require","DOT/dot","DOT/Matrix4","DOT/Vector3","DOT/Ray3"],function(t){var e=t("DOT/dot");t("DOT/Matrix4"),t("DOT/Vector3"),t("DOT/Ray3"),e.Transform4=function(t){this.setMatrix(void 0===t?e.Matrix4.IDENTITY:t)};var i=e.Transform4;return i.prototype={constructor:i,setMatrix:function(t){this.matrix=t,this.inverse=null,this.matrixTransposed=null,this.inverseTransposed=null},getMatrix:function(){return this.matrix},getInverse:function(){return null===this.inverse&&(this.inverse=this.matrix.inverted()),this.inverse},getMatrixTransposed:function(){return null===this.matrixTransposed&&(this.matrixTransposed=this.matrix.transposed()),this.matrixTransposed},getInverseTransposed:function(){return null===this.inverseTransposed&&(this.inverseTransposed=this.getInverse().transposed()),this.inverseTransposed},prepend:function(t){this.setMatrix(t.timesMatrix(this.matrix))},append:function(t){this.setMatrix(this.matrix.timesMatrix(t))},prependTransform:function(t){this.prepend(t.matrix)},appendTransform:function(t){this.append(t.matrix)},isIdentity:function(){return this.matrix.type===e.Matrix4.Types.IDENTITY},applyToCanvasContext:function(t){t.setTransform(this.matrix.m00(),this.matrix.m10(),this.matrix.m01(),this.matrix.m11(),this.matrix.m03(),this.matrix.m13())},transformPosition3:function(t){return this.matrix.timesVector3(t)},transformDelta3:function(t){return this.matrix.timesRelativeVector3(t)},transformNormal3:function(t){return this.getInverse().timesTransposeVector3(t)},transformDeltaX:function(t){return this.transformDelta3(new e.Vector3(t,0,0)).x},transformDeltaY:function(t){return this.transformDelta3(new e.Vector3(0,t,0)).y},transformDeltaZ:function(t){return this.transformDelta3(new e.Vector3(0,0,t)).z},transformRay:function(t){return new e.Ray3(this.transformPosition3(t.pos),this.transformPosition3(t.pos.plus(t.dir)).minus(this.transformPosition3(t.pos)))},inversePosition3:function(t){return this.getInverse().timesVector3(t)},inverseDelta3:function(t){return this.inversePosition3(t).minus(this.inversePosition3(e.Vector3.ZERO))},inverseNormal3:function(t){return this.matrix.timesTransposeVector3(t)},inverseDeltaX:function(t){return this.inverseDelta3(new e.Vector3(t,0,0)).x},inverseDeltaY:function(t){return this.inverseDelta3(new e.Vector3(0,t,0)).y},inverseDeltaZ:function(t){return this.inverseDelta3(new e.Vector3(0,0,t)).z},inverseRay:function(t){return new e.Ray3(this.inversePosition3(t.pos),this.inversePosition3(t.pos.plus(t.dir)).minus(this.inversePosition3(t.pos)))}},i}),i("DOT/main",["DOT/dot","DOT/Bounds2","DOT/Bounds3","DOT/Complex","DOT/ConvexHull2","DOT/Dimension2","DOT/EigenvalueDecomposition","DOT/LinearFunction","DOT/LUDecomposition","DOT/Matrix","DOT/Matrix3","DOT/Matrix4","DOT/ObservableBounds2","DOT/ObservableMatrix3","DOT/ObservableVector2","DOT/Permutation","DOT/Plane3","DOT/QRDecomposition","DOT/Quaternion","DOT/Ray2","DOT/Ray3","DOT/Rectangle","DOT/SingularValueDecomposition","DOT/Sphere3","DOT/Transform3","DOT/Transform4","DOT/Util","DOT/Vector2","DOT/Vector3","DOT/Vector4"],function(t){return t}),i("PHET_CORE/collect",["require","PHET_CORE/core"],function(t){var e=t("PHET_CORE/core");return e.collect=function(t){var e=[];return t(function(t){e.push(t)}),e},e.collect}),i("PHET_CORE/detectPrefixEvent",["require","PHET_CORE/core"],function(t){var e=t("PHET_CORE/core");return e.detectPrefixEvent=function(t,e){return void 0!==t["on"+e]?e:void 0!==t["onmoz"+e]?"moz"+e:void 0!==t["onMoz"+e]?"Moz"+e:void 0!==t["onwebkit"+e]?"webkit"+e:void 0!==t["onms"+e]?"ms"+e:void 0!==t["ono"+e]?"o"+e:void 0},e.detectPrefixEvent}),i("PHET_CORE/EventTimer",["require","PHET_CORE/core","PHET_CORE/inherit"],function(t){var e=t("PHET_CORE/core"),i=t("PHET_CORE/inherit");return e.EventTimer=function(t,e){this.eventModel=t,this.eventCallback=e,this.timeBeforeNextEvent=this.eventModel.getPeriodBeforeNextEvent()},i(Object,e.EventTimer,{step:function(t){for(;t>=this.timeBeforeNextEvent;)t-=this.timeBeforeNextEvent,this.timeBeforeNextEvent=this.eventModel.getPeriodBeforeNextEvent(),this.eventCallback(t);this.timeBeforeNextEvent-=t}}),e.EventTimer.ConstantEventModel=i(Object,function(t){this.rate=t},{getPeriodBeforeNextEvent:function(){return 1/this.rate}}),e.EventTimer.UniformEventModel=i(Object,function(t,e){this.rate=t,this.pseudoRandomNumberSource=e},{getPeriodBeforeNextEvent:function(){var t=this.pseudoRandomNumberSource();return 2*t/this.rate}}),e.EventTimer.PoissonEventModel=i(Object,function(t,e){this.rate=t,this.pseudoRandomNumberSource=e},{getPeriodBeforeNextEvent:function(){var t=this.pseudoRandomNumberSource();return-Math.log(t)/this.rate}}),e.EventTimer}),i("PHET_CORE/loadScript",["require","PHET_CORE/core"],function(t){var e=t("PHET_CORE/core");return e.loadScript=function(t){"string"==typeof t&&(t={src:t});var e=t.src,i=t.callback,n=void 0===t.async?!0:t.async,r=void 0===t.cacheBuster?!1:t.cacheBuster,s=!1,a=document.createElement("script");a.type="text/javascript",a.async=n,a.onload=a.onreadystatechange=function(){var t=this.readyState;t&&"complete"!==t&&"loaded"!==t||s||(s=!0,i&&i())},a.src=e+(r?"?random="+Math.random().toFixed(10):"");var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(a,o)},e.loadScript}),i("PHET_CORE/pairs",["require","PHET_CORE/core"],function(t){var e=t("PHET_CORE/core");return e.pairs=function(t){var e=[],i=t.length;if(i>1)for(var n=0;i-1>n;n++)for(var r=t[n],s=n+1;i>s;s++)e.push([r,t[s]]);return e},e.pairs}),i("PHET_CORE/partition",["require","PHET_CORE/core"],function(t){var e=t("PHET_CORE/core");return e.partition=function(t,e){for(var i=[],n=[],r=t.length,s=0;r>s;s++)e(t[s])?i.push(t[s]):n.push(t[s]);return[i,n]},e.partition}),i("PHET_CORE/profiler",["require","PHET_CORE/core"],function(t){var e=t("PHET_CORE/core"),i=[],n={},r=0,s=[];return e.profiler={displayCount:1e3,start:function(t){var e=Date.now();i.push({name:t,time:e})},addListener:function(t){s.push(t)},stop:function(){var t=Date.now(),e=i.pop(),a=t-e.time;if(n[e.name]||(n[e.name]=[]),n[e.name].push(a),r++,r%this.displayCount===0){var o=JSON.stringify(this.toJSON());console.log(o);for(var h=0;h<s.length;h++)s[h](o);n={}}},toJSON:function(){var t,e={};for(var i in n){t=0;for(var r=0;r<n[i].length;r++){var s=n[i][r];t+=s}var a=t/n[i].length;e[i]={average:a,count:n[i].length}}return e},testSelf:function(){var t,e,i=this;this.displayCount=1e7;
for(var n=0;10>n;n++){i.start("physics");for(var r=0;1e4>r;r++){i.start("mloop");for(var s=0;1e4>s;s++)t=2e4;i.stop(),i.start("xloop");for(var a=0;2e4>a;a++)e=2e4;i.stop()}i.stop()}console.log("results: ",t,e),console.log(JSON.stringify(this.toJSON()))}},e.profiler}),i("PHET_CORE/main",["PHET_CORE/core","PHET_CORE/arrayRemove","PHET_CORE/cleanArray","PHET_CORE/collect","PHET_CORE/detectPrefix","PHET_CORE/detectPrefixEvent","PHET_CORE/escapeHTML","PHET_CORE/EventTimer","PHET_CORE/extend","PHET_CORE/inherit","PHET_CORE/isArray","PHET_CORE/loadScript","PHET_CORE/pairs","PHET_CORE/partition","PHET_CORE/phetAllocation","PHET_CORE/platform","PHET_CORE/PoolableMixin","PHET_CORE/profiler"],function(t){return t}),e.config({deps:["main","KITE/main","DOT/main","PHET_CORE/main"],paths:{underscore:"../../sherpa/lodash-2.4.1",jquery:"../../sherpa/jquery-2.1.0",SCENERY:".",KITE:"../../kite/js",DOT:"../../dot/js",PHET_CORE:"../../phet-core/js",AXON:"../../axon/js",text:"../../sherpa/text"},shim:{underscore:{exports:"_"},jquery:{exports:"$"}},urlArgs:(new Date).getTime()}),i("config",function(){}),window.scenery=e("main"),window.kite=e("KITE/main"),window.dot=e("DOT/main"),window.core=e("PHET_CORE/main"),scenery.Util.polyfillRequestAnimationFrame()}();
//# sourceMappingURL=scenery.min.js.map