<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>

  <meta name="viewport"
        content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>

  <meta name="apple-mobile-web-app-capable" content="yes">

  <title>Test PixiNode</title>

  <!-- jQuery and LoDash are dependencies -->
  <script src="../../../sherpa/pixi-v3.0.0-rc1-dev.js"></script>
  <script src="../../../sherpa/stats-r12.js"></script>
  <script src="../../../sherpa/jquery-2.1.0.js"></script>
  <script src="../../../sherpa/lodash-2.4.1.min.js"></script>
  <script src="../../../sherpa/has-70898c7.js"></script>
  <script src="../../../assert/js/assert.js"></script>
  <script src="../../../sherpa/rAF.js"></script>

  <!--Turn these assertions on!-->
  <!--<script type="text/javascript">-->
  <!--window.assertions.enableAssert();-->
  <!--window.assertions.enableAssertSlow();-->
  <!--</script>-->

  <script data-main="../../js/config.js" src="../../../sherpa/require-2.1.11.js"></script>

  <style type="text/css">
    html, body {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      background-color: white;
    }

  </style>
</head>

<body>


<script>


  require( [ 'config' ], function() {
    require( [
      'main',
      'KITE/main',
      'DOT/main',
      'AXON/main',
      'PHET_CORE/main',
      'image!ENERGY_SKATE_PARK_BASICS/skater-icon.png'
    ], function( scenery, kite, dot, axon, phetCore, skaterImage ) {
      window.scenery = scenery;
      window.kite = kite;
      window.dot = dot;
      window.axon = axon;
      window.phetCore = phetCore;

      // Create a Node as the root of our tree (it can contain children)
      var scene = new scenery.Node();

      // Create a display using this root node, using our existing div
      var display = new scenery.Display( scene );
      document.body.appendChild( display.domElement );

      var path = new scenery.Path( kite.Shape.rectangle( 0, 0, 200, 100 ), { fill: 'yellow' } );

      path.addChild( new scenery.Text( 'Hello!', {
        top: 0,
        left: 0,
        fill: '#000000',
        font: '20px sans-serif'
      } ) );
      var skaters = [];
      for ( var i = 0; i < 50; i++ ) {
        skaters.push( new scenery.Image( skaterImage, { x: i * 2, y: i * 2 } ) );
      }
      var skatersParent = new scenery.Node( {
        children: skaters
      } );

      var sceneryRootNode = new scenery.Node( {
        children: [
          path,
          new scenery.Image( skaterImage ),
          skatersParent
        ]
      } );

      // Choose one or the other of the lines below.
      var pixiNode = new scenery.PixiNode( sceneryRootNode );
      scene.addChild( pixiNode );
//      scene.addChild( sceneryRootNode );

      // Paint any changes (in this case, our text).
      display.updateDisplay();

      var stats = new Stats();
      stats.setMode( 0 ); // 0: fps, 1: ms

      // align top-left
      stats.domElement.style.position = 'absolute';
      stats.domElement.style.left = '0px';
      stats.domElement.style.top = '0px';
      stats.domElement.style.zIndex = '99';

      var update = function update() {
        window.requestAnimationFrame( update );
        stats.begin();
        path.x = Math.sin( Date.now() / 1000 ) * 100 + 100;
        display.updateDisplay();
        if ( typeof(pixiNode) !== 'undefined' ) {
          pixiNode.render();
        }

        for ( var i = 0; i < skatersParent.children.length; i++ ) {
          skatersParent.children[ i ].y = Math.cos( Date.now() / 1000 + i / 10 ) * 100 + 200;
        }
        stats.end();
      };
      window.requestAnimationFrame( update );
      document.body.appendChild( stats.domElement );
    } );
  } );
</script>


</body>
</html>
