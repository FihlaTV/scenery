<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1">

  <title>Troubleshooting information</title>
  
  <script src="html5-shiv.js"></script>
  <!-- <script src="http://modernizr.com/downloads/modernizr-latest.js"></script> -->
  <script src="modernizr-custom-min.js"></script>
  
  <style type="text/css">
    html, body {

    }
  </style>
</head>

<body>
  
  <h1>Troubleshooting information</h1>
  
  <script src="jquery-1.8.3.min.js"></script>
  <script src="lodash.min-1.0.0-rc.3.js"></script>
  
  <script>
    var container = document.getElementById( 'info' );
    
    function addText( label, text, styles ) {
      var $p = $( '<p>' ).css( 'padding', '0' ).css( 'margin', '0' );
      $p.append( $( '<span>' ).text( label + ': ' ).css( 'font-weight', 'bold' ) );
      $p.append( $( '<span>' ).text( '' + text ) );
      if ( styles ) {
        $p.css( styles );
      }
      $( document.body ).append( $p );
    }
    function addIfDefined( label, text, styles ) {
      if ( text !== undefined ) {
        addText( label, text, styles );
      }
    }
    function addIfTruthy( label, text, styles ) {
      if ( text ) {
        addText( label, text, styles );
      }
    }
    
    var canvas, context, backingStorePixelRatio;
    
    try {
      canvas = document.createElement( 'canvas' );
      context = canvas.getContext( '2d' );
      backingStorePixelRatio = context.webkitBackingStorePixelRatio ||
                               context.mozBackingStorePixelRatio ||
                               context.msBackingStorePixelRatio ||
                               context.oBackingStorePixelRatio ||
                               context.backingStorePixelRatio || 1;
    } catch ( e ) {
      
    }
    
    var criticalFeaturesMissing = [];
    var featuresMissing = [];
    _.each( [
      'hsla',
      'opacity',
      'rgba',
      'cssgradients',
      'csstransforms',
      'applicationcache',
      'canvas',
      'canvastext',
      'audio',
      'inlinesvg',
      'svg',
      'svgclippaths',
      'json'
    ], function( featureName ) {
      if ( !Modernizr[featureName] ) {
        criticalFeaturesMissing.push( featureName );
        featuresMissing.push( featureName );
      }
    } );
    _.each( [
      'borderradius',
      'boxshadow',
      'flexbox',
      'hsla',
      'opacity',
      'rgba',
      'cssanimations',
      'generatedcontent',
      'csstransforms3d',
      'applicationcache',
      'history',
      'video',
      'localstorage',
      'postmessage',
      'webworkers',
      'websockets',
      'svgclippaths',
      'touch',
      'webgl',
      'fullscreen',
      'raf', // requestAnimationFrame
      'svgfilters'
    ], function( featureName ) {
      if ( !Modernizr[featureName] ) {
        featuresMissing.push( featureName );
      }
    } );
    if ( !window.Float32Array ) { featuresMissing.push( 'Float32Array' ); }
    if ( !window.Float64Array ) { featuresMissing.push( 'Float64Array' ); }
    if ( !( Array.prototype &&
            Array.prototype.every &&
            Array.prototype.filter &&
            Array.prototype.forEach &&
            Array.prototype.indexOf &&
            Array.prototype.lastIndexOf &&
            Array.prototype.map &&
            Array.prototype.some &&
            Array.prototype.reduce &&
            Array.prototype.reduceRight &&
            Array.isArray ) ) {
      featuresMissing.push( 'es5array' );
      criticalFeaturesMissing.push( 'es5array' );
    }
    if ( !( Object.keys &&
            Object.create &&
            Object.getPrototypeOf &&
            Object.getOwnPropertyNames &&
            Object.isSealed &&
            Object.isFrozen &&
            Object.isExtensible &&
            Object.getOwnPropertyDescriptor &&
            Object.defineProperty &&
            Object.defineProperties &&
            Object.seal &&
            Object.freeze &&
            Object.preventExtensions ) ) {
      featuresMissing.push( 'es5object' );
      criticalFeaturesMissing.push( 'es5object' );
    }
    
    var flags = [];
    if ( window.navigator.pointerEnabled ) { flags.push( 'pointerEnabled' ); }
    if ( window.navigator.msPointerEnabled ) { flags.push( 'msPointerEnabled' ); }
    if ( !window.navigator.onLine ) { flags.push( 'offline' ); }
    if ( ( window.devicePixelRatio || 1 ) / backingStorePixelRatio !== 1 ) { flags.push( 'pixelRatioScaling' ); }
    
    addIfTruthy( 'Required features missing', criticalFeaturesMissing.join( ', ' ), { color: 'red' } );
    addIfTruthy( 'Features missing', featuresMissing.join( ', ' ) );
    addIfTruthy( 'Flags', flags.join( ', ' ) );
    addIfTruthy( 'User Agent', window.navigator.userAgent );
    // addIfTruthy( 'window.navigator.platform', window.navigator.platform );
    // addIfTruthy( 'window.navigator.appName', window.navigator.appName );
    // addIfTruthy( 'window.navigator.appVersion', window.navigator.appVersion );
    addIfTruthy( 'Language', window.navigator.language );
    // addIfTruthy( 'window.navigator.oscpu', window.navigator.oscpu );
    // addIfTruthy( 'window.navigator.vendor', window.navigator.vendor );
    // addIfTruthy( 'window.navigator.vendorSub', window.navigator.vendorSub );
    // addIfTruthy( 'window.navigator.product', window.navigator.product );
    // addIfTruthy( 'window.navigator.appCodeName', window.navigator.appCodeName );
    addIfDefined( 'Window', window.innerWidth + 'x' + window.innerHeight );
    addIfDefined( 'Pixel Ratio', ( window.devicePixelRatio || 1 ) + '/' + backingStorePixelRatio );

  </script>

</body>
</html>
