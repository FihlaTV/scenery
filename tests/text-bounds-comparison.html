<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>

  <title>Text Bounds Comparison - Scenery</title>
  
  <!-- jQuery and LoDash are dependencies -->
  <script src="../contrib/jquery-1.8.3.min.js"></script>
  <script src="../contrib/lodash.min-1.0.0-rc.3.js"></script>
  
  <!-- Canvg for SVG to Canvas -->
  <script src="../contrib/canvg/rgbcolor.js"></script>
  <script src="../contrib/canvg/canvg.js"></script>
  
  <!-- Our code, in either the concatenated 'with comments' version or the minified version -->
  <script src="../scenery.js"></script>
  <!-- <script src="../scenery-min.js"></script> -->
  
  <style type="text/css">
    /* Let content go to the edges */
    html, body {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
    }
    
    /* Have the #main div cover the entire viewport */
    .scene {
      position: relative;
      float: left;
    }

  </style>
</head>

<body>
  
  <div id="main" class="scene"></div>
  
  <script type="text/javascript">
  
  var scene = new scenery.Scene( $( '#main' ) );
  var padding = 2;
  
  function boundsSnapshot( textNode ) {
    
    var canvasBounds = textNode.accurateCanvasBounds();
    var svgBounds = textNode.approximateSVGBounds();
    var domBounds = textNode.approximateDOMBounds();
    
    var unionBounds = canvasBounds.union( svgBounds ).union( domBounds );
    
    // align the container so that our upper-left corner of the union bounds is at 0,0
    var container = new scenery.Node( {
      x: -unionBounds.minX,
      y: -unionBounds.minY
    } );
    
    container.addChild( new scenery.Path( {
      shape: scenery.Shape.bounds( canvasBounds ),
      fill: '#aaaaaa'
    } ) );
    container.addChild( new scenery.Path( {
      shape: scenery.Shape.bounds( svgBounds ),
      fill: 'rgba(255,0,0,0.4)'
    } ) );
    container.addChild( new scenery.Path( {
      shape: scenery.Shape.bounds( domBounds ),
      fill: 'rgba(0,0,255,0.4)'
    } ) );
    container.addChild( textNode );
    textNode.fill = '#ffffff';
    
    return container;
  }
  
  function wrapScene( node ) {
    var $main = $( '<div>' );
    $main.width( Math.ceil( node.width + 2 * padding ) );
    $main.height( Math.ceil( node.height + 2 * padding ) );
    
    var scene = new scenery.Scene( $main );
    scene.addChild( node );
    node.x += padding;
    node.y += padding;
    scene.updateScene();
    return $main.addClass( 'scene' )[0];
  }
  
  var queue = [];
  var started = false;
  function process( string, options ) {
    queue.push( {
      string: string,
      options: options
    } );
    if ( !started ) {
      started = true;
      var id = window.setInterval( function() {
        if ( queue.length === 0 ) {
          window.clearInterval( id );
        } else {
          var ob = queue.shift();
          document.body.appendChild( wrapScene( boundsSnapshot( new scenery.Text( ob.string, ob.options ) ) ) );
        }
      }, 4 );
    }
  }
  
  var unicodeTestStrings = [
    "A",
    "b",
    "m",
    "x",
    'Q',
    "New\nLine?",
    "New\r\nLine+?",
    "Or\tTabs?",
    "\u222b",
    "\ufdfa",
    "\u00a7",
    "\u00C1",
    "\u00FF",
    "\u03A9",
    "\u0906",
    "\u79C1",
    "\u9054",
    "A\u030a\u0352\u0333\u0325\u0353\u035a\u035e\u035e",
    "0\u0489",
    "\u2588"
  ];
  
  _.each( unicodeTestStrings, function( string ) {
    process( string, { fontSize: 60 } );
  } );
  
  </script>

</body>
</html>
