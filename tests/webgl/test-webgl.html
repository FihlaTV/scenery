<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1"/>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="phet-sim-level" content="production">
  <title>Simulation Test WebGL</title>

  <!-- jQuery and LoDash are dependencies -->
  <script src="../../../assert/js/assert.js"></script>
  <script src="../../../sherpa/jquery-2.1.0.min.js"></script>
  <script src="../../../sherpa/lodash-2.4.1.min.js"></script>
  <script src="../../../sherpa/has.js"></script>
  <script src="../../../sherpa/stats-r12.js"></script>

  <!-- Parse query parameters, so we can easily subset the tests.-->
  <script src="../../../phetcommon/js/util/query-parameters.js"></script>

  <script type="text/javascript">
    window.assertions.enableAssert();
  </script>

  <!-- Our code, in either the concatenated 'with comments' version or the minified version -->
  <script data-main="../../js/config.js" src="../../../sherpa/require-2.1.11.js"></script>

</head>

<body>
<canvas id="canvas" style="position: absolute;top:0px; left:0px"></canvas>
<button id="add-rectangle" style="position: absolute;top:100px; left:0px">Add Rectangle</button>

<script>

  document.onready = function() {
    require( ["../js/display/webgl/TestWebGL"], function( TestWebGL ) {
      var testWebGL = new TestWebGL();
      testWebGL.events.on( 'step', function() {
        // Show one oscillation per second so it is easy to count time
        var x = 0.2 * Math.cos( Date.now() / 1000 * 2 * Math.PI );
        for ( var i = 0; i < testWebGL.rectangles.length; i++ ) {
          var rectangle = testWebGL.rectangles[i];
          rectangle.setXWidth( rectangle.initialState.x + x, rectangle.initialState.width );
        }

        for ( var mm = 0; mm < testWebGL.stars.length / 2; mm++ ) {
          var star = testWebGL.stars[mm];
          star.setStar( star.initialState._x, star.initialState._y, star.initialState._innerRadius, star.initialState._outerRadius, star.initialState._totalAngle + Date.now() / 1000 );
        }
      } );
      testWebGL.start();

      document.getElementById( 'add-rectangle' ).onclick = function() {
        for ( var i = 0; i < 1; i++ ) {
          testWebGL.addRectangle();
        }
        testWebGL.bindVertexBuffer();
        testWebGL.bindColorBuffer();
      };

      var numRectangles = 500;
      for ( var i = 0; i < numRectangles; i++ ) {
        testWebGL.addRectangle();
      }

      var numStars = 500;
      for ( var k = 0; k < numStars; k++ ) {
        testWebGL.addStar();
      }

      testWebGL.bindVertexBuffer();
      testWebGL.bindColorBuffer();
    } );
  };

</script>

</body>
</html>
