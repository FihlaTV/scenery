<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>

  <title>DOM Rasterization test for Scenery</title>

  <script src="../../sherpa/jquery-2.1.0.js"></script>
  <script src="../../sherpa/lodash-2.4.1.min.js"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
    }
    canvas {
      margin-top: 130px;
    }
  </style>
</head>
<body>

<div id="div">
  <div style="display: block; position: absolute; left: 0px; top: 0px; pointer-events: none; transform-origin: left top 0px; z-index: 20; width: 100px; height: 100px; border-radius: 50px; transform: matrix(1, 0, 0, 1, 3, 3); background-color: blue;"><div style="display: block; position: absolute; left: -3px; top: -3px; pointer-events: none; border: 6px solid red; width: 94px; height: 94px; border-radius: 53px;"></div></div>
  <div style="display: block; position: absolute; pointer-events: none; left: 0px; top: 0px; transform-origin: left top 0px; z-index: 40; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 30px; line-height: normal; font-family: sans-serif; color: white; width: 69.990234375px; height: 33px; transform: matrix(1, 0, 0, 1, 18.0048828125, 36.5);" dir="ltr">DOM</div>
</div>

<script>
  var canvas = document.createElement( 'canvas' );
  var context = canvas.getContext( '2d' );
  document.body.appendChild( canvas );
  canvas.width = 106;
  canvas.height = 106;

  var data = '<svg xmlns="http://www.w3.org/2000/svg" width="106" height="106">' +
             '<foreignObject width="100%" height="100%">' +
             '<div xmlns="http://www.w3.org/1999/xhtml">' +
             document.getElementById( 'div' ).innerHTML +
             // '<div style="display: block; position: absolute; left: 0px; top: 0px; pointer-events: none; transform-origin: left top 0px; z-index: 20; width: 100px; height: 100px; border-radius: 50px; transform: matrix(1, 0, 0, 1, 3, 3); background-color: blue;"><div style="display: block; position: absolute; left: -3px; top: -3px; pointer-events: none; border: 6px solid red; width: 94px; height: 94px; border-radius: 53px;"></div></div>' +
             // '<div style="display: block; position: absolute; pointer-events: none; left: 0px; top: 0px; transform-origin: left top 0px; z-index: 40; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 30px; line-height: normal; font-family: sans-serif; color: white; width: 69.990234375px; height: 33px; transform: matrix(1, 0, 0, 1, 18.0048828125, 36.5);" dir="ltr">DOM</div>' +
             '</div>' +
             '</foreignObject>' +
             '</svg>';

  var DOMURL = window.URL || window.webkitURL || window;

  var img = new Image();
  var svg = new Blob( [ data ], { type: 'image/svg+xml;charset=utf-8' } );
  var url = DOMURL.createObjectURL( svg );

  img.onload = function () {
    context.drawImage( img, 0, 0 );
    DOMURL.revokeObjectURL( url );
  }

  img.src = url;
</script>
</body>
</html>
