<!DOCTYPE HTML>
<html>

<head>
  <!-- styling for the accessibility DOM. Mostly unnecessary as this is a hidden parallel structure. -->
  <style>
    .hidden {
      visibility: hidden;
    }

    #bluePullerGroup {
      position: relative;
    }

    #bluePuller1 {
      position: absolute;
    }

    #bluePuller2 {
      position: absolute;
      left: 100px;
      top: 0px;
    }

    #bluePuller3 {
      position: absolute;
      left: 200px;
      top: 0px;
    }

    #bluePuller4 {
      position: absolute;
      left: 300px;
      top: 0px;
    }

    #redPullerGroup {
      position: relative;
      top: -135px;
      left: 400px;
    }

    #redPuller1 {
      position: absolute;
    }

    #redPuller2 {
      position: absolute;
      left: 100px;
      top: 0px;
    }

    #redPuller3 {
      position: absolute;
      left: 200px;
      top: 0px;
    }

    #redPuller4 {
      position: absolute;
      left: 300px;
      top: 0px;
    }

  </style>

  <!-- scripting for the prototype.  Mostly critical for handling key strokes. -->
  <script>

    /**
     * Enter a group with children.  Children by default are not part of the selected tab order.  Entering the group
     * with this method will bring them into the tab order.
     */
    function enterGroup( event, parent, firstChildId ) {
      // on enter or spacebar, step in to the selected group.
      if ( event.keyCode === 13 || event.keyCode === 32 ) {

        // make sure that all children can be tabbed to
        for ( var i = 0; i < parent.children.length; i++ ) {
          parent.children[ i ].tabIndex = "0";
        }

        // set focus to the first child
        document.getElementById( firstChildId ).focus();

        // set the active descendant to the first child
        parent.setAttribute( "aria-activedescendant", firstChildId );
      }
    }

    /**
     * Exit the group.  This is fired on focus of the next element in the DOM after the last child of a group, and
     * removes all children of a parent from the tab order.  This must be called on focus for the parent and the next
     * element in the DOM so that exiting the group will reset the child tab indicies.
     *
     * TODO: This needs to be replaced with a function that resets all tab indicies whenever a main div receives foucs.
     */
    function exitGroup( parentId ) {
      var parent = document.getElementById( parentId );
      for ( var i = 0; i < parent.children.length; i++ ) {
        parent.children[ i ].tabIndex = "-1";
      }
    }

    // function to handle selection of a group descendant
    function handleSelection( element, parent ) {
      // on enter or spacebar, select the element
      var parentId = parent.id;
      var elementId = element.id;

      parent.setAttribute( "aria-activedescendant", elementId );
    }

    // function to toggle button with two values.
    function toggleButton( event, button, values ) {
      // if enter or spacebar, press the button.
      if ( event.keyCode === 13 || event.keyCode === 32 ) {
        // if the button is not disabled, press.
        if ( !button.getAttribute( "aria-disabled" ) ) {
          if ( button.value === values[ 0 ] ) {
            button.value = values[ 1 ];
          }
          else {
            button.value = values[ 0 ];
          }
        }
      }
    }

    /**
     * Processes drag events triggered by a draggable.  Function stores the active draggable so that the grid may
     * store the position.
     *
     * @param event - the event object
     * @param child - the child element in drag.
     */
    function handleGrab( event, child ) {
      // TODO: Is there a way to get the active draggable?
      // this.activeDraggable = child;
    }

  </script>
</head>

<body>

<h1 id="simTitle"> Forces and Motion Basics </h1>

<!-- Testing application role.  Unsure how appropriate it is, take a peak at
https://www.marcozehe.de/2012/02/06/if-you-use-the-wai-aria-role-application-please-do-so-wisely/
for description of when role="application" is and is not appropriate.

Everything in the role='application' should include the main play area.  Other features of the sim should exist
outside of this role.
-->
<div role="application">

  <!--Description of sim visual state at launch for the sim screen.-->
  <div tabindex="-1" aria-describedby="screen_overview">
    <p id="screen_overview">
      There is a heavily loaded cart on wheels sitting on a track. Attached to the left side of the cart is a thick 8
      foot rope with 4 large knots spaced at equal intervals. Standing near this knotted rope is a group of 4 people.
      On the opposite side of the cart, a similar rope with 4 large knots is attached to the right side of the cart.
      There is another group of 4 people - they are standing near this other rope. The center position of the cart has
      been marked on the ground.
    </p>
  </div>

  <!-- aria-live region where the tug of war simulation occurs.  aria-atomic="true" will present the entire region
  whenever updates are detected. -->
  <div id="tugOfWarLiveRegion" aria-live="polite" aria-atomic="true">
    <table border="1" tabindex="-1" role="grid" id="ropeTable" aria-labelledby="aria-tugOfWarRopeLabel"
           aria-activedescendant="ropeKnot1">
      <tr role="row">
        <td id="ropeKnot1" role="gridcell" class="target" aria-labelledby="ropeKnot1Label" aria-dropeffect="none"
            aria-selected="false">
          <p class="hidden" id="ropeKnot1Label">Inner left rope position is empty</p>
        </td>
        <td id="ropeKnot2" role="gridcell" class="target" aria-labelledby="ropeKnot2Label" aria-dropeffect="none"
            aria-selected="false">
          <p class="hidden" id="ropeKnot2Label">Second left rope position is empty</p>
        </td>
        <td id="ropeKnot3" role="gridcell" class="target" aria-labelledby="ropeKnot3Label" aria-dropeffect="none"
            aria-selected="false">
          <p class="hidden" id="ropeKnot3Label">Third left rope position is empty</p>
        </td>
        <td id="ropeKnot4" role="gridcell" class="target" aria-labelledby="ropeKnot3Label" aria-dropeffect="none"
            aria-selected="false">
          <p class="hidden" id="ropeKnot4Label">Outer left rope position is empty</p>
        </td>
      </tr>
      <tr role="row">
        <td id="rightRopeKnot1" role="gridcell" class="target" aria-labelledby="rightRopeKnot1Label"
            aria-dropeffect="none"
            aria-selected="false">
          <p class="hidden" id="rightRopeKnot1Label">Inner right rope position is empty</p>
        </td>
        <td id="rightRopeKnot2" role="gridcell" class="target" aria-labelledby="rightRopeKnot2Label"
            aria-dropeffect="none"
            aria-selected="false">
          <p class="hidden" id="rightRopeKnot2Label">Second right rope position is empty</p>
        </td>
        <td id="rightRopKnot3" role="gridcell" class="target" aria-labelledby="rightRopeKnot3Label"
            aria-dropeffect="none"
            aria-selected="false">
          <p class="hidden" id="rightRopeKnot3Label">Third right rope position is empty</p>
        </td>
        <td id="rightRopeKnot4" role="gridcell" class="target" aria-labelledby="rightRopeKnot3Label"
            aria-dropeffect="none"
            aria-selected="false">
          <p class="hidden" id="rightRopeKnot4Label">Outer right rope position is empty</p>
        </td>
      </tr>
    </table>
  </div>

  <!-- Blue Puller Group -->
  <div tabindex="0" role="group" id="bluePullerGroup" class="pullerGroup" aria-describedby="pullerGroup1_description"
       aria-activedescendant="bluePuller1" onkeypress="enterGroup(event, this, 'bluePuller1' )"
       onfocus="exitGroup( 'bluePullerGroup' )">
    <div id="bluePuller1" role="button" aria-dropeffect="none" class="bluePuller" aria-labelledby="bluePuller1_label"
         aria-grabbed="false">
      <img src="pull_figure_small_BLUE_0.png" alt="Grabable blue person">
    </div>
    <p class="hidden" id="bluePuller1_label">Strong person</p>

    <div id="bluePuller2" role="button" aria-dropeffect="none" class="bluePuller" aria-labelledby="bluePuller2_label"
         aria-grabbed="false">
      <img src="pull_figure_small_BLUE_0.png" alt="Grabable blue person">
    </div>
    <p class="hidden" id="bluePuller2_label">Strong person</p>

    <div id="bluePuller3" role="button" aria-dropeffect="none" class="bluePuller" aria-labelledby="bluePuller3_label"
         aria-grabbed="false">
      <img src="pull_figure_BLUE_0.png" alt="Grabbable stronger blue person">
    </div>
    <p class="hidden" id="bluePuller3_label">Stronger person</p>

    <div id="bluePuller4" role="button" aria-dropeffect="none" class="bluePuller" aria-labelledby="bluePuller4_label"
         aria-grabbed="false">
      <img src="pull_figure_lrg_BLUE_0.png" alt="Grabbable strongest blue person">
    </div>
    <p class="hidden" id="bluePuller4_label">Strongest person</p>
  </div>

  <!-- Red Puller Group -->
  <div tabindex="0" role="group" id="redPullerGroup" aria-describedby="redGroup_description"
       aria-activedescendant="redPuller1" onfocus="exitGroup( 'redPullerGroup' )"
       onkeypress="enterGroup(event, this, 'redPuller1' )">
    <div id="redPuller1" role="button" aria-dropeffect="none" class="redPuller" aria-labelledby="redPuller1_label"
         aria-grabbed="false">
      <img src="pull_figure_small_RED_0.png" alt="Grabbable red person">
    </div>
    <p class="hidden" id="redPuller1_label">Strong person</p>

    <div id="redPuller2" role="button" aria-dropeffect="none" class="redPuller" aria-labelledby="redPuller2_label"
         aria-grabbed="false">
      <img src="pull_figure_small_RED_0.png" alt="Grabbable red person">
    </div>
    <p class="hidden" id="redPuller2_label">Strong person</p>

    <div id="redPuller3" role="button" aria-dropeffect="none" class="redPuller" aria-labelledby="redPuller3_label"
         aria-grabbed="false">
      <img src="pull_figure_RED_0.png" alt="Grabbable stronger red person">
    </div>
    <p class="hidden" id="redPuller3_label">Stronger person</p>

    <div id="redPuller4" role="button" aria-dropeffect="none" class="redPuller" aria-labelledby="redPuller4_label"
         aria-grabbed="false">
      <img src="pull_figure_lrg_RED_0.png" alt="Grabbable strongest red person">
    </div>
    <p class="hidden" id="redPuller4_label">Strongest person</p>
  </div>

  <!-- Use aria-disabled to disable buttons so that they stay in the tab order, but can be disabled.. -->
  <input id="startButton" value="GO!" type="button" tabindex="0" aria-disabled="true"
         onkeydown="toggleButton( event, this, ['Go!', 'Pause'] )" onfocus="exitGroup('redPullerGroup')"/><br>
  <input id="returnButton" value="Return" type="button" tabindex="0" aria-disabled="true"/><br>

  <input id="sumOfForcesCheckBox" value="Sum Of Forces" type="checkbox">Sum of Forces<br>
  <input id="valuesCheckBox" value="Values" type="checkbox">Values<br>

  <input id="resetButton" value="Reset" type="button" tabindex="0"><br>
  <input id="muteButton" value="Mute" type="button" tabindex="0"
         onkeydown="toggleButton( event, this, ['Mute', 'Unmute'])"><br>

  <div id="phetMenu" tabindex="0" onkeydown="enterGroup( event, this, 'phetWebsite')">
    <a href="http://phet.colorado.edu" tabindex="-1" id="phetWebsite">PhET Website...</a>
    <a href="http://phet.colorado.edu/files/troubleshooting/?sim=Forces%20and%20Motion%3A%20Basics&version=1.1.5-dev.4&url=http%3A%2F%2Fwww.colorado.edu%2Fphysics%2Fphet%2Fdev%2Fhtml%2Fforces-and-motion-basics%2F1.1.5-dev.4%2Fforces-and-motion-basics_en.html%3Fscreens%3D1"
       tabindex="-1">Report a Problem...</a>

    <div tabindex="-1">About Dialog</div>
  </div>
</div>
</body>

</html>